{"version":3,"sources":["webpack://ConnectyCube/webpack/universalModuleDefinition","webpack://ConnectyCube/webpack/bootstrap","webpack://ConnectyCube/./node_modules/@babel/runtime/helpers/interopRequireDefault.js","webpack://ConnectyCube/./node_modules/@babel/runtime/helpers/classCallCheck.js","webpack://ConnectyCube/./node_modules/@babel/runtime/helpers/createClass.js","webpack://ConnectyCube/./lib/cubeInternalUtils.js","webpack://ConnectyCube/./lib/cubeConfig.js","webpack://ConnectyCube/./lib/cubeDependencies.js","webpack://ConnectyCube/./node_modules/@babel/runtime/helpers/typeof.js","webpack://ConnectyCube/./node_modules/@xmpp/xml/index.js","webpack://ConnectyCube/./lib/videocalling/cubeWebRTCConstants.js","webpack://ConnectyCube/./lib/messaging/cubeChatInternalUtils.js","webpack://ConnectyCube/(webpack)/buildin/module.js","webpack://ConnectyCube/(webpack)/buildin/global.js","webpack://ConnectyCube/./node_modules/crypto-js/core.js","webpack://ConnectyCube/./node_modules/@xmpp/events/index.js","webpack://ConnectyCube/./node_modules/events/events.js","webpack://ConnectyCube/./node_modules/@xmpp/jid/index.js","webpack://ConnectyCube/./lib/videocalling/cubeWebRTCHelpers.js","webpack://ConnectyCube/./node_modules/@xmpp/events/lib/TimeoutError.js","webpack://ConnectyCube/./node_modules/@xmpp/xml/lib/Element.js","webpack://ConnectyCube/./node_modules/ltx/lib/escape.js","webpack://ConnectyCube/./node_modules/@xmpp/error/index.js","webpack://ConnectyCube/./node_modules/@babel/runtime/helpers/defineProperty.js","webpack://ConnectyCube/./node_modules/crypto-js/hmac.js","webpack://ConnectyCube/./node_modules/@xmpp/connection/index.js","webpack://ConnectyCube/./node_modules/@xmpp/events/lib/delay.js","webpack://ConnectyCube/./node_modules/@xmpp/jid/lib/JID.js","webpack://ConnectyCube/./node_modules/@xmpp/jid/lib/escaping.js","webpack://ConnectyCube/./node_modules/@xmpp/xml/lib/Parser.js","webpack://ConnectyCube/./node_modules/@xmpp/xml/lib/XMLError.js","webpack://ConnectyCube/./node_modules/@xmpp/middleware/lib/Context.js","webpack://ConnectyCube/external \"node-fetch\"","webpack://ConnectyCube/./lib/videocalling/cubeRTCPeerConnection.js","webpack://ConnectyCube/./node_modules/@babel/runtime/regenerator/index.js","webpack://ConnectyCube/./node_modules/@babel/runtime/helpers/asyncToGenerator.js","webpack://ConnectyCube/./node_modules/fbemitter/lib/EmitterSubscription.js","webpack://ConnectyCube/./node_modules/fbjs/lib/invariant.js","webpack://ConnectyCube/./lib/videocalling_conference/cubeConferenceConstansts.js","webpack://ConnectyCube/./lib/cubeMain.js","webpack://ConnectyCube/./lib/cubeProxy.js","webpack://ConnectyCube/./node_modules/buffer/index.js","webpack://ConnectyCube/./node_modules/base64-js/index.js","webpack://ConnectyCube/./node_modules/ieee754/index.js","webpack://ConnectyCube/./node_modules/isarray/index.js","webpack://ConnectyCube/./node_modules/crypto-js/hmac-sha1.js","webpack://ConnectyCube/./node_modules/crypto-js/sha1.js","webpack://ConnectyCube/./node_modules/crypto-js/hmac-sha256.js","webpack://ConnectyCube/./node_modules/crypto-js/sha256.js","webpack://ConnectyCube/./node_modules/@xmpp/client/react-native.js","webpack://ConnectyCube/./node_modules/@xmpp/client-core/index.js","webpack://ConnectyCube/./node_modules/@xmpp/client-core/lib/Client.js","webpack://ConnectyCube/./node_modules/@xmpp/events/lib/timeout.js","webpack://ConnectyCube/./node_modules/@xmpp/events/lib/promise.js","webpack://ConnectyCube/./node_modules/@xmpp/events/lib/Deferred.js","webpack://ConnectyCube/./node_modules/@xmpp/jid/lib/parse.js","webpack://ConnectyCube/./node_modules/@xmpp/xml/lib/x.js","webpack://ConnectyCube/./node_modules/ltx/lib/Element.js","webpack://ConnectyCube/./node_modules/ltx/lib/equal.js","webpack://ConnectyCube/./node_modules/ltx/lib/clone.js","webpack://ConnectyCube/./node_modules/ltx/lib/parsers/ltx.js","webpack://ConnectyCube/./node_modules/inherits/inherits_browser.js","webpack://ConnectyCube/./node_modules/@xmpp/connection/lib/StreamError.js","webpack://ConnectyCube/./node_modules/@xmpp/connection/lib/util.js","webpack://ConnectyCube/./node_modules/@xmpp/client/lib/getDomain.js","webpack://ConnectyCube/./node_modules/@xmpp/reconnect/index.js","webpack://ConnectyCube/./node_modules/@xmpp/websocket/index.js","webpack://ConnectyCube/./node_modules/@xmpp/websocket/lib/Connection.js","webpack://ConnectyCube/./node_modules/@xmpp/websocket/lib/Socket.js","webpack://ConnectyCube/./node_modules/@xmpp/websocket/lib/FramedParser.js","webpack://ConnectyCube/./node_modules/@xmpp/middleware/index.js","webpack://ConnectyCube/./node_modules/koa-compose/index.js","webpack://ConnectyCube/./node_modules/@xmpp/middleware/lib/IncomingContext.js","webpack://ConnectyCube/./node_modules/@xmpp/middleware/lib/OutgoingContext.js","webpack://ConnectyCube/./node_modules/@xmpp/stream-features/index.js","webpack://ConnectyCube/./node_modules/@xmpp/stream-features/route.js","webpack://ConnectyCube/./node_modules/@xmpp/iq/caller.js","webpack://ConnectyCube/./node_modules/@xmpp/id/index.js","webpack://ConnectyCube/./node_modules/@xmpp/middleware/lib/StanzaError.js","webpack://ConnectyCube/./node_modules/@xmpp/iq/callee.js","webpack://ConnectyCube/./node_modules/@xmpp/resolve/index.js","webpack://ConnectyCube/./node_modules/@xmpp/resolve/resolve.js","webpack://ConnectyCube/./node_modules/@xmpp/resolve/lib/http.js","webpack://ConnectyCube/./node_modules/@xmpp/xml/lib/parse.js","webpack://ConnectyCube/./node_modules/@xmpp/resolve/lib/alt-connections.js","webpack://ConnectyCube/./node_modules/@xmpp/sasl/index.js","webpack://ConnectyCube/./node_modules/@xmpp/base64/browser.js","webpack://ConnectyCube/./node_modules/@xmpp/sasl/lib/SASLError.js","webpack://ConnectyCube/./node_modules/saslmechanisms/main.js","webpack://ConnectyCube/./node_modules/saslmechanisms/lib/factory.js","webpack://ConnectyCube/./node_modules/@xmpp/resource-binding/index.js","webpack://ConnectyCube/./node_modules/@xmpp/session-establishment/index.js","webpack://ConnectyCube/./node_modules/@xmpp/sasl-anonymous/index.js","webpack://ConnectyCube/./node_modules/sasl-anonymous/main.js","webpack://ConnectyCube/./node_modules/sasl-anonymous/lib/mechanism.js","webpack://ConnectyCube/./node_modules/@xmpp/sasl-plain/index.js","webpack://ConnectyCube/./node_modules/sasl-plain/main.js","webpack://ConnectyCube/./node_modules/sasl-plain/lib/mechanism.js","webpack://ConnectyCube/external \"form-data\"","webpack://ConnectyCube/./lib/cubeAuth.js","webpack://ConnectyCube/./lib/cubeUsers.js","webpack://ConnectyCube/./lib/cubeStorage.js","webpack://ConnectyCube/./lib/cubePushNotifications.js","webpack://ConnectyCube/./lib/cubeData.js","webpack://ConnectyCube/./lib/cubeAddressBook.js","webpack://ConnectyCube/./lib/messaging/cubeChat.js","webpack://ConnectyCube/./node_modules/@babel/runtime/helpers/readOnlyError.js","webpack://ConnectyCube/./lib/messaging/cubeChatHelpers.js","webpack://ConnectyCube/./lib/messaging/cubeStreamManagement.js","webpack://ConnectyCube/./lib/messaging/cubeContactList.js","webpack://ConnectyCube/./lib/messaging/cubePrivacyList.js","webpack://ConnectyCube/./lib/messaging/cubeMultiUserChat.js","webpack://ConnectyCube/./lib/messaging/cubeDialog.js","webpack://ConnectyCube/./lib/messaging/cubeMessage.js","webpack://ConnectyCube/./lib/videocalling/cubeWebRTCClient.js","webpack://ConnectyCube/./lib/videocalling/cubeWebRTCSession.js","webpack://ConnectyCube/./lib/videocalling/cubeWebRTCSignalingProcessor.js","webpack://ConnectyCube/./lib/videocalling/cubeWebRTCSignalingProvider.js","webpack://ConnectyCube/./lib/videocalling_conference/cubeConferenceClient.js","webpack://ConnectyCube/./node_modules/regenerator-runtime/runtime.js","webpack://ConnectyCube/./lib/videocalling_conference/cubeConferenceSession.js","webpack://ConnectyCube/./lib/videocalling_conference/cubeVideoCallingConference.js","webpack://ConnectyCube/./lib/videocalling_conference/janus.umd.js","webpack://ConnectyCube/./node_modules/fbemitter/index.js","webpack://ConnectyCube/./node_modules/fbemitter/lib/BaseEventEmitter.js","webpack://ConnectyCube/./node_modules/fbemitter/lib/EventSubscription.js","webpack://ConnectyCube/./node_modules/fbemitter/lib/EventSubscriptionVendor.js","webpack://ConnectyCube/./node_modules/fbjs/lib/emptyFunction.js"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__30__","__WEBPACK_EXTERNAL_MODULE__99__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","obj","instance","Constructor","TypeError","_defineProperties","target","props","length","descriptor","configurable","writable","protoProps","staticProps","config","IS_BROWSER_ENV","document","IS_RN_ENV","navigator","product","IS_NS_ENV","global","android","NSObject","InternalUtils","nativescript","reactnative","browser","node","RTCPeerConnection","RTCIceCandidate","RTCSessionDescription","callback","arguments","listenerCall","callbackString","toString","callbackName","split","argumentsCopy","push","shift","apply","err","console","error","Math","floor","random","Date","now","base","id","extension","resource","endpoints","api","urls","type","arr","timestamp","this","unixTime","increment","ObjectId","substr","machine","pid","loggers","logger","consoleLoggerFunction","args","log","Array","slice","debug","forEach","j","code","message","errors","ex","arrayTo","arrayFrom","merged","JSON","parse","stringify","firstLevel","newItem","user_id","str","getEnv","btoa","encodeURIComponent","replace","match","p1","String","fromCharCode","Buffer","params","application_id","creds","appId","auth_key","authKey","nonce","randomNonce","login","password","user","email","provider","scope","keys","token","secret","cryptoSessionMsg","sessionMsg","map","val","val1","sort","join","hash","sha1","Error","sha256","Blob","size","data","body","getSizeOfString","headers","on","getDateSize","version","authSecret","chat","muc","chatProtocol","bosh","websocket","active","webSession","getSessionTimeInterval","getSessionTimeout","contactList","subscriptionMode","mutual","reconnectionTimeInterval","streamManagement","enable","videochat","answerTimeInterval","dialingTimeInterval","disconnectTimeInterval","statsReportTimeInterval","iceServers","username","credential","session","users","blobs","subscriptions","events","addressbook","addressbookRegistered","sessionExpired","xmppDataWrite","xmppDataRead","timeout","options","nextkey","fetchImpl","formDataImpl","MediaStream","mediaDevices","Utils","XMPPClient","fetch","FormData","_typeof","iterator","constructor","x","Element","Parser","escapeXML","unescapeXML","escapeXMLText","unescapeXMLText","XMLError","assign","SignalingConstants","MODULE_ID","SignalingType","CALL","ACCEPT","REJECT","STOP","CANDIDATE","SessionConnectionState","UNDEFINED","CONNECTING","CONNECTED","FAILED","DISCONNECTED","CLOSED","COMPLETED","SessionState","NEW","ACTIVE","HUNGUP","REJECTED","PeerConnectionState","CHECKING","CallType","VIDEO","AUDIO","Config","XMPP","ChatInternalUtils","jid","userId","xml","elementName","el","attrName","getAttribute","attr","attrs","stanza","elName","querySelector","getChild","querySelectorAll","txt","textContent","getChildText","elementsPath","reduce","prevStanza","elem","getElement","title","msg","field","_JStoXML","up","objChildNodes","childNodes","children","subNode","subNodeChildNodes","subNodeTagName","tagName","subNodeTextContent","_XMLtoJS","attach","extraParams","dialogId","attributes","attachments","lenght","attrKeys","parseInt","dialog_id","child","moduleIdentifier","errorStanza","errorElement","getAttr","info","getElementText","suffix","uuid","webpackPolyfill","deprecate","paths","g","Function","e","CryptoJS","undefined","F","subtype","C","C_lib","lib","Base","extend","overrides","mixIn","init","$super","properties","propertyName","clone","WordArray","words","sigBytes","encoder","Hex","concat","wordArray","thisWords","thatWords","thisSigBytes","thatSigBytes","clamp","thatByte","ceil","nBytes","rcache","m_w","m_z","mask","result","_r","C_enc","enc","hexChars","bite","hexStr","hexStrLength","Latin1","latin1Chars","latin1Str","latin1StrLength","charCodeAt","Utf8","decodeURIComponent","escape","utf8Str","unescape","BufferedBlockAlgorithm","reset","_data","_nDataBytes","_append","_process","doFlush","dataWords","dataSigBytes","blockSize","nBlocksReady","nWordsReady","max","_minBufferSize","nBytesReady","min","offset","_doProcessBlock","processedWords","splice","C_algo","Hasher","cfg","_doReset","update","messageUpdate","finalize","_doFinalize","_createHelper","hasher","_createHmacHelper","HMAC","algo","delay","TimeoutError","promise","EventEmitter","Deferred","ReflectOwnKeys","R","Reflect","ReflectApply","receiver","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","NumberIsNaN","Number","isNaN","_events","_eventsCount","_maxListeners","defaultMaxListeners","$getMaxListeners","that","_addListener","listener","prepend","existing","warning","newListener","emit","unshift","warned","w","emitter","count","warn","onceWrapper","fired","removeListener","wrapFn","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","ret","unwrapListeners","arrayClone","listenerCount","copy","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","er","context","handler","len","listeners","addListener","prependListener","once","prependOnceListener","list","position","originalListener","index","pop","spliceOne","off","removeAllListeners","rawListeners","eventNames","JID","escaping","equal","a","b","equals","detectEscape","detect","escapeLocal","unescapeLocal","WebRTCHelpers","indexOf","client","_local","_domain","_resource","text","ua","userAgent","ffInfo","sVer","super","_Element","xmlns","nodes","isArray","parent","escapeXMLTable","'","escapeXMLReplace","unescapeXMLTable","unescapeXMLReplace","num","fromCodePoint","start","end","previous","substring","XMPPError","condition","application","element","second","third","is","_hasher","hasherBlockSize","hasherBlockSizeBytes","oKey","_oKey","iKey","_iKey","oKeyWords","iKeyWords","innerHash","StreamError","parseHost","parseService","Connection","socketListeners","parserListeners","status","socket","parser","_detachSocket","_detachParser","send","_end","write","_streamError","sock","_onData","close","dirty","event","_reset","_status","clean","connect","k","isStanza","_onStreamError","fromElement","_onSeeOtherHost","protocol","service","host","port","domain","lang","open","_onElement","_onParserError","disconnect","promiseOnline","Socket","_attachSocket","socketParameters","headerElement","to","_attachParser","header","Promise","all","footer","footerElement","then","resolve","reject","NS","ms","setTimeout","local","setDomain","setLocal","setResource","toPrimitive","hint","NaN","getLocal","other","toLowerCase","getDomain","getResource","search","LtxParser","cursor","onStartElement","onEndElement","onText","append","entity","from","Helpers","setMediaBitrate","sdp","media","bitrate","lines","line","modifier","getVersionFirefox","amount","newLines","_init","delegate","userID","sessionID","trace","remoteSDP","onicecandidate","onIceCandidateCallback","onsignalingstatechange","onSignalingStateCallback","oniceconnectionstatechange","onIceConnectionStateCallback","getVersionSafari","remoteStream","ontrack","onAddRemoteMediaCallback","onStatusClosedChecker","onaddstream","dialingTimer","statsReportTimer","iceCandidates","released","release","_clearDialingTimer","_clearStatsReportTimer","updateRemoteSDP","newSDP","getRemoteSDP","setRemoteSessionDescription","remoteSessionDescription","desc","bandwidth","setRemoteDescription","addLocalStream","localStream","addStream","getAndSetLocalSessionDescription","callType","createOffer","offer","setLocalDescription","createAnswer","answer","addCandidates","candidate","sdpMLineIndex","sdpMid","addIceCandidate","traceError","signalingState","_processIceCandidates","iceCandidateData","_onRemoteStreamListener","stream","addTrack","track","getVideoTracks","getAudioTracks","_getStatsWrap","iceConnectionState","_onSessionConnectionStateChangedListener","conState","clearTimeout","_clearWaitingReconnectTimer","_startWaitingReconnectTimer","clearInterval","statsReportInterval","lastResult","setInterval","peer","lastResults","successCallback","errorCallback","statistic","getLocalStreams","localVideoSettings","getSettings","video","frameHeight","height","frameWidth","width","getStats","results","item","bytesReceived","remote","mediaType","_getBitratePerSecond","packetsReceived","framerateMean","framesPerSecond","round","bytesSent","packetsSent","candidateType","mozLocalTransport","transport","ip","ipAddress","portNumber","kind","remoteSource","_getFramesPerSecond","isLocal","seconds","framesSent","framesReceived","_getStats","_onCallStatsReport","waitingReconnectTimeoutCallback","_closeSessionIfAllConnectionsClosed","_startDialingTimer","withOnNotAnswerCallback","_dialingCallback","skipIncrement","_processOnNotAnswer","_processCall","asyncGeneratorStep","gen","_next","_throw","done","fn","self","EmitterSubscription","_EventSubscription","subscriber","_classCallCheck","subClass","superClass","setPrototypeOf","__proto__","_inherits","format","f","argIndex","framesToPop","CALL_TYPES","DEVICE_INPUT_TYPES","ConnectyCube","credentials","configMap","Proxy","Auth","Users","Storage","PushNotifications","Data","AddressBook","Chat","DialogProxy","MessageProxy","auth","storage","pushnotifications","dialog","utils","isWebRTCAvailble","WebRTCClient","xmppClient","webrtcSignalingProcessor","signalingProcessor","ConferenceClient","videochatconference","RTCView","setSession","getSession","createSession","destroySession","createWebSession","checkWebSessionUntilUpgrade","webToken","upgradeWebSession","logout","CB","HTTPProxy","sdkInstance","currentUserId","requestsNumber","DLog","url","response","requestBody","isGetOrHeadType","isPostOrPutType","isInternalRequest","isMultipartFormData","contentType","requestURL","requestObject","method","buildRequestBody","dataObject","fileToCustomObject","isObject","v","logRequest","requestAndURL","buildRequestAndURL","resp","dataType","json","ok","processAjaxResponse","processAjaxError","responseBody","logResponse","statusCode","errorObject","errno","isExpiredSessionError","handleExpiredSessionResponse","ajax","base64","ieee754","kMaxLength","TYPED_ARRAY_SUPPORT","createBuffer","Uint8Array","encodingOrOffset","allocUnsafe","ArrayBuffer","array","byteOffset","byteLength","fromArrayLike","fromArrayBuffer","string","encoding","isEncoding","actual","fromString","isBuffer","checked","buffer","fromObject","assertSize","isView","loweredCase","utf8ToBytes","base64ToBytes","slowToString","hexSlice","utf8Slice","asciiSlice","latin1Slice","base64Slice","utf16leSlice","swap","bidirectionalIndexOf","dir","arrayIndexOf","lastIndexOf","indexSize","arrLength","valLength","read","buf","readUInt16BE","foundIndex","found","hexWrite","remaining","strLen","parsed","utf8Write","blitBuffer","asciiWrite","byteArray","asciiToBytes","latin1Write","base64Write","ucs2Write","units","hi","lo","utf16leToBytes","fromByteArray","res","secondByte","thirdByte","fourthByte","tempCodePoint","firstByte","codePoint","bytesPerSequence","codePoints","decodeCodePointsArray","SlowBuffer","alloc","INSPECT_MAX_BYTES","foo","subarray","typedArraySupport","poolSize","_augment","species","fill","allocUnsafeSlow","_isBuffer","compare","y","pos","swap16","swap32","swap64","inspect","thisStart","thisEnd","thisCopy","targetCopy","includes","isFinite","toJSON","_arr","out","toHex","bytes","checkOffset","ext","checkInt","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","writeDouble","newBuf","sliceLen","readUIntLE","mul","readUIntBE","readUInt8","readUInt16LE","readUInt32LE","readUInt32BE","readIntLE","pow","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","writeUIntLE","writeUIntBE","writeUInt8","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeIntLE","limit","sub","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","targetStart","INVALID_BASE64_RE","Infinity","leadSurrogate","toByteArray","trim","stringtrim","base64clean","src","dst","b64","lens","getLens","validLen","placeHoldersLen","tmp","Arr","_byteLength","curByte","revLookup","uint8","extraBytes","parts","len2","encodeChunk","lookup","output","isLE","mLen","eLen","eMax","eBias","nBits","rt","abs","LN2","HmacSHA1","W","SHA1","_hash","M","H","nBitsTotal","nBitsLeft","HmacSHA256","K","isPrime","sqrtN","sqrt","factor","getFractionalBits","nPrime","SHA256","h","gamma0x","gamma0","gamma1x","gamma1","maj","sigma0","t1","Client","_reconnect","_websocket","_middleware","_streamFeatures","_iqCaller","_iqCallee","_resolve","_sasl","_resourceBinding","_sessionEstablishment","anonymous","plain","reconnect","middleware","streamFeatures","iqCaller","iqCallee","sasl","resourceBinding","sessionEstablishment","mechanisms","entries","transports","Transport","find","_findTransport","promiseDelay","race","finally","EE","rejectEvent","timeoutId","cleanup","onEvent","onError","reason","resourceStart","atStart","equality","nameEqual","attrsEqual","childrenEqual","setAttrs","getName","getNS","prefix","findNS","getXmlns","namespaces","getChildren","getChildByAttr","recursive","getChildrenByAttr","getChildrenByFilter","filter","getText","getChildElements","tree","cnode","remove","_addChildren","writer","nameEquals","attrsEquals","childrenEquals","inherits","SaxLtx","remainder","endTag","selfClosing","attrQuote","attrQuoteChar","recordStart","_handleTagOpening","endRecording","recorded","lt","quot","endcomment","endCDATA","cData","prevFirst","prevSecond","ctor","superCtor","super_","TempCtor","parseURI","URI","hostname","URL","Reconnect","_timeout","async","scheduleReconnect","ConnectionWebSocket","FramedParser","NS_FRAMING","WS","WebSocket","CODE","wasClean","addEventListener","removeEventListener","compose","IncomingContext","OutgoingContext","Context","ctx","errorHandler","next","reply","catch","incoming","outgoing","incomingListener","outgoingListener","hookOutgoing","use","dispatch","route","feature","xid","StanzaError","timeoutPromise","IQCaller","handlers","Map","_route","isReply","deferred","delete","request","_childRequest","buildReply","buildReplyError","buildError","iqHandler","isQuery","isValidQuery","buildReplyResult","_connect","uris","uri","filterSupportedURIs","Set","srv","record","fetchURIs","fallbackConnect","dns","http","records","compareAltConnections","link","rel","href","isSecure","startsWith","secure","encode","decode","SASLError","SASLFactory","authenticate","SASL","mechname","mech","server","realm","serviceType","serviceName","challenge","mechanism","clientFirst","offered","_mechs","restart","atob","Factory","mechs","jlen","entry","makeBindElement","_jid","Mechanism","cred","chal","authzid","AuthService","proxy","webSessionCheckInterval","ajaxParams","getUrl","sessionParams","generateCreateSessionParams","signature","signParams","qr_code","setCurrentUserId","long","interval","timeoutError","timeleft","_clearWebSessionCheckTimer","web_token","UsersService","filters","order","DATE_FIELDS","NUMBER_FIELDS","generateFilter","full_name","facebook_id","twitter_id","phone","tags","external","getCurrentUserId","param","StorageService","blob","file","fileId","createParams","content_type","parseUri","blob_object_access","authority","path","queryKey","upload","uploadResult","markUploaded","uid","fileUID","strictMode","exec","q","$0","$1","$2","strict","loose","SubscriptionsService","EventsService","base64Encode","toBase64","DataService","className","_id","requestedData","requestedTypeOf","typesData","AddressBookService","opts","contacts","force","udid","isCompact","compact","ChatUtils","ChatHelpers","StreamManagement","ContactListProxy","PrivacyListProxy","MucProxy","ChatService","stanzasCallbacks","isConnected","_isConnecting","_isLogout","_checkConnectionTimer","helpers","xmppClientListeners","privacylist","_sentMessageCallback","messageLost","messageSent","onSentMessageCallback","buildUserJid","isInitialConnect","callbackConnect","callbackOnline","_postConnectActions","callbackOffline","callbackDisconnect","onDisconnectedListener","safeCallbackCall","_establishConnection","callbackStatus","callbackStanza","_onPresence","_onIQ","_onSystemMessageListener","_onMessageErrorListener","_onMessage","callbackError","callbackOutput","callTrafficUsageCallback","callbackInput","buildUserJidLocalPart","jidOrUserId","stanzaParams","getUserCurrentJid","getBsonObjectId","messageStanza","createMessageStanza","markable","filledExtraParams","typeChat","messageId","iqParams","getUniqueId","iqStanza","createIqStanza","getUserIdFromJID","query","onLastUserActivityListener","buildErrorFromXMPPErrorStanza","joinedRooms","setUserCurrentJid","stop","start_date","toISOString","end_date","chat_dialog_ids","rawStanza","extraParamsParsed","recipientId","recipient","getElementTreePath","delivered","composing","paused","invite","bodyContent","forwarded","forwardedMessage","getDialogIdFromJID","getIdFromResource","marker","parseExtraParams","onMessageTypingListener","onDeliveredStatusListener","onReadStatusListener","userCurrentJid","autoSendReceiveStatusParams","sendDeliveredStatus","recipient_id","onMessageListener","xXMLNS","endsWith","getUserIdFromRoomJid","onKickOccupant","actorElement","initiatorUserJid","getRoomJidFromRoomFullJid","onLeaveOccupant","onJoinOccupant","contact","subscription","ask","_sendSubscriptionPresence","onSubscribeListener","onConfirmSubscribeListener","onRejectSubscribeListener","onContactListListener","createPresenceStanza","stanzaId","onSystemMessageListener","onMessageErrorListener","presence","sentMessageCallback","_enableCarbons","onReconnectListener","carbonParams","_isEnable","user_jid","_setSubscriptionToUserLastActivity","_userCurrentJid","chatType","arrayElements","identifier","getRoomJidFromDialogId","StreamManagementService","_NS","_isStreamManagementEnabled","_clientProcessedStanzasCounter","_clientSentStanzasCounter","_lastAck","_xmppClient","_originalSend","_unackedQueue","connection","enableParams","_addEnableHandlers","createNonza","nodeTree","_increaseReceivedStanzasCounter","answerStanza","_checkCounterOnIncomeStanza","getAllElements","_sendStanzasRequest","expect","numAcked","ContactListService","items","isUniqName","userJid","add","presenceParams","presenceStanza","PrivacyListService","userMuc","userAction","mutualBlock","listUserId","listPrivacy","action","iq","createPrivacyItem","jidOrMuc","createPrivacyItemMutal","getUserNickWithMucDomain","isErrorStanza","usersList","stanzaQuery","listWithUpdates","getList","existentList","updatedList","mergeArrays","defaultList","activeList","allLists","defaultName","activeName","allNames","default","names","GroupChatService","dialogIdOrJid","dialogJid","getDialogJid","getRoomJid","maxstanzas","errorEl","errorMessage","DIALOGS_API_URL","ChatDialogsService","occupants_ids","idOrIds","admins_ids","push_all","pull_all","enabled","settings","MESSAGES_API_URL","ChatMessagesService","WebRTCSession","WebRTCSignalingProcessor","WebRTCSignalingProvider","cubeWebRTCConstants","signalingProvider","sessions","ondevicechange","_onDevicesChangeListener","spec","specDevices","enumerateDevices","devices","device","opponentsIDs","callerID","_createAndStoreSession","initiatorID","opIDs","newSession","currentUserID","onUserNotAnswerListener","onRemoteStreamListener","onSessionConnectionStateChangedListener","onSessionCloseListener","onCallStatsReport","ID","sessionId","userInfo","_processOnCall","onCallListener","traceWarning","onAcceptCallListener","_processOnAccept","onRejectCallListener","_processOnReject","onInvalidEventsListener","_processOnStop","onStopCallListener","_processOnIceCandidates","onDevicesChangeListener","MediaDevicesImpl","getTime","peerConnections","mediaParams","answerTimer","startCallTime","acceptCallTime","getUserMedia","audio","elementId","attachMediaStream","peerConnection","getElementById","srcObject","createObjectURL","muted","mirror","style","webkitTransform","transform","onloadedmetadata","play","pause","deviceIds","deviceId","getTracks","_replaceTracks","peers","ops","newStreamTracks","detachMediaStream","getSenders","sender","replaceTrack","_prepareExtension","_callInternal","_createPeer","safariVersion","_clearAnswerTimer","_acceptInternal","oppIDs","_uniqueOpponentsIDsWithoutInitiator","offerTime","_startWaitingOfferOrAnswerTimer","opID","localDescription","sendMessage","_close","_muteStream","_uniqueOpponentsIDs","pConn","_startAnswerTimer","_clearWaitingOfferOrAnswerTimer","pcKeys","pc","sendCandidate","stats","connectionState","peerConnectionType","pcConfig","_prepareIceServers","_closeLocalMediaStream","isAllConnectionsClosed","peerState","peerCon","audioTrack","videoTrack","waitingOfferOrAnswerTimer","time","opponents","iceServersCopy","_getExtension","signalType","_onCallListener","_onAcceptListener","_onRejectListener","_onStopListener","_onIceCandidatesListener","opponent","childrenNodes","extraParamsChildNodes","itemTagName","len3","childName","childValue","len2v","wholeNodeContent","signalingConnection","signalingType","platform","getUserJid","opponentId","ConferenceSession","confConfig","onParticipantJoinedListener","onParticipantLeftListener","onSlowLinkListener","onRemoteConnectionStateChangedListener","sessionsStore","deviceInputType","_listDevices","session_id","runtime","Op","hasOwn","$Symbol","iteratorSymbol","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","wrap","innerFn","outerFn","tryLocsList","protoGenerator","Generator","generator","_invoke","doneResult","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","tryCatch","makeInvokeMethod","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","getProto","NativeIteratorPrototype","values","Gp","defineIteratorMethods","AsyncIterator","PromiseImpl","previousPromise","callInvokeWithMethodAndArg","invoke","__await","unwrapped","resultName","nextLoc","pushTryEntry","locs","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","iterable","iteratorMethod","displayName","isGeneratorFunction","genFun","mark","awrap","iter","reverse","skipTempReset","prev","charAt","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","regeneratorRuntime","accidentalStrictMode","ClientJanusConf","janusConfig","userDisplayName","_createListener","iceState","uplink","nacks","_clientConf","_setOnParticipantJoinListener","_setOnParticipantLeftListener","_setOnRemoveStreamListener","success","roomId","_createSession","currentRoomId","_createPublisher","_createHandler","_join","isRemote","attachVideoConferencingPlugin","_onRemoteIceStateChanged","_onLocalIceStateChanged","slowLink","_onSlowLink","_onParticipantJoined","_onParticipantLeft","_onRemoteStream","listOnlineParticipants","_leaveGroup","_destroy","leave","updateCurrentStream","prevAudioMuteState","prevVideoMuteState","attachStreamOptions","isAudioMuted","isVideoMuted","removeTrack","activeAudioDeviceId","activeVideoDeviceId","trackSetting","constraints","_switchVideo","_switchAudio","mediaDeviceId","updateLocalStream","_switchMediaTracks","newLocalStream","pcSenders","currentPublisherPC","toggleVideoMute","toggleAudioMute","currentDialogId","videoRoomPlugin","webrtcStuff","Janus","coreConfig","VideoConferencingClient","configParams","adapter","configs","engine","isOnlyAudio","remoteFeeds","remoteJseps","remoteFeedsAttachingInProgress","currentMidiaDeviceId","bitrateTimers","listDevices","listVideoinputDevices","videoSelect","deviceInfo","videoinputDescription","label","videoinputId","callbacks","isWebrtcSupported","destroyed","timeoutSessionCallback","getSessionId","destroy","remoteFeed","plugin","pluginHandle","listen","consentDialog","mediaState","medium","webrtcState","onmessage","jsep","feedId","useAudio","useVideo","publishers","detachRemoteFeed","handleRemoteJsep","onlocalstream","onremotestream","oncleanup","detached","getPluginId","getId","detachVideoConferencingPlugin","detach","chatDialogId","joinEvent","leaveEvent","listRequest","participants","unmuteAudio","muteAudio","toggleRemoteAudioMute","audioTracks","isRemoteAudioMuted","unmuteVideo","muteVideo","toggleRemoteVideoMute","videoTracks","isRemoteVideoMuted","switchVideoinput","replaceVideo","switchAudioinput","replaceAudio","iceRestart","userIdOrCallbacks","inputParams","videoQuality","quality","videoFrameRate","frameRate","audioRecv","videoRecv","audioSend","videoSend","ideal","publish","showBitrate","browserDetails","getBitrate","hideBitrate","eventType","gatewayCallbacks","initDone","noop","websockets","ws","wsHandlers","wsKeepaliveTimeoutId","servers","serversIndex","iceTransportPolicy","bundlePolicy","ipv6Support","ipv6","withCredentials","maxev","max_poll_events","apisecret","destroyOnUnload","connected","pluginHandles","retries","transactions","eventHandler","longpoll","httpAPICall","verb","handleEvent","textStatus","errorThrown","skipTimeout","hangup","ondetached","transaction","reportSuccess","plugindata","vdebug","keepAlive","randomString","handleId","sendTrickleCandidate","sendData","dataChannel","sendDtmf","dtmfSender","myStream","tracks","local_audio_track","createDTMFSender","ontonechange","tone","dtmf","tones","duration","gap","insertDTMF","destroyHandle","asyncRequest","cleanupWebrtc","streamsDone","streamExternal","removeAudio","removeVideo","addTracks","isAudioSendEnabled","addAudio","isVideoSendEnabled","addVideo","pc_config","pc_constraints","optional","rtcConstraints","webRTCAdapter","volume","trickle","iceDone","mySdp","sdpSent","sendSDP","streams","onended","ev","isDataEnabled","onDataChannelStateChange","dcState","readyState","ondataopen","createDataChannel","ordered","ondata","onopen","onclose","onerror","simulcast","mediaConstraints","isAudioRecvEnabled","isVideoRecvEnabled","sendVideo","parameters","getParameters","setParameters","encodings","rid","priority","maxBitrate","ssrc","ssrc_fid","cname","msid","mslabel","insertAt","mline","fid","mungeSdpForSimulcasting","prepareWebrtc","webrtcError","addData","mst","mandatory","audioSupport","videoSupport","callbackUserMedia","getScreenMedia","gsmCallback","audioStream","screenshareFrameRate","location","cache","chromever","maxver","googLeakyBucket","maxWidth","screen","maxHeight","minFrameRate","maxFrameRate","chromeMediaSource","pending","postMessage","mozMediaSource","mediaSource","lastTime","currentTime","polly","origin","sourceId","googTemporalLayeredScreencast","chromeMediaSourceId","audioExist","some","videoExist","needAudioDevice","failIfNoAudio","isAudioSendRequired","needVideoDevice","failIfNoVideo","isVideoSendRequired","haveAudioDevice","haveVideoDevice","prepareWebrtcPeer","getVolume","timer","stat","isMuted","mute","inStats","googCodecName","bsnow","tsnow","bsbefore","tsbefore","timePassed","bitRate","hangupRequest","eventName","newWebSocket","getServer","unbindWebSocket","onUnbindMessage","onUnbindError","opaqueId","started","getPlugin","sendRequest","createHandle","extensionId","isExtensionEnabled","checkJanusExtension","useDefaultDependencies","deps","socketCls","proto","fetchOptions","fetching","timerId","useOldDependencies","jq","jQuery","payload","xhrFields","xhr","usedDependencies","dependencies","reattachMediaStream","oldOBF","onbeforeunload","charSet","randomPoz","fbemitter","EventSubscriptionVendor","emptyFunction","invariant","BaseEventEmitter","_subscriber","_currentSubscription","addSubscription","removeCurrentListener","removeAllSubscriptions","removeSubscription","getSubscriptionsForType","thatReturnsTrue","ii","__emitToSubscription","EventSubscription","_subscriptionsForType","subscriptionsForType","makeEmptyFunction","thatReturns","thatReturnsFalse","thatReturnsNull","thatReturnsThis","thatReturnsArgument"],"mappings":"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","file":"connectycube.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"node-fetch\"), require(\"form-data\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"node-fetch\", \"form-data\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ConnectyCube\"] = factory(require(\"node-fetch\"), require(\"form-data\"));\n\telse\n\t\troot[\"ConnectyCube\"] = factory(root[\"node-fetch\"], root[\"form-data\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__30__, __WEBPACK_EXTERNAL_MODULE__99__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 37);\n","function _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nmodule.exports = _interopRequireDefault;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","const config = require('./cubeConfig')\r\n\r\nconst IS_BROWSER_ENV = typeof document !== 'undefined';\r\nconst IS_RN_ENV = typeof navigator !== 'undefined' &&\r\n  navigator.product == 'ReactNative';\r\nconst IS_NS_ENV = typeof global === 'object' &&\r\n  (typeof global.android !== 'undefined' ||\r\n    typeof global.NSObject !== 'undefined');\r\n\r\nclass InternalUtils {\r\n\r\n  static getEnv() {\r\n    return {\r\n      nativescript: IS_NS_ENV,\r\n      reactnative: IS_RN_ENV,\r\n      browser: IS_BROWSER_ENV,\r\n      node: !IS_BROWSER_ENV && !IS_NS_ENV && !IS_RN_ENV\r\n    }\r\n  }\r\n\r\n  static isWebRTCAvailble() {\r\n    return (\r\n      IS_RN_ENV ||\r\n      (IS_BROWSER_ENV &&\r\n        window.RTCPeerConnection &&\r\n        window.RTCIceCandidate &&\r\n        window.RTCSessionDescription)\r\n    )\r\n  }\r\n\r\n  static safeCallbackCall() {\r\n    const callback = arguments[0];\r\n    if (typeof callback !== 'function') {\r\n      return;\r\n    }\r\n\r\n    const callbackString = callback.toString()\r\n    const callbackName = callbackString.split('(')[0].split(' ')[1]\r\n\r\n    const argumentsCopy = []\r\n    let listenerCall\r\n\r\n    for (let i = 0; i < arguments.length; i++) {\r\n      argumentsCopy.push(arguments[i])\r\n    }\r\n\r\n    listenerCall = argumentsCopy.shift()\r\n\r\n    try {\r\n      listenerCall.apply(null, argumentsCopy)\r\n    } catch (err) {\r\n      if (callbackName === '') {\r\n        console.error('Error: ' + err)\r\n      } else {\r\n        console.error('Error in listener ' + callbackName + ': ' + err)\r\n      }\r\n    }\r\n  }\r\n\r\n  static randomNonce() {\r\n    return Math.floor(Math.random() * 10000)\r\n  }\r\n\r\n  static unixTime() {\r\n    return Math.floor(Date.now() / 1000)\r\n  }\r\n\r\n  static getUrl(base, id, extension) {\r\n    let resource = `${id ? '/' + id : ''}`\r\n    extension = `${extension ? '/' + extension : ''}`\r\n    return `https://${config.endpoints.api}/${base}${resource}${extension}${config.urls.type}`\r\n  }\r\n\r\n  static isArray(arr) {\r\n    return Object.prototype.toString.call(arr) === '[object Array]'\r\n  }\r\n\r\n  static isObject(obj) {\r\n    return Object.prototype.toString.call(obj) === '[object Object]'\r\n  }\r\n\r\n  static getBsonObjectId() {\r\n    const timestamp = this.unixTime().toString(16)\r\n    const increment = (ObjectId.increment++).toString(16)\r\n\r\n    if (increment > 0xffffff) ObjectId.increment = 0\r\n\r\n    return (\r\n      '00000000'.substr(0, 8 - timestamp.length) +\r\n      timestamp +\r\n      '000000'.substr(0, 6 - ObjectId.machine.length) +\r\n      ObjectId.machine +\r\n      '0000'.substr(0, 4 - ObjectId.pid.length) +\r\n      ObjectId.pid +\r\n      '000000'.substr(0, 6 - increment.length) +\r\n      increment\r\n    )\r\n  }\r\n\r\n  static DLog() {\r\n    if (this.loggers) {\r\n      for (let i = 0; i < this.loggers.length; ++i) {\r\n        this.loggers[i](arguments)\r\n      }\r\n\r\n      return\r\n    }\r\n\r\n    let logger\r\n\r\n    this.loggers = []\r\n\r\n    const consoleLoggerFunction = function () {\r\n      const logger = function (args) {\r\n        console.log.apply(console, Array.prototype.slice.call(args))\r\n      }\r\n\r\n      return logger\r\n    }\r\n\r\n    if (typeof config.debug === 'object') {\r\n      if (typeof config.debug.mode === 'number') {\r\n        if (config.debug.mode == 1) {\r\n          logger = consoleLoggerFunction()\r\n          this.loggers.push(logger)\r\n        }\r\n      } else if (typeof config.debug.mode === 'object') {\r\n        config.debug.mode.forEach(function (mode) {\r\n          if (mode === 1) {\r\n            logger = consoleLoggerFunction()\r\n            this.loggers.push(logger)\r\n          }\r\n        })\r\n      }\r\n    }\r\n\r\n    if (this.loggers) {\r\n      for (let j = 0; j < this.loggers.length; ++j) {\r\n        this.loggers[j](arguments)\r\n      }\r\n    }\r\n  }\r\n\r\n  static isExpiredSessionError(error) {\r\n    try {\r\n      return (\r\n        error &&\r\n        error.code === 401 &&\r\n        error.message.errors.base[0] === 'Required session does not exist'\r\n      )\r\n    } catch (ex) {\r\n      return false\r\n    }\r\n  }\r\n\r\n  static mergeArrays(arrayTo, arrayFrom) {\r\n    const merged = JSON.parse(JSON.stringify(arrayTo))\r\n\r\n    firstLevel: for (let i = 0; i < arrayFrom.length; i++) {\r\n      const newItem = arrayFrom[i]\r\n\r\n      for (let j = 0; j < merged.length; j++) {\r\n        if (newItem.user_id === merged[j].user_id) {\r\n          merged[j] = newItem\r\n          continue firstLevel\r\n        }\r\n      }\r\n      merged.push(newItem)\r\n    }\r\n    return merged\r\n  }\r\n\r\n  static toBase64(str) {\r\n    if (this.getEnv().browser) {\r\n      return btoa(\r\n        encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function (match, p1) {\r\n          return String.fromCharCode('0x' + p1)\r\n        })\r\n      )\r\n    } else if (this.getEnv().reactnative) {\r\n      return global.btoa(str)\r\n    } else {\r\n      // Node.js & Native Script\r\n      return new Buffer(str).toString('base64')\r\n    }\r\n  }\r\n\r\n  static generateCreateSessionParams(params) {\r\n    const message = {\r\n      application_id: config.creds.appId,\r\n      auth_key: config.creds.authKey,\r\n      nonce: this.randomNonce(),\r\n      timestamp: this.unixTime()\r\n    }\r\n\r\n    if (params) {\r\n      if (params.login && params.password) {\r\n        message.user = { login: params.login, password: params.password }\r\n      } else if (params.email && params.password) {\r\n        message.user = { email: params.email, password: params.password }\r\n      } else if (params.provider) {\r\n        // Via social networking provider (e.g. facebook, twitter etc.)\r\n        message.provider = params.provider\r\n        if (params.scope) {\r\n          message.scope = params.scope\r\n        }\r\n        if (params.keys && params.keys.token) {\r\n          message.keys = { token: params.keys.token }\r\n        }\r\n        if (params.keys && params.keys.secret) {\r\n          message.keys.secret = params.keys.secret\r\n        }\r\n      } else if (params.hasOwnProperty('long')) {\r\n        message.long = params.long\r\n      }\r\n    }\r\n\r\n    return message;\r\n  }\r\n\r\n  static signParams(message, secret) {\r\n    const sessionMsg = Object.keys(message)\r\n      .map(function (val) {\r\n        if (typeof message[val] === 'object') {\r\n          return Object.keys(message[val])\r\n            .map(function (val1) {\r\n              return val + '[' + val1 + ']=' + message[val][val1]\r\n            })\r\n            .sort()\r\n            .join('&')\r\n        } else {\r\n          return val + '=' + message[val]\r\n        }\r\n      })\r\n      .sort()\r\n      .join('&')\r\n\r\n    let cryptoSessionMsg\r\n\r\n    if (config.hash === 'sha1') {\r\n      const sha1 = require('crypto-js/hmac-sha1')\r\n      cryptoSessionMsg = sha1(sessionMsg, secret).toString()\r\n    } else if (config.hash === 'sha256') {\r\n      const sha256 = require('crypto-js/hmac-sha256')\r\n      cryptoSessionMsg = sha256(sessionMsg, secret).toString()\r\n    } else {\r\n      throw new Error('Unknown crypto standards, available sha1 or sha256')\r\n    }\r\n\r\n    return cryptoSessionMsg\r\n  }\r\n\r\n  static getSizeOfString(str) {\r\n    return (new Blob([str])).size\r\n  }\r\n\r\n  static getDateSize(data) {\r\n    let size = 0;\r\n    if (data.body) {\r\n      let body = data.body\r\n      if (typeof body != 'string') {\r\n        body = JSON.stringify(body)\r\n      }\r\n      size += this.getSizeOfString(body)\r\n    }\r\n    if (data.headers) {\r\n      size += this.getSizeOfString(JSON.stringify(data.headers))\r\n    }\r\n    return size;\r\n  }\r\n\r\n  static callTrafficUsageCallback(callbackName, data) {\r\n    if (typeof config.on[callbackName] === 'function') {\r\n      config.on[callbackName](this.getDateSize(data))\r\n    }\r\n  }\r\n}\r\n\r\n// The object for type MongoDB.Bson.ObjectId\r\n// http://docs.mongodb.org/manual/reference/object-id/\r\nconst ObjectId = {\r\n  machine: Math.floor(Math.random() * 16777216).toString(16),\r\n  pid: Math.floor(Math.random() * 32767).toString(16),\r\n  increment: 0\r\n}\r\n\r\nmodule.exports = InternalUtils;\r\n","const config = {\r\n    version: require('../package.json').version,\r\n    creds: {\r\n        appId: '',\r\n        authKey: '',\r\n        authSecret: ''\r\n    },\r\n    endpoints: {\r\n        api: 'api.connectycube.com',\r\n        chat: 'chat.connectycube.com',\r\n        muc: 'muc.chat.connectycube.com'\r\n    },\r\n    hash: 'sha1',\r\n    chatProtocol: {\r\n        bosh: 'https://chat.connectycube.com:5281',\r\n        websocket: 'wss://chat.connectycube.com:5291',\r\n        active: 2\r\n    },\r\n    webSession: {\r\n        getSessionTimeInterval: 3,\r\n        getSessionTimeout: 120\r\n    },\r\n    chat: {\r\n        contactList: {\r\n            subscriptionMode: {\r\n                mutual: true\r\n            }\r\n        },\r\n        reconnectionTimeInterval: 5,\r\n        streamManagement: {\r\n            enable: false\r\n        }\r\n    },\r\n    videochat: {\r\n        answerTimeInterval: 60,\r\n        dialingTimeInterval: 5,\r\n        disconnectTimeInterval: 30,\r\n        statsReportTimeInterval: false,\r\n        iceServers: [\r\n            {\r\n                urls: 'stun:stun.l.google.com:19302'\r\n            },\r\n            {\r\n                urls: 'stun:turn.connectycube.com'\r\n            },\r\n            {\r\n                urls: 'turn:turn.connectycube.com:5349?transport=udp',\r\n                username: 'connectycube',\r\n                credential: '4c29501ca9207b7fb9c4b4b6b04faeb1'\r\n            },\r\n            {\r\n                urls: 'turn:turn.connectycube.com:5349?transport=tcp',\r\n                username: 'connectycube',\r\n                credential: '4c29501ca9207b7fb9c4b4b6b04faeb1'\r\n            }\r\n        ]\r\n    },\r\n    urls: {\r\n        session: 'session',\r\n        webSession: 'session/web',\r\n        login: 'login',\r\n        users: 'users',\r\n        chat: 'chat',\r\n        blobs: 'blobs',\r\n        subscriptions: 'subscriptions',\r\n        events: 'events',\r\n        data: 'data',\r\n        addressbook: 'address_book',\r\n        addressbookRegistered: 'address_book/registered_users',\r\n        type: '.json'\r\n    },\r\n    on: {\r\n        sessionExpired: null,\r\n        xmppDataWrite: null,\r\n        xmppDataRead: null\r\n    },\r\n    timeout: null,\r\n    debug: {\r\n        mode: 0\r\n    }\r\n}\r\n\r\nconfig.set = function (options) {\r\n    if (typeof options.endpoints === 'object' && options.endpoints.chat) {\r\n        config.endpoints.muc = 'muc.' + options.endpoints.chat\r\n        config.chatProtocol.bosh = 'https://' + options.endpoints.chat + ':5281'\r\n        config.chatProtocol.websocket = 'wss://' + options.endpoints.chat + ':5291'\r\n    }\r\n\r\n    Object.keys(options).forEach(function (key) {\r\n        if (key !== 'set' && config.hasOwnProperty(key)) {\r\n            if (typeof options[key] !== 'object') {\r\n                config[key] = options[key]\r\n            } else {\r\n                Object.keys(options[key]).forEach(function (nextkey) {\r\n                    if (config[key].hasOwnProperty(nextkey)) {\r\n                        config[key][nextkey] = options[key][nextkey]\r\n                    }\r\n                })\r\n            }\r\n        }\r\n    })\r\n}\r\n\r\nmodule.exports = config\r\n","const Utils = require('./cubeInternalUtils')\r\n\r\nlet fetchImpl, formDataImpl\r\n\r\nlet RTCPeerConnection,\r\n  RTCSessionDescription,\r\n  RTCIceCandidate,\r\n  MediaStream,\r\n  mediaDevices;\r\n\r\nlet XMPPClient = require('@xmpp/client/react-native'); // https://github.com/xmppjs/xmpp.js/issues/807\r\n\r\nif (Utils.getEnv().browser) {\r\n  fetchImpl = fetch\r\n  formDataImpl = FormData\r\n\r\n  RTCPeerConnection = window.RTCPeerConnection\r\n  RTCSessionDescription = window.RTCSessionDescription\r\n  RTCIceCandidate = window.RTCIceCandidate\r\n  MediaStream = window.MediaStream\r\n  mediaDevices = navigator.mediaDevices\r\n} else if (Utils.getEnv().nativescript) {\r\n  fetchImpl = fetch\r\n  formDataImpl = FormData\r\n} else if (Utils.getEnv().node) {\r\n  fetchImpl = require('node-fetch')\r\n  formDataImpl = require('form-data')\r\n} else if (Utils.getEnv().reactnative) {\r\n  fetchImpl = fetch\r\n  formDataImpl = FormData\r\n}\r\n\r\nmodule.exports = {\r\n  fetchImpl: fetchImpl,\r\n  formDataImpl: formDataImpl,\r\n  XMPPClient: XMPPClient,\r\n  RTCPeerConnection: RTCPeerConnection,\r\n  RTCSessionDescription: RTCSessionDescription,\r\n  RTCIceCandidate: RTCIceCandidate,\r\n  MediaStream: MediaStream,\r\n  mediaDevices: mediaDevices\r\n}\r\n","function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","'use strict'\n\nconst x = require('./lib/x')\nconst Element = require('./lib/Element')\nconst Parser = require('./lib/Parser')\nconst {\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n} = require('ltx/lib/escape')\nconst XMLError = require('./lib/XMLError')\n\nfunction xml(...args) {\n  return x(...args)\n}\n\nexports = module.exports = xml\n\nObject.assign(exports, {\n  x,\n  Element,\n  Parser,\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n  XMLError,\n})\n","module.exports = {\r\n    SignalingConstants: {\r\n        MODULE_ID: \"WebRTCVideoChat\",\r\n        SignalingType: {\r\n            CALL: 'call',\r\n            ACCEPT: 'accept',\r\n            REJECT: 'reject',\r\n            STOP: 'hangUp',\r\n            CANDIDATE: 'iceCandidates'\r\n        }\r\n    },\r\n    SessionConnectionState: {\r\n        UNDEFINED: 0,\r\n        CONNECTING: 1,\r\n        CONNECTED: 2,\r\n        FAILED: 3,\r\n        DISCONNECTED: 4,\r\n        CLOSED: 5,\r\n        COMPLETED: 6\r\n    },\r\n    SessionState: {\r\n        NEW: 1,\r\n        ACTIVE: 2,\r\n        HUNGUP: 3,\r\n        REJECTED: 4,\r\n        CLOSED: 5\r\n    },\r\n    PeerConnectionState: {\r\n        NEW: 1,\r\n        CONNECTING: 2,\r\n        CHECKING: 3,\r\n        CONNECTED: 4,\r\n        DISCONNECTED: 5,\r\n        FAILED: 6,\r\n        CLOSED: 7,\r\n        COMPLETED: 8\r\n    },\r\n    CallType: {\r\n        VIDEO: 1,\r\n        AUDIO: 2\r\n    }\r\n};\r\n","const Utils = require('../cubeInternalUtils'),\r\n  Config = require('../cubeConfig'),\r\n  XMPP = require('../cubeDependencies').XMPPClient;\r\n\r\nclass ChatInternalUtils {\r\n  static buildUserJid(params) {\r\n    let jid;\r\n\r\n    if ('userId' in params) {\r\n      jid = params.userId + '-' + Config.creds.appId + '@' + Config.endpoints.chat;\r\n\r\n      if ('resource' in params) {\r\n        jid = jid + '/' + params.resource;\r\n      }\r\n    } else if ('jid' in params) {\r\n      jid = params.jid;\r\n    }\r\n\r\n    return jid;\r\n  }\r\n\r\n  static buildUserJidLocalPart(userId) {\r\n    return userId + '-' + Config.creds.appId;\r\n  }\r\n\r\n  static createMessageStanza(params) {\r\n    return XMPP.xml('message', params);\r\n  }\r\n\r\n  static createIqStanza(params) {\r\n    return XMPP.xml('iq', params);\r\n  }\r\n\r\n  static createPresenceStanza(params) {\r\n    return XMPP.xml('presence', params);\r\n  }\r\n\r\n  static createNonza(elementName, params) {\r\n    return XMPP.xml(elementName, params);\r\n  }\r\n\r\n  static getAttr(el, attrName) {\r\n    if (!el) {\r\n      return null;\r\n    }\r\n\r\n    let attr;\r\n    if (typeof el.getAttribute === 'function') {\r\n      attr = el.getAttribute(attrName);\r\n    } else if (el.attrs) {\r\n      attr = el.attrs[attrName];\r\n    }\r\n\r\n    return attr;\r\n  }\r\n\r\n  static getElement(stanza, elName) {\r\n    let el;\r\n\r\n    if (typeof stanza.querySelector === 'function') {\r\n      el = stanza.querySelector(elName);\r\n    } else if (typeof stanza.getChild === 'function') {\r\n      el = stanza.getChild(elName);\r\n    }\r\n\r\n    return el;\r\n  }\r\n\r\n  static isErrorStanza(stanza) {\r\n    return !!stanza.getChild('error');\r\n  }\r\n\r\n  static getAllElements(stanza, elName) {\r\n    let el;\r\n    if (typeof stanza.querySelectorAll === 'function') {\r\n      el = stanza.querySelectorAll(elName);\r\n    } else if (typeof stanza.getChild === 'function') {\r\n      el = stanza.getChild(elName);\r\n    }\r\n\r\n    return el;\r\n  }\r\n\r\n  static getElementText(stanza, elName) {\r\n    let el, txt;\r\n\r\n    if (typeof stanza.querySelector === 'function') {\r\n      el = stanza.querySelector(elName);\r\n      txt = el ? el.textContent : null;\r\n    } else if (typeof stanza.getChildText === 'function') {\r\n      txt = stanza.getChildText(elName);\r\n    }\r\n\r\n    return txt;\r\n  }\r\n\r\n  static getElementTreePath(stanza, elementsPath) {\r\n    return elementsPath.reduce((prevStanza, elem) => prevStanza ? this.getElement(prevStanza, elem) : prevStanza, stanza)\r\n  }\r\n\r\n\r\n  static _JStoXML(title, obj, msg) {\r\n    msg = msg.c(title);\r\n\r\n    Object.keys(obj).forEach(field => {\r\n      if (typeof obj[field] === 'object') {\r\n        this._JStoXML(field, obj[field], msg);\r\n      } else {\r\n        msg = msg.c(field).t(obj[field]).up();\r\n      }\r\n    });\r\n\r\n    msg = msg.up();\r\n  }\r\n\r\n  static _XMLtoJS(extension, title, obj) {\r\n    extension[title] = {};\r\n\r\n    let objChildNodes = obj.childNodes || obj.children;\r\n\r\n    for (let i = 0; i < objChildNodes.length; i++) {\r\n      let subNode = objChildNodes[i];\r\n      let subNodeChildNodes = subNode.childNodes || subNode.children;\r\n      let subNodeTagName = subNode.tagName || subNode.name;\r\n      let subNodeTextContent = subNode.textContent || subNode.children[0];\r\n\r\n      if (subNodeChildNodes.length > 1) {\r\n        extension[title] = this._XMLtoJS(extension[title], subNodeTagName, subNode);\r\n      } else {\r\n        extension[title][subNodeTagName] = subNodeTextContent;\r\n      }\r\n    }\r\n    return extension;\r\n  }\r\n\r\n  static filledExtraParams(stanza, extension) {\r\n    Object.keys(extension).forEach(field => {\r\n      if (field === 'attachments') {\r\n        extension[field].forEach(attach => {\r\n          stanza\r\n            .getChild('extraParams')\r\n            .c('attachment', attach)\r\n            .up();\r\n\r\n        });\r\n      } else if (typeof extension[field] === 'object') {\r\n        this._JStoXML(field, extension[field], stanza);\r\n      } else {\r\n        stanza\r\n          .getChild('extraParams')\r\n          .c(field)\r\n          .t(extension[field])\r\n          .up();\r\n\r\n      }\r\n    });\r\n\r\n    stanza.up();\r\n\r\n    return stanza;\r\n  }\r\n\r\n  static parseExtraParams(extraParams) {\r\n    if (!extraParams) {\r\n      return null;\r\n    }\r\n\r\n    let extension = {};\r\n\r\n    let dialogId, attach, attributes;\r\n\r\n    let attachments = [];\r\n\r\n    for (let c = 0, lenght = extraParams.children.length; c < lenght; c++) {\r\n      if (extraParams.children[c].name === 'attachment') {\r\n        attach = {};\r\n        attributes = extraParams.children[c].attrs;\r\n\r\n        let attrKeys = Object.keys(attributes);\r\n\r\n        for (let l = 0; l < attrKeys.length; l++) {\r\n          if (attrKeys[l] === 'size') {\r\n            attach.size = parseInt(attributes.size);\r\n          } else {\r\n            attach[attrKeys[l]] = attributes[attrKeys[l]];\r\n          }\r\n        }\r\n\r\n        attachments.push(attach);\r\n      } else if (extraParams.children[c].name === 'dialog_id') {\r\n        dialogId = extraParams.getChildText('dialog_id');\r\n        extension.dialog_id = dialogId;\r\n      }\r\n\r\n      if (extraParams.children[c].children.length === 1) {\r\n        let child = extraParams.children[c];\r\n\r\n        extension[child.name] = child.children[0];\r\n      }\r\n    }\r\n\r\n    if (attachments.length > 0) {\r\n      extension.attachments = attachments;\r\n    }\r\n\r\n    if (extension.moduleIdentifier) {\r\n      delete extension.moduleIdentifier;\r\n    }\r\n\r\n    return {\r\n      extension: extension,\r\n      dialogId: dialogId\r\n    };\r\n  }\r\n\r\n  static buildErrorFromXMPPErrorStanza(errorStanza) {\r\n    const errorElement = this.getElement(errorStanza, 'error');\r\n    const code = parseInt(this.getAttr(errorElement, 'code'));\r\n    const info = this.getElementText(errorElement, 'text');\r\n    return { code: code, info: info };\r\n  }\r\n\r\n  static getUniqueId(suffix) {\r\n    const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\r\n      const r = (Math.random() * 16) | 0,\r\n        v = c == 'x' ? r : (r & 0x3) | 0x8;\r\n      return v.toString(16);\r\n    });\r\n    if (typeof suffix == 'string' || typeof suffix == 'number') {\r\n      return uuid + ':' + suffix;\r\n    } else {\r\n      return uuid + '';\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = ChatInternalUtils;\r\n","module.exports = function(module) {\n\tif (!module.webpackPolyfill) {\n\t\tmodule.deprecate = function() {};\n\t\tmodule.paths = [];\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n",";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory();\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\troot.CryptoJS = factory();\n\t}\n}(this, function () {\n\n\t/**\n\t * CryptoJS core components.\n\t */\n\tvar CryptoJS = CryptoJS || (function (Math, undefined) {\n\t    /*\n\t     * Local polyfil of Object.create\n\t     */\n\t    var create = Object.create || (function () {\n\t        function F() {};\n\n\t        return function (obj) {\n\t            var subtype;\n\n\t            F.prototype = obj;\n\n\t            subtype = new F();\n\n\t            F.prototype = null;\n\n\t            return subtype;\n\t        };\n\t    }())\n\n\t    /**\n\t     * CryptoJS namespace.\n\t     */\n\t    var C = {};\n\n\t    /**\n\t     * Library namespace.\n\t     */\n\t    var C_lib = C.lib = {};\n\n\t    /**\n\t     * Base object for prototypal inheritance.\n\t     */\n\t    var Base = C_lib.Base = (function () {\n\n\n\t        return {\n\t            /**\n\t             * Creates a new object that inherits from this object.\n\t             *\n\t             * @param {Object} overrides Properties to copy into the new object.\n\t             *\n\t             * @return {Object} The new object.\n\t             *\n\t             * @static\n\t             *\n\t             * @example\n\t             *\n\t             *     var MyType = CryptoJS.lib.Base.extend({\n\t             *         field: 'value',\n\t             *\n\t             *         method: function () {\n\t             *         }\n\t             *     });\n\t             */\n\t            extend: function (overrides) {\n\t                // Spawn\n\t                var subtype = create(this);\n\n\t                // Augment\n\t                if (overrides) {\n\t                    subtype.mixIn(overrides);\n\t                }\n\n\t                // Create default initializer\n\t                if (!subtype.hasOwnProperty('init') || this.init === subtype.init) {\n\t                    subtype.init = function () {\n\t                        subtype.$super.init.apply(this, arguments);\n\t                    };\n\t                }\n\n\t                // Initializer's prototype is the subtype object\n\t                subtype.init.prototype = subtype;\n\n\t                // Reference supertype\n\t                subtype.$super = this;\n\n\t                return subtype;\n\t            },\n\n\t            /**\n\t             * Extends this object and runs the init method.\n\t             * Arguments to create() will be passed to init().\n\t             *\n\t             * @return {Object} The new object.\n\t             *\n\t             * @static\n\t             *\n\t             * @example\n\t             *\n\t             *     var instance = MyType.create();\n\t             */\n\t            create: function () {\n\t                var instance = this.extend();\n\t                instance.init.apply(instance, arguments);\n\n\t                return instance;\n\t            },\n\n\t            /**\n\t             * Initializes a newly created object.\n\t             * Override this method to add some logic when your objects are created.\n\t             *\n\t             * @example\n\t             *\n\t             *     var MyType = CryptoJS.lib.Base.extend({\n\t             *         init: function () {\n\t             *             // ...\n\t             *         }\n\t             *     });\n\t             */\n\t            init: function () {\n\t            },\n\n\t            /**\n\t             * Copies properties into this object.\n\t             *\n\t             * @param {Object} properties The properties to mix in.\n\t             *\n\t             * @example\n\t             *\n\t             *     MyType.mixIn({\n\t             *         field: 'value'\n\t             *     });\n\t             */\n\t            mixIn: function (properties) {\n\t                for (var propertyName in properties) {\n\t                    if (properties.hasOwnProperty(propertyName)) {\n\t                        this[propertyName] = properties[propertyName];\n\t                    }\n\t                }\n\n\t                // IE won't copy toString using the loop above\n\t                if (properties.hasOwnProperty('toString')) {\n\t                    this.toString = properties.toString;\n\t                }\n\t            },\n\n\t            /**\n\t             * Creates a copy of this object.\n\t             *\n\t             * @return {Object} The clone.\n\t             *\n\t             * @example\n\t             *\n\t             *     var clone = instance.clone();\n\t             */\n\t            clone: function () {\n\t                return this.init.prototype.extend(this);\n\t            }\n\t        };\n\t    }());\n\n\t    /**\n\t     * An array of 32-bit words.\n\t     *\n\t     * @property {Array} words The array of 32-bit words.\n\t     * @property {number} sigBytes The number of significant bytes in this word array.\n\t     */\n\t    var WordArray = C_lib.WordArray = Base.extend({\n\t        /**\n\t         * Initializes a newly created word array.\n\t         *\n\t         * @param {Array} words (Optional) An array of 32-bit words.\n\t         * @param {number} sigBytes (Optional) The number of significant bytes in the words.\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.lib.WordArray.create();\n\t         *     var wordArray = CryptoJS.lib.WordArray.create([0x00010203, 0x04050607]);\n\t         *     var wordArray = CryptoJS.lib.WordArray.create([0x00010203, 0x04050607], 6);\n\t         */\n\t        init: function (words, sigBytes) {\n\t            words = this.words = words || [];\n\n\t            if (sigBytes != undefined) {\n\t                this.sigBytes = sigBytes;\n\t            } else {\n\t                this.sigBytes = words.length * 4;\n\t            }\n\t        },\n\n\t        /**\n\t         * Converts this word array to a string.\n\t         *\n\t         * @param {Encoder} encoder (Optional) The encoding strategy to use. Default: CryptoJS.enc.Hex\n\t         *\n\t         * @return {string} The stringified word array.\n\t         *\n\t         * @example\n\t         *\n\t         *     var string = wordArray + '';\n\t         *     var string = wordArray.toString();\n\t         *     var string = wordArray.toString(CryptoJS.enc.Utf8);\n\t         */\n\t        toString: function (encoder) {\n\t            return (encoder || Hex).stringify(this);\n\t        },\n\n\t        /**\n\t         * Concatenates a word array to this word array.\n\t         *\n\t         * @param {WordArray} wordArray The word array to append.\n\t         *\n\t         * @return {WordArray} This word array.\n\t         *\n\t         * @example\n\t         *\n\t         *     wordArray1.concat(wordArray2);\n\t         */\n\t        concat: function (wordArray) {\n\t            // Shortcuts\n\t            var thisWords = this.words;\n\t            var thatWords = wordArray.words;\n\t            var thisSigBytes = this.sigBytes;\n\t            var thatSigBytes = wordArray.sigBytes;\n\n\t            // Clamp excess bits\n\t            this.clamp();\n\n\t            // Concat\n\t            if (thisSigBytes % 4) {\n\t                // Copy one byte at a time\n\t                for (var i = 0; i < thatSigBytes; i++) {\n\t                    var thatByte = (thatWords[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                    thisWords[(thisSigBytes + i) >>> 2] |= thatByte << (24 - ((thisSigBytes + i) % 4) * 8);\n\t                }\n\t            } else {\n\t                // Copy one word at a time\n\t                for (var i = 0; i < thatSigBytes; i += 4) {\n\t                    thisWords[(thisSigBytes + i) >>> 2] = thatWords[i >>> 2];\n\t                }\n\t            }\n\t            this.sigBytes += thatSigBytes;\n\n\t            // Chainable\n\t            return this;\n\t        },\n\n\t        /**\n\t         * Removes insignificant bits.\n\t         *\n\t         * @example\n\t         *\n\t         *     wordArray.clamp();\n\t         */\n\t        clamp: function () {\n\t            // Shortcuts\n\t            var words = this.words;\n\t            var sigBytes = this.sigBytes;\n\n\t            // Clamp\n\t            words[sigBytes >>> 2] &= 0xffffffff << (32 - (sigBytes % 4) * 8);\n\t            words.length = Math.ceil(sigBytes / 4);\n\t        },\n\n\t        /**\n\t         * Creates a copy of this word array.\n\t         *\n\t         * @return {WordArray} The clone.\n\t         *\n\t         * @example\n\t         *\n\t         *     var clone = wordArray.clone();\n\t         */\n\t        clone: function () {\n\t            var clone = Base.clone.call(this);\n\t            clone.words = this.words.slice(0);\n\n\t            return clone;\n\t        },\n\n\t        /**\n\t         * Creates a word array filled with random bytes.\n\t         *\n\t         * @param {number} nBytes The number of random bytes to generate.\n\t         *\n\t         * @return {WordArray} The random word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.lib.WordArray.random(16);\n\t         */\n\t        random: function (nBytes) {\n\t            var words = [];\n\n\t            var r = (function (m_w) {\n\t                var m_w = m_w;\n\t                var m_z = 0x3ade68b1;\n\t                var mask = 0xffffffff;\n\n\t                return function () {\n\t                    m_z = (0x9069 * (m_z & 0xFFFF) + (m_z >> 0x10)) & mask;\n\t                    m_w = (0x4650 * (m_w & 0xFFFF) + (m_w >> 0x10)) & mask;\n\t                    var result = ((m_z << 0x10) + m_w) & mask;\n\t                    result /= 0x100000000;\n\t                    result += 0.5;\n\t                    return result * (Math.random() > .5 ? 1 : -1);\n\t                }\n\t            });\n\n\t            for (var i = 0, rcache; i < nBytes; i += 4) {\n\t                var _r = r((rcache || Math.random()) * 0x100000000);\n\n\t                rcache = _r() * 0x3ade67b7;\n\t                words.push((_r() * 0x100000000) | 0);\n\t            }\n\n\t            return new WordArray.init(words, nBytes);\n\t        }\n\t    });\n\n\t    /**\n\t     * Encoder namespace.\n\t     */\n\t    var C_enc = C.enc = {};\n\n\t    /**\n\t     * Hex encoding strategy.\n\t     */\n\t    var Hex = C_enc.Hex = {\n\t        /**\n\t         * Converts a word array to a hex string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The hex string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var hexString = CryptoJS.enc.Hex.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            // Shortcuts\n\t            var words = wordArray.words;\n\t            var sigBytes = wordArray.sigBytes;\n\n\t            // Convert\n\t            var hexChars = [];\n\t            for (var i = 0; i < sigBytes; i++) {\n\t                var bite = (words[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                hexChars.push((bite >>> 4).toString(16));\n\t                hexChars.push((bite & 0x0f).toString(16));\n\t            }\n\n\t            return hexChars.join('');\n\t        },\n\n\t        /**\n\t         * Converts a hex string to a word array.\n\t         *\n\t         * @param {string} hexStr The hex string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Hex.parse(hexString);\n\t         */\n\t        parse: function (hexStr) {\n\t            // Shortcut\n\t            var hexStrLength = hexStr.length;\n\n\t            // Convert\n\t            var words = [];\n\t            for (var i = 0; i < hexStrLength; i += 2) {\n\t                words[i >>> 3] |= parseInt(hexStr.substr(i, 2), 16) << (24 - (i % 8) * 4);\n\t            }\n\n\t            return new WordArray.init(words, hexStrLength / 2);\n\t        }\n\t    };\n\n\t    /**\n\t     * Latin1 encoding strategy.\n\t     */\n\t    var Latin1 = C_enc.Latin1 = {\n\t        /**\n\t         * Converts a word array to a Latin1 string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The Latin1 string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var latin1String = CryptoJS.enc.Latin1.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            // Shortcuts\n\t            var words = wordArray.words;\n\t            var sigBytes = wordArray.sigBytes;\n\n\t            // Convert\n\t            var latin1Chars = [];\n\t            for (var i = 0; i < sigBytes; i++) {\n\t                var bite = (words[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                latin1Chars.push(String.fromCharCode(bite));\n\t            }\n\n\t            return latin1Chars.join('');\n\t        },\n\n\t        /**\n\t         * Converts a Latin1 string to a word array.\n\t         *\n\t         * @param {string} latin1Str The Latin1 string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Latin1.parse(latin1String);\n\t         */\n\t        parse: function (latin1Str) {\n\t            // Shortcut\n\t            var latin1StrLength = latin1Str.length;\n\n\t            // Convert\n\t            var words = [];\n\t            for (var i = 0; i < latin1StrLength; i++) {\n\t                words[i >>> 2] |= (latin1Str.charCodeAt(i) & 0xff) << (24 - (i % 4) * 8);\n\t            }\n\n\t            return new WordArray.init(words, latin1StrLength);\n\t        }\n\t    };\n\n\t    /**\n\t     * UTF-8 encoding strategy.\n\t     */\n\t    var Utf8 = C_enc.Utf8 = {\n\t        /**\n\t         * Converts a word array to a UTF-8 string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The UTF-8 string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var utf8String = CryptoJS.enc.Utf8.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            try {\n\t                return decodeURIComponent(escape(Latin1.stringify(wordArray)));\n\t            } catch (e) {\n\t                throw new Error('Malformed UTF-8 data');\n\t            }\n\t        },\n\n\t        /**\n\t         * Converts a UTF-8 string to a word array.\n\t         *\n\t         * @param {string} utf8Str The UTF-8 string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Utf8.parse(utf8String);\n\t         */\n\t        parse: function (utf8Str) {\n\t            return Latin1.parse(unescape(encodeURIComponent(utf8Str)));\n\t        }\n\t    };\n\n\t    /**\n\t     * Abstract buffered block algorithm template.\n\t     *\n\t     * The property blockSize must be implemented in a concrete subtype.\n\t     *\n\t     * @property {number} _minBufferSize The number of blocks that should be kept unprocessed in the buffer. Default: 0\n\t     */\n\t    var BufferedBlockAlgorithm = C_lib.BufferedBlockAlgorithm = Base.extend({\n\t        /**\n\t         * Resets this block algorithm's data buffer to its initial state.\n\t         *\n\t         * @example\n\t         *\n\t         *     bufferedBlockAlgorithm.reset();\n\t         */\n\t        reset: function () {\n\t            // Initial values\n\t            this._data = new WordArray.init();\n\t            this._nDataBytes = 0;\n\t        },\n\n\t        /**\n\t         * Adds new data to this block algorithm's buffer.\n\t         *\n\t         * @param {WordArray|string} data The data to append. Strings are converted to a WordArray using UTF-8.\n\t         *\n\t         * @example\n\t         *\n\t         *     bufferedBlockAlgorithm._append('data');\n\t         *     bufferedBlockAlgorithm._append(wordArray);\n\t         */\n\t        _append: function (data) {\n\t            // Convert string to WordArray, else assume WordArray already\n\t            if (typeof data == 'string') {\n\t                data = Utf8.parse(data);\n\t            }\n\n\t            // Append\n\t            this._data.concat(data);\n\t            this._nDataBytes += data.sigBytes;\n\t        },\n\n\t        /**\n\t         * Processes available data blocks.\n\t         *\n\t         * This method invokes _doProcessBlock(offset), which must be implemented by a concrete subtype.\n\t         *\n\t         * @param {boolean} doFlush Whether all blocks and partial blocks should be processed.\n\t         *\n\t         * @return {WordArray} The processed data.\n\t         *\n\t         * @example\n\t         *\n\t         *     var processedData = bufferedBlockAlgorithm._process();\n\t         *     var processedData = bufferedBlockAlgorithm._process(!!'flush');\n\t         */\n\t        _process: function (doFlush) {\n\t            // Shortcuts\n\t            var data = this._data;\n\t            var dataWords = data.words;\n\t            var dataSigBytes = data.sigBytes;\n\t            var blockSize = this.blockSize;\n\t            var blockSizeBytes = blockSize * 4;\n\n\t            // Count blocks ready\n\t            var nBlocksReady = dataSigBytes / blockSizeBytes;\n\t            if (doFlush) {\n\t                // Round up to include partial blocks\n\t                nBlocksReady = Math.ceil(nBlocksReady);\n\t            } else {\n\t                // Round down to include only full blocks,\n\t                // less the number of blocks that must remain in the buffer\n\t                nBlocksReady = Math.max((nBlocksReady | 0) - this._minBufferSize, 0);\n\t            }\n\n\t            // Count words ready\n\t            var nWordsReady = nBlocksReady * blockSize;\n\n\t            // Count bytes ready\n\t            var nBytesReady = Math.min(nWordsReady * 4, dataSigBytes);\n\n\t            // Process blocks\n\t            if (nWordsReady) {\n\t                for (var offset = 0; offset < nWordsReady; offset += blockSize) {\n\t                    // Perform concrete-algorithm logic\n\t                    this._doProcessBlock(dataWords, offset);\n\t                }\n\n\t                // Remove processed words\n\t                var processedWords = dataWords.splice(0, nWordsReady);\n\t                data.sigBytes -= nBytesReady;\n\t            }\n\n\t            // Return processed words\n\t            return new WordArray.init(processedWords, nBytesReady);\n\t        },\n\n\t        /**\n\t         * Creates a copy of this object.\n\t         *\n\t         * @return {Object} The clone.\n\t         *\n\t         * @example\n\t         *\n\t         *     var clone = bufferedBlockAlgorithm.clone();\n\t         */\n\t        clone: function () {\n\t            var clone = Base.clone.call(this);\n\t            clone._data = this._data.clone();\n\n\t            return clone;\n\t        },\n\n\t        _minBufferSize: 0\n\t    });\n\n\t    /**\n\t     * Abstract hasher template.\n\t     *\n\t     * @property {number} blockSize The number of 32-bit words this hasher operates on. Default: 16 (512 bits)\n\t     */\n\t    var Hasher = C_lib.Hasher = BufferedBlockAlgorithm.extend({\n\t        /**\n\t         * Configuration options.\n\t         */\n\t        cfg: Base.extend(),\n\n\t        /**\n\t         * Initializes a newly created hasher.\n\t         *\n\t         * @param {Object} cfg (Optional) The configuration options to use for this hash computation.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hasher = CryptoJS.algo.SHA256.create();\n\t         */\n\t        init: function (cfg) {\n\t            // Apply config defaults\n\t            this.cfg = this.cfg.extend(cfg);\n\n\t            // Set initial values\n\t            this.reset();\n\t        },\n\n\t        /**\n\t         * Resets this hasher to its initial state.\n\t         *\n\t         * @example\n\t         *\n\t         *     hasher.reset();\n\t         */\n\t        reset: function () {\n\t            // Reset data buffer\n\t            BufferedBlockAlgorithm.reset.call(this);\n\n\t            // Perform concrete-hasher logic\n\t            this._doReset();\n\t        },\n\n\t        /**\n\t         * Updates this hasher with a message.\n\t         *\n\t         * @param {WordArray|string} messageUpdate The message to append.\n\t         *\n\t         * @return {Hasher} This hasher.\n\t         *\n\t         * @example\n\t         *\n\t         *     hasher.update('message');\n\t         *     hasher.update(wordArray);\n\t         */\n\t        update: function (messageUpdate) {\n\t            // Append\n\t            this._append(messageUpdate);\n\n\t            // Update the hash\n\t            this._process();\n\n\t            // Chainable\n\t            return this;\n\t        },\n\n\t        /**\n\t         * Finalizes the hash computation.\n\t         * Note that the finalize operation is effectively a destructive, read-once operation.\n\t         *\n\t         * @param {WordArray|string} messageUpdate (Optional) A final message update.\n\t         *\n\t         * @return {WordArray} The hash.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hash = hasher.finalize();\n\t         *     var hash = hasher.finalize('message');\n\t         *     var hash = hasher.finalize(wordArray);\n\t         */\n\t        finalize: function (messageUpdate) {\n\t            // Final message update\n\t            if (messageUpdate) {\n\t                this._append(messageUpdate);\n\t            }\n\n\t            // Perform concrete-hasher logic\n\t            var hash = this._doFinalize();\n\n\t            return hash;\n\t        },\n\n\t        blockSize: 512/32,\n\n\t        /**\n\t         * Creates a shortcut function to a hasher's object interface.\n\t         *\n\t         * @param {Hasher} hasher The hasher to create a helper for.\n\t         *\n\t         * @return {Function} The shortcut function.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var SHA256 = CryptoJS.lib.Hasher._createHelper(CryptoJS.algo.SHA256);\n\t         */\n\t        _createHelper: function (hasher) {\n\t            return function (message, cfg) {\n\t                return new hasher.init(cfg).finalize(message);\n\t            };\n\t        },\n\n\t        /**\n\t         * Creates a shortcut function to the HMAC's object interface.\n\t         *\n\t         * @param {Hasher} hasher The hasher to use in this HMAC helper.\n\t         *\n\t         * @return {Function} The shortcut function.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var HmacSHA256 = CryptoJS.lib.Hasher._createHmacHelper(CryptoJS.algo.SHA256);\n\t         */\n\t        _createHmacHelper: function (hasher) {\n\t            return function (message, key) {\n\t                return new C_algo.HMAC.init(hasher, key).finalize(message);\n\t            };\n\t        }\n\t    });\n\n\t    /**\n\t     * Algorithm namespace.\n\t     */\n\t    var C_algo = C.algo = {};\n\n\t    return C;\n\t}(Math));\n\n\n\treturn CryptoJS;\n\n}));","'use strict'\n\nconst timeout = require('./lib/timeout')\nconst delay = require('./lib/delay')\nconst TimeoutError = require('./lib/TimeoutError')\nconst promise = require('./lib/promise')\nconst EventEmitter = require('events')\nconst Deferred = require('./lib/Deferred')\n\nexports.EventEmitter = EventEmitter\nexports.timeout = timeout\nexports.delay = delay\nexports.TimeoutError = TimeoutError\nexports.promise = promise\nexports.Deferred = Deferred\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction $getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return $getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = $getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  var args = [];\n  for (var i = 0; i < arguments.length; i++) args.push(arguments[i]);\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    ReflectApply(this.listener, this.target, args);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","'use strict'\n\nconst JID = require('./lib/JID')\nconst escaping = require('./lib/escaping')\nconst parse = require('./lib/parse')\n\nfunction jid(...args) {\n  if (!args[1] && !args[2]) {\n    return parse(...args)\n  }\n\n  return new JID(...args)\n}\n\nexports = module.exports = jid.bind()\nexports.jid = jid\nexports.JID = JID\nexports.equal = function(a, b) {\n  return a.equals(b)\n}\n\nexports.detectEscape = escaping.detect\nexports.escapeLocal = escaping.escape\nexports.unescapeLocal = escaping.unescape\nexports.parse = parse\n","const config = require('../cubeConfig');\r\n\r\nclass WebRTCHelpers {\r\n    static getUserJid(id, appId) {\r\n        return id + '-' + appId + '@' + config.endpoints.chat;\r\n    }\r\n\r\n    static getUserIdFromJID(jid) {\r\n        if (jid.indexOf('@') < 0) return null;\r\n        return parseInt(jid.split('@')[0].split('-')[0]);\r\n    }\r\n\r\n    static userCurrentJid(client) {\r\n        return client.jid._local + '@' + client.jid._domain + '/' + client.jid._resource;\r\n    }\r\n\r\n    static trace(text) {\r\n        if (config.debug) {\r\n            console.log('[VideoChat]:', text);\r\n        }\r\n    }\r\n\r\n    static traceWarning(text) {\r\n        if (config.debug) {\r\n            console.warn('[VideoChat]:', text);\r\n        }\r\n    }\r\n\r\n    static traceError(text) {\r\n        if (config.debug) {\r\n            console.error('[VideoChat]:', text);\r\n        }\r\n    }\r\n\r\n    static getVersionFirefox() {\r\n        const ua = navigator ? navigator.userAgent : false;\r\n        let version;\r\n        if (ua) {\r\n            const ffInfo = ua.match(/(?:firefox)[ \\/](\\d+)/i) || [];\r\n            version = ffInfo[1] ? + ffInfo[1] : null;\r\n        }\r\n        return version;\r\n    }\r\n\r\n    static getVersionSafari() {\r\n        const ua = navigator ? navigator.userAgent : false;\r\n        let version;\r\n        if (ua) {\r\n            const sInfo = ua.match(/(?:safari)[ \\/](\\d+)/i) || [];\r\n            if (sInfo.length) {\r\n                const sVer = ua.match(/(?:version)[ \\/](\\d+)/i) || [];\r\n                if (sVer) {\r\n                    version = sVer[1] ? + sVer[1] : null;\r\n                } else {\r\n                    version = null;\r\n                }\r\n            } else {\r\n                version = null;\r\n            }\r\n        }\r\n\r\n        return version;\r\n    }\r\n};\r\n\r\nmodule.exports = WebRTCHelpers;\r\n","'use strict'\n\nmodule.exports = class TimeoutError extends Error {\n  constructor(message) {\n    super(message)\n    this.name = 'TimeoutError'\n  }\n}\n","'use strict'\n\nconst _Element = require('ltx/lib/Element')\n\nclass Element extends _Element {\n  setAttrs(attrs) {\n    if (typeof attrs === 'string') {\n      this.attrs.xmlns = attrs\n    } else if (attrs) {\n      Object.keys(attrs).forEach(function(key) {\n        // https://github.com/facebook/react/pull/4596\n        // https://www.npmjs.com/package/babel-plugin-transform-react-jsx-source\n        if (key === '__source' || key === '__self') return\n        const val = attrs[key]\n        if (val !== undefined && val !== null)\n          this.attrs[key.toString()] = val.toString()\n      }, this)\n    }\n  }\n\n  append(nodes) {\n    nodes = Array.isArray(nodes) ? nodes : [nodes]\n    nodes.forEach(node => {\n      this.children.push(node)\n      if (typeof node === 'object') {\n        node.parent = this\n      }\n    })\n    return this\n  }\n\n  prepend(nodes) {\n    nodes = Array.isArray(nodes) ? nodes : [nodes]\n    nodes.forEach(node => {\n      this.children.unshift(node)\n      if (typeof node === 'object') {\n        node.parent = this\n      }\n    })\n    return this\n  }\n}\n\nmodule.exports = Element\n","'use strict'\n\nvar escapeXMLTable = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  '\\'': '&apos;'\n}\n\nfunction escapeXMLReplace (match) {\n  return escapeXMLTable[match]\n}\n\nvar unescapeXMLTable = {\n  '&amp;': '&',\n  '&lt;': '<',\n  '&gt;': '>',\n  '&quot;': '\"',\n  '&apos;': \"'\"\n}\n\nfunction unescapeXMLReplace (match) {\n  if (match[1] === '#') {\n    var num\n    if (match[2] === 'x') {\n      num = parseInt(match.slice(3), 16)\n    } else {\n      num = parseInt(match.slice(2), 10)\n    }\n    // https://www.w3.org/TR/xml/#NT-Char defines legal XML characters:\n    // #x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]\n    if (num === 0x9 || num === 0xA || num === 0xD ||\n        (num >= 0x20 && num <= 0xD7FF) ||\n        (num >= 0xE000 && num <= 0xFFFD) ||\n        (num >= 0x10000 && num <= 0x10FFFF)) {\n      return String.fromCodePoint(num)\n    }\n    throw new Error('Illegal XML character 0x' + num.toString(16))\n  }\n  if (unescapeXMLTable[match]) {\n    return unescapeXMLTable[match] || match\n  }\n  throw new Error('Illegal XML entity ' + match)\n}\n\nexports.escapeXML = function escapeXML (s) {\n  return s.replace(/&|<|>|\"|'/g, escapeXMLReplace)\n}\n\nexports.unescapeXML = function unescapeXML (s) {\n  var result = ''\n  var start = -1\n  var end = -1\n  var previous = 0\n  while ((start = s.indexOf('&', previous)) !== -1 && (end = s.indexOf(';', start + 1)) !== -1) {\n    result = result +\n      s.substring(previous, start) +\n      unescapeXMLReplace(s.substring(start, end + 1))\n    previous = end + 1\n  }\n\n  // shortcut if loop never entered:\n  // return the original string without creating new objects\n  if (previous === 0) return s\n\n  // push the remaining characters\n  result = result + s.substring(previous)\n\n  return result\n}\n\nexports.escapeXMLText = function escapeXMLText (s) {\n  return s.replace(/&|<|>/g, escapeXMLReplace)\n}\n\nexports.unescapeXMLText = function unescapeXMLText (s) {\n  return s.replace(/&(amp|#38|lt|#60|gt|#62);/g, unescapeXMLReplace)\n}\n","'use strict'\n\nclass XMPPError extends Error {\n  constructor(condition, text, application) {\n    super(condition + (text ? ` - ${text}` : ''))\n    this.name = 'XMPPError'\n    this.condition = condition\n    this.text = text\n    this.application = application\n  }\n\n  static fromElement(element) {\n    const [condition, second, third] = element.children\n    let text\n    let application\n\n    if (second) {\n      if (second.is('text')) {\n        text = second\n      } else if (second) {\n        application = second\n      }\n\n      if (third) application = third\n    }\n\n    const error = new this(condition.name, text ? text.text() : '', application)\n    error.element = element\n    return error\n  }\n}\n\nmodule.exports = XMPPError\n","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;",";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([\"./core\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\t(function () {\n\t    // Shortcuts\n\t    var C = CryptoJS;\n\t    var C_lib = C.lib;\n\t    var Base = C_lib.Base;\n\t    var C_enc = C.enc;\n\t    var Utf8 = C_enc.Utf8;\n\t    var C_algo = C.algo;\n\n\t    /**\n\t     * HMAC algorithm.\n\t     */\n\t    var HMAC = C_algo.HMAC = Base.extend({\n\t        /**\n\t         * Initializes a newly created HMAC.\n\t         *\n\t         * @param {Hasher} hasher The hash algorithm to use.\n\t         * @param {WordArray|string} key The secret key.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hmacHasher = CryptoJS.algo.HMAC.create(CryptoJS.algo.SHA256, key);\n\t         */\n\t        init: function (hasher, key) {\n\t            // Init hasher\n\t            hasher = this._hasher = new hasher.init();\n\n\t            // Convert string to WordArray, else assume WordArray already\n\t            if (typeof key == 'string') {\n\t                key = Utf8.parse(key);\n\t            }\n\n\t            // Shortcuts\n\t            var hasherBlockSize = hasher.blockSize;\n\t            var hasherBlockSizeBytes = hasherBlockSize * 4;\n\n\t            // Allow arbitrary length keys\n\t            if (key.sigBytes > hasherBlockSizeBytes) {\n\t                key = hasher.finalize(key);\n\t            }\n\n\t            // Clamp excess bits\n\t            key.clamp();\n\n\t            // Clone key for inner and outer pads\n\t            var oKey = this._oKey = key.clone();\n\t            var iKey = this._iKey = key.clone();\n\n\t            // Shortcuts\n\t            var oKeyWords = oKey.words;\n\t            var iKeyWords = iKey.words;\n\n\t            // XOR keys with pad constants\n\t            for (var i = 0; i < hasherBlockSize; i++) {\n\t                oKeyWords[i] ^= 0x5c5c5c5c;\n\t                iKeyWords[i] ^= 0x36363636;\n\t            }\n\t            oKey.sigBytes = iKey.sigBytes = hasherBlockSizeBytes;\n\n\t            // Set initial values\n\t            this.reset();\n\t        },\n\n\t        /**\n\t         * Resets this HMAC to its initial state.\n\t         *\n\t         * @example\n\t         *\n\t         *     hmacHasher.reset();\n\t         */\n\t        reset: function () {\n\t            // Shortcut\n\t            var hasher = this._hasher;\n\n\t            // Reset\n\t            hasher.reset();\n\t            hasher.update(this._iKey);\n\t        },\n\n\t        /**\n\t         * Updates this HMAC with a message.\n\t         *\n\t         * @param {WordArray|string} messageUpdate The message to append.\n\t         *\n\t         * @return {HMAC} This HMAC instance.\n\t         *\n\t         * @example\n\t         *\n\t         *     hmacHasher.update('message');\n\t         *     hmacHasher.update(wordArray);\n\t         */\n\t        update: function (messageUpdate) {\n\t            this._hasher.update(messageUpdate);\n\n\t            // Chainable\n\t            return this;\n\t        },\n\n\t        /**\n\t         * Finalizes the HMAC computation.\n\t         * Note that the finalize operation is effectively a destructive, read-once operation.\n\t         *\n\t         * @param {WordArray|string} messageUpdate (Optional) A final message update.\n\t         *\n\t         * @return {WordArray} The HMAC.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hmac = hmacHasher.finalize();\n\t         *     var hmac = hmacHasher.finalize('message');\n\t         *     var hmac = hmacHasher.finalize(wordArray);\n\t         */\n\t        finalize: function (messageUpdate) {\n\t            // Shortcut\n\t            var hasher = this._hasher;\n\n\t            // Compute HMAC\n\t            var innerHash = hasher.finalize(messageUpdate);\n\t            hasher.reset();\n\t            var hmac = hasher.finalize(this._oKey.clone().concat(innerHash));\n\n\t            return hmac;\n\t        }\n\t    });\n\t}());\n\n\n}));","'use strict'\n\nconst {EventEmitter, promise} = require('@xmpp/events')\nconst jid = require('@xmpp/jid')\nconst xml = require('@xmpp/xml')\nconst StreamError = require('./lib/StreamError')\nconst {parseHost, parseService} = require('./lib/util')\n\nconst NS_STREAM = 'urn:ietf:params:xml:ns:xmpp-streams'\n\nclass Connection extends EventEmitter {\n  constructor(options = {}) {\n    super()\n    this.jid = null\n    this.timeout = 2000\n    this.options = options\n    this.socketListeners = Object.create(null)\n    this.parserListeners = Object.create(null)\n    this.status = 'offline'\n    this.socket = null\n    this.parser = null\n    this.root = null\n  }\n\n  _reset() {\n    this.jid = null\n    this.status = 'offline'\n    this._detachSocket()\n    this._detachParser()\n  }\n\n  async _streamError(condition, children) {\n    try {\n      await this.send(\n        // prettier-ignore\n        xml('stream:error', {}, [\n          xml(condition, {xmlns: NS_STREAM}, children),\n        ])\n      )\n      // eslint-disable-next-line no-unused-vars\n    } catch (err) {}\n\n    return this._end()\n  }\n\n  _onData(data) {\n    const str = data.toString('utf8')\n    this.emit('input', str)\n    this.parser.write(str)\n  }\n\n  _onParserError(error) {\n    // https://xmpp.org/rfcs/rfc6120.html#streams-error-conditions-bad-format\n    // \"This error can be used instead of the more specific XML-related errors,\n    // such as <bad-namespace-prefix/>, <invalid-xml/>, <not-well-formed/>, <restricted-xml/>,\n    // and <unsupported-encoding/>. However, the more specific errors are RECOMMENDED.\"\n    this._streamError('bad-format')\n    this._detachParser()\n    this.emit('error', error)\n  }\n\n  _attachSocket(socket) {\n    const sock = (this.socket = socket)\n    const listeners = this.socketListeners\n\n    listeners.data = this._onData.bind(this)\n\n    listeners.close = (dirty, event) => {\n      this._reset()\n      this._status('disconnect', {clean: !dirty, event})\n    }\n\n    listeners.connect = () => {\n      this._status('connect')\n    }\n\n    listeners.error = error => {\n      this.emit('error', error)\n    }\n\n    sock.on('close', listeners.close)\n    sock.on('data', listeners.data)\n    sock.on('error', listeners.error)\n    sock.on('connect', listeners.connect)\n  }\n\n  _detachSocket() {\n    const {socketListeners, socket} = this\n    Object.getOwnPropertyNames(socketListeners).forEach(k => {\n      socket.removeListener(k, socketListeners[k])\n      delete socketListeners[k]\n    })\n    this.socket = null\n    return socket\n  }\n\n  _onElement(element) {\n    this.emit('element', element)\n    this.emit(this.isStanza(element) ? 'stanza' : 'nonza', element)\n\n    if (element.name === 'stream:error') {\n      this._onStreamError(element)\n    }\n  }\n\n  // https://xmpp.org/rfcs/rfc6120.html#streams-error\n  _onStreamError(element) {\n    const error = StreamError.fromElement(element)\n\n    if (error.condition === 'see-other-host') {\n      this._onSeeOtherHost(error)\n    } else {\n      this.emit('error', error)\n    }\n\n    // \"Stream Errors Are Unrecoverable\"\n    // \"The entity that receives the stream error then SHALL close the stream\"\n    this._end()\n  }\n\n  // https://xmpp.org/rfcs/rfc6120.html#streams-error-conditions-see-other-host\n  async _onSeeOtherHost(error) {\n    const {protocol} = parseService(this.options.service)\n\n    const host = error.element.getChildText('see-other-host')\n    const {port} = parseHost(host)\n\n    let service\n    if (port) {\n      service = `${protocol || 'xmpp:'}//${host}`\n    } else {\n      service = (protocol ? `${protocol}//` : '') + host\n    }\n\n    try {\n      await promise(this, 'disconnect')\n      const {domain, lang} = this.options\n      await this.connect(service)\n      await this.open({domain, lang})\n    } catch (err) {\n      this.emit('error', err)\n    }\n  }\n\n  _attachParser(p) {\n    const parser = (this.parser = p)\n    const listeners = this.parserListeners\n\n    listeners.element = this._onElement.bind(this)\n    listeners.error = this._onParserError.bind(this)\n\n    listeners.end = element => {\n      this._detachParser()\n      this._status('close', element)\n    }\n\n    listeners.start = element => {\n      this._status('open', element)\n    }\n\n    parser.on('error', listeners.error)\n    parser.on('element', listeners.element)\n    parser.on('end', listeners.end)\n    parser.on('start', listeners.start)\n  }\n\n  _detachParser() {\n    const listeners = this.parserListeners\n    Object.getOwnPropertyNames(listeners).forEach(k => {\n      this.parser.removeListener(k, listeners[k])\n      delete listeners[k]\n    })\n    this.parser = null\n  }\n\n  _jid(id) {\n    this.jid = jid(id)\n    return this.jid\n  }\n\n  _status(status, ...args) {\n    this.status = status\n    this.emit('status', status, ...args)\n    this.emit(status, ...args)\n  }\n\n  async _end() {\n    let el\n    try {\n      el = await this.close()\n      // eslint-disable-next-line no-unused-vars\n    } catch (err) {}\n\n    try {\n      await this.disconnect()\n      // eslint-disable-next-line no-unused-vars\n    } catch (err) {}\n\n    return el\n  }\n\n  /**\n   * Opens the socket then opens the stream\n   */\n  async start() {\n    if (this.status !== 'offline') {\n      throw new Error('Connection is not offline')\n    }\n\n    const {service, domain, lang} = this.options\n\n    await this.connect(service)\n\n    const promiseOnline = promise(this, 'online')\n\n    await this.open({domain, lang})\n\n    return promiseOnline\n  }\n\n  /**\n   * Connects the socket\n   */\n  async connect(service) {\n    this._status('connecting', service)\n    const socket = new this.Socket()\n    this._attachSocket(socket)\n    // The 'connect' status is set by the socket 'connect' listener\n    socket.connect(this.socketParameters(service))\n    return promise(socket, 'connect')\n  }\n\n  /**\n   * Disconnects the socket\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async disconnect(timeout = this.timeout) {\n    if (this.socket) this._status('disconnecting')\n\n    this.socket.end()\n\n    // The 'disconnect' status is set by the socket 'close' listener\n    await promise(this.socket, 'close', 'error', timeout)\n  }\n\n  /**\n   * Opens the stream\n   */\n  async open(options) {\n    this._status('opening')\n\n    if (typeof options === 'string') {\n      options = {domain: options}\n    }\n\n    const {domain, lang, timeout = this.timeout} = options\n\n    const headerElement = this.headerElement()\n    headerElement.attrs.to = domain\n    headerElement.attrs['xml:lang'] = lang\n    this.root = headerElement\n\n    this._attachParser(new this.Parser())\n\n    await this.write(this.header(headerElement))\n    return promise(this, 'open', 'error', timeout)\n  }\n\n  /**\n   * Closes the stream then closes the socket\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async stop() {\n    const el = await this._end()\n    if (this.status !== 'offline') this._status('offline', el)\n    return el\n  }\n\n  /**\n   * Closes the stream and wait for the server to close it\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async close(timeout = this.timeout) {\n    const p = Promise.all([\n      promise(this.parser, 'end', 'error', timeout),\n      this.write(this.footer(this.footerElement())),\n    ])\n\n    if (this.parser && this.socket) this._status('closing')\n    const [el] = await p\n    this.root = null\n    return el\n    // The 'close' status is set by the parser 'end' listener\n  }\n\n  /**\n   * Restart the stream\n   * https://xmpp.org/rfcs/rfc6120.html#streams-negotiation-restart\n   */\n  async restart() {\n    this._detachParser()\n    const {domain, lang} = this.options\n    return this.open({domain, lang})\n  }\n\n  async send(element) {\n    element.parent = this.root\n    this.emit('outgoing', element)\n    await this.write(element)\n    this.emit('send', element)\n  }\n\n  sendReceive(element, timeout = this.timeout) {\n    return Promise.all([\n      this.send(element),\n      promise(this, 'element', 'error', timeout),\n    ]).then(([, el]) => el)\n  }\n\n  write(data) {\n    return new Promise((resolve, reject) => {\n      // https://xmpp.org/rfcs/rfc6120.html#streams-close\n      // \"Refrain from sending any further data over its outbound stream to the other entity\"\n      if (this.status === 'closing') {\n        reject(new Error('Connection is closing'))\n        return\n      }\n\n      const str = data.toString('utf8')\n      this.socket.write(str, err => {\n        if (err) {\n          return reject(err)\n        }\n\n        this.emit('output', str)\n        resolve()\n      })\n    })\n  }\n\n  isStanza(element) {\n    const {name} = element\n    return name === 'iq' || name === 'message' || name === 'presence'\n  }\n\n  isNonza(element) {\n    return !this.isStanza(element)\n  }\n\n  // Override\n  header(el) {\n    return el.toString()\n  }\n\n  // Override\n  headerElement() {\n    return new xml.Element('', {\n      version: '1.0',\n      xmlns: this.NS,\n    })\n  }\n\n  // Override\n  footer(el) {\n    return el.toString()\n  }\n\n  // Override\n  footerElement() {}\n\n  // Override\n  socketParameters() {}\n}\n\n// Overrirde\nConnection.prototype.NS = ''\nConnection.prototype.Socket = null\nConnection.prototype.Parser = null\n\nmodule.exports = Connection\n","'use strict'\n\nmodule.exports = function delay(ms) {\n  let timeout\n  const promise = new Promise(resolve => {\n    timeout = setTimeout(resolve, ms)\n  })\n  promise.timeout = timeout\n  return promise\n}\n","'use strict'\n\nconst escaping = require('./escaping')\n\n/**\n * JID implements\n * - XMPP addresses according to RFC6122\n * - XEP-0106: JID Escaping\n *\n * @see http://tools.ietf.org/html/rfc6122#section-2\n * @see http://xmpp.org/extensions/xep-0106.html\n */\nclass JID {\n  constructor(local, domain, resource) {\n    if (typeof domain !== 'string' || !domain) {\n      throw new TypeError(`Invalid domain.`)\n    }\n\n    this.setDomain(domain)\n    this.setLocal(typeof local === 'string' ? local : '')\n    this.setResource(typeof resource === 'string' ? resource : '')\n  }\n\n  [Symbol.toPrimitive](hint) {\n    if (hint === 'number') {\n      return NaN\n    }\n\n    return this.toString()\n  }\n\n  toString(unescape) {\n    let s = this._domain\n    if (this._local) {\n      s = this.getLocal(unescape) + '@' + s\n    }\n\n    if (this._resource) {\n      s = s + '/' + this._resource\n    }\n\n    return s\n  }\n\n  /**\n   * Convenience method to distinguish users\n   * */\n  bare() {\n    if (this._resource) {\n      return new JID(this._local, this._domain, null)\n    }\n\n    return this\n  }\n\n  /**\n   * Comparison function\n   * */\n  equals(other) {\n    return (\n      this._local === other._local &&\n      this._domain === other._domain &&\n      this._resource === other._resource\n    )\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-localpart\n   * */\n  setLocal(local, escape) {\n    escape = escape || escaping.detect(local)\n\n    if (escape) {\n      local = escaping.escape(local)\n    }\n\n    this._local = local && local.toLowerCase()\n    return this\n  }\n\n  getLocal(unescape) {\n    unescape = unescape || false\n    let local = null\n\n    if (unescape) {\n      local = escaping.unescape(this._local)\n    } else {\n      local = this._local\n    }\n\n    return local\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-domain\n   */\n  setDomain(domain) {\n    this._domain = domain.toLowerCase()\n    return this\n  }\n\n  getDomain() {\n    return this._domain\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-resourcepart\n   */\n  setResource(resource) {\n    this._resource = resource\n    return this\n  }\n\n  getResource() {\n    return this._resource\n  }\n}\n\nObject.defineProperty(JID.prototype, 'local', {\n  get: JID.prototype.getLocal,\n  set: JID.prototype.setLocal,\n})\n\nObject.defineProperty(JID.prototype, 'domain', {\n  get: JID.prototype.getDomain,\n  set: JID.prototype.setDomain,\n})\n\nObject.defineProperty(JID.prototype, 'resource', {\n  get: JID.prototype.getResource,\n  set: JID.prototype.setResource,\n})\n\nmodule.exports = JID\n","'use strict'\n\nmodule.exports.detect = function(local) {\n  if (!local) {\n    return false\n  }\n\n  // Remove all escaped sequences\n  const tmp = local\n    .replace(/\\\\20/g, '')\n    .replace(/\\\\22/g, '')\n    .replace(/\\\\26/g, '')\n    .replace(/\\\\27/g, '')\n    .replace(/\\\\2f/g, '')\n    .replace(/\\\\3a/g, '')\n    .replace(/\\\\3c/g, '')\n    .replace(/\\\\3e/g, '')\n    .replace(/\\\\40/g, '')\n    .replace(/\\\\5c/g, '')\n\n  // Detect if we have unescaped sequences\n  // eslint-disable-next-line unicorn/regex-shorthand\n  const search = tmp.search(/\\\\| |\"|&|'|\\/|:|<|>|@/g)\n  if (search === -1) {\n    return false\n  }\n\n  return true\n}\n\n/**\n * Escape the local part of a JID.\n *\n * @see http://xmpp.org/extensions/xep-0106.html\n * @param String local local part of a jid\n * @return An escaped local part\n */\nmodule.exports.escape = function(local) {\n  if (local === null) {\n    return null\n  }\n\n  return local\n    .replace(/^\\s+|\\s+$/g, '')\n    .replace(/\\\\/g, '\\\\5c')\n    .replace(/ /g, '\\\\20')\n    .replace(/\"/g, '\\\\22')\n    .replace(/&/g, '\\\\26')\n    .replace(/'/g, '\\\\27')\n    .replace(/\\//g, '\\\\2f')\n    .replace(/:/g, '\\\\3a')\n    .replace(/</g, '\\\\3c')\n    .replace(/>/g, '\\\\3e')\n    .replace(/@/g, '\\\\40')\n    .replace(/\\3a/g, '\\u0005c3a')\n}\n\n/**\n * Unescape a local part of a JID.\n *\n * @see http://xmpp.org/extensions/xep-0106.html\n * @param String local local part of a jid\n * @return unescaped local part\n */\nmodule.exports.unescape = function(local) {\n  if (local === null) {\n    return null\n  }\n\n  return local\n    .replace(/\\\\20/g, ' ')\n    .replace(/\\\\22/g, '\"')\n    .replace(/\\\\26/g, '&')\n    .replace(/\\\\27/g, \"'\")\n    .replace(/\\\\2f/g, '/')\n    .replace(/\\\\3a/g, ':')\n    .replace(/\\\\3c/g, '<')\n    .replace(/\\\\3e/g, '>')\n    .replace(/\\\\40/g, '@')\n    .replace(/\\\\5c/g, '\\\\')\n}\n","'use strict'\n\nconst LtxParser = require('ltx/lib/parsers/ltx')\nconst Element = require('./Element')\nconst EventEmitter = require('events')\nconst XMLError = require('./XMLError')\n\nclass Parser extends EventEmitter {\n  constructor() {\n    super()\n    const parser = new LtxParser()\n    this.root = null\n    this.cursor = null\n\n    parser.on('startElement', this.onStartElement.bind(this))\n    parser.on('endElement', this.onEndElement.bind(this))\n    parser.on('text', this.onText.bind(this))\n\n    this.parser = parser\n  }\n\n  onStartElement(name, attrs) {\n    const element = new Element(name, attrs)\n\n    const {root, cursor} = this\n\n    if (!root) {\n      this.root = element\n      this.emit('start', element)\n    } else if (cursor !== root) {\n      cursor.append(element)\n    }\n\n    this.cursor = element\n  }\n\n  onEndElement(name) {\n    const {root, cursor} = this\n    if (name !== cursor.name) {\n      // <foo></bar>\n      this.emit('error', new XMLError(`${cursor.name} must be closed.`))\n      return\n    }\n\n    if (cursor === root) {\n      this.emit('end', root)\n      return\n    }\n\n    if (!cursor.parent) {\n      cursor.parent = root\n      this.emit('element', cursor)\n      this.cursor = root\n      return\n    }\n\n    this.cursor = cursor.parent\n  }\n\n  onText(str) {\n    const {cursor} = this\n    if (!cursor) {\n      this.emit('error', new XMLError(`${str} must be a child.`))\n      return\n    }\n\n    cursor.t(str)\n  }\n\n  write(data) {\n    this.parser.write(data)\n  }\n\n  end(data) {\n    if (data) {\n      this.parser.write(data)\n    }\n  }\n}\n\nParser.XMLError = XMLError\n\nmodule.exports = Parser\n","'use strict'\n\nmodule.exports = class XMLError extends Error {\n  constructor(...args) {\n    super(...args)\n    this.name = 'XMLError'\n  }\n}\n","'use strict'\n\nmodule.exports = class Context {\n  constructor(entity, stanza) {\n    this.stanza = stanza\n    this.entity = entity\n\n    const {name, attrs} = stanza\n    const {type, id} = attrs\n\n    this.name = name\n    this.id = id || ''\n\n    if (name === 'message') {\n      this.type = type || 'normal'\n    } else if (name === 'presence') {\n      this.type = type || 'available'\n    } else {\n      this.type = type || ''\n    }\n\n    this.from = null\n    this.to = null\n    this.local = ''\n    this.domain = ''\n    this.resource = ''\n  }\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__30__;","const config = require('../cubeConfig');\r\nconst Helpers = require('./cubeWebRTCHelpers');\r\nconst SessionConnectionState = require('./cubeWebRTCConstants').SessionConnectionState\r\nconst RTCPeerConnection = require('../cubeDependencies').RTCPeerConnection;\r\nconst RTCSessionDescription = require('../cubeDependencies').RTCSessionDescription;\r\nconst RTCIceCandidate = require('../cubeDependencies').RTCIceCandidate;\r\nconst MediaStream = require('../cubeDependencies').MediaStream;\r\nconst PeerConnectionState = require('./cubeWebRTCConstants').PeerConnectionState;\r\n\r\nRTCPeerConnection.prototype._init = function (delegate, userID, sessionID, type) {\r\n    Helpers.trace('RTCPeerConnection init. userID: ' + userID + ', sessionID: ' + sessionID + ', type: ' + type);\r\n\r\n    this.delegate = delegate;\r\n\r\n    this.sessionID = sessionID;\r\n    this.userID = userID;\r\n    this.type = type;\r\n    this.remoteSDP = null;\r\n\r\n    this.state = PeerConnectionState.NEW;\r\n\r\n    this.onicecandidate = this.onIceCandidateCallback.bind(this);\r\n    this.onsignalingstatechange = this.onSignalingStateCallback.bind(this);\r\n    this.oniceconnectionstatechange = this.onIceConnectionStateCallback.bind(this);\r\n\r\n    if (Helpers.getVersionSafari() >= 11) {\r\n        this.remoteStream = new MediaStream();\r\n        this.ontrack = this.onAddRemoteMediaCallback.bind(this);\r\n        this.onStatusClosedChecker = undefined;\r\n    } else {\r\n        this.remoteStream = null;\r\n        this.onaddstream = this.onAddRemoteMediaCallback.bind(this);\r\n    }\r\n\r\n    /** We use this timer interval to dial a user - produce the call requests each N seconds. */\r\n    this.dialingTimer = null;\r\n    this.answerTimeInterval = 0;\r\n    this.statsReportTimer = null;\r\n\r\n    this.iceCandidates = [];\r\n\r\n    this.released = false;\r\n};\r\n\r\nRTCPeerConnection.prototype.release = function () {\r\n    this._clearDialingTimer();\r\n    this._clearStatsReportTimer();\r\n\r\n    this.close();\r\n\r\n    // TODO: 'closed' state doesn't fires on Safari 11 (do it manually)\r\n    if (Helpers.getVersionSafari() >= 11) {\r\n        this.onIceConnectionStateCallback();\r\n    }\r\n\r\n    this.released = true;\r\n};\r\n\r\nRTCPeerConnection.prototype.updateRemoteSDP = function (newSDP) {\r\n    if (!newSDP) {\r\n        throw new Error(\"sdp string can't be empty.\");\r\n    } else {\r\n        this.remoteSDP = newSDP;\r\n    }\r\n};\r\n\r\nRTCPeerConnection.prototype.getRemoteSDP = function () {\r\n    return this.remoteSDP;\r\n};\r\n\r\nRTCPeerConnection.prototype.setRemoteSessionDescription = function (type, remoteSessionDescription) {\r\n    const desc = new RTCSessionDescription({ sdp: remoteSessionDescription, type: type });\r\n\r\n    desc.sdp = setMediaBitrate(desc.sdp, 'video', this.delegate.bandwidth);\r\n\r\n    return this.setRemoteDescription(desc);\r\n};\r\n\r\nRTCPeerConnection.prototype.addLocalStream = function (localStream) {\r\n    if (localStream) {\r\n        this.addStream(localStream);\r\n    } else {\r\n        throw new Error(\"'RTCPeerConnection.addStream' error: stream is 'null'.\");\r\n    }\r\n};\r\n\r\nRTCPeerConnection.prototype.getAndSetLocalSessionDescription = function (callType) {\r\n    return new Promise((resolve, reject) => {\r\n        this.state = PeerConnectionState.CONNECTING;\r\n\r\n        if (this.type === 'offer') {\r\n            this.createOffer()\r\n                .then(offer => {\r\n                    offer.sdp = setMediaBitrate(offer.sdp, 'video', this.delegate.bandwidth);\r\n                    this.setLocalDescription(offer).then(resolve).catch(reject);\r\n                }).catch(reject);\r\n        } else {\r\n            this.createAnswer()\r\n                .then(answer => {\r\n                    answer.sdp = setMediaBitrate(answer.sdp, 'video', this.delegate.bandwidth);\r\n                    this.setLocalDescription(answer).then(resolve).catch(reject);\r\n                }).catch(reject);\r\n        }\r\n    });\r\n};\r\n\r\nRTCPeerConnection.prototype.addCandidates = function (iceCandidates) {\r\n    for (let i = 0, len = iceCandidates.length; i < len; i++) {\r\n        const candidate = {\r\n            sdpMLineIndex: iceCandidates[i].sdpMLineIndex,\r\n            sdpMid: iceCandidates[i].sdpMid,\r\n            candidate: iceCandidates[i].candidate\r\n        };\r\n        this.addIceCandidate(\r\n            new RTCIceCandidate(candidate),\r\n            () => { },\r\n            error => {\r\n                Helpers.traceError(\"Error on 'addIceCandidate': \" + error);\r\n            }\r\n        );\r\n    }\r\n};\r\n\r\nRTCPeerConnection.prototype.toString = function () {\r\n    return 'sessionID: ' + this.sessionID + ', userID:  ' + this.userID + ', type: ' + this.type + ', state: ' + this.state;\r\n};\r\n\r\n/// CALLBACKS\r\n\r\nRTCPeerConnection.prototype.onSignalingStateCallback = function () {\r\n    Helpers.trace(\"onSignalingStateCallback: \" + this.signalingState);\r\n\r\n    if (this.signalingState === 'stable' && this.iceCandidates.length > 0) {\r\n        this.delegate._processIceCandidates(this, this.iceCandidates);\r\n        this.iceCandidates.length = 0;\r\n    }\r\n};\r\n\r\nRTCPeerConnection.prototype.onIceCandidateCallback = function (event) {\r\n    const candidate = event.candidate;\r\n\r\n    if (candidate) {\r\n        const iceCandidateData = {\r\n            sdpMLineIndex: candidate.sdpMLineIndex,\r\n            sdpMid: candidate.sdpMid,\r\n            candidate: candidate.candidate\r\n        };\r\n\r\n        if (this.signalingState === 'stable') {\r\n            this.delegate._processIceCandidates(this, [iceCandidateData]);\r\n        } else {\r\n            this.iceCandidates.push(iceCandidateData);\r\n        }\r\n    }\r\n};\r\n\r\n/** handler of remote media stream */\r\nRTCPeerConnection.prototype.onAddRemoteMediaCallback = function (event) {\r\n    if (typeof this.delegate._onRemoteStreamListener === 'function') {\r\n        if (event.type === 'addstream') {\r\n            this.remoteStream = event.stream;\r\n        } else {\r\n            this.remoteStream.addTrack(event.track);\r\n        }\r\n\r\n        if (((this.delegate.callType == 1) && this.remoteStream.getVideoTracks().length) ||\r\n            ((this.delegate.callType == 2) && this.remoteStream.getAudioTracks().length)) {\r\n            this.delegate._onRemoteStreamListener(this.userID, this.remoteStream);\r\n        }\r\n\r\n        this._getStatsWrap();\r\n    }\r\n};\r\n\r\nRTCPeerConnection.prototype.onIceConnectionStateCallback = function () {\r\n    Helpers.trace(\"onIceConnectionStateCallback: \" + this.iceConnectionState);\r\n\r\n    if (typeof this.delegate._onSessionConnectionStateChangedListener === 'function') {\r\n        let conState = null;\r\n\r\n        if (Helpers.getVersionSafari() >= 11) {\r\n            clearTimeout(this.onStatusClosedChecker);\r\n        }\r\n\r\n        switch (this.iceConnectionState) {\r\n            case 'checking':\r\n                this.state = PeerConnectionState.CHECKING;\r\n                conState = SessionConnectionState.CONNECTING;\r\n                break;\r\n\r\n            case 'connected':\r\n                this._clearWaitingReconnectTimer();\r\n                this.state = PeerConnectionState.CONNECTED;\r\n                conState = SessionConnectionState.CONNECTED;\r\n                break;\r\n\r\n            case 'completed':\r\n                this._clearWaitingReconnectTimer();\r\n                this.state = PeerConnectionState.COMPLETED;\r\n                conState = SessionConnectionState.COMPLETED;\r\n                break;\r\n\r\n            case 'failed':\r\n                this.state = PeerConnectionState.FAILED;\r\n                conState = SessionConnectionState.FAILED;\r\n                break;\r\n\r\n            case 'disconnected':\r\n                this._startWaitingReconnectTimer();\r\n                this.state = PeerConnectionState.DISCONNECTED;\r\n                conState = SessionConnectionState.DISCONNECTED;\r\n\r\n                // repeat to call onIceConnectionStateCallback to get status \"closed\"\r\n                if (Helpers.getVersionSafari() >= 11) {\r\n                    this.onStatusClosedChecker = setTimeout(() => {\r\n                        this.onIceConnectionStateCallback();\r\n                    }, 500);\r\n                }\r\n                break;\r\n\r\n            // TODO: this state doesn't fires on Safari 11\r\n            case 'closed':\r\n                this._clearWaitingReconnectTimer();\r\n                this.state = PeerConnectionState.CLOSED;\r\n                conState = SessionConnectionState.CLOSED;\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n\r\n        if (conState) {\r\n            this.delegate._onSessionConnectionStateChangedListener(this.userID, conState);\r\n        }\r\n    }\r\n};\r\n\r\n\r\n/// PRIVATE\r\n\r\nRTCPeerConnection.prototype._clearStatsReportTimer = function () {\r\n    if (this.statsReportTimer) {\r\n        clearInterval(this.statsReportTimer);\r\n        this.statsReportTimer = null;\r\n    }\r\n};\r\n\r\nRTCPeerConnection.prototype._getStatsWrap = function () {\r\n    let statsReportInterval;\r\n    let lastResult;\r\n\r\n    if (config.videochat && config.videochat.statsReportTimeInterval) {\r\n        if (isNaN(+config.videochat.statsReportTimeInterval)) {\r\n            Helpers.traceError('statsReportTimeInterval (' + config.videochat.statsReportTimeInterval + ') must be integer.');\r\n            return;\r\n        }\r\n        statsReportInterval = config.videochat.statsReportTimeInterval * 1000;\r\n\r\n        const _statsReportCallback = () => {\r\n            _getStats(this, lastResult, (results, lastResults) => {\r\n                lastResult = lastResults;\r\n                this.delegate._onCallStatsReport(this.userID, results, null);\r\n            }, err => {\r\n                Helpers.traceError('_getStats error. ' + err.name + ': ' + err.message);\r\n                this.delegate._onCallStatsReport(this.userID, null, err);\r\n            });\r\n        };\r\n\r\n        Helpers.trace('Stats tracker has been started.');\r\n        this.statsReportTimer = setInterval(_statsReportCallback, statsReportInterval);\r\n    }\r\n};\r\n\r\nRTCPeerConnection.prototype._clearWaitingReconnectTimer = function () {\r\n    if (this.waitingReconnectTimeoutCallback) {\r\n        Helpers.trace('_clearWaitingReconnectTimer');\r\n        clearTimeout(this.waitingReconnectTimeoutCallback);\r\n        this.waitingReconnectTimeoutCallback = null;\r\n    }\r\n};\r\n\r\nRTCPeerConnection.prototype._startWaitingReconnectTimer = function () {\r\n    const timeout = config.videochat.disconnectTimeInterval * 1000;\r\n    const waitingReconnectTimeoutCallback = () => {\r\n        Helpers.trace('waitingReconnectTimeoutCallback');\r\n\r\n        clearTimeout(this.waitingReconnectTimeoutCallback);\r\n\r\n        this.release();\r\n\r\n        this.delegate._closeSessionIfAllConnectionsClosed();\r\n    };\r\n\r\n    Helpers.trace('_startWaitingReconnectTimer, timeout: ' + timeout);\r\n\r\n    this.waitingReconnectTimeoutCallback = setTimeout(waitingReconnectTimeoutCallback, timeout);\r\n};\r\n\r\nRTCPeerConnection.prototype._clearDialingTimer = function () {\r\n    if (this.dialingTimer) {\r\n        Helpers.trace('_clearDialingTimer');\r\n\r\n        clearInterval(this.dialingTimer);\r\n        this.dialingTimer = null;\r\n        this.answerTimeInterval = 0;\r\n    }\r\n};\r\n\r\nRTCPeerConnection.prototype._startDialingTimer = function (extension, withOnNotAnswerCallback) {\r\n    const dialingTimeInterval = config.videochat.dialingTimeInterval * 1000;\r\n\r\n    Helpers.trace('_startDialingTimer, dialingTimeInterval: ' + dialingTimeInterval);\r\n\r\n    const _dialingCallback = (extension, withOnNotAnswerCallback, skipIncrement) => {\r\n        if (!skipIncrement) {\r\n            this.answerTimeInterval += config.videochat.dialingTimeInterval * 1000;\r\n        }\r\n\r\n        Helpers.trace('_dialingCallback, answerTimeInterval: ' + this.answerTimeInterval);\r\n\r\n        if (this.answerTimeInterval >= config.videochat.answerTimeInterval * 1000) {\r\n            this._clearDialingTimer();\r\n\r\n            if (withOnNotAnswerCallback) {\r\n                this.delegate._processOnNotAnswer(this);\r\n            }\r\n        } else {\r\n            this.delegate._processCall(this, extension);\r\n        }\r\n    };\r\n\r\n    this.dialingTimer = setInterval(_dialingCallback, dialingTimeInterval, extension, withOnNotAnswerCallback, false);\r\n\r\n    // call for the 1st time\r\n    _dialingCallback(extension, withOnNotAnswerCallback, true);\r\n};\r\n\r\n/**\r\n * PRIVATE\r\n */\r\nfunction _getStats(peer, lastResults, successCallback, errorCallback) {\r\n    let statistic = {\r\n        'local': {\r\n            'audio': {},\r\n            'video': {},\r\n            'candidate': {}\r\n        },\r\n        'remote': {\r\n            'audio': {},\r\n            'video': {},\r\n            'candidate': {}\r\n        }\r\n    };\r\n\r\n    if (Helpers.getVersionFirefox()) {\r\n        let localStream = peer.getLocalStreams().length ? peer.getLocalStreams()[0] : peer.delegate.localStream,\r\n            localVideoSettings = localStream.getVideoTracks().length ? localStream.getVideoTracks()[0].getSettings() : null;\r\n\r\n        statistic.local.video.frameHeight = localVideoSettings && localVideoSettings.height;\r\n        statistic.local.video.frameWidth = localVideoSettings && localVideoSettings.width;\r\n    }\r\n\r\n    peer.getStats(null).then(results => {\r\n        results.forEach(result => {\r\n            let item;\r\n\r\n            if (result.bytesReceived && result.type === 'inbound-rtp') {\r\n                item = statistic.remote[result.mediaType];\r\n                item.bitrate = _getBitratePerSecond(result, lastResults, false);\r\n                item.bytesReceived = result.bytesReceived;\r\n                item.packetsReceived = result.packetsReceived;\r\n                item.timestamp = result.timestamp;\r\n                if (result.mediaType === 'video' && result.framerateMean) {\r\n                    item.framesPerSecond = Math.round(result.framerateMean * 10) / 10;\r\n                }\r\n            } else if (result.bytesSent && result.type === 'outbound-rtp') {\r\n                item = statistic.local[result.mediaType];\r\n                item.bitrate = _getBitratePerSecond(result, lastResults, true);\r\n                item.bytesSent = result.bytesSent;\r\n                item.packetsSent = result.packetsSent;\r\n                item.timestamp = result.timestamp;\r\n                if (result.mediaType === 'video' && result.framerateMean) {\r\n                    item.framesPerSecond = Math.round(result.framerateMean * 10) / 10;\r\n                }\r\n            } else if (result.type === 'local-candidate') {\r\n                item = statistic.local.candidate;\r\n                if (result.candidateType === 'host' && result.mozLocalTransport === 'udp' && result.transport === 'udp') {\r\n                    item.protocol = result.transport;\r\n                    item.ip = result.ipAddress;\r\n                    item.port = result.portNumber;\r\n                } else if (!Helpers.getVersionFirefox()) {\r\n                    item.protocol = result.protocol;\r\n                    item.ip = result.ip;\r\n                    item.port = result.port;\r\n                }\r\n            } else if (result.type === 'remote-candidate') {\r\n                item = statistic.remote.candidate;\r\n                item.protocol = result.protocol || result.transport;\r\n                item.ip = result.ip || result.ipAddress;\r\n                item.port = result.port || result.portNumber;\r\n            } else if (result.type === 'track' && result.kind === 'video' && !Helpers.getVersionFirefox()) {\r\n                if (result.remoteSource) {\r\n                    item = statistic.remote.video;\r\n                    item.frameHeight = result.frameHeight;\r\n                    item.frameWidth = result.frameWidth;\r\n                    item.framesPerSecond = _getFramesPerSecond(result, lastResults, false);\r\n                } else {\r\n                    item = statistic.local.video;\r\n                    item.frameHeight = result.frameHeight;\r\n                    item.frameWidth = result.frameWidth;\r\n                    item.framesPerSecond = _getFramesPerSecond(result, lastResults, true);\r\n                }\r\n            }\r\n        });\r\n        successCallback(statistic, results);\r\n    }, errorCallback);\r\n\r\n    const _getBitratePerSecond = (result, lastResults, isLocal) => {\r\n        let lastResult = lastResults && lastResults.get(result.id),\r\n            seconds = lastResult ? ((result.timestamp - lastResult.timestamp) / 1000) : 5,\r\n            kilo = 1024,\r\n            bit = 8,\r\n            bitrate;\r\n\r\n        if (!lastResult) {\r\n            bitrate = 0;\r\n        } else if (isLocal) {\r\n            bitrate = bit * (result.bytesSent - lastResult.bytesSent) / (kilo * seconds);\r\n        } else {\r\n            bitrate = bit * (result.bytesReceived - lastResult.bytesReceived) / (kilo * seconds);\r\n        }\r\n\r\n        return Math.round(bitrate);\r\n    }\r\n\r\n    const _getFramesPerSecond = (result, lastResults, isLocal) => {\r\n        let lastResult = lastResults && lastResults.get(result.id),\r\n            seconds = lastResult ? ((result.timestamp - lastResult.timestamp) / 1000) : 5,\r\n            framesPerSecond;\r\n\r\n        if (!lastResult) {\r\n            framesPerSecond = 0;\r\n        } else if (isLocal) {\r\n            framesPerSecond = (result.framesSent - lastResult.framesSent) / seconds;\r\n        } else {\r\n            framesPerSecond = (result.framesReceived - lastResult.framesReceived) / seconds;\r\n        }\r\n\r\n        return Math.round(framesPerSecond * 10) / 10;\r\n    }\r\n}\r\n\r\nfunction setMediaBitrate(sdp, media, bitrate) {\r\n    if (!bitrate) {\r\n        return sdp.replace(/b=AS:.*\\r\\n/, '').replace(/b=TIAS:.*\\r\\n/, '');\r\n    }\r\n\r\n    var lines = sdp.split('\\n'),\r\n        line = -1,\r\n        modifier = Helpers.getVersionFirefox() ? 'TIAS' : 'AS',\r\n        amount = Helpers.getVersionFirefox() ? bitrate * 1024 : bitrate;\r\n\r\n    for (let i = 0; i < lines.length; i++) {\r\n        if (lines[i].indexOf(\"m=\" + media) === 0) {\r\n            line = i;\r\n            break;\r\n        }\r\n    }\r\n\r\n    if (line === -1) {\r\n        return sdp;\r\n    }\r\n\r\n    line++;\r\n\r\n    while (lines[line].indexOf('i=') === 0 || lines[line].indexOf('c=') === 0) {\r\n        line++;\r\n    }\r\n\r\n    if (lines[line].indexOf('b') === 0) {\r\n        lines[line] = 'b=' + modifier + ':' + amount;\r\n        return lines.join('\\n');\r\n    }\r\n\r\n    let newLines = lines.slice(0, line);\r\n    newLines.push('b=' + modifier + ':' + amount);\r\n    newLines = newLines.concat(lines.slice(line, lines.length));\r\n\r\n    return newLines.join('\\n');\r\n}\r\n\r\nmodule.exports = RTCPeerConnection;\r\n","module.exports = require(\"regenerator-runtime\");\n","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nmodule.exports = _asyncToGenerator;","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n * \n * @providesModule EmitterSubscription\n * @typechecks\n */\n\n'use strict';\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar EventSubscription = require('./EventSubscription');\n\n/**\n * EmitterSubscription represents a subscription with listener and context data.\n */\n\nvar EmitterSubscription = (function (_EventSubscription) {\n  _inherits(EmitterSubscription, _EventSubscription);\n\n  /**\n   * @param {EventSubscriptionVendor} subscriber - The subscriber that controls\n   *   this subscription\n   * @param {function} listener - Function to invoke when the specified event is\n   *   emitted\n   * @param {*} context - Optional context object to use when invoking the\n   *   listener\n   */\n\n  function EmitterSubscription(subscriber, listener, context) {\n    _classCallCheck(this, EmitterSubscription);\n\n    _EventSubscription.call(this, subscriber);\n    this.listener = listener;\n    this.context = context;\n  }\n\n  return EmitterSubscription;\n})(EventSubscription);\n\nmodule.exports = EmitterSubscription;","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n'use strict';\n\n/**\n * Use invariant() to assert state which your program assumes to be true.\n *\n * Provide sprintf-style format (only %s is supported) and arguments\n * to provide information about what broke and what you were\n * expecting.\n *\n * The invariant message will be stripped in production, but the invariant\n * will remain to ensure logic does not differ in production.\n */\n\nvar validateFormat = function validateFormat(format) {};\n\nif (process.env.NODE_ENV !== 'production') {\n  validateFormat = function validateFormat(format) {\n    if (format === undefined) {\n      throw new Error('invariant requires an error message argument');\n    }\n  };\n}\n\nfunction invariant(condition, format, a, b, c, d, e, f) {\n  validateFormat(format);\n\n  if (!condition) {\n    var error;\n    if (format === undefined) {\n      error = new Error('Minified exception occurred; use the non-minified dev environment ' + 'for the full error message and additional helpful warnings.');\n    } else {\n      var args = [a, b, c, d, e, f];\n      var argIndex = 0;\n      error = new Error(format.replace(/%s/g, function () {\n        return args[argIndex++];\n      }));\n      error.name = 'Invariant Violation';\n    }\n\n    error.framesToPop = 1; // we don't care about invariant's own frame\n    throw error;\n  }\n}\n\nmodule.exports = invariant;","const CALL_TYPES = {\r\n    VIDEO: 'video',\r\n    AUDIO: 'audio'\r\n}\r\n\r\nconst DEVICE_INPUT_TYPES = {\r\n    VIDEO: 'videoinput',\r\n    AUDIO: 'audioinput'\r\n}\r\n\r\nmodule.exports = {\r\n    CALL_TYPES,\r\n    DEVICE_INPUT_TYPES\r\n}","const config = require('./cubeConfig')\r\n\r\nclass ConnectyCube {\r\n  init(credentials, configMap) {\r\n    if (configMap && typeof configMap === 'object') {\r\n      config.set(configMap)\r\n    }\r\n\r\n    const Proxy = require('./cubeProxy')\r\n    const Auth = require('./cubeAuth')\r\n    const Users = require('./cubeUsers')\r\n    const Storage = require('./cubeStorage')\r\n    const PushNotifications = require('./cubePushNotifications')\r\n    const Data = require('./cubeData')\r\n    const AddressBook = require('./cubeAddressBook')\r\n    const Chat = require('./messaging/cubeChat')\r\n    const DialogProxy = require('./messaging/cubeDialog')\r\n    const MessageProxy = require('./messaging/cubeMessage')\r\n    const Utils = require('./cubeInternalUtils')\r\n\r\n    this.service = new Proxy()\r\n    this.auth = new Auth(this.service)\r\n    this.users = new Users(this.service)\r\n    this.storage = new Storage(this.service)\r\n    this.pushnotifications = new PushNotifications(this.service)\r\n    this.data = new Data(this.service)\r\n    this.addressbook = new AddressBook(this.service)\r\n    this.chat = new Chat(this.service)\r\n    this.chat.dialog = new DialogProxy(this.service)\r\n    this.chat.message = new MessageProxy(this.service)\r\n    this.utils = Utils\r\n\r\n    // add WebRTC API if API is avaible\r\n    if (Utils.isWebRTCAvailble()) {\r\n      // p2p calls client\r\n      const WebRTCClient = require('./videocalling/cubeWebRTCClient')\r\n\r\n      this.videochat = new WebRTCClient(this.chat.xmppClient)\r\n      this.chat.webrtcSignalingProcessor = this.videochat.signalingProcessor\r\n      // conf calls client\r\n      const ConferenceClient = require('./videocalling_conference/cubeConferenceClient')\r\n      this.videochatconference = new ConferenceClient()\r\n      // React Native RTCView\r\n      if (Utils.getEnv().reactnative) {\r\n        this.RTCView = require('./cubeDependencies').RTCView\r\n      }\r\n    } else {\r\n      this.videochat = null\r\n      this.videochatconference = null\r\n    }\r\n\r\n    // Initialization by outside token\r\n    if (credentials.token) {\r\n      config.creds.appId = credentials.appId\r\n      this.service.setSession({ token: credentials.token })\r\n    } else {\r\n      config.creds.appId = credentials.appId\r\n      config.creds.authKey = credentials.authKey\r\n      config.creds.authSecret = credentials.authSecret\r\n    }\r\n  }\r\n\r\n  getSession() {\r\n    return this.auth.getSession()\r\n  }\r\n\r\n  createSession(params) {\r\n    return this.auth.createSession(params)\r\n  }\r\n\r\n  destroySession() {\r\n    return this.auth.destroySession()\r\n  }\r\n\r\n  createWebSession(params) {\r\n    return this.auth.createWebSession(params)\r\n  }\r\n\r\n  checkWebSessionUntilUpgrade(callback) {\r\n    return this.auth.checkWebSessionUntilUpgrade(callback)\r\n  }\r\n\r\n  upgradeWebSession(webToken) {\r\n    return this.auth.upgradeWebSession(webToken)\r\n  }\r\n\r\n  login(params) {\r\n    return this.auth.login(params)\r\n  }\r\n\r\n  logout() {\r\n    return this.auth.logout()\r\n  }\r\n}\r\n\r\nconst CB = new ConnectyCube()\r\nCB.ConnectyCube = ConnectyCube\r\nmodule.exports = CB\r\n","const config = require('./cubeConfig')\r\nconst Utils = require('./cubeInternalUtils')\r\nconst fetchImpl = require('./cubeDependencies').fetchImpl\r\nconst formDataImpl = require('./cubeDependencies').formDataImpl\r\n\r\nclass HTTPProxy {\r\n  constructor() {\r\n    this.sdkInstance = {\r\n      config: config,\r\n      session: null\r\n    }\r\n\r\n    this.currentUserId = null\r\n\r\n    this.requestsNumber = 0\r\n  }\r\n\r\n  setSession(session) {\r\n    this.sdkInstance.session = session\r\n    // if (session && session.user_id) {\r\n    //   this.setCurrentUserId(session.user_id);\r\n    // }\r\n  }\r\n\r\n  getSession() {\r\n    return this.sdkInstance.session\r\n  }\r\n\r\n  setCurrentUserId(userId) {\r\n    this.currentUserId = userId\r\n  }\r\n\r\n  getCurrentUserId() {\r\n    return this.currentUserId\r\n  }\r\n\r\n  logRequest(params) {\r\n    ++this.requestsNumber\r\n\r\n    Utils.DLog(\r\n      '[Request][' + this.requestsNumber + ']',\r\n      (params.type || 'GET') + ' ' + params.url,\r\n      params\r\n    )\r\n  }\r\n\r\n  logResponse(response) {\r\n    Utils.DLog('[Response][' + this.requestsNumber + ']', response)\r\n  }\r\n\r\n  buildRequestAndURL(params) {\r\n    const isGetOrHeadType = !params.type || params.type === 'GET' || params.type === 'HEAD'\r\n    const isPostOrPutType = params.type && (params.type === 'POST' || params.type === 'PUT')\r\n    const token =\r\n      this.sdkInstance &&\r\n      this.sdkInstance.session &&\r\n      this.sdkInstance.session.token\r\n    const isInternalRequest = params.url.indexOf('s3.amazonaws.com') === -1\r\n    const isMultipartFormData = params.contentType === false\r\n\r\n    let requestBody\r\n    let requestURL = params.url\r\n    const requestObject = {}\r\n    let responseObject\r\n\r\n    requestObject.method = params.type || 'GET'\r\n\r\n    if (params.data) {\r\n      requestBody = this.buildRequestBody(params, isMultipartFormData, isPostOrPutType)\r\n\r\n      if (isGetOrHeadType) {\r\n        requestURL += '?' + requestBody\r\n      } else {\r\n        requestObject.body = requestBody\r\n      }\r\n    }\r\n\r\n    if (!isMultipartFormData) {\r\n      requestObject.headers = {\r\n        'Content-Type':\r\n          isPostOrPutType ?\r\n            'application/json;charset=utf-8' :\r\n            'application/x-www-form-urlencoded; charset=UTF-8'\r\n      }\r\n    }\r\n\r\n    if (isInternalRequest) {\r\n      if (!requestObject.headers) {\r\n        requestObject.headers = {}\r\n      }\r\n\r\n      requestObject.headers['CB-SDK'] = 'JS ' + config.version + ' - Client'\r\n\r\n      if (token) {\r\n        requestObject.headers['CB-Token'] = token\r\n      }\r\n    }\r\n\r\n    if (config.timeout) {\r\n      requestObject.timeout = config.timeout\r\n    }\r\n\r\n    return [requestObject, requestURL]\r\n  }\r\n\r\n  buildRequestBody(params, isMultipartFormData, isPostOrPutType) {\r\n    const data = params.data\r\n\r\n    let dataObject\r\n\r\n    if (isMultipartFormData) {\r\n      dataObject = new formDataImpl()\r\n\r\n      Object.keys(data).forEach(function (item) {\r\n        if (params.fileToCustomObject && item === 'file') {\r\n          dataObject.append(item, data[item].data, data[item].name)\r\n        } else {\r\n          dataObject.append(item, params.data[item])\r\n        }\r\n      })\r\n    } else if (isPostOrPutType) {\r\n      dataObject = JSON.stringify(data)\r\n    } else {\r\n      dataObject = Object.keys(data)\r\n        .map(k => {\r\n          if (Utils.isObject(data[k])) {\r\n            return Object.keys(data[k])\r\n              .map(v => {\r\n                return (\r\n                  this.encodeURIComponent(k) +\r\n                  '[' +\r\n                  (Utils.isArray(data[k]) ? '' : v) +\r\n                  ']=' +\r\n                  this.encodeURIComponent(data[k][v])\r\n                )\r\n              })\r\n              .sort()\r\n              .join('&')\r\n          } else {\r\n            return (\r\n              this.encodeURIComponent(k) +\r\n              (Utils.isArray(data[k]) ? '[]' : '') +\r\n              '=' +\r\n              this.encodeURIComponent(data[k])\r\n            )\r\n          }\r\n        })\r\n        .sort()\r\n        .join('&')\r\n    }\r\n\r\n    return dataObject\r\n  }\r\n\r\n  encodeURIComponent(str) {\r\n    return encodeURIComponent(str).replace(/[#$&+,/:;=?@\\[\\]]/g, function (c) {\r\n      return '%' + c.charCodeAt(0).toString(16)\r\n    })\r\n  }\r\n\r\n  ajax(params) {\r\n    return new Promise((resolve, reject) => {\r\n      this.logRequest(params)\r\n\r\n      const requestAndURL = this.buildRequestAndURL(params)\r\n      const requestObject = requestAndURL[0]\r\n      const requestURL = requestAndURL[1]\r\n\r\n      let response\r\n\r\n      // The Promise returned from fetch() won’t reject on HTTP error\r\n      // status even if the response is an HTTP 404 or 500.\r\n      // Instead, it will resolve normally (with ok status set to false),\r\n      // and it will only reject on network failure or if anything prevented the request from completing.\r\n      fetchImpl(requestURL, requestObject)\r\n        .then(resp => {\r\n          response = resp\r\n          const dataType = params.dataType || 'json'\r\n          return dataType === 'text' ? response.text() : response.json()\r\n        })\r\n        .then(body => {\r\n          if (!response.ok) {\r\n            this.processAjaxError(\r\n              response,\r\n              body,\r\n              null,\r\n              reject,\r\n              resolve,\r\n              params\r\n            )\r\n          } else {\r\n            this.processAjaxResponse(body, resolve)\r\n          }\r\n        })\r\n        .catch(error => {\r\n          this.processAjaxError(response, ' ', error, reject, resolve, params)\r\n        })\r\n    })\r\n  }\r\n\r\n  processAjaxResponse(body, resolve) {\r\n    const responseBody = body && body !== ' ' ? body : 'empty body'\r\n    this.logResponse(responseBody)\r\n\r\n    resolve(body)\r\n  }\r\n\r\n  processAjaxError(response, body, error, reject, resolve, params) {\r\n    const statusCode = response && (response.status || response.statusCode)\r\n\r\n    const errorObject = {\r\n      code: (response && statusCode) || (error && error.code),\r\n      info: (body && typeof body === 'string' ? JSON.parse(body) : body) || (error && error.errno),\r\n    }\r\n\r\n    const responseBody = body || error || body.errors\r\n    this.logResponse(responseBody)\r\n\r\n    if (response.url.indexOf(config.urls.session) === -1) {\r\n      if (\r\n        Utils.isExpiredSessionError(errorObject) &&\r\n        typeof config.on.sessionExpired === 'function'\r\n      ) {\r\n        this.handleExpiredSessionResponse(\r\n          errorObject,\r\n          null,\r\n          reject,\r\n          resolve,\r\n          params\r\n        )\r\n      } else {\r\n        reject(errorObject)\r\n      }\r\n    } else {\r\n      reject(errorObject)\r\n    }\r\n  }\r\n\r\n  handleExpiredSessionResponse(error, response, reject, resolve, params) {\r\n    const handleResponse = function () {\r\n      if (error) {\r\n        reject(error)\r\n      } else {\r\n        resolve(response)\r\n      }\r\n    }\r\n\r\n    const retryCallback = function (session) {\r\n      if (session) {\r\n        this.setSession(session)\r\n        return this.ajax(params)\r\n      }\r\n    }\r\n\r\n    config.on.sessionExpired(handleResponse, retryCallback)\r\n  }\r\n}\r\n\r\nmodule.exports = HTTPProxy\r\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <http://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('isarray')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Due to various browser bugs, sometimes the Object implementation will be used even\n * when the browser supports typed arrays.\n *\n * Note:\n *\n *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,\n *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *     incorrect length in some situations.\n\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they\n * get the Object implementation, which is slower but behaves correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = global.TYPED_ARRAY_SUPPORT !== undefined\n  ? global.TYPED_ARRAY_SUPPORT\n  : typedArraySupport()\n\n/*\n * Export kMaxLength after typed array support is determined.\n */\nexports.kMaxLength = kMaxLength()\n\nfunction typedArraySupport () {\n  try {\n    var arr = new Uint8Array(1)\n    arr.__proto__ = {__proto__: Uint8Array.prototype, foo: function () { return 42 }}\n    return arr.foo() === 42 && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n}\n\nfunction kMaxLength () {\n  return Buffer.TYPED_ARRAY_SUPPORT\n    ? 0x7fffffff\n    : 0x3fffffff\n}\n\nfunction createBuffer (that, length) {\n  if (kMaxLength() < length) {\n    throw new RangeError('Invalid typed array length')\n  }\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = new Uint8Array(length)\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    if (that === null) {\n      that = new Buffer(length)\n    }\n    that.length = length\n  }\n\n  return that\n}\n\n/**\n * The Buffer constructor returns instances of `Uint8Array` that have their\n * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of\n * `Uint8Array`, so the returned instances will have all the node `Buffer` methods\n * and the `Uint8Array` methods. Square bracket notation works as expected -- it\n * returns a single octet.\n *\n * The `Uint8Array` prototype remains unmodified.\n */\n\nfunction Buffer (arg, encodingOrOffset, length) {\n  if (!Buffer.TYPED_ARRAY_SUPPORT && !(this instanceof Buffer)) {\n    return new Buffer(arg, encodingOrOffset, length)\n  }\n\n  // Common case.\n  if (typeof arg === 'number') {\n    if (typeof encodingOrOffset === 'string') {\n      throw new Error(\n        'If encoding is specified then the first argument must be a string'\n      )\n    }\n    return allocUnsafe(this, arg)\n  }\n  return from(this, arg, encodingOrOffset, length)\n}\n\nBuffer.poolSize = 8192 // not used by this implementation\n\n// TODO: Legacy, not needed anymore. Remove in next major version.\nBuffer._augment = function (arr) {\n  arr.__proto__ = Buffer.prototype\n  return arr\n}\n\nfunction from (that, value, encodingOrOffset, length) {\n  if (typeof value === 'number') {\n    throw new TypeError('\"value\" argument must not be a number')\n  }\n\n  if (typeof ArrayBuffer !== 'undefined' && value instanceof ArrayBuffer) {\n    return fromArrayBuffer(that, value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'string') {\n    return fromString(that, value, encodingOrOffset)\n  }\n\n  return fromObject(that, value)\n}\n\n/**\n * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError\n * if value is a number.\n * Buffer.from(str[, encoding])\n * Buffer.from(array)\n * Buffer.from(buffer)\n * Buffer.from(arrayBuffer[, byteOffset[, length]])\n **/\nBuffer.from = function (value, encodingOrOffset, length) {\n  return from(null, value, encodingOrOffset, length)\n}\n\nif (Buffer.TYPED_ARRAY_SUPPORT) {\n  Buffer.prototype.__proto__ = Uint8Array.prototype\n  Buffer.__proto__ = Uint8Array\n  if (typeof Symbol !== 'undefined' && Symbol.species &&\n      Buffer[Symbol.species] === Buffer) {\n    // Fix subarray() in ES2016. See: https://github.com/feross/buffer/pull/97\n    Object.defineProperty(Buffer, Symbol.species, {\n      value: null,\n      configurable: true\n    })\n  }\n}\n\nfunction assertSize (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('\"size\" argument must be a number')\n  } else if (size < 0) {\n    throw new RangeError('\"size\" argument must not be negative')\n  }\n}\n\nfunction alloc (that, size, fill, encoding) {\n  assertSize(size)\n  if (size <= 0) {\n    return createBuffer(that, size)\n  }\n  if (fill !== undefined) {\n    // Only pay attention to encoding if it's a string. This\n    // prevents accidentally sending in a number that would\n    // be interpretted as a start offset.\n    return typeof encoding === 'string'\n      ? createBuffer(that, size).fill(fill, encoding)\n      : createBuffer(that, size).fill(fill)\n  }\n  return createBuffer(that, size)\n}\n\n/**\n * Creates a new filled Buffer instance.\n * alloc(size[, fill[, encoding]])\n **/\nBuffer.alloc = function (size, fill, encoding) {\n  return alloc(null, size, fill, encoding)\n}\n\nfunction allocUnsafe (that, size) {\n  assertSize(size)\n  that = createBuffer(that, size < 0 ? 0 : checked(size) | 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < size; ++i) {\n      that[i] = 0\n    }\n  }\n  return that\n}\n\n/**\n * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.\n * */\nBuffer.allocUnsafe = function (size) {\n  return allocUnsafe(null, size)\n}\n/**\n * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.\n */\nBuffer.allocUnsafeSlow = function (size) {\n  return allocUnsafe(null, size)\n}\n\nfunction fromString (that, string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('\"encoding\" must be a valid string encoding')\n  }\n\n  var length = byteLength(string, encoding) | 0\n  that = createBuffer(that, length)\n\n  var actual = that.write(string, encoding)\n\n  if (actual !== length) {\n    // Writing a hex string, for example, that contains invalid characters will\n    // cause everything after the first invalid character to be ignored. (e.g.\n    // 'abxxcd' will be treated as 'ab')\n    that = that.slice(0, actual)\n  }\n\n  return that\n}\n\nfunction fromArrayLike (that, array) {\n  var length = array.length < 0 ? 0 : checked(array.length) | 0\n  that = createBuffer(that, length)\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\nfunction fromArrayBuffer (that, array, byteOffset, length) {\n  array.byteLength // this throws if `array` is not a valid ArrayBuffer\n\n  if (byteOffset < 0 || array.byteLength < byteOffset) {\n    throw new RangeError('\\'offset\\' is out of bounds')\n  }\n\n  if (array.byteLength < byteOffset + (length || 0)) {\n    throw new RangeError('\\'length\\' is out of bounds')\n  }\n\n  if (byteOffset === undefined && length === undefined) {\n    array = new Uint8Array(array)\n  } else if (length === undefined) {\n    array = new Uint8Array(array, byteOffset)\n  } else {\n    array = new Uint8Array(array, byteOffset, length)\n  }\n\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = array\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    that = fromArrayLike(that, array)\n  }\n  return that\n}\n\nfunction fromObject (that, obj) {\n  if (Buffer.isBuffer(obj)) {\n    var len = checked(obj.length) | 0\n    that = createBuffer(that, len)\n\n    if (that.length === 0) {\n      return that\n    }\n\n    obj.copy(that, 0, 0, len)\n    return that\n  }\n\n  if (obj) {\n    if ((typeof ArrayBuffer !== 'undefined' &&\n        obj.buffer instanceof ArrayBuffer) || 'length' in obj) {\n      if (typeof obj.length !== 'number' || isnan(obj.length)) {\n        return createBuffer(that, 0)\n      }\n      return fromArrayLike(that, obj)\n    }\n\n    if (obj.type === 'Buffer' && isArray(obj.data)) {\n      return fromArrayLike(that, obj.data)\n    }\n  }\n\n  throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < kMaxLength()` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= kMaxLength()) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + kMaxLength().toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (length) {\n  if (+length != length) { // eslint-disable-line eqeqeq\n    length = 0\n  }\n  return Buffer.alloc(+length)\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function compare (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError('Arguments must be Buffers')\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n\n  for (var i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i]\n      y = b[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'latin1':\n    case 'binary':\n    case 'base64':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!isArray(list)) {\n    throw new TypeError('\"list\" argument must be an Array of Buffers')\n  }\n\n  if (list.length === 0) {\n    return Buffer.alloc(0)\n  }\n\n  var i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; ++i) {\n      length += list[i].length\n    }\n  }\n\n  var buffer = Buffer.allocUnsafe(length)\n  var pos = 0\n  for (i = 0; i < list.length; ++i) {\n    var buf = list[i]\n    if (!Buffer.isBuffer(buf)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers')\n    }\n    buf.copy(buffer, pos)\n    pos += buf.length\n  }\n  return buffer\n}\n\nfunction byteLength (string, encoding) {\n  if (Buffer.isBuffer(string)) {\n    return string.length\n  }\n  if (typeof ArrayBuffer !== 'undefined' && typeof ArrayBuffer.isView === 'function' &&\n      (ArrayBuffer.isView(string) || string instanceof ArrayBuffer)) {\n    return string.byteLength\n  }\n  if (typeof string !== 'string') {\n    string = '' + string\n  }\n\n  var len = string.length\n  if (len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return len\n      case 'utf8':\n      case 'utf-8':\n      case undefined:\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) return utf8ToBytes(string).length // assume utf8\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  var loweredCase = false\n\n  // No need to verify that \"this.length <= MAX_UINT32\" since it's a read-only\n  // property of a typed array.\n\n  // This behaves neither like String nor Uint8Array in that we set start/end\n  // to their upper/lower bounds if the value passed is out of range.\n  // undefined is handled specially as per ECMA-262 6th Edition,\n  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.\n  if (start === undefined || start < 0) {\n    start = 0\n  }\n  // Return early if start > this.length. Done here to prevent potential uint32\n  // coercion fail below.\n  if (start > this.length) {\n    return ''\n  }\n\n  if (end === undefined || end > this.length) {\n    end = this.length\n  }\n\n  if (end <= 0) {\n    return ''\n  }\n\n  // Force coersion to uint32. This will also coerce falsey/NaN values to 0.\n  end >>>= 0\n  start >>>= 0\n\n  if (end <= start) {\n    return ''\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Slice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\n// The property is used by `Buffer.isBuffer` and `is-buffer` (in Safari 5-7) to detect\n// Buffer instances.\nBuffer.prototype._isBuffer = true\n\nfunction swap (b, n, m) {\n  var i = b[n]\n  b[n] = b[m]\n  b[m] = i\n}\n\nBuffer.prototype.swap16 = function swap16 () {\n  var len = this.length\n  if (len % 2 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 16-bits')\n  }\n  for (var i = 0; i < len; i += 2) {\n    swap(this, i, i + 1)\n  }\n  return this\n}\n\nBuffer.prototype.swap32 = function swap32 () {\n  var len = this.length\n  if (len % 4 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 32-bits')\n  }\n  for (var i = 0; i < len; i += 4) {\n    swap(this, i, i + 3)\n    swap(this, i + 1, i + 2)\n  }\n  return this\n}\n\nBuffer.prototype.swap64 = function swap64 () {\n  var len = this.length\n  if (len % 8 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 64-bits')\n  }\n  for (var i = 0; i < len; i += 8) {\n    swap(this, i, i + 7)\n    swap(this, i + 1, i + 6)\n    swap(this, i + 2, i + 5)\n    swap(this, i + 3, i + 4)\n  }\n  return this\n}\n\nBuffer.prototype.toString = function toString () {\n  var length = this.length | 0\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max) str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {\n  if (!Buffer.isBuffer(target)) {\n    throw new TypeError('Argument must be a Buffer')\n  }\n\n  if (start === undefined) {\n    start = 0\n  }\n  if (end === undefined) {\n    end = target ? target.length : 0\n  }\n  if (thisStart === undefined) {\n    thisStart = 0\n  }\n  if (thisEnd === undefined) {\n    thisEnd = this.length\n  }\n\n  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n    throw new RangeError('out of range index')\n  }\n\n  if (thisStart >= thisEnd && start >= end) {\n    return 0\n  }\n  if (thisStart >= thisEnd) {\n    return -1\n  }\n  if (start >= end) {\n    return 1\n  }\n\n  start >>>= 0\n  end >>>= 0\n  thisStart >>>= 0\n  thisEnd >>>= 0\n\n  if (this === target) return 0\n\n  var x = thisEnd - thisStart\n  var y = end - start\n  var len = Math.min(x, y)\n\n  var thisCopy = this.slice(thisStart, thisEnd)\n  var targetCopy = target.slice(start, end)\n\n  for (var i = 0; i < len; ++i) {\n    if (thisCopy[i] !== targetCopy[i]) {\n      x = thisCopy[i]\n      y = targetCopy[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\n// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,\n// OR the last index of `val` in `buffer` at offset <= `byteOffset`.\n//\n// Arguments:\n// - buffer - a Buffer to search\n// - val - a string, Buffer, or number\n// - byteOffset - an index into `buffer`; will be clamped to an int32\n// - encoding - an optional encoding, relevant is val is a string\n// - dir - true for indexOf, false for lastIndexOf\nfunction bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {\n  // Empty buffer means no match\n  if (buffer.length === 0) return -1\n\n  // Normalize byteOffset\n  if (typeof byteOffset === 'string') {\n    encoding = byteOffset\n    byteOffset = 0\n  } else if (byteOffset > 0x7fffffff) {\n    byteOffset = 0x7fffffff\n  } else if (byteOffset < -0x80000000) {\n    byteOffset = -0x80000000\n  }\n  byteOffset = +byteOffset  // Coerce to Number.\n  if (isNaN(byteOffset)) {\n    // byteOffset: it it's undefined, null, NaN, \"foo\", etc, search whole buffer\n    byteOffset = dir ? 0 : (buffer.length - 1)\n  }\n\n  // Normalize byteOffset: negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = buffer.length + byteOffset\n  if (byteOffset >= buffer.length) {\n    if (dir) return -1\n    else byteOffset = buffer.length - 1\n  } else if (byteOffset < 0) {\n    if (dir) byteOffset = 0\n    else return -1\n  }\n\n  // Normalize val\n  if (typeof val === 'string') {\n    val = Buffer.from(val, encoding)\n  }\n\n  // Finally, search either indexOf (if dir is true) or lastIndexOf\n  if (Buffer.isBuffer(val)) {\n    // Special case: looking for empty string/buffer always fails\n    if (val.length === 0) {\n      return -1\n    }\n    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)\n  } else if (typeof val === 'number') {\n    val = val & 0xFF // Search for a byte value [0-255]\n    if (Buffer.TYPED_ARRAY_SUPPORT &&\n        typeof Uint8Array.prototype.indexOf === 'function') {\n      if (dir) {\n        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)\n      } else {\n        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)\n      }\n    }\n    return arrayIndexOf(buffer, [ val ], byteOffset, encoding, dir)\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\nfunction arrayIndexOf (arr, val, byteOffset, encoding, dir) {\n  var indexSize = 1\n  var arrLength = arr.length\n  var valLength = val.length\n\n  if (encoding !== undefined) {\n    encoding = String(encoding).toLowerCase()\n    if (encoding === 'ucs2' || encoding === 'ucs-2' ||\n        encoding === 'utf16le' || encoding === 'utf-16le') {\n      if (arr.length < 2 || val.length < 2) {\n        return -1\n      }\n      indexSize = 2\n      arrLength /= 2\n      valLength /= 2\n      byteOffset /= 2\n    }\n  }\n\n  function read (buf, i) {\n    if (indexSize === 1) {\n      return buf[i]\n    } else {\n      return buf.readUInt16BE(i * indexSize)\n    }\n  }\n\n  var i\n  if (dir) {\n    var foundIndex = -1\n    for (i = byteOffset; i < arrLength; i++) {\n      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize\n      } else {\n        if (foundIndex !== -1) i -= i - foundIndex\n        foundIndex = -1\n      }\n    }\n  } else {\n    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength\n    for (i = byteOffset; i >= 0; i--) {\n      var found = true\n      for (var j = 0; j < valLength; j++) {\n        if (read(arr, i + j) !== read(val, j)) {\n          found = false\n          break\n        }\n      }\n      if (found) return i\n    }\n  }\n\n  return -1\n}\n\nBuffer.prototype.includes = function includes (val, byteOffset, encoding) {\n  return this.indexOf(val, byteOffset, encoding) !== -1\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)\n}\n\nBuffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new TypeError('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; ++i) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(parsed)) return i\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction latin1Write (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset | 0\n    if (isFinite(length)) {\n      length = length | 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  // legacy write(string, encoding, offset, length) - remove in v0.13\n  } else {\n    throw new Error(\n      'Buffer.write(string, encoding, offset[, length]) is no longer supported'\n    )\n  }\n\n  var remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('Attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n        return asciiWrite(this, string, offset, length)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Write(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  var res = []\n\n  var i = start\n  while (i < end) {\n    var firstByte = buf[i]\n    var codePoint = null\n    var bytesPerSequence = (firstByte > 0xEF) ? 4\n      : (firstByte > 0xDF) ? 3\n      : (firstByte > 0xBF) ? 2\n      : 1\n\n    if (i + bytesPerSequence <= end) {\n      var secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nvar MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  var len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  var res = ''\n  var i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction latin1Slice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; ++i) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    newBuf = this.subarray(start, end)\n    newBuf.__proto__ = Buffer.prototype\n  } else {\n    var sliceLen = end - start\n    newBuf = new Buffer(sliceLen, undefined)\n    for (var i = 0; i < sliceLen; ++i) {\n      newBuf[i] = this[i + start]\n    }\n  }\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n}\n\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; ++i) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; ++i) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n  if (offset < 0) throw new RangeError('Index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  var len = end - start\n  var i\n\n  if (this === target && start < targetStart && targetStart < end) {\n    // descending copy from end\n    for (i = len - 1; i >= 0; --i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    // ascending copy from start\n    for (i = 0; i < len; ++i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else {\n    Uint8Array.prototype.set.call(\n      target,\n      this.subarray(start, start + len),\n      targetStart\n    )\n  }\n\n  return len\n}\n\n// Usage:\n//    buffer.fill(number[, offset[, end]])\n//    buffer.fill(buffer[, offset[, end]])\n//    buffer.fill(string[, offset[, end]][, encoding])\nBuffer.prototype.fill = function fill (val, start, end, encoding) {\n  // Handle string cases:\n  if (typeof val === 'string') {\n    if (typeof start === 'string') {\n      encoding = start\n      start = 0\n      end = this.length\n    } else if (typeof end === 'string') {\n      encoding = end\n      end = this.length\n    }\n    if (val.length === 1) {\n      var code = val.charCodeAt(0)\n      if (code < 256) {\n        val = code\n      }\n    }\n    if (encoding !== undefined && typeof encoding !== 'string') {\n      throw new TypeError('encoding must be a string')\n    }\n    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {\n      throw new TypeError('Unknown encoding: ' + encoding)\n    }\n  } else if (typeof val === 'number') {\n    val = val & 255\n  }\n\n  // Invalid ranges are not set to a default, so can range check early.\n  if (start < 0 || this.length < start || this.length < end) {\n    throw new RangeError('Out of range index')\n  }\n\n  if (end <= start) {\n    return this\n  }\n\n  start = start >>> 0\n  end = end === undefined ? this.length : end >>> 0\n\n  if (!val) val = 0\n\n  var i\n  if (typeof val === 'number') {\n    for (i = start; i < end; ++i) {\n      this[i] = val\n    }\n  } else {\n    var bytes = Buffer.isBuffer(val)\n      ? val\n      : utf8ToBytes(new Buffer(val, encoding).toString())\n    var len = bytes.length\n    for (i = 0; i < end - start; ++i) {\n      this[i + start] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n\n  for (var i = 0; i < length; ++i) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; ++i) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction isnan (val) {\n  return val !== val // eslint-disable-line no-self-compare\n}\n","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(\n      uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)\n    ))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n","exports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n",";(function (root, factory, undef) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"), require(\"./sha1\"), require(\"./hmac\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([\"./core\", \"./sha1\", \"./hmac\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\treturn CryptoJS.HmacSHA1;\n\n}));",";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([\"./core\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\t(function () {\n\t    // Shortcuts\n\t    var C = CryptoJS;\n\t    var C_lib = C.lib;\n\t    var WordArray = C_lib.WordArray;\n\t    var Hasher = C_lib.Hasher;\n\t    var C_algo = C.algo;\n\n\t    // Reusable object\n\t    var W = [];\n\n\t    /**\n\t     * SHA-1 hash algorithm.\n\t     */\n\t    var SHA1 = C_algo.SHA1 = Hasher.extend({\n\t        _doReset: function () {\n\t            this._hash = new WordArray.init([\n\t                0x67452301, 0xefcdab89,\n\t                0x98badcfe, 0x10325476,\n\t                0xc3d2e1f0\n\t            ]);\n\t        },\n\n\t        _doProcessBlock: function (M, offset) {\n\t            // Shortcut\n\t            var H = this._hash.words;\n\n\t            // Working variables\n\t            var a = H[0];\n\t            var b = H[1];\n\t            var c = H[2];\n\t            var d = H[3];\n\t            var e = H[4];\n\n\t            // Computation\n\t            for (var i = 0; i < 80; i++) {\n\t                if (i < 16) {\n\t                    W[i] = M[offset + i] | 0;\n\t                } else {\n\t                    var n = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];\n\t                    W[i] = (n << 1) | (n >>> 31);\n\t                }\n\n\t                var t = ((a << 5) | (a >>> 27)) + e + W[i];\n\t                if (i < 20) {\n\t                    t += ((b & c) | (~b & d)) + 0x5a827999;\n\t                } else if (i < 40) {\n\t                    t += (b ^ c ^ d) + 0x6ed9eba1;\n\t                } else if (i < 60) {\n\t                    t += ((b & c) | (b & d) | (c & d)) - 0x70e44324;\n\t                } else /* if (i < 80) */ {\n\t                    t += (b ^ c ^ d) - 0x359d3e2a;\n\t                }\n\n\t                e = d;\n\t                d = c;\n\t                c = (b << 30) | (b >>> 2);\n\t                b = a;\n\t                a = t;\n\t            }\n\n\t            // Intermediate hash value\n\t            H[0] = (H[0] + a) | 0;\n\t            H[1] = (H[1] + b) | 0;\n\t            H[2] = (H[2] + c) | 0;\n\t            H[3] = (H[3] + d) | 0;\n\t            H[4] = (H[4] + e) | 0;\n\t        },\n\n\t        _doFinalize: function () {\n\t            // Shortcuts\n\t            var data = this._data;\n\t            var dataWords = data.words;\n\n\t            var nBitsTotal = this._nDataBytes * 8;\n\t            var nBitsLeft = data.sigBytes * 8;\n\n\t            // Add padding\n\t            dataWords[nBitsLeft >>> 5] |= 0x80 << (24 - nBitsLeft % 32);\n\t            dataWords[(((nBitsLeft + 64) >>> 9) << 4) + 14] = Math.floor(nBitsTotal / 0x100000000);\n\t            dataWords[(((nBitsLeft + 64) >>> 9) << 4) + 15] = nBitsTotal;\n\t            data.sigBytes = dataWords.length * 4;\n\n\t            // Hash final blocks\n\t            this._process();\n\n\t            // Return final computed hash\n\t            return this._hash;\n\t        },\n\n\t        clone: function () {\n\t            var clone = Hasher.clone.call(this);\n\t            clone._hash = this._hash.clone();\n\n\t            return clone;\n\t        }\n\t    });\n\n\t    /**\n\t     * Shortcut function to the hasher's object interface.\n\t     *\n\t     * @param {WordArray|string} message The message to hash.\n\t     *\n\t     * @return {WordArray} The hash.\n\t     *\n\t     * @static\n\t     *\n\t     * @example\n\t     *\n\t     *     var hash = CryptoJS.SHA1('message');\n\t     *     var hash = CryptoJS.SHA1(wordArray);\n\t     */\n\t    C.SHA1 = Hasher._createHelper(SHA1);\n\n\t    /**\n\t     * Shortcut function to the HMAC's object interface.\n\t     *\n\t     * @param {WordArray|string} message The message to hash.\n\t     * @param {WordArray|string} key The secret key.\n\t     *\n\t     * @return {WordArray} The HMAC.\n\t     *\n\t     * @static\n\t     *\n\t     * @example\n\t     *\n\t     *     var hmac = CryptoJS.HmacSHA1(message, key);\n\t     */\n\t    C.HmacSHA1 = Hasher._createHmacHelper(SHA1);\n\t}());\n\n\n\treturn CryptoJS.SHA1;\n\n}));",";(function (root, factory, undef) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"), require(\"./sha256\"), require(\"./hmac\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([\"./core\", \"./sha256\", \"./hmac\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\treturn CryptoJS.HmacSHA256;\n\n}));",";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine([\"./core\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\t(function (Math) {\n\t    // Shortcuts\n\t    var C = CryptoJS;\n\t    var C_lib = C.lib;\n\t    var WordArray = C_lib.WordArray;\n\t    var Hasher = C_lib.Hasher;\n\t    var C_algo = C.algo;\n\n\t    // Initialization and round constants tables\n\t    var H = [];\n\t    var K = [];\n\n\t    // Compute constants\n\t    (function () {\n\t        function isPrime(n) {\n\t            var sqrtN = Math.sqrt(n);\n\t            for (var factor = 2; factor <= sqrtN; factor++) {\n\t                if (!(n % factor)) {\n\t                    return false;\n\t                }\n\t            }\n\n\t            return true;\n\t        }\n\n\t        function getFractionalBits(n) {\n\t            return ((n - (n | 0)) * 0x100000000) | 0;\n\t        }\n\n\t        var n = 2;\n\t        var nPrime = 0;\n\t        while (nPrime < 64) {\n\t            if (isPrime(n)) {\n\t                if (nPrime < 8) {\n\t                    H[nPrime] = getFractionalBits(Math.pow(n, 1 / 2));\n\t                }\n\t                K[nPrime] = getFractionalBits(Math.pow(n, 1 / 3));\n\n\t                nPrime++;\n\t            }\n\n\t            n++;\n\t        }\n\t    }());\n\n\t    // Reusable object\n\t    var W = [];\n\n\t    /**\n\t     * SHA-256 hash algorithm.\n\t     */\n\t    var SHA256 = C_algo.SHA256 = Hasher.extend({\n\t        _doReset: function () {\n\t            this._hash = new WordArray.init(H.slice(0));\n\t        },\n\n\t        _doProcessBlock: function (M, offset) {\n\t            // Shortcut\n\t            var H = this._hash.words;\n\n\t            // Working variables\n\t            var a = H[0];\n\t            var b = H[1];\n\t            var c = H[2];\n\t            var d = H[3];\n\t            var e = H[4];\n\t            var f = H[5];\n\t            var g = H[6];\n\t            var h = H[7];\n\n\t            // Computation\n\t            for (var i = 0; i < 64; i++) {\n\t                if (i < 16) {\n\t                    W[i] = M[offset + i] | 0;\n\t                } else {\n\t                    var gamma0x = W[i - 15];\n\t                    var gamma0  = ((gamma0x << 25) | (gamma0x >>> 7))  ^\n\t                                  ((gamma0x << 14) | (gamma0x >>> 18)) ^\n\t                                   (gamma0x >>> 3);\n\n\t                    var gamma1x = W[i - 2];\n\t                    var gamma1  = ((gamma1x << 15) | (gamma1x >>> 17)) ^\n\t                                  ((gamma1x << 13) | (gamma1x >>> 19)) ^\n\t                                   (gamma1x >>> 10);\n\n\t                    W[i] = gamma0 + W[i - 7] + gamma1 + W[i - 16];\n\t                }\n\n\t                var ch  = (e & f) ^ (~e & g);\n\t                var maj = (a & b) ^ (a & c) ^ (b & c);\n\n\t                var sigma0 = ((a << 30) | (a >>> 2)) ^ ((a << 19) | (a >>> 13)) ^ ((a << 10) | (a >>> 22));\n\t                var sigma1 = ((e << 26) | (e >>> 6)) ^ ((e << 21) | (e >>> 11)) ^ ((e << 7)  | (e >>> 25));\n\n\t                var t1 = h + sigma1 + ch + K[i] + W[i];\n\t                var t2 = sigma0 + maj;\n\n\t                h = g;\n\t                g = f;\n\t                f = e;\n\t                e = (d + t1) | 0;\n\t                d = c;\n\t                c = b;\n\t                b = a;\n\t                a = (t1 + t2) | 0;\n\t            }\n\n\t            // Intermediate hash value\n\t            H[0] = (H[0] + a) | 0;\n\t            H[1] = (H[1] + b) | 0;\n\t            H[2] = (H[2] + c) | 0;\n\t            H[3] = (H[3] + d) | 0;\n\t            H[4] = (H[4] + e) | 0;\n\t            H[5] = (H[5] + f) | 0;\n\t            H[6] = (H[6] + g) | 0;\n\t            H[7] = (H[7] + h) | 0;\n\t        },\n\n\t        _doFinalize: function () {\n\t            // Shortcuts\n\t            var data = this._data;\n\t            var dataWords = data.words;\n\n\t            var nBitsTotal = this._nDataBytes * 8;\n\t            var nBitsLeft = data.sigBytes * 8;\n\n\t            // Add padding\n\t            dataWords[nBitsLeft >>> 5] |= 0x80 << (24 - nBitsLeft % 32);\n\t            dataWords[(((nBitsLeft + 64) >>> 9) << 4) + 14] = Math.floor(nBitsTotal / 0x100000000);\n\t            dataWords[(((nBitsLeft + 64) >>> 9) << 4) + 15] = nBitsTotal;\n\t            data.sigBytes = dataWords.length * 4;\n\n\t            // Hash final blocks\n\t            this._process();\n\n\t            // Return final computed hash\n\t            return this._hash;\n\t        },\n\n\t        clone: function () {\n\t            var clone = Hasher.clone.call(this);\n\t            clone._hash = this._hash.clone();\n\n\t            return clone;\n\t        }\n\t    });\n\n\t    /**\n\t     * Shortcut function to the hasher's object interface.\n\t     *\n\t     * @param {WordArray|string} message The message to hash.\n\t     *\n\t     * @return {WordArray} The hash.\n\t     *\n\t     * @static\n\t     *\n\t     * @example\n\t     *\n\t     *     var hash = CryptoJS.SHA256('message');\n\t     *     var hash = CryptoJS.SHA256(wordArray);\n\t     */\n\t    C.SHA256 = Hasher._createHelper(SHA256);\n\n\t    /**\n\t     * Shortcut function to the HMAC's object interface.\n\t     *\n\t     * @param {WordArray|string} message The message to hash.\n\t     * @param {WordArray|string} key The secret key.\n\t     *\n\t     * @return {WordArray} The HMAC.\n\t     *\n\t     * @static\n\t     *\n\t     * @example\n\t     *\n\t     *     var hmac = CryptoJS.HmacSHA256(message, key);\n\t     */\n\t    C.HmacSHA256 = Hasher._createHmacHelper(SHA256);\n\t}(Math));\n\n\n\treturn CryptoJS.SHA256;\n\n}));","'use strict'\n\nconst {xml, jid, Client} = require('@xmpp/client-core')\nconst getDomain = require('./lib/getDomain')\n\nconst _reconnect = require('@xmpp/reconnect')\nconst _websocket = require('@xmpp/websocket')\nconst _middleware = require('@xmpp/middleware')\nconst _streamFeatures = require('@xmpp/stream-features')\nconst _iqCaller = require('@xmpp/iq/caller')\nconst _iqCallee = require('@xmpp/iq/callee')\nconst _resolve = require('@xmpp/resolve')\n\n// Stream features - order matters and define priority\nconst _sasl = require('@xmpp/sasl')\nconst _resourceBinding = require('@xmpp/resource-binding')\nconst _sessionEstablishment = require('@xmpp/session-establishment')\n\n// SASL mechanisms - order matters and define priority\nconst anonymous = require('@xmpp/sasl-anonymous')\nconst plain = require('@xmpp/sasl-plain')\n\nfunction client(options = {}) {\n  const {resource, credentials, username, password, ...params} = options\n\n  const {domain, service} = params\n  if (!domain && service) {\n    params.domain = getDomain(service)\n  }\n\n  const entity = new Client(params)\n\n  const reconnect = _reconnect({entity})\n  const websocket = _websocket({entity})\n\n  const middleware = _middleware({entity})\n  const streamFeatures = _streamFeatures({middleware})\n  const iqCaller = _iqCaller({middleware, entity})\n  const iqCallee = _iqCallee({middleware, entity})\n  const resolve = _resolve({entity})\n  // Stream features - order matters and define priority\n  const sasl = _sasl({streamFeatures}, credentials || {username, password})\n  const resourceBinding = _resourceBinding({iqCaller, streamFeatures}, resource)\n  const sessionEstablishment = _sessionEstablishment({iqCaller, streamFeatures})\n  // SASL mechanisms - order matters and define priority\n  const mechanisms = Object.entries({plain, anonymous}).map(([k, v]) => ({\n    [k]: v(sasl),\n  }))\n\n  return Object.assign(entity, {\n    entity,\n    reconnect,\n    websocket,\n    middleware,\n    streamFeatures,\n    iqCaller,\n    iqCallee,\n    resolve,\n    sasl,\n    resourceBinding,\n    sessionEstablishment,\n    mechanisms,\n  })\n}\n\nmodule.exports.xml = xml\nmodule.exports.jid = jid\nmodule.exports.client = client\n","'use strict'\n\nconst Client = require('./lib/Client')\nconst xml = require('@xmpp/xml')\nconst jid = require('@xmpp/jid')\n\nmodule.exports.Client = Client\nmodule.exports.xml = xml\nmodule.exports.jid = jid\n","'use strict'\n\nconst Connection = require('@xmpp/connection')\n\nclass Client extends Connection {\n  constructor(options) {\n    super(options)\n    this.transports = []\n  }\n\n  send(element, ...args) {\n    return this.Transport.prototype.send.call(this, element, ...args)\n  }\n\n  _findTransport(service) {\n    return this.transports.find(Transport => {\n      try {\n        return Transport.prototype.socketParameters(service) !== undefined\n        // eslint-disable-next-line no-unused-vars\n      } catch (err) {\n        return false\n      }\n    })\n  }\n\n  connect(service) {\n    const Transport = this._findTransport(service)\n\n    if (!Transport) {\n      throw new Error('No compatible connection method found.')\n    }\n\n    this.Transport = Transport\n    this.Socket = Transport.prototype.Socket\n    this.Parser = Transport.prototype.Parser\n\n    return super.connect(service)\n  }\n\n  socketParameters(...args) {\n    return this.Transport.prototype.socketParameters(...args)\n  }\n\n  header(...args) {\n    return this.Transport.prototype.header(...args)\n  }\n\n  headerElement(...args) {\n    return this.Transport.prototype.headerElement(...args)\n  }\n\n  footer(...args) {\n    return this.Transport.prototype.footer(...args)\n  }\n\n  footerElement(...args) {\n    return this.Transport.prototype.footerElement(...args)\n  }\n}\n\nClient.prototype.NS = 'jabber:client'\n\nmodule.exports = Client\n","'use strict'\n\nconst TimeoutError = require('./TimeoutError')\nconst delay = require('./delay')\n\nmodule.exports = function timeout(promise, ms) {\n  const promiseDelay = delay(ms)\n\n  // eslint-disable-next-line unicorn/consistent-function-scoping\n  function cancelDelay() {\n    clearTimeout(promiseDelay.timeout)\n  }\n\n  return Promise.race([\n    promise.finally(cancelDelay),\n    promiseDelay.then(() => {\n      throw new TimeoutError()\n    }),\n  ])\n}\n","'use strict'\n\nconst TimeoutError = require('./TimeoutError')\n\n// eslint-disable-next-line default-param-last\nmodule.exports = function promise(EE, event, rejectEvent = 'error', timeout) {\n  return new Promise((resolve, reject) => {\n    let timeoutId\n\n    const cleanup = () => {\n      clearTimeout(timeoutId)\n      EE.removeListener(event, onEvent)\n      EE.removeListener(rejectEvent, onError)\n    }\n\n    function onError(reason) {\n      reject(reason)\n      cleanup()\n    }\n\n    function onEvent(value) {\n      resolve(value)\n      cleanup()\n    }\n\n    EE.once(event, onEvent)\n    if (rejectEvent) {\n      EE.once(rejectEvent, onError)\n    }\n\n    if (timeout) {\n      timeoutId = setTimeout(() => {\n        cleanup()\n        reject(new TimeoutError())\n      }, timeout)\n    }\n  })\n}\n","'use strict'\n\nmodule.exports = function Deferred() {\n  this.promise = new Promise((resolve, reject) => {\n    this.resolve = resolve\n    this.reject = reject\n  })\n}\n","'use strict'\n\nconst JID = require('../lib/JID')\n\nmodule.exports = function parse(s) {\n  let local\n  let resource\n\n  const resourceStart = s.indexOf('/')\n  if (resourceStart !== -1) {\n    resource = s.slice(resourceStart + 1)\n    s = s.slice(0, resourceStart)\n  }\n\n  const atStart = s.indexOf('@')\n  if (atStart !== -1) {\n    local = s.slice(0, atStart)\n    s = s.slice(atStart + 1)\n  }\n\n  return new JID(local, s, resource)\n}\n","'use strict'\n\nconst Element = require('./Element')\n\nfunction append(el, child) {\n  if (child === false || child === null || child === undefined) return\n  if (child instanceof Element) {\n    el.append(child)\n  } else if (Array.isArray(child)) {\n    child.forEach(c => append(el, c))\n  } else {\n    el.append(String(child))\n  }\n}\n\nfunction x(name, attrs, ...children) {\n  const el = new Element(name, attrs)\n  // eslint-disable-next-line unicorn/no-for-loop\n  for (let i = 0; i < children.length; i++) {\n    append(el, children[i])\n  }\n\n  return el\n}\n\nmodule.exports = x\n","'use strict'\n\nvar escape = require('./escape')\nvar escapeXML = escape.escapeXML\nvar escapeXMLText = escape.escapeXMLText\n\nvar equality = require('./equal')\nvar equal = equality.equal\nvar nameEqual = equality.name\nvar attrsEqual = equality.attrs\nvar childrenEqual = equality.children\n\nvar clone = require('./clone')\n\n/**\n * Element\n *\n * Attributes are in the element.attrs object. Children is a list of\n * either other Elements or Strings for text content.\n **/\nfunction Element (name, attrs) {\n  this.name = name\n  this.parent = null\n  this.children = []\n  this.attrs = {}\n  this.setAttrs(attrs)\n}\n\n/* Accessors */\n\n/**\n * if (element.is('message', 'jabber:client')) ...\n **/\nElement.prototype.is = function (name, xmlns) {\n  return (this.getName() === name) &&\n  (!xmlns || (this.getNS() === xmlns))\n}\n\n/* without prefix */\nElement.prototype.getName = function () {\n  if (this.name.indexOf(':') >= 0) {\n    return this.name.substr(this.name.indexOf(':') + 1)\n  } else {\n    return this.name\n  }\n}\n\n/**\n * retrieves the namespace of the current element, upwards recursively\n **/\nElement.prototype.getNS = function () {\n  if (this.name.indexOf(':') >= 0) {\n    var prefix = this.name.substr(0, this.name.indexOf(':'))\n    return this.findNS(prefix)\n  }\n  return this.findNS()\n}\n\n/**\n * find the namespace to the given prefix, upwards recursively\n **/\nElement.prototype.findNS = function (prefix) {\n  if (!prefix) {\n    /* default namespace */\n    if (this.attrs.xmlns) {\n      return this.attrs.xmlns\n    } else if (this.parent) {\n      return this.parent.findNS()\n    }\n  } else {\n    /* prefixed namespace */\n    var attr = 'xmlns:' + prefix\n    if (this.attrs[attr]) {\n      return this.attrs[attr]\n    } else if (this.parent) {\n      return this.parent.findNS(prefix)\n    }\n  }\n}\n\n/**\n * Recursiverly gets all xmlns defined, in the form of {url:prefix}\n **/\nElement.prototype.getXmlns = function () {\n  var namespaces = {}\n\n  if (this.parent) {\n    namespaces = this.parent.getXmlns()\n  }\n\n  for (var attr in this.attrs) {\n    var m = attr.match('xmlns:?(.*)')\n    // eslint-disable-next-line  no-prototype-builtins\n    if (this.attrs.hasOwnProperty(attr) && m) {\n      namespaces[this.attrs[attr]] = m[1]\n    }\n  }\n  return namespaces\n}\n\nElement.prototype.setAttrs = function (attrs) {\n  if (typeof attrs === 'string') {\n    this.attrs.xmlns = attrs\n  } else if (attrs) {\n    Object.keys(attrs).forEach(function (key) {\n      this.attrs[key] = attrs[key]\n    }, this)\n  }\n}\n\n/**\n * xmlns can be null, returns the matching attribute.\n **/\nElement.prototype.getAttr = function (name, xmlns) {\n  if (!xmlns) {\n    return this.attrs[name]\n  }\n\n  var namespaces = this.getXmlns()\n\n  if (!namespaces[xmlns]) {\n    return null\n  }\n\n  return this.attrs[[namespaces[xmlns], name].join(':')]\n}\n\n/**\n * xmlns can be null\n **/\nElement.prototype.getChild = function (name, xmlns) {\n  return this.getChildren(name, xmlns)[0]\n}\n\n/**\n * xmlns can be null\n **/\nElement.prototype.getChildren = function (name, xmlns) {\n  var result = []\n  for (var i = 0; i < this.children.length; i++) {\n    var child = this.children[i]\n    if (child.getName &&\n      (child.getName() === name) &&\n      (!xmlns || (child.getNS() === xmlns))) {\n      result.push(child)\n    }\n  }\n  return result\n}\n\n/**\n * xmlns and recursive can be null\n **/\nElement.prototype.getChildByAttr = function (attr, val, xmlns, recursive) {\n  return this.getChildrenByAttr(attr, val, xmlns, recursive)[0]\n}\n\n/**\n * xmlns and recursive can be null\n **/\nElement.prototype.getChildrenByAttr = function (attr, val, xmlns, recursive) {\n  var result = []\n  for (var i = 0; i < this.children.length; i++) {\n    var child = this.children[i]\n    if (child.attrs &&\n      (child.attrs[attr] === val) &&\n      (!xmlns || (child.getNS() === xmlns))) {\n      result.push(child)\n    }\n    if (recursive && child.getChildrenByAttr) {\n      result.push(child.getChildrenByAttr(attr, val, xmlns, true))\n    }\n  }\n  if (recursive) {\n    result = [].concat.apply([], result)\n  }\n  return result\n}\n\nElement.prototype.getChildrenByFilter = function (filter, recursive) {\n  var result = []\n  for (var i = 0; i < this.children.length; i++) {\n    var child = this.children[i]\n    if (filter(child)) {\n      result.push(child)\n    }\n    if (recursive && child.getChildrenByFilter) {\n      result.push(child.getChildrenByFilter(filter, true))\n    }\n  }\n  if (recursive) {\n    result = [].concat.apply([], result)\n  }\n  return result\n}\n\nElement.prototype.getText = function () {\n  var text = ''\n  for (var i = 0; i < this.children.length; i++) {\n    var child = this.children[i]\n    if ((typeof child === 'string') || (typeof child === 'number')) {\n      text += child\n    }\n  }\n  return text\n}\n\nElement.prototype.getChildText = function (name, xmlns) {\n  var child = this.getChild(name, xmlns)\n  return child ? child.getText() : null\n}\n\n/**\n * Return all direct descendents that are Elements.\n * This differs from `getChildren` in that it will exclude text nodes,\n * processing instructions, etc.\n */\nElement.prototype.getChildElements = function () {\n  return this.getChildrenByFilter(function (child) {\n    return child instanceof Element\n  })\n}\n\n/* Builder */\n\n/** returns uppermost parent */\nElement.prototype.root = function () {\n  if (this.parent) {\n    return this.parent.root()\n  }\n  return this\n}\nElement.prototype.tree = Element.prototype.root\n\n/** just parent or itself */\nElement.prototype.up = function () {\n  if (this.parent) {\n    return this.parent\n  }\n  return this\n}\n\n/** create child node and return it */\nElement.prototype.c = function (name, attrs) {\n  return this.cnode(new Element(name, attrs))\n}\n\nElement.prototype.cnode = function (child) {\n  this.children.push(child)\n  if (typeof child === 'object') {\n    child.parent = this\n  }\n  return child\n}\n\n/** add text node and return element */\nElement.prototype.t = function (text) {\n  this.children.push(text)\n  return this\n}\n\n/* Manipulation */\n\n/**\n * Either:\n *   el.remove(childEl)\n *   el.remove('author', 'urn:...')\n */\nElement.prototype.remove = function (el, xmlns) {\n  var filter\n  if (typeof el === 'string') {\n    /* 1st parameter is tag name */\n    filter = function (child) {\n      return !(child.is &&\n      child.is(el, xmlns))\n    }\n  } else {\n    /* 1st parameter is element */\n    filter = function (child) {\n      return child !== el\n    }\n  }\n\n  this.children = this.children.filter(filter)\n\n  return this\n}\n\nElement.prototype.clone = function () {\n  return clone(this)\n}\n\nElement.prototype.text = function (val) {\n  if (val && this.children.length === 1) {\n    this.children[0] = val\n    return this\n  }\n  return this.getText()\n}\n\nElement.prototype.attr = function (attr, val) {\n  if (typeof val !== 'undefined' || val === null) {\n    if (!this.attrs) {\n      this.attrs = {}\n    }\n    this.attrs[attr] = val\n    return this\n  }\n  return this.attrs[attr]\n}\n\n/* Serialization */\n\nElement.prototype.toString = function () {\n  var s = ''\n  this.write(function (c) {\n    s += c\n  })\n  return s\n}\n\nElement.prototype.toJSON = function () {\n  return {\n    name: this.name,\n    attrs: this.attrs,\n    children: this.children.map(function (child) {\n      return child && child.toJSON ? child.toJSON() : child\n    })\n  }\n}\n\nElement.prototype._addChildren = function (writer) {\n  writer('>')\n  for (var i = 0; i < this.children.length; i++) {\n    var child = this.children[i]\n    /* Skip null/undefined */\n    if (child || (child === 0)) {\n      if (child.write) {\n        child.write(writer)\n      } else if (typeof child === 'string') {\n        writer(escapeXMLText(child))\n      } else if (child.toString) {\n        writer(escapeXMLText(child.toString(10)))\n      }\n    }\n  }\n  writer('</')\n  writer(this.name)\n  writer('>')\n}\n\nElement.prototype.write = function (writer) {\n  writer('<')\n  writer(this.name)\n  for (var k in this.attrs) {\n    var v = this.attrs[k]\n    if (v != null) { // === null || undefined\n      writer(' ')\n      writer(k)\n      writer('=\"')\n      if (typeof v !== 'string') {\n        v = v.toString()\n      }\n      writer(escapeXML(v))\n      writer('\"')\n    }\n  }\n  if (this.children.length === 0) {\n    writer('/>')\n  } else {\n    this._addChildren(writer)\n  }\n}\n\nElement.prototype.nameEquals = function (el) {\n  return nameEqual(this, el)\n}\n\nElement.prototype.attrsEquals = function (el) {\n  return attrsEqual(this, el)\n}\n\nElement.prototype.childrenEquals = function (el) {\n  return childrenEqual(this, el)\n}\n\nElement.prototype.equals = function (el) {\n  return equal(this, el)\n}\n\nmodule.exports = Element\n","'use strict'\n\nfunction nameEqual (a, b) {\n  return a.name === b.name\n}\n\nfunction attrsEqual (a, b) {\n  var attrs = a.attrs\n  var keys = Object.keys(attrs)\n  var length = keys.length\n  if (length !== Object.keys(b.attrs).length) return false\n  for (var i = 0, l = length; i < l; i++) {\n    var key = keys[i]\n    var value = attrs[key]\n    if (value == null || b.attrs[key] == null) { // === null || undefined\n      if (value !== b.attrs[key]) return false\n    } else if (value.toString() !== b.attrs[key].toString()) {\n      return false\n    }\n  }\n  return true\n}\n\nfunction childrenEqual (a, b) {\n  var children = a.children\n  var length = children.length\n  if (length !== b.children.length) return false\n  for (var i = 0, l = length; i < l; i++) {\n    var child = children[i]\n    if (typeof child === 'string') {\n      if (child !== b.children[i]) return false\n    } else {\n      if (!child.equals(b.children[i])) return false\n    }\n  }\n  return true\n}\n\nfunction equal (a, b) {\n  if (!nameEqual(a, b)) return false\n  if (!attrsEqual(a, b)) return false\n  if (!childrenEqual(a, b)) return false\n  return true\n}\n\nmodule.exports.name = nameEqual\nmodule.exports.attrs = attrsEqual\nmodule.exports.children = childrenEqual\nmodule.exports.equal = equal\n","'use strict'\n\nmodule.exports = function clone (el) {\n  var clone = new el.constructor(el.name, el.attrs)\n  for (var i = 0; i < el.children.length; i++) {\n    var child = el.children[i]\n    clone.cnode(child.clone ? child.clone() : child)\n  }\n  return clone\n}\n","'use strict'\n\nvar inherits = require('inherits')\nvar EventEmitter = require('events').EventEmitter\nvar unescapeXML = require('../escape').unescapeXML\n\nvar STATE_TEXT = 0\nvar STATE_IGNORE_COMMENT = 1\nvar STATE_IGNORE_INSTRUCTION = 2\nvar STATE_TAG_NAME = 3\nvar STATE_TAG = 4\nvar STATE_ATTR_NAME = 5\nvar STATE_ATTR_EQ = 6\nvar STATE_ATTR_QUOT = 7\nvar STATE_ATTR_VALUE = 8\nvar STATE_CDATA = 9\nvar STATE_IGNORE_CDATA = 10\n\nvar SaxLtx = module.exports = function SaxLtx () {\n  EventEmitter.call(this)\n\n  var state = STATE_TEXT\n  var remainder\n  var tagName\n  var attrs\n  var endTag\n  var selfClosing\n  var attrQuote\n  var attrQuoteChar\n  var recordStart = 0\n  var attrName\n\n  this._handleTagOpening = function (endTag, tagName, attrs) {\n    if (!endTag) {\n      this.emit('startElement', tagName, attrs)\n      if (selfClosing) {\n        this.emit('endElement', tagName)\n      }\n    } else {\n      this.emit('endElement', tagName)\n    }\n  }\n\n  this.write = function (data) {\n    if (typeof data !== 'string') {\n      data = data.toString()\n    }\n    var pos = 0\n\n    /* Anything from previous write()? */\n    if (remainder) {\n      data = remainder + data\n      pos += remainder.length\n      remainder = null\n    }\n\n    function endRecording () {\n      if (typeof recordStart === 'number') {\n        var recorded = data.substring(recordStart, pos)\n        recordStart = undefined\n        return recorded\n      }\n    }\n\n    for (; pos < data.length; pos++) {\n      if (state === STATE_TEXT) {\n        // if we're looping through text, fast-forward using indexOf to\n        // the next '<' character\n        var lt = data.indexOf('<', pos)\n        if (lt !== -1 && pos !== lt) {\n          pos = lt\n        }\n      } else if (state === STATE_ATTR_VALUE) {\n        // if we're looping through an attribute, fast-forward using\n        // indexOf to the next end quote character\n        var quot = data.indexOf(attrQuoteChar, pos)\n        if (quot !== -1) {\n          pos = quot\n        }\n      } else if (state === STATE_IGNORE_COMMENT) {\n        // if we're looping through a comment, fast-forward using\n        // indexOf to the first end-comment character\n        var endcomment = data.indexOf('-->', pos)\n        if (endcomment !== -1) {\n          pos = endcomment + 2 // target the '>' character\n        }\n      } else if (state === STATE_IGNORE_CDATA) {\n        // if we're looping through a CDATA, fast-forward using\n        // indexOf to the first end-CDATA character ]]>\n        var endCDATA = data.indexOf(']]>', pos)\n        if (endCDATA !== -1) {\n          pos = endCDATA + 2 // target the '>' character\n        }\n      }\n\n      var c = data.charCodeAt(pos)\n      switch (state) {\n        case STATE_TEXT:\n          if (c === 60 /* < */) {\n            var text = endRecording()\n            if (text) {\n              this.emit('text', unescapeXML(text))\n            }\n            state = STATE_TAG_NAME\n            recordStart = pos + 1\n            attrs = {}\n          }\n          break\n        case STATE_CDATA:\n          if (c === 93 /* ] */ && data.substr(pos + 1, 2) === ']>') {\n            var cData = endRecording()\n            if (cData) {\n              this.emit('text', cData)\n            }\n            state = STATE_TEXT\n          }\n          break\n        case STATE_TAG_NAME:\n          if (c === 47 /* / */ && recordStart === pos) {\n            recordStart = pos + 1\n            endTag = true\n          } else if (c === 33 /* ! */) {\n            if (data.substr(pos + 1, 7) === '[CDATA[') {\n              recordStart = pos + 8\n              state = STATE_CDATA\n            } else {\n              recordStart = undefined\n              state = STATE_IGNORE_COMMENT\n            }\n          } else if (c === 63 /* ? */) {\n            recordStart = undefined\n            state = STATE_IGNORE_INSTRUCTION\n          } else if (c <= 32 || c === 47 /* / */ || c === 62 /* > */) {\n            tagName = endRecording()\n            pos--\n            state = STATE_TAG\n          }\n          break\n        case STATE_IGNORE_COMMENT:\n          if (c === 62 /* > */) {\n            var prevFirst = data.charCodeAt(pos - 1)\n            var prevSecond = data.charCodeAt(pos - 2)\n            if ((prevFirst === 45 /* - */ && prevSecond === 45 /* - */) ||\n                (prevFirst === 93 /* ] */ && prevSecond === 93 /* ] */)) {\n              state = STATE_TEXT\n            }\n          }\n          break\n        case STATE_IGNORE_INSTRUCTION:\n          if (c === 62 /* > */) {\n            var prev = data.charCodeAt(pos - 1)\n            if (prev === 63 /* ? */) {\n              state = STATE_TEXT\n            }\n          }\n          break\n        case STATE_TAG:\n          if (c === 62 /* > */) {\n            this._handleTagOpening(endTag, tagName, attrs)\n            tagName = undefined\n            attrs = undefined\n            endTag = undefined\n            selfClosing = undefined\n            state = STATE_TEXT\n            recordStart = pos + 1\n          } else if (c === 47 /* / */) {\n            selfClosing = true\n          } else if (c > 32) {\n            recordStart = pos\n            state = STATE_ATTR_NAME\n          }\n          break\n        case STATE_ATTR_NAME:\n          if (c <= 32 || c === 61 /* = */) {\n            attrName = endRecording()\n            pos--\n            state = STATE_ATTR_EQ\n          }\n          break\n        case STATE_ATTR_EQ:\n          if (c === 61 /* = */) {\n            state = STATE_ATTR_QUOT\n          }\n          break\n        case STATE_ATTR_QUOT:\n          if (c === 34 /* \" */ || c === 39 /* ' */) {\n            attrQuote = c\n            attrQuoteChar = c === 34 ? '\"' : \"'\"\n            state = STATE_ATTR_VALUE\n            recordStart = pos + 1\n          }\n          break\n        case STATE_ATTR_VALUE:\n          if (c === attrQuote) {\n            var value = unescapeXML(endRecording())\n            attrs[attrName] = value\n            attrName = undefined\n            state = STATE_TAG\n          }\n          break\n      }\n    }\n\n    if (typeof recordStart === 'number' &&\n      recordStart <= data.length) {\n      remainder = data.slice(recordStart)\n      recordStart = 0\n    }\n  }\n}\ninherits(SaxLtx, EventEmitter)\n\nSaxLtx.prototype.end = function (data) {\n  if (data) {\n    this.write(data)\n  }\n\n  /* Uh, yeah */\n  this.write = function () {}\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","'use strict'\n\nconst XMPPError = require('@xmpp/error')\n\n// https://xmpp.org/rfcs/rfc6120.html#streams-error\n\nclass StreamError extends XMPPError {\n  constructor(...args) {\n    super(...args)\n    this.name = 'StreamError'\n  }\n}\n\nmodule.exports = StreamError\n","'use strict'\n\nfunction parseURI(URI) {\n  let {port, hostname, protocol} = new URL(URI)\n  // https://github.com/nodejs/node/issues/12410#issuecomment-294138912\n  if (hostname === '[::1]') {\n    hostname = '::1'\n  }\n\n  return {port, hostname, protocol}\n}\n\nfunction parseHost(host) {\n  const {port, hostname} = parseURI(`http://${host}`)\n  return {port, hostname}\n}\n\nfunction parseService(service) {\n  return service.includes('://') ? parseURI(service) : parseHost(service)\n}\n\nObject.assign(module.exports, {parseURI, parseHost, parseService})\n","'use strict'\n\nmodule.exports = function getDomain(service) {\n  const domain = service.split('://')[1] || service\n  return domain.split(':')[0].split('/')[0]\n}\n","'use strict'\n\nconst {EventEmitter} = require('@xmpp/events')\n\nclass Reconnect extends EventEmitter {\n  constructor(entity) {\n    super()\n\n    this.delay = 1000\n    this.entity = entity\n    this._timeout = null\n  }\n\n  scheduleReconnect() {\n    const {entity, delay, _timeout} = this\n    clearTimeout(_timeout)\n    this._timeout = setTimeout(async () => {\n      if (entity.status !== 'disconnect') {\n        return\n      }\n\n      try {\n        await this.reconnect()\n        // eslint-disable-next-line no-unused-vars\n      } catch (err) {\n        // Ignoring the rejection is safe because the error is emitted on entity by #start\n      }\n    }, delay)\n  }\n\n  async reconnect() {\n    const {entity} = this\n    this.emit('reconnecting')\n\n    const {service, domain, lang} = entity.options\n    await entity.connect(service)\n    await entity.open({domain, lang})\n\n    this.emit('reconnected')\n  }\n\n  start() {\n    const {entity} = this\n    const listeners = {}\n    listeners.disconnect = () => {\n      this.scheduleReconnect()\n    }\n\n    this.listeners = listeners\n    entity.on('disconnect', listeners.disconnect)\n  }\n\n  stop() {\n    const {entity, listeners, _timeout} = this\n    entity.removeListener('disconnect', listeners.disconnect)\n    clearTimeout(_timeout)\n  }\n}\n\nmodule.exports = function reconnect({entity}) {\n  const r = new Reconnect(entity)\n  r.start()\n  return r\n}\n","'use strict'\n\nconst ConnectionWebSocket = require('./lib/Connection')\n\nmodule.exports = function websocket({entity}) {\n  entity.transports.push(ConnectionWebSocket)\n}\n","'use strict'\n\nconst Socket = require('./Socket')\nconst Connection = require('@xmpp/connection')\nconst xml = require('@xmpp/xml')\nconst FramedParser = require('./FramedParser')\n\nconst NS_FRAMING = 'urn:ietf:params:xml:ns:xmpp-framing'\n\n/* References\n * WebSocket protocol https://tools.ietf.org/html/rfc6455\n * WebSocket Web API https://html.spec.whatwg.org/multipage/comms.html#network\n * XMPP over WebSocket https://tools.ietf.org/html/rfc7395\n */\n\nclass ConnectionWebSocket extends Connection {\n  send(element, ...args) {\n    if (!element.attrs.xmlns && super.isStanza(element)) {\n      element.attrs.xmlns = 'jabber:client'\n    }\n\n    return super.send(element, ...args)\n  }\n\n  // https://tools.ietf.org/html/rfc7395#section-3.6\n  footerElement() {\n    return new xml.Element('close', {\n      xmlns: NS_FRAMING,\n    })\n  }\n\n  // https://tools.ietf.org/html/rfc7395#section-3.4\n  headerElement() {\n    const el = super.headerElement()\n    el.name = 'open'\n    el.attrs.xmlns = NS_FRAMING\n    return el\n  }\n\n  socketParameters(service) {\n    return service.match(/^wss?:\\/\\//) ? service : undefined\n  }\n}\n\nConnectionWebSocket.prototype.Socket = Socket\nConnectionWebSocket.prototype.NS = 'jabber:client'\nConnectionWebSocket.prototype.Parser = FramedParser\n\nmodule.exports = ConnectionWebSocket\n","'use strict'\n\nconst WS = require('ws')\nconst WebSocket = global.WebSocket || WS\nconst EventEmitter = require('events')\n\nconst CODE = 'ECONNERROR'\n\nclass Socket extends EventEmitter {\n  constructor() {\n    super()\n    this.listeners = Object.create(null)\n  }\n\n  connect(url) {\n    this.url = url\n    this._attachSocket(new WebSocket(url, ['xmpp']))\n  }\n\n  _attachSocket(socket) {\n    const sock = (this.socket = socket)\n    const {listeners} = this\n    listeners.open = () => {\n      this.emit('connect')\n    }\n\n    listeners.message = ({data}) => this.emit('data', data)\n    listeners.error = event => {\n      // WS\n      let {error} = event\n      // DOM\n      if (!error) {\n        error = new Error(`WebSocket ${CODE} ${this.url}`)\n        error.errno = CODE\n        error.code = CODE\n      }\n\n      error.event = event\n      error.url = this.url\n      this.emit('error', error)\n    }\n\n    listeners.close = event => {\n      this._detachSocket()\n      this.emit('close', !event.wasClean, event)\n    }\n\n    sock.addEventListener('open', listeners.open)\n    sock.addEventListener('message', listeners.message)\n    sock.addEventListener('error', listeners.error)\n    sock.addEventListener('close', listeners.close)\n  }\n\n  _detachSocket() {\n    delete this.url\n    const {socket, listeners} = this\n    Object.getOwnPropertyNames(listeners).forEach(k => {\n      socket.removeEventListener(k, listeners[k])\n      delete listeners[k]\n    })\n    delete this.socket\n  }\n\n  end() {\n    this.socket.close()\n  }\n\n  write(data, fn) {\n    if (WebSocket === WS) {\n      this.socket.send(data, fn)\n    } else {\n      this.socket.send(data)\n      fn()\n    }\n  }\n}\n\nmodule.exports = Socket\n","'use strict'\n\nconst {Parser, Element, XMLError} = require('@xmpp/xml')\n\nmodule.exports = class FramedParser extends Parser {\n  onStartElement(name, attrs) {\n    const element = new Element(name, attrs)\n\n    const {cursor} = this\n\n    if (cursor) {\n      cursor.append(element)\n    }\n\n    this.cursor = element\n  }\n\n  onEndElement(name) {\n    const {cursor} = this\n    if (name !== cursor.name) {\n      // <foo></bar>\n      this.emit('error', new XMLError(`${cursor.name} must be closed.`))\n      return\n    }\n\n    if (cursor.parent) {\n      this.cursor = cursor.parent\n      return\n    }\n\n    if (cursor.is('open', 'urn:ietf:params:xml:ns:xmpp-framing')) {\n      this.emit('start', cursor)\n    } else if (cursor.is('close', 'urn:ietf:params:xml:ns:xmpp-framing')) {\n      this.emit('end', cursor)\n    } else {\n      this.emit('element', cursor)\n    }\n\n    this.cursor = null\n  }\n}\n","'use strict'\n\nconst compose = require('koa-compose')\n\nconst IncomingContext = require('./lib/IncomingContext')\nconst OutgoingContext = require('./lib/OutgoingContext')\n\nfunction listener(entity, middleware, Context) {\n  return function(stanza) {\n    const ctx = new Context(entity, stanza)\n    return compose(middleware)(ctx)\n  }\n}\n\nfunction errorHandler(entity) {\n  return function(ctx, next) {\n    next()\n      .then(reply => reply && entity.send(reply))\n      .catch(err => entity.emit('error', err))\n  }\n}\n\nmodule.exports = function({entity}) {\n  const incoming = [errorHandler(entity)]\n  const outgoing = []\n\n  const incomingListener = listener(entity, incoming, IncomingContext)\n  const outgoingListener = listener(entity, outgoing, OutgoingContext)\n\n  entity.on('element', incomingListener)\n  entity.hookOutgoing = outgoingListener\n\n  return {\n    use(fn) {\n      incoming.push(fn)\n      return fn\n    },\n    filter(fn) {\n      outgoing.push(fn)\n      return fn\n    },\n  }\n}\n","'use strict'\n\n/**\n * Expose compositor.\n */\n\nmodule.exports = compose\n\n/**\n * Compose `middleware` returning\n * a fully valid middleware comprised\n * of all those which are passed.\n *\n * @param {Array} middleware\n * @return {Function}\n * @api public\n */\n\nfunction compose (middleware) {\n  if (!Array.isArray(middleware)) throw new TypeError('Middleware stack must be an array!')\n  for (const fn of middleware) {\n    if (typeof fn !== 'function') throw new TypeError('Middleware must be composed of functions!')\n  }\n\n  /**\n   * @param {Object} context\n   * @return {Promise}\n   * @api public\n   */\n\n  return function (context, next) {\n    // last called middleware #\n    let index = -1\n    return dispatch(0)\n    function dispatch (i) {\n      if (i <= index) return Promise.reject(new Error('next() called multiple times'))\n      index = i\n      let fn = middleware[i]\n      if (i === middleware.length) fn = next\n      if (!fn) return Promise.resolve()\n      try {\n        return Promise.resolve(fn(context, dispatch.bind(null, i + 1)));\n      } catch (err) {\n        return Promise.reject(err)\n      }\n    }\n  }\n}\n","'use strict'\n\nconst Context = require('./Context')\nconst JID = require('@xmpp/jid')\n\nmodule.exports = class IncomingContext extends Context {\n  constructor(entity, stanza) {\n    super(entity, stanza)\n\n    const {jid, domain} = entity\n\n    const to = stanza.attrs.to || (jid && jid.toString())\n    const from = stanza.attrs.from || domain\n\n    if (to) this.to = new JID(to)\n\n    if (from) {\n      this.from = new JID(from)\n      this.local = this.from.local\n      this.domain = this.from.domain\n      this.resource = this.from.resource\n    }\n  }\n}\n","'use strict'\n\nconst Context = require('./Context')\nconst JID = require('@xmpp/jid')\n\nmodule.exports = class OutgoingContext extends Context {\n  constructor(entity, stanza) {\n    super(entity, stanza)\n\n    const {jid, domain} = entity\n\n    const from = stanza.attrs.from || (jid && jid.toString())\n    const to = stanza.attrs.to || domain\n\n    if (from) this.from = new JID(from)\n\n    if (to) {\n      this.to = new JID(to)\n      this.local = this.to.local\n      this.domain = this.to.domain\n      this.resource = this.to.resource\n    }\n  }\n}\n","'use strict'\n\n/**\n * References\n * https://xmpp.org/rfcs/rfc6120.html#streams-negotiation Stream Negotiation\n * https://xmpp.org/extensions/xep-0170.html XEP-0170: Recommended Order of Stream Feature Negotiation\n * https://xmpp.org/registrar/stream-features.html XML Stream Features\n */\n\nconst route = require('./route')\n\nmodule.exports = function({middleware}) {\n  middleware.use(route())\n\n  function use(name, xmlns, handler) {\n    return middleware.use((ctx, next) => {\n      const {stanza} = ctx\n      if (!stanza.is('features', 'http://etherx.jabber.org/streams'))\n        return next()\n      const feature = stanza.getChild(name, xmlns)\n      if (!feature) return next()\n      return handler(ctx, next, feature)\n    })\n  }\n\n  return {\n    use,\n  }\n}\n","'use strict'\n\nmodule.exports = function route() {\n  return async function({stanza, entity}, next) {\n    if (!stanza.is('features', 'http://etherx.jabber.org/streams'))\n      return next()\n\n    await next()\n    if (entity.jid) entity._status('online', entity.jid)\n  }\n}\n","'use strict'\n\nconst xid = require('@xmpp/id')\nconst StanzaError = require('@xmpp/middleware/lib/StanzaError')\nconst {Deferred} = require('@xmpp/events')\nconst timeoutPromise = require('@xmpp/events').timeout\nconst xml = require('@xmpp/xml')\n\nfunction isReply({name, type}) {\n  if (name !== 'iq') return false\n  if (type !== 'error' && type !== 'result') return false\n  return true\n}\n\nclass IQCaller {\n  constructor({entity, middleware}) {\n    this.handlers = new Map()\n    this.entity = entity\n    this.middleware = middleware\n  }\n\n  start() {\n    this.middleware.use(this._route.bind(this))\n  }\n\n  _route({type, name, id, stanza}, next) {\n    if (!isReply({name, type})) return next()\n\n    const deferred = this.handlers.get(id)\n\n    if (!deferred) {\n      return next()\n    }\n\n    if (type === 'error') {\n      deferred.reject(StanzaError.fromElement(stanza.getChild('error')))\n    } else {\n      deferred.resolve(stanza)\n    }\n\n    this.handlers.delete(id)\n  }\n\n  async request(stanza, timeout = 30 * 1000) {\n    if (!stanza.attrs.id) {\n      stanza.attrs.id = xid()\n    }\n\n    const deferred = new Deferred()\n    this.handlers.set(stanza.attrs.id, deferred)\n\n    try {\n      await this.entity.send(stanza)\n      await timeoutPromise(deferred.promise, timeout)\n    } catch (err) {\n      this.handlers.delete(stanza.attrs.id)\n      throw err\n    }\n\n    return deferred.promise\n  }\n\n  _childRequest(type, element, to, ...args) {\n    const {name} = element\n    const {xmlns} = element.attrs\n    return this.request(xml('iq', {type, to}, element), ...args).then(stanza =>\n      stanza.getChild(name, xmlns)\n    )\n  }\n\n  async get(...args) {\n    return this._childRequest('get', ...args)\n  }\n\n  async set(...args) {\n    return this._childRequest('set', ...args)\n  }\n}\n\nmodule.exports = function iqCaller(...args) {\n  const iqCaller = new IQCaller(...args)\n  iqCaller.start()\n  return iqCaller\n}\n","'use strict'\n\nmodule.exports = function id() {\n  let i\n  while (!i) {\n    i = Math.random()\n      .toString(36)\n      .slice(2, 12)\n  }\n\n  return i\n}\n","'use strict'\n\n/* https://xmpp.org/rfcs/rfc6120.html#stanzas-error */\n\nconst XMPPError = require('@xmpp/error')\n\nclass StanzaError extends XMPPError {\n  constructor(condition, text, application, type) {\n    super(condition, text, application)\n    this.type = type\n    this.name = 'StanzaError'\n  }\n\n  static fromElement(element) {\n    const error = super.fromElement(element)\n    error.type = element.attrs.type\n    return error\n  }\n}\n\nmodule.exports = StanzaError\n","'use strict'\n\n/**\n * References\n * https://xmpp.org/rfcs/rfc6120.html#stanzas-semantics-iq\n * https://xmpp.org/rfcs/rfc6120.html#stanzas-error\n */\n\nconst xml = require('@xmpp/xml')\n\nconst NS_STANZA = 'urn:ietf:params:xml:ns:xmpp-stanzas'\n\nfunction isQuery({name, type}) {\n  if (name !== 'iq') return false\n  if (type === 'error' || type === 'result') return false\n  return true\n}\n\nfunction isValidQuery({type}, children, child) {\n  if (type !== 'get' && type !== 'set') return false\n  if (children.length !== 1) return false\n  if (!child) return false\n  return true\n}\n\nfunction buildReply({stanza}) {\n  return xml('iq', {\n    to: stanza.attrs.from,\n    from: stanza.attrs.to,\n    id: stanza.attrs.id,\n  })\n}\n\nfunction buildReplyResult(ctx, child) {\n  const reply = buildReply(ctx)\n  reply.attrs.type = 'result'\n  if (child) {\n    reply.append(child)\n  }\n\n  return reply\n}\n\nfunction buildReplyError(ctx, error, child) {\n  const reply = buildReply(ctx)\n  reply.attrs.type = 'error'\n  if (child) {\n    reply.append(child)\n  }\n\n  reply.append(error)\n  return reply\n}\n\nfunction buildError(type, condition) {\n  return xml('error', {type}, xml(condition, NS_STANZA))\n}\n\nfunction iqHandler(entity) {\n  return async function iqHandler(ctx, next) {\n    if (!isQuery(ctx)) return next()\n\n    const {stanza} = ctx\n    const children = stanza.getChildElements()\n    const [child] = children\n\n    if (!isValidQuery(ctx, children, child)) {\n      return buildReplyError(ctx, buildError('modify', 'bad-request'), child)\n    }\n\n    ctx.element = child\n\n    let reply\n    try {\n      reply = await next()\n    } catch (err) {\n      entity.emit('error', err)\n      reply = buildError('cancel', 'internal-server-error')\n    }\n\n    if (!reply) {\n      reply = buildError('cancel', 'service-unavailable')\n    }\n\n    if (reply instanceof xml.Element && reply.is('error')) {\n      return buildReplyError(ctx, reply, child)\n    }\n\n    return buildReplyResult(\n      ctx,\n      reply instanceof xml.Element ? reply : undefined\n    )\n  }\n}\n\nfunction route(type, ns, name, handler) {\n  return function(ctx, next) {\n    if ((ctx.type !== type) | !ctx.element || !ctx.element.is(name, ns))\n      return next()\n    return handler(ctx, next)\n  }\n}\n\nmodule.exports = function({middleware, entity}) {\n  middleware.use(iqHandler(entity))\n\n  return {\n    get(ns, name, handler) {\n      middleware.use(route('get', ns, name, handler))\n    },\n    set(ns, name, handler) {\n      middleware.use(route('set', ns, name, handler))\n    },\n  }\n}\n","'use strict'\n\nconst resolve = require('./resolve')\nconst {promise} = require('@xmpp/events')\n\nasync function fetchURIs(domain) {\n  return [\n    // Remove duplicates\n    ...new Set(\n      (\n        await resolve(domain, {\n          srv: [\n            {\n              service: 'xmpps-client',\n              protocol: 'tcp',\n            },\n            {\n              service: 'xmpp-client',\n              protocol: 'tcp',\n            },\n          ],\n        })\n      ).map(record => record.uri)\n    ),\n  ]\n}\n\nfunction filterSupportedURIs(entity, uris) {\n  return uris.filter(uri => entity._findTransport(uri))\n}\n\nasync function fallbackConnect(entity, uris) {\n  if (uris.length === 0) {\n    throw new Error(\"Couldn't connect\")\n  }\n\n  const uri = uris.shift()\n  const Transport = entity._findTransport(uri)\n\n  if (!Transport) {\n    return fallbackConnect(entity, uris)\n  }\n\n  entity._status('connecting', uri)\n  const params = Transport.prototype.socketParameters(uri)\n  const socket = new Transport.prototype.Socket()\n\n  try {\n    socket.connect(params)\n    await promise(socket, 'connect')\n    // eslint-disable-next-line no-unused-vars\n  } catch (err) {\n    return fallbackConnect(entity, uris)\n  }\n\n  entity._attachSocket(socket)\n  socket.emit('connect')\n  entity.Transport = Transport\n  entity.Socket = Transport.prototype.Socket\n  entity.Parser = Transport.prototype.Parser\n}\n\nmodule.exports = function({entity}) {\n  const _connect = entity.connect\n  entity.connect = async function connect(service) {\n    if (!service || service.match(/:\\/\\//)) {\n      return _connect.call(this, service)\n    }\n\n    const uris = filterSupportedURIs(entity, await fetchURIs(service))\n\n    if (uris.length === 0) {\n      throw new Error('No compatible transport found.')\n    }\n\n    try {\n      await fallbackConnect(entity, uris)\n    } catch (err) {\n      entity._reset()\n      entity._status('disconnect')\n      throw err\n    }\n  }\n}\n","'use strict'\n\nconst dns = require('./lib/dns')\nconst http = require('./lib/http')\n\nmodule.exports = function resolve(...args) {\n  return Promise.all([\n    dns.resolve ? dns.resolve(...args) : Promise.resolve([]),\n    http.resolve(...args),\n  ]).then(([records, endpoints]) => records.concat(endpoints))\n}\n\nif (dns.resolve) {\n  module.exports.dns = dns\n}\n\nmodule.exports.http = http\n","'use strict'\n\nconst fetch = global.fetch || require('node-fetch')\nconst parse = require('@xmpp/xml/lib/parse')\nconst compareAltConnections = require('./alt-connections').compare\n\nfunction resolve(domain) {\n  return fetch(`https://${domain}/.well-known/host-meta`)\n    .then(res => res.text())\n    .then(res => {\n      return parse(res)\n        .getChildren('Link')\n        .filter(link =>\n          [\n            'urn:xmpp:alt-connections:websocket',\n            'urn:xmpp:alt-connections:httppoll',\n            'urn:xmpp:alt-connections:xbosh',\n          ].includes(link.attrs.rel)\n        )\n        .map(({attrs}) => ({\n          rel: attrs.rel,\n          href: attrs.href,\n          method: attrs.rel.split(':').pop(),\n          uri: attrs.href,\n        }))\n        .sort(compareAltConnections)\n    })\n    .catch(() => {\n      return []\n    })\n}\n\nmodule.exports.resolve = resolve\n","'use strict'\n\nconst Parser = require('./Parser')\n\nmodule.exports = function parse(data) {\n  const p = new Parser()\n\n  let result = null\n  let error = null\n\n  p.on('start', el => {\n    result = el\n  })\n  p.on('element', el => {\n    result.append(el)\n  })\n  p.on('error', err => {\n    error = err\n  })\n\n  p.write(data)\n  p.end()\n\n  if (error) {\n    throw error\n  } else {\n    return result\n  }\n}\n","'use strict'\n\nfunction isSecure(uri) {\n  return uri.startsWith('https') || uri.startsWith('wss')\n}\n\nmodule.exports.compare = function compare(a, b) {\n  let secure\n  if (isSecure(a.uri) && !isSecure(b.uri)) {\n    secure = -1\n  } else if (!isSecure(a.uri) && isSecure(b.uri)) {\n    secure = 1\n  } else {\n    secure = 0\n  }\n\n  if (secure !== 0) {\n    return secure\n  }\n\n  let method\n  if (a.method === b.method) {\n    method = 0\n  } else if (a.method === 'websocket') {\n    method = -1\n  } else if (b.method === 'websocket') {\n    method = 1\n  } else if (a.method === 'xbosh') {\n    method = -1\n  } else if (b.method === 'xbosh') {\n    method = 1\n  } else if (a.method === 'httppoll') {\n    method = -1\n  } else if (b.method === 'httppoll') {\n    method = 1\n  } else {\n    method = 0\n  }\n\n  if (method !== 0) {\n    return method\n  }\n\n  return 0\n}\n","'use strict'\n\nconst {encode, decode} = require('@xmpp/base64')\nconst SASLError = require('./lib/SASLError')\nconst xml = require('@xmpp/xml')\nconst SASLFactory = require('saslmechanisms')\n\n// https://xmpp.org/rfcs/rfc6120.html#sasl\n\nconst NS = 'urn:ietf:params:xml:ns:xmpp-sasl'\n\nfunction getMechanismNames(features) {\n  return features.getChild('mechanisms', NS).children.map(el => el.text())\n}\n\nasync function authenticate(SASL, entity, mechname, credentials) {\n  const mech = SASL.create([mechname])\n  if (!mech) {\n    throw new Error('No compatible mechanism')\n  }\n\n  const {domain} = entity.options\n  const creds = {\n    username: null,\n    password: null,\n    server: domain,\n    host: domain,\n    realm: domain,\n    serviceType: 'xmpp',\n    serviceName: domain,\n    ...credentials,\n  }\n\n  return new Promise((resolve, reject) => {\n    const handler = element => {\n      if (element.attrs.xmlns !== NS) {\n        return\n      }\n\n      if (element.name === 'challenge') {\n        mech.challenge(decode(element.text()))\n        const resp = mech.response(creds)\n        entity.send(\n          xml(\n            'response',\n            {xmlns: NS, mechanism: mech.name},\n            typeof resp === 'string' ? encode(resp) : ''\n          )\n        )\n        return\n      }\n\n      if (element.name === 'failure') {\n        reject(SASLError.fromElement(element))\n      } else if (element.name === 'success') {\n        resolve()\n      }\n\n      entity.removeListener('nonza', handler)\n    }\n\n    entity.on('nonza', handler)\n\n    if (mech.clientFirst) {\n      entity.send(\n        xml(\n          'auth',\n          {xmlns: NS, mechanism: mech.name},\n          encode(mech.response(creds))\n        )\n      )\n    }\n  })\n}\n\nmodule.exports = function sasl({streamFeatures}, credentials) {\n  const SASL = new SASLFactory()\n\n  streamFeatures.use('mechanisms', NS, async ({stanza, entity}) => {\n    const offered = getMechanismNames(stanza)\n    const supported = SASL._mechs.map(({name}) => name)\n    const intersection = supported.filter(mech => {\n      return offered.includes(mech)\n    })\n    let mech = intersection[0]\n\n    if (typeof credentials === 'function') {\n      await credentials(\n        creds => authenticate(SASL, entity, mech, creds, stanza),\n        mech\n      )\n    } else {\n      if (!credentials.username && !credentials.password) {\n        mech = 'ANONYMOUS'\n      }\n\n      await authenticate(SASL, entity, mech, credentials, stanza)\n    }\n\n    await entity.restart()\n  })\n\n  return {\n    use(...args) {\n      return SASL.use(...args)\n    },\n  }\n}\n","'use strict'\n\nmodule.exports.encode = function encode(string) {\n  return global.btoa(string)\n}\n\nmodule.exports.decode = function decode(string) {\n  return global.atob(string)\n}\n","'use strict'\n\nconst XMPPError = require('@xmpp/error')\n\n// https://xmpp.org/rfcs/rfc6120.html#sasl-errors\n\nclass SASLError extends XMPPError {\n  constructor(...args) {\n    super(...args)\n    this.name = 'SASLError'\n  }\n}\n\nmodule.exports = SASLError\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/factory'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/factory'], factory);\n  }\n}(this, function(exports, module, Factory) {\n  \n  exports = module.exports = Factory;\n  exports.Factory = Factory;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n  \n  /**\n   * `Factory` constructor.\n   *\n   * @api public\n   */\n  function Factory() {\n    this._mechs = [];\n  }\n  \n  /**\n   * Utilize the given `mech` with optional `name`, overridding the mechanism's\n   * default name.\n   *\n   * Examples:\n   *\n   *     factory.use(FooMechanism);\n   *\n   *     factory.use('XFOO', FooMechanism);\n   *\n   * @param {String|Mechanism} name\n   * @param {Mechanism} mech\n   * @return {Factory} for chaining\n   * @api public\n   */\n  Factory.prototype.use = function(name, mech) {\n    if (!mech) {\n      mech = name;\n      name = mech.prototype.name;\n    }\n    this._mechs.push({ name: name, mech: mech });\n    return this;\n  };\n  \n  /**\n   * Create a new mechanism from supported list of `mechs`.\n   *\n   * If no mechanisms are supported, returns `null`.\n   *\n   * Examples:\n   *\n   *     var mech = factory.create(['FOO', 'BAR']);\n   *\n   * @param {Array} mechs\n   * @return {Mechanism}\n   * @api public\n   */\n  Factory.prototype.create = function(mechs) {\n    for (var i = 0, len = this._mechs.length; i < len; i++) {\n      for (var j = 0, jlen = mechs.length; j < jlen; j++) {\n        var entry = this._mechs[i];\n        if (entry.name == mechs[j]) {\n          return new entry.mech();\n        }\n      }\n    }\n    return null;\n  };\n\n  exports = module.exports = Factory;\n  \n}));\n","'use strict'\n\nconst xml = require('@xmpp/xml')\n\n/*\n * References\n * https://xmpp.org/rfcs/rfc6120.html#bind\n */\n\nconst NS = 'urn:ietf:params:xml:ns:xmpp-bind'\n\nfunction makeBindElement(resource) {\n  return xml('bind', {xmlns: NS}, resource && xml('resource', {}, resource))\n}\n\nasync function bind(entity, iqCaller, resource) {\n  const result = await iqCaller.set(makeBindElement(resource))\n  const jid = result.getChildText('jid')\n  entity._jid(jid)\n  return jid\n}\n\nfunction route({iqCaller}, resource) {\n  return async function({entity}, next) {\n    if (typeof resource === 'function') {\n      await resource(resource => bind(entity, iqCaller, resource))\n    } else {\n      await bind(entity, iqCaller, resource)\n    }\n\n    next()\n  }\n}\n\nmodule.exports = function({streamFeatures, iqCaller}, resource) {\n  streamFeatures.use('bind', NS, route({iqCaller}, resource))\n}\n","'use strict'\n\nconst xml = require('@xmpp/xml')\n\n// https://tools.ietf.org/html/draft-cridland-xmpp-session-01\n\nconst NS = 'urn:ietf:params:xml:ns:xmpp-session'\n\nmodule.exports = function({iqCaller, streamFeatures}) {\n  streamFeatures.use('session', NS, async (context, next, feature) => {\n    if (feature.getChild('optional')) return next()\n    await iqCaller.set(xml('session', NS))\n    return next()\n  })\n}\n","'use strict'\n\n/**\n * [XEP-0175: Best Practices for Use of SASL ANONYMOUS](https://xmpp.org/extensions/xep-0175.html)\n * [RFC-4504: Anonymous Simple Authentication and Security Layer (SASL) Mechanism](https://tools.ietf.org/html/rfc4505)\n */\n\nconst mech = require('sasl-anonymous')\n\nmodule.exports = function saslAnonymous(sasl) {\n  sasl.use(mech)\n}\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/mechanism'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/mechanism'], factory);\n  }\n}(this, function(exports, module, Mechanism) {\n\n  exports = module.exports = Mechanism;\n  exports.Mechanism = Mechanism;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n\n  /**\n   * ANONYMOUS `Mechanism` constructor.\n   *\n   * This class implements the ANONYMOUS SASL mechanism.\n   *\n   * The ANONYMOUS SASL mechanism provides support for permitting anonymous\n   * access to various services\n   *\n   * References:\n   *  - [RFC 4505](http://tools.ietf.org/html/rfc4505)\n   *\n   * @api public\n   */\n  function Mechanism() {\n  }\n  \n  Mechanism.prototype.name = 'ANONYMOUS';\n  Mechanism.prototype.clientFirst = true;\n  \n  /**\n   * Encode a response using optional trace information.\n   *\n   * Options:\n   *  - `trace`  trace information (optional)\n   *\n   * @param {Object} cred\n   * @api public\n   */\n  Mechanism.prototype.response = function(cred) {\n    return cred.trace || '';\n  };\n  \n  /**\n   * Decode a challenge issued by the server.\n   *\n   * @param {String} chal\n   * @api public\n   */\n  Mechanism.prototype.challenge = function(chal) {\n  };\n\n  exports = module.exports = Mechanism;\n  \n}));\n","'use strict'\n\nconst mech = require('sasl-plain')\n\nmodule.exports = function saslPlain(sasl) {\n  sasl.use(mech)\n}\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/mechanism'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/mechanism'], factory);\n  }\n}(this, function(exports, module, Mechanism) {\n\n  exports = module.exports = Mechanism;\n  exports.Mechanism = Mechanism;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n\n  /**\n   * PLAIN `Mechanism` constructor.\n   *\n   * This class implements the PLAIN SASL mechanism.\n   *\n   * The PLAIN SASL mechanism provides support for exchanging a clear-text\n   * username and password.  This mechanism should not be used without adequate\n   * security provided by an underlying transport layer. \n   *\n   * References:\n   *  - [RFC 4616](http://tools.ietf.org/html/rfc4616)\n   *\n   * @api public\n   */\n  function Mechanism() {\n  }\n  \n  Mechanism.prototype.name = 'PLAIN';\n  Mechanism.prototype.clientFirst = true;\n  \n  /**\n   * Encode a response using given credential.\n   *\n   * Options:\n   *  - `username`\n   *  - `password`\n   *  - `authzid`   authorization identity (optional)\n   *\n   * @param {Object} cred\n   * @api public\n   */\n  Mechanism.prototype.response = function(cred) {\n    var str = '';\n    str += cred.authzid || '';\n    str += '\\0';\n    str += cred.username;\n    str += '\\0';\n    str += cred.password;\n    return str;\n  };\n  \n  /**\n   * Decode a challenge issued by the server.\n   *\n   * @param {String} chal\n   * @return {Mechanism} for chaining\n   * @api public\n   */\n  Mechanism.prototype.challenge = function(chal) {\n    return this;\n  };\n\n  exports = module.exports = Mechanism;\n  \n}));\n","module.exports = __WEBPACK_EXTERNAL_MODULE__99__;","const config = require('./cubeConfig')\r\nconst Utils = require('./cubeInternalUtils')\r\n\r\nclass AuthService {\r\n  constructor (proxy) {\r\n    this.proxy = proxy\r\n    this.webSessionCheckInterval = null\r\n  }\r\n\r\n  getSession () {\r\n    const ajaxParams = {\r\n      type: 'GET',\r\n      url: Utils.getUrl(config.urls.session)\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.proxy\r\n        .ajax(ajaxParams)\r\n        .then(res => {\r\n          resolve(res.session)\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  }\r\n\r\n  createSession (params) {\r\n    if (config.creds.appId === '' ||\r\n      config.creds.authKey === '' ||\r\n      config.creds.authSecret === '') {\r\n      throw new Error(\r\n        'Cannot create a new session without app credentials (app ID, auth key and auth secret)'\r\n      )\r\n    }\r\n\r\n    const route = params && params.hasOwnProperty('long') ? config.urls.webSession : config.urls.session\r\n\r\n    const sessionParams = Utils.generateCreateSessionParams(params)\r\n    sessionParams.signature = Utils.signParams(sessionParams, config.creds.authSecret)\r\n\r\n    const ajaxParams = {\r\n      type: 'POST',\r\n      url: Utils.getUrl(route),\r\n      data: sessionParams\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.proxy\r\n        .ajax(ajaxParams)\r\n        .then(res => {\r\n          const response = res.qr_code ? res.qr_code : res.session\r\n          this.proxy.setSession(res.session)\r\n          this.proxy.setCurrentUserId(res.session.user_id)\r\n          resolve(response)\r\n        })\r\n        .catch(error => {\r\n          console.log(\"error\", error);\r\n          reject(error)\r\n        })\r\n    })\r\n  }\r\n\r\n  destroySession () {\r\n    const ajaxParams = {\r\n      type: 'DELETE',\r\n      url: Utils.getUrl(config.urls.session),\r\n      dataType: 'text'\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.proxy\r\n        .ajax(ajaxParams)\r\n        .then(res => {\r\n          this.proxy.setSession(null)\r\n          this.proxy.setCurrentUserId(null)\r\n\r\n          resolve()\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  }\r\n\r\n  createWebSession (params) {\r\n    if (!params) {\r\n      params = {\r\n        long: 0\r\n      }\r\n    }\r\n\r\n    return this.createSession(params)\r\n  }\r\n\r\n  checkWebSessionUntilUpgrade (callback) {\r\n    const interval = config.webSession.getSessionTimeInterval\r\n    const timeoutError = new Error(\r\n      'The web session check interval was stopped (timeout)'\r\n    )\r\n\r\n    let timeleft = config.webSession.getSessionTimeout\r\n\r\n    const _clearWebSessionCheckTimer = () => {\r\n      this.webSessionCheckInterval &&\r\n        clearInterval(this.webSessionCheckInterval)\r\n    }\r\n\r\n    _clearWebSessionCheckTimer()\r\n\r\n    this.webSessionCheckInterval = setInterval(() => {\r\n      this.getSession()\r\n        .then(session => {\r\n          if (session.user_id !== 0) {\r\n            _clearWebSessionCheckTimer()\r\n            this.proxy.setCurrentUserId(session.user_id)\r\n            this.proxy.setSession(session)\r\n            callback(null, session)\r\n          } else {\r\n            if (timeleft > interval) {\r\n              timeleft -= interval\r\n            } else {\r\n              _clearWebSessionCheckTimer()\r\n              callback(timeoutError, null)\r\n            }\r\n          }\r\n        })\r\n        .catch(error => {\r\n          _clearWebSessionCheckTimer()\r\n          callback(error, null)\r\n        })\r\n    }, interval * 1000)\r\n\r\n    return this.webSessionCheckInterval\r\n  }\r\n\r\n  upgradeWebSession (webToken) {\r\n    const ajaxParams = {\r\n      type: 'PATCH',\r\n      url: Utils.getUrl(config.urls.webSession),\r\n      dataType: 'text',\r\n      data: {\r\n        web_token: webToken\r\n      }\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  login (params) {\r\n    const ajaxParams = {\r\n      type: 'POST',\r\n      url: Utils.getUrl(config.urls.login),\r\n      data: params\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.proxy\r\n        .ajax(ajaxParams)\r\n        .then(res => {\r\n          this.proxy.setCurrentUserId(res.user.id)\r\n          resolve(res.user)\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  }\r\n\r\n  logout () {\r\n    const ajaxParams = {\r\n      type: 'DELETE',\r\n      url: Utils.getUrl(config.urls.login),\r\n      dataType: 'text'\r\n    }\r\n\r\n    this.proxy.setCurrentUserId(null)\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n}\r\n\r\nmodule.exports = AuthService\r\n","const config = require('./cubeConfig')\r\nconst Utils = require('./cubeInternalUtils')\r\n\r\nclass UsersService {\r\n  constructor(proxy) {\r\n    this.proxy = proxy\r\n  }\r\n\r\n  get(params) {\r\n    let url\r\n    const filters = []\r\n    let item\r\n\r\n    if (params.order) {\r\n      params.order = generateOrder(params.order)\r\n    }\r\n\r\n    if (params && params.filter) {\r\n      if (Utils.isArray(params.filter)) {\r\n        params.filter.forEach(function (el) {\r\n          item = generateFilter(el)\r\n          filters.push(item)\r\n        })\r\n      } else {\r\n        item = generateFilter(params.filter)\r\n        filters.push(item)\r\n      }\r\n      params.filter = filters\r\n    }\r\n\r\n    if (typeof params === 'number') {\r\n      url = params\r\n      params = {}\r\n    } else {\r\n      if (params.login) {\r\n        url = 'by_login'\r\n      } else if (params.full_name) {\r\n        url = 'by_full_name'\r\n      } else if (params.facebook_id) {\r\n        url = 'by_facebook_id'\r\n      } else if (params.twitter_id) {\r\n        url = 'by_twitter_id'\r\n      } else if (params.phone) {\r\n        url = 'phone'\r\n      } else if (params.email) {\r\n        url = 'by_email'\r\n      } else if (params.tags) {\r\n        url = 'by_tags'\r\n      } else if (params.external) {\r\n        url = 'external/' + params.external\r\n        params = {}\r\n      }\r\n    }\r\n\r\n    const ajaxParams = {\r\n      type: 'GET',\r\n      url: Utils.getUrl(config.urls.users, url),\r\n      data: params\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  signup(params) {\r\n    const ajaxParams = {\r\n      type: 'POST',\r\n      url: Utils.getUrl(config.urls.users),\r\n      data: {\r\n        user: params\r\n      }\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  update(params) {\r\n    const ajaxParams = {\r\n      type: 'PUT',\r\n      url: Utils.getUrl(config.urls.users, this.proxy.getCurrentUserId()),\r\n      data: { user: params }\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  delete() {\r\n    const ajaxParams = {\r\n      type: 'DELETE',\r\n      url: Utils.getUrl(config.urls.users, this.proxy.getCurrentUserId()),\r\n      dataType: 'text'\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  resetPassword(email) {\r\n    const ajaxParams = {\r\n      type: 'GET',\r\n      url: Utils.getUrl(config.urls.users + '/password/reset'),\r\n      data: {\r\n        email: email\r\n      },\r\n      dataType: 'text'\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n}\r\n\r\nmodule.exports = UsersService\r\n\r\nconst DATE_FIELDS = ['created_at', 'updated_at', 'last_request_at']\r\nconst NUMBER_FIELDS = ['id', 'external_user_id']\r\n\r\nfunction generateFilter(obj) {\r\n  let type = obj.field in DATE_FIELDS ? 'date' : typeof obj.value\r\n\r\n  if (Utils.isArray(obj.value)) {\r\n    if (type === 'object') {\r\n      type = typeof obj.value[0]\r\n    }\r\n    obj.value = obj.value.toString()\r\n  }\r\n\r\n  return [type, obj.field, obj.param, obj.value].join(' ')\r\n}\r\n\r\nfunction generateOrder(obj) {\r\n  const type =\r\n    obj.field in DATE_FIELDS\r\n      ? 'date'\r\n      : obj.field in NUMBER_FIELDS\r\n        ? 'number'\r\n        : 'string'\r\n  return [obj.sort, type, obj.field].join(' ')\r\n}\r\n","const config = require('./cubeConfig')\r\nconst Utils = require('./cubeInternalUtils')\r\n\r\nclass StorageService {\r\n  constructor(proxy) {\r\n    this.proxy = proxy\r\n  }\r\n\r\n  list(params) {\r\n    const ajaxParams = {\r\n      type: 'GET',\r\n      url: Utils.getUrl(config.urls.blobs),\r\n      data: params\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  create(params) {\r\n    const ajaxParams = {\r\n      type: 'POST',\r\n      url: Utils.getUrl(config.urls.blobs),\r\n      data: { blob: params }\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  delete(id) {\r\n    const ajaxParams = {\r\n      type: 'DELETE',\r\n      url: Utils.getUrl(config.urls.blobs, id),\r\n      dataType: 'text'\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  createAndUpload(params) {\r\n    const createParams = {}\r\n    let file\r\n    let name\r\n    let type\r\n    let size\r\n    let fileId\r\n    let result\r\n\r\n    const clonedParams = JSON.parse(JSON.stringify(params))\r\n\r\n    clonedParams.file.data = '...'\r\n\r\n    file = params.file\r\n    name = params.name || file.name\r\n    type = params.type || file.type\r\n    size = params.size || file.size\r\n\r\n    createParams.name = name\r\n    createParams.content_type = type\r\n\r\n    if (params.public) {\r\n      createParams.public = params.public\r\n    }\r\n\r\n    return this.create(createParams)\r\n      .then(({ blob }) => {\r\n        const uri = parseUri(blob.blob_object_access.params)\r\n        const uploadUrl = uri.protocol + '://' + uri.authority + uri.path\r\n\r\n        const ajaxParams = { url: uploadUrl }\r\n        const data = {}\r\n\r\n        fileId = blob.id\r\n        result = { ...blob, size }\r\n\r\n        Object.keys(uri.queryKey).forEach(function (val) {\r\n          data[val] = decodeURIComponent(uri.queryKey[val])\r\n        })\r\n\r\n        data.file = file\r\n        ajaxParams.data = data\r\n\r\n        return this.upload(ajaxParams)\r\n      })\r\n      .then(uploadResult => {\r\n        const ajaxParams = {\r\n          id: fileId,\r\n          size: size\r\n        }\r\n        return this.markUploaded(ajaxParams)\r\n      })\r\n      .then(() => result)\r\n  }\r\n\r\n  upload(params) {\r\n    const ajaxParams = {\r\n      type: 'POST',\r\n      url: params.url,\r\n      dataType: 'text',\r\n      contentType: false,\r\n      data: params.data\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  markUploaded(params) {\r\n    const ajaxParams = {\r\n      type: 'PUT',\r\n      url: Utils.getUrl(config.urls.blobs, params.id + '/complete'),\r\n      data: {\r\n        size: params.size\r\n      },\r\n      dataType: 'text'\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  getInfo(id) {\r\n    const ajaxParams = {\r\n      url: Utils.getUrl(config.urls.blobs, id)\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  getFile(uid) {\r\n    const ajaxParams = {\r\n      url: Utils.getUrl(config.urls.blobs, uid)\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  update(params) {\r\n    const data = {}\r\n    data.blob = {}\r\n    if (typeof params.name !== 'undefined') {\r\n      data.blob.name = params.name\r\n    }\r\n\r\n    const ajaxParams = {\r\n      url: Utils.getUrl(config.urls.blobs, params.id),\r\n      data: data\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  privateUrl(fileUID) {\r\n    return (\r\n      'https://' +\r\n      config.endpoints.api +\r\n      '/blobs/' +\r\n      fileUID +\r\n      '?token=' +\r\n      this.proxy.getSession().token\r\n    )\r\n  }\r\n\r\n  publicUrl(fileUID) {\r\n    return 'https://' + config.endpoints.api + '/blobs/' + fileUID\r\n  }\r\n}\r\n\r\nmodule.exports = StorageService\r\n\r\n// parseUri 1.2.2\r\n// (c) Steven Levithan <stevenlevithan.com>\r\n// MIT License\r\n// http://blog.stevenlevithan.com/archives/parseuri\r\nfunction parseUri(str) {\r\n  const o = parseUri.options\r\n  const m = o.parser[o.strictMode ? 'strict' : 'loose'].exec(str)\r\n\r\n  const uri = {}\r\n  let i = 14\r\n\r\n  while (i--) {\r\n    uri[o.key[i]] = m[i] || ''\r\n  }\r\n\r\n  uri[o.q.name] = {}\r\n  uri[o.key[12]].replace(o.q.parser, function ($0, $1, $2) {\r\n    if ($1) {\r\n      uri[o.q.name][$1] = $2\r\n    }\r\n  })\r\n\r\n  return uri\r\n}\r\n\r\nparseUri.options = {\r\n  strictMode: false,\r\n  key: [\r\n    'source',\r\n    'protocol',\r\n    'authority',\r\n    'userInfo',\r\n    'user',\r\n    'password',\r\n    'host',\r\n    'port',\r\n    'relative',\r\n    'path',\r\n    'directory',\r\n    'file',\r\n    'query',\r\n    'anchor'\r\n  ],\r\n  q: {\r\n    name: 'queryKey',\r\n    parser: /(?:^|&)([^&=]*)=?([^&]*)/g\r\n  },\r\n  parser: {\r\n    strict: /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,\r\n    loose: /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/\r\n  }\r\n}\r\n","const config = require('./cubeConfig')\r\nconst Utils = require('./cubeInternalUtils')\r\n\r\nclass PushNotificationsService {\r\n  constructor (proxy) {\r\n    this.proxy = proxy\r\n\r\n    this.subscriptions = new SubscriptionsService(proxy)\r\n    this.events = new EventsService(proxy)\r\n\r\n    this.base64Encode = function (str) {\r\n      return Utils.toBase64(str)\r\n    }\r\n  }\r\n}\r\n\r\nclass SubscriptionsService {\r\n  constructor (proxy) {\r\n    this.proxy = proxy\r\n  }\r\n\r\n  create (params) {\r\n    const ajaxParams = {\r\n      type: 'POST',\r\n      url: Utils.getUrl(config.urls.subscriptions),\r\n      data: params\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  list () {\r\n    const ajaxParams = {\r\n      type: 'GET',\r\n      url: Utils.getUrl(config.urls.subscriptions)\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  delete (id) {\r\n    const ajaxParams = {\r\n      type: 'DELETE',\r\n      dataType: 'text',\r\n      url: Utils.getUrl(config.urls.subscriptions, id)\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n}\r\n\r\nclass EventsService {\r\n  constructor (proxy) {\r\n    this.proxy = proxy\r\n  }\r\n\r\n  create (params) {\r\n    const ajaxParams = {\r\n      type: 'POST',\r\n      url: Utils.getUrl(config.urls.events),\r\n      data: {\r\n        event: params\r\n      }\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n}\r\n\r\nmodule.exports = PushNotificationsService\r\n","const config = require('./cubeConfig')\r\nconst Utils = require('./cubeInternalUtils')\r\n\r\nclass DataService {\r\n  constructor (proxy) {\r\n    this.proxy = proxy\r\n  }\r\n\r\n  create (className, data) {\r\n    const ajaxParams = {\r\n      type: 'POST',\r\n      data: data,\r\n      url: Utils.getUrl(config.urls.data, className)\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  list (className, filters) {\r\n    const ajaxParams = {\r\n      url: Utils.getUrl(config.urls.data, className),\r\n      data: filters\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  update (className, data) {\r\n    const ajaxParams = {\r\n      type: 'PUT',\r\n      url: Utils.getUrl(config.urls.data, className + '/' + data._id),\r\n      data: data\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  delete (className, requestedData) {\r\n    const typesData = {\r\n      id: 1,\r\n      ids: 2,\r\n      criteria: 3\r\n    }\r\n\r\n    const ajaxParams = {\r\n      type: 'DELETE'\r\n    }\r\n\r\n    /** Define what type of data passed by client */\r\n    let requestedTypeOf\r\n    if (typeof requestedData === 'string') {\r\n      requestedTypeOf = typesData.id\r\n    } else if (Utils.isArray(requestedData)) {\r\n      requestedTypeOf = typesData.ids\r\n    } else if (Utils.isObject(requestedData)) {\r\n      requestedTypeOf = typesData.criteria\r\n    }\r\n\r\n    if (requestedTypeOf === typesData.id) {\r\n      ajaxParams.url = Utils.getUrl(\r\n        config.urls.data,\r\n        className + '/' + requestedData\r\n      )\r\n      ajaxParams.dataType = 'text';\r\n    } else if (requestedTypeOf === typesData.ids) {\r\n      ajaxParams.url = Utils.getUrl(\r\n        config.urls.data,\r\n        className + '/' + requestedData.toString()\r\n      )\r\n    } else if (requestedTypeOf === typesData.criteria) {\r\n      ajaxParams.url = Utils.getUrl(\r\n        config.urls.data,\r\n        className + '/by_criteria'\r\n      )\r\n      ajaxParams.data = requestedData\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n}\r\n\r\nmodule.exports = DataService\r\n","const Utils = require('./cubeInternalUtils')\r\nconst config = require('./cubeConfig')\r\n\r\nclass AddressBookService {\r\n  constructor (proxy) {\r\n    this.proxy = proxy\r\n  }\r\n\r\n  uploadAddressBook (list, opts) {\r\n    if (!Utils.isArray(list)) {\r\n      new Error('First parameter must be an Array.')\r\n      return\r\n    }\r\n\r\n    const data = { contacts: list }\r\n\r\n    if (opts) {\r\n      if (opts.force) {\r\n        data.force = opts.force\r\n      }\r\n\r\n      if (opts.udid) {\r\n        data.udid = opts.udid\r\n      }\r\n    }\r\n\r\n    const ajaxParams = {\r\n      type: 'POST',\r\n      url: Utils.getUrl(config.urls.addressbook),\r\n      data: data\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  get (udid) {\r\n    const ajaxParams = {\r\n      type: 'GET',\r\n      url: Utils.getUrl(config.urls.addressbook)\r\n    }\r\n    if (udid) {\r\n      ajaxParams.data = { udid: udid }\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  getRegisteredUsers (isCompact) {\r\n    const ajaxParams = {\r\n      type: 'GET',\r\n      url: Utils.getUrl(config.urls.addressbookRegistered)\r\n    }\r\n    if (isCompact) {\r\n      ajaxParams.data = { compact: 1 }\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n}\r\n\r\nmodule.exports = AddressBookService\r\n","const Config = require('../cubeConfig'),\r\n  Utils = require('../cubeInternalUtils'),\r\n  ChatUtils = require('./cubeChatInternalUtils'),\r\n  ChatHelpers = require('./cubeChatHelpers'),\r\n  StreamManagement = require('./cubeStreamManagement'),\r\n  ContactListProxy = require('./cubeContactList'),\r\n  PrivacyListProxy = require('./cubePrivacyList'),\r\n  MucProxy = require('./cubeMultiUserChat'),\r\n  XMPPClient = require('../cubeDependencies').XMPPClient;\r\n\r\nclass ChatService {\r\n  constructor(proxy) {\r\n    this.proxy = proxy\r\n\r\n    this.xmppClient = XMPPClient.client({\r\n      service: Config.chatProtocol.websocket,\r\n      credentials: (auth, mechanism) => {\r\n        const crds = {\r\n          username: this.xmppClient.options.username,\r\n          password: this.xmppClient.options.password\r\n        };\r\n        return auth(crds);\r\n      }\r\n    });\r\n\r\n    this.webrtcSignalingProcessor = null;\r\n\r\n    this.stanzasCallbacks = {};\r\n\r\n    this.isConnected = false;\r\n    this._isConnecting = false;\r\n    this._isLogout = false;\r\n\r\n    this._checkConnectionTimer = undefined;\r\n\r\n    this.helpers = new ChatHelpers();\r\n\r\n    this.xmppClientListeners = [];\r\n\r\n    // Chat additional modules\r\n    var options = {\r\n      xmppClient: this.xmppClient,\r\n      helpers: this.helpers,\r\n      stanzasCallbacks: this.stanzasCallbacks\r\n    };\r\n\r\n    this.contactList = new ContactListProxy(options);\r\n    this.privacylist = new PrivacyListProxy(options);\r\n    this.muc = new MucProxy(options);\r\n\r\n    if (Config.chat.streamManagement.enable) {\r\n      if (Config.chatProtocol.active === 2) {\r\n        this.streamManagement = new StreamManagement();\r\n        this._sentMessageCallback = (messageLost, messageSent) => {\r\n          if (typeof this.onSentMessageCallback === 'function') {\r\n            if (messageSent) {\r\n              this.onSentMessageCallback(null, messageSent);\r\n            } else {\r\n              this.onSentMessageCallback(messageLost);\r\n            }\r\n          }\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  connect(params) {\r\n    return new Promise((resolve, reject) => {\r\n      Utils.DLog('[Chat]', 'Connect with parameters ', params);\r\n\r\n      const userJid = ChatUtils.buildUserJid(params),\r\n        isInitialConnect = typeof callback === 'function';\r\n\r\n      if (this._isConnecting) {\r\n        if (isInitialConnect) {\r\n          const err = { code: 422, info: 'Already in CONNECTING state' };\r\n          reject(err);\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (this.isConnected) {\r\n        Utils.DLog('[Chat]', 'CONNECTED - You are already connected');\r\n        if (isInitialConnect) {\r\n          resolve();\r\n        }\r\n        return;\r\n      }\r\n\r\n      this._isConnecting = true;\r\n      this._isLogout = false;\r\n\r\n      // remove all old listeners\r\n      this.xmppClientListeners.forEach((listener) => {\r\n        this.xmppClient.removeListener(listener.name, listener.callback);\r\n      });\r\n\r\n      const callbackConnect = () => {\r\n        Utils.DLog('[Chat]', 'CONNECTING');\r\n      };\r\n      this.xmppClient.on('connect', callbackConnect);\r\n      this.xmppClientListeners.push({ name: 'connect', callback: callbackConnect });\r\n\r\n      const callbackOnline = (jid) => {\r\n        Utils.DLog('[Chat]', 'ONLINE');\r\n        this._postConnectActions(isInitialConnect);\r\n        resolve();\r\n      };\r\n      this.xmppClient.on('online', callbackOnline);\r\n      this.xmppClientListeners.push({ name: 'online', callback: callbackOnline });\r\n\r\n      const callbackOffline = () => {\r\n        Utils.DLog('[Chat]', 'OFFLINE');\r\n      };\r\n      this.xmppClient.on('offline', callbackOffline);\r\n      this.xmppClientListeners.push({ name: 'offline', callback: callbackOffline });\r\n\r\n      const callbackDisconnect = () => {\r\n        Utils.DLog('[Chat]', 'DISCONNECTED');\r\n\r\n        if (typeof this.onDisconnectedListener === 'function') {\r\n          Utils.safeCallbackCall(this.onDisconnectedListener);\r\n        }\r\n\r\n        this.isConnected = false;\r\n        this._isConnecting = false;\r\n\r\n        // reconnect to chat and enable check connection\r\n        this._establishConnection(params);\r\n      };\r\n      this.xmppClient.on('disconnect', callbackDisconnect);\r\n      this.xmppClientListeners.push({ name: 'disconnect', callback: callbackDisconnect });\r\n\r\n      const callbackStatus = (status, value) => {\r\n        Utils.DLog('[Chat]', 'status', status, value ? value.toString() : '');\r\n      };\r\n      this.xmppClient.on('status', callbackStatus);\r\n      this.xmppClientListeners.push({ name: 'status', callback: callbackStatus });\r\n\r\n      const callbackStanza = stanza => {\r\n        // console.log('stanza', stanza.toString())\r\n        // after 'input' and 'element' (only if stanza, not nonza)\r\n        if (stanza.is('presence')) {\r\n          this._onPresence(stanza);\r\n        } else if (stanza.is('iq')) {\r\n          this._onIQ(stanza);\r\n        } else if (stanza.is('message')) {\r\n          if (stanza.attrs.type === 'headline') {\r\n            this._onSystemMessageListener(stanza);\r\n          } else if (stanza.attrs.type === 'error') {\r\n            this._onMessageErrorListener(stanza);\r\n          } else {\r\n            this._onMessage(stanza);\r\n          }\r\n        }\r\n      };\r\n      this.xmppClient.on('stanza', callbackStanza);\r\n      this.xmppClientListeners.push({ name: 'stanza', callback: callbackStanza });\r\n\r\n      const callbackError = err => {\r\n        Utils.DLog('[Chat]', 'ERROR:', err);\r\n\r\n        if (isInitialConnect) {\r\n          if (err.name == 'SASLError') {\r\n            err = err.condition;\r\n          }\r\n          reject(err);\r\n        }\r\n\r\n        this.isConnected = false;\r\n        this._isConnecting = false;\r\n      };\r\n      this.xmppClient.on('error', callbackError);\r\n      this.xmppClientListeners.push({ name: 'error', callback: callbackError });\r\n\r\n      const callbackOutput = str => {\r\n        Utils.callTrafficUsageCallback('xmppDataWrite', { body: str })\r\n        Utils.DLog('[Chat]', 'SENT:', str);\r\n      };\r\n      this.xmppClient.on('output', callbackOutput);\r\n      this.xmppClientListeners.push({ name: 'output', callback: callbackOutput });\r\n\r\n      const callbackInput = str => {\r\n        Utils.callTrafficUsageCallback('xmppDataRead', { body: str })\r\n        Utils.DLog('[Chat]', 'RECV:', str);\r\n      };\r\n      this.xmppClient.on('input', callbackInput);\r\n      this.xmppClientListeners.push({ name: 'input', callback: callbackInput });\r\n\r\n      // save user connection data so they will be used when authenticate (above)\r\n      this.xmppClient.options.username = ChatUtils.buildUserJidLocalPart(params.userId);\r\n      this.xmppClient.options.password = params.password;\r\n      //\r\n      this.xmppClient.start();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @deprecated since version 2.0\r\n   */\r\n  getContacts() {\r\n    return new Promise((resolve, reject) => {\r\n      this.contactList.get().then(contacts => {\r\n        this.contactList.contacts = contacts;\r\n        resolve(contacts);\r\n      }).catch(error => {\r\n        reject(reject);\r\n      });\r\n    });\r\n  }\r\n\r\n  send(jidOrUserId, message) {\r\n    const stanzaParams = {\r\n      from: this.helpers.getUserCurrentJid(),\r\n      to: this.helpers.jidOrUserId(jidOrUserId),\r\n      type: message.type ? message.type : 'chat',\r\n      id: message.id ? message.id : Utils.getBsonObjectId()\r\n    };\r\n\r\n    let messageStanza = ChatUtils.createMessageStanza(stanzaParams);\r\n\r\n    if (message.body) {\r\n      messageStanza\r\n        .c('body', {\r\n          xmlns: 'jabber:client'\r\n        })\r\n        .t(message.body)\r\n        .up();\r\n    }\r\n\r\n    if (message.markable) {\r\n      messageStanza\r\n        .c('markable', {\r\n          xmlns: 'urn:xmpp:chat-markers:0'\r\n        })\r\n        .up();\r\n    }\r\n\r\n    if (message.extension) {\r\n      messageStanza.c('extraParams', {\r\n        xmlns: 'jabber:client'\r\n      });\r\n\r\n      messageStanza = ChatUtils.filledExtraParams(messageStanza, message.extension);\r\n    }\r\n\r\n    if (Config.chat.streamManagement.enable) {\r\n      message.id = stanzaParams.id;\r\n      this.xmppClient.send(messageStanza, message);\r\n    } else {\r\n      this.xmppClient.send(messageStanza);\r\n    }\r\n\r\n    return stanzaParams.id;\r\n  }\r\n\r\n  sendSystemMessage(jidOrUserId, message) {\r\n    const stanzaParams = {\r\n      type: 'headline',\r\n      id: message.id ? message.id : Utils.getBsonObjectId(),\r\n      to: this.helpers.jidOrUserId(jidOrUserId)\r\n    };\r\n\r\n    let messageStanza = ChatUtils.createMessageStanza(stanzaParams);\r\n\r\n    if (message.body) {\r\n      messageStanza\r\n        .c('body', {\r\n          xmlns: 'jabber:client'\r\n        })\r\n        .t(message.body)\r\n        .up();\r\n    }\r\n\r\n    // custom parameters\r\n    if (message.extension) {\r\n      messageStanza\r\n        .c('extraParams', {\r\n          xmlns: 'jabber:client'\r\n        })\r\n        .c('moduleIdentifier')\r\n        .t('SystemNotifications')\r\n        .up();\r\n\r\n      messageStanza = ChatUtils.filledExtraParams(messageStanza, message.extension);\r\n    }\r\n\r\n    this.xmppClient.send(messageStanza);\r\n\r\n    return stanzaParams.id;\r\n  }\r\n\r\n  sendIsTypingStatus(jidOrUserId) {\r\n    const stanzaParams = {\r\n      from: this.helpers.getUserCurrentJid(),\r\n      to: this.helpers.jidOrUserId(jidOrUserId),\r\n      type: this.helpers.typeChat(jidOrUserId)\r\n    };\r\n\r\n    const messageStanza = ChatUtils.createMessageStanza(stanzaParams);\r\n\r\n    messageStanza.c('composing', {\r\n      xmlns: 'http://jabber.org/protocol/chatstates'\r\n    });\r\n\r\n    this.xmppClient.send(messageStanza);\r\n  }\r\n\r\n  sendIsStopTypingStatus(jidOrUserId) {\r\n    const stanzaParams = {\r\n      from: this.helpers.getUserCurrentJid(),\r\n      to: this.helpers.jidOrUserId(jidOrUserId),\r\n      type: this.helpers.typeChat(jidOrUserId)\r\n    };\r\n\r\n    const messageStanza = ChatUtils.createMessageStanza(stanzaParams);\r\n\r\n    messageStanza.c('paused', {\r\n      xmlns: 'http://jabber.org/protocol/chatstates'\r\n    });\r\n\r\n    this.xmppClient.send(messageStanza);\r\n  }\r\n\r\n  sendDeliveredStatus(params) {\r\n    const stanzaParams = {\r\n      type: 'chat',\r\n      from: this.helpers.getUserCurrentJid(),\r\n      id: Utils.getBsonObjectId(),\r\n      to: this.helpers.jidOrUserId(params.userId)\r\n    };\r\n\r\n    const messageStanza = ChatUtils.createMessageStanza(stanzaParams);\r\n    messageStanza\r\n      .c('received', {\r\n        xmlns: 'urn:xmpp:chat-markers:0',\r\n        id: params.messageId\r\n      })\r\n      .up();\r\n    messageStanza\r\n      .c('extraParams', {\r\n        xmlns: 'jabber:client'\r\n      })\r\n      .c('dialog_id')\r\n      .t(params.dialogId);\r\n\r\n    this.xmppClient.send(messageStanza);\r\n  }\r\n\r\n  sendReadStatus(params) {\r\n    const stanzaParams = {\r\n      type: 'chat',\r\n      from: this.helpers.getUserCurrentJid(),\r\n      to: this.helpers.jidOrUserId(params.userId),\r\n      id: Utils.getBsonObjectId()\r\n    };\r\n\r\n    const messageStanza = ChatUtils.createMessageStanza(stanzaParams);\r\n    messageStanza\r\n      .c('displayed', {\r\n        xmlns: 'urn:xmpp:chat-markers:0',\r\n        id: params.messageId\r\n      })\r\n      .up();\r\n    messageStanza\r\n      .c('extraParams', {\r\n        xmlns: 'jabber:client'\r\n      })\r\n      .c('dialog_id')\r\n      .t(params.dialogId);\r\n\r\n    this.xmppClient.send(messageStanza);\r\n  }\r\n\r\n  getLastUserActivity(jidOrUserId) {\r\n    return new Promise((resolve, reject) => {\r\n      const iqParams = {\r\n        from: this.helpers.getUserCurrentJid(),\r\n        id: ChatUtils.getUniqueId('lastActivity'),\r\n        to: this.helpers.jidOrUserId(jidOrUserId),\r\n        type: 'get'\r\n      };\r\n      const iqStanza = ChatUtils.createIqStanza(iqParams);\r\n\r\n      iqStanza.c('query', { xmlns: 'jabber:iq:last' });\r\n\r\n      this.stanzasCallbacks[iqParams.id] = stanza => {\r\n        const error = ChatUtils.getElement(stanza, 'error');\r\n        const from = ChatUtils.getAttr(stanza, 'from');\r\n        const userId = this.helpers.getUserIdFromJID(from);\r\n        const query = ChatUtils.getElement(stanza, 'query');\r\n        const seconds = +ChatUtils.getAttr(query, 'seconds');\r\n\r\n        // trigger onLastUserActivityListener callback\r\n        Utils.safeCallbackCall(this.onLastUserActivityListener, userId, seconds);\r\n\r\n        if (error) {\r\n          reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza));\r\n        } else {\r\n          resolve({ userId, seconds });\r\n        }\r\n      }\r\n\r\n      this.xmppClient.send(iqStanza);\r\n    });\r\n  }\r\n\r\n  markActive() {\r\n    const iqParams = {\r\n      id: this.helpers.getUniqueId('markActive'),\r\n      type: 'set'\r\n    };\r\n\r\n    const iqStanza = ChatUtils.createIqStanza(iqParams);\r\n    iqStanza.c('mobile', {\r\n      xmlns: \"http://tigase.org/protocol/mobile#v2\",\r\n      enable: \"false\"\r\n    });\r\n\r\n    this.xmppClient.send(iqStanza);\r\n  }\r\n\r\n  markInactive() {\r\n    const iqParams = {\r\n      id: this.helpers.getUniqueId('markActive'),\r\n      type: 'set'\r\n    };\r\n\r\n    const iqStanza = ChatUtils.createIqStanza(iqParams);\r\n    iqStanza.c('mobile', {\r\n      xmlns: \"http://tigase.org/protocol/mobile#v2\",\r\n      enable: \"true\"\r\n    });\r\n\r\n    this.xmppClient.send(iqStanza);\r\n  }\r\n\r\n  disconnect() {\r\n    Utils.DLog('[Chat]', 'disconnect');\r\n\r\n    clearInterval(this._checkConnectionTimer);\r\n    this._checkConnectionTimer = undefined;\r\n    this.muc.joinedRooms = {};\r\n    this._isLogout = true;\r\n    this.helpers.setUserCurrentJid('');\r\n\r\n    this.xmppClient.stop();\r\n  }\r\n\r\n  search(params) {\r\n    let query = Object.assign({}, params)\r\n\r\n    if (query.start_date) {\r\n      query.start_date = new Date(query.start_date).toISOString()\r\n    }\r\n\r\n    if (query.end_date) {\r\n      query.end_date = new Date(query.end_date).toISOString()\r\n    }\r\n\r\n    if (Utils.isArray(query.chat_dialog_ids)) {\r\n      query.chat_dialog_ids = query.chat_dialog_ids.join(',')\r\n    }\r\n\r\n    const ajaxParams = {\r\n      type: 'GET',\r\n      url: Utils.getUrl(`${Config.urls.chat}/search`),\r\n      data: query\r\n    };\r\n\r\n    return this.proxy.ajax(ajaxParams);\r\n  }\r\n\r\n\r\n  /// PRIVATE ///\r\n\r\n  _onMessage(rawStanza) {\r\n    const forwaredStanza = ChatUtils.getElementTreePath(rawStanza, ['sent', 'forwarded', 'message']),\r\n      stanza = forwaredStanza || rawStanza,\r\n      from = ChatUtils.getAttr(stanza, 'from'),\r\n      type = ChatUtils.getAttr(stanza, 'type'),\r\n      messageId = ChatUtils.getAttr(stanza, 'id'),\r\n      markable = ChatUtils.getElement(stanza, 'markable'),\r\n      delivered = ChatUtils.getElement(stanza, 'received'),\r\n      read = ChatUtils.getElement(stanza, 'displayed'),\r\n      composing = ChatUtils.getElement(stanza, 'composing'),\r\n      paused = ChatUtils.getElement(stanza, 'paused'),\r\n      invite = ChatUtils.getElement(stanza, 'invite'),\r\n      delay = ChatUtils.getElement(stanza, 'delay'),\r\n      extraParams = ChatUtils.getElement(stanza, 'extraParams'),\r\n      bodyContent = ChatUtils.getElementText(stanza, 'body'),\r\n      forwarded = ChatUtils.getElement(stanza, 'forwarded');\r\n\r\n    let extraParamsParsed,\r\n      recipientId,\r\n      recipient;\r\n\r\n    const forwardedMessage = forwarded ? ChatUtils.getElement(forwarded, 'message') : null;\r\n\r\n    recipient = forwardedMessage ? ChatUtils.getAttr(forwardedMessage, 'to') : null;\r\n    recipientId = recipient ? this.helpers.getUserIdFromJID(recipient) : null;\r\n\r\n    let dialogId = type === 'groupchat' ? this.helpers.getDialogIdFromJID(from) : null,\r\n      userId = type === 'groupchat' ? this.helpers.getIdFromResource(from) : this.helpers.getUserIdFromJID(from),\r\n      marker = delivered || read || null;\r\n\r\n    // ignore invite messages from MUC\r\n    if (invite) return true;\r\n\r\n    if (extraParams) {\r\n      extraParamsParsed = ChatUtils.parseExtraParams(extraParams);\r\n\r\n      if (extraParamsParsed.dialogId) {\r\n        dialogId = extraParamsParsed.dialogId;\r\n      }\r\n    }\r\n\r\n    if (composing || paused) {\r\n      if (\r\n        typeof this.onMessageTypingListener === 'function' &&\r\n        (type === 'chat' || type === 'groupchat' || !delay)) {\r\n        Utils.safeCallbackCall(this.onMessageTypingListener, !!composing, userId, dialogId);\r\n      }\r\n\r\n      return true;\r\n    }\r\n\r\n    if (marker) {\r\n      if (delivered) {\r\n        if (typeof this.onDeliveredStatusListener === 'function' && type === 'chat') {\r\n          Utils.safeCallbackCall(\r\n            this.onDeliveredStatusListener,\r\n            ChatUtils.getAttr(delivered, 'id'),\r\n            dialogId,\r\n            userId\r\n          );\r\n        }\r\n      } else {\r\n        if (typeof this.onReadStatusListener === 'function' && type === 'chat') {\r\n          Utils.safeCallbackCall(this.onReadStatusListener, ChatUtils.getAttr(read, 'id'), dialogId, userId);\r\n        }\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    // autosend 'received' status (ignore messages from yourself)\r\n    if (markable && userId != this.helpers.getUserIdFromJID(this.helpers.userCurrentJid(this.xmppClient))) {\r\n      const autoSendReceiveStatusParams = {\r\n        messageId: messageId,\r\n        userId: userId,\r\n        dialogId: dialogId\r\n      };\r\n\r\n      this.sendDeliveredStatus(autoSendReceiveStatusParams);\r\n    }\r\n\r\n    const message = {\r\n      id: messageId,\r\n      dialog_id: dialogId,\r\n      recipient_id: recipientId,\r\n      type: type,\r\n      body: bodyContent,\r\n      extension: extraParamsParsed ? extraParamsParsed.extension : null,\r\n      delay: delay\r\n    };\r\n\r\n    if (markable) {\r\n      message.markable = 1;\r\n    }\r\n\r\n    if (typeof this.onMessageListener === 'function' && (type === 'chat' || type === 'groupchat')) {\r\n      Utils.safeCallbackCall(this.onMessageListener, userId, message);\r\n    }\r\n  }\r\n\r\n  _onPresence(stanza) {\r\n    const from = ChatUtils.getAttr(stanza, 'from'),\r\n      id = ChatUtils.getAttr(stanza, 'id'),\r\n      type = ChatUtils.getAttr(stanza, 'type'),\r\n      currentUserId = this.helpers.getUserIdFromJID(this.helpers.userCurrentJid(this.xmppClient)),\r\n      x = ChatUtils.getElement(stanza, 'x');\r\n\r\n    let xXMLNS,\r\n      status,\r\n      statusCode;\r\n\r\n    if (x) {\r\n      xXMLNS = ChatUtils.getAttr(x, 'xmlns');\r\n      status = ChatUtils.getElement(x, 'status');\r\n      if (status) {\r\n        statusCode = ChatUtils.getAttr(status, 'code');\r\n      }\r\n    }\r\n\r\n    // MUC presences\r\n    if (xXMLNS && xXMLNS.startsWith('http://jabber.org/protocol/muc')) {\r\n\r\n      // Error\r\n      if (type === 'error') {\r\n        // JOIN to dialog error\r\n        if (id.endsWith(':join')) {\r\n          if (typeof this.stanzasCallbacks[id] === 'function') {\r\n            this.stanzasCallbacks[id](stanza);\r\n          }\r\n        }\r\n        return;\r\n      }\r\n\r\n      const dialogId = this.helpers.getDialogIdFromJID(from);\r\n      const userId = this.helpers.getUserIdFromRoomJid(from);\r\n\r\n\r\n      // self presence\r\n      if (status) {\r\n        // KICK from dialog event\r\n        if (statusCode == '301') {\r\n          if (typeof this.onKickOccupant === 'function') {\r\n            var actorElement = ChatUtils.getElement(ChatUtils.getElement(x, 'item'), 'actor');\r\n            var initiatorUserJid = ChatUtils.getAttr(actorElement, 'jid');\r\n            Utils.safeCallbackCall(this.onKickOccupant, dialogId, this.helpers.getUserIdFromJID(initiatorUserJid));\r\n          }\r\n\r\n          delete this.muc.joinedRooms[this.helpers.getRoomJidFromRoomFullJid(from)];\r\n          return;\r\n\r\n        } else {\r\n          if (type === 'unavailable') {\r\n            // LEAVE response\r\n            if (status && statusCode == '110') {\r\n              if (typeof this.stanzasCallbacks['muc:leave'] === 'function') {\r\n                Utils.safeCallbackCall(this.stanzasCallbacks['muc:leave'], null);\r\n              }\r\n            }\r\n            return;\r\n          }\r\n\r\n          // JOIN response\r\n          if (id.endsWith(':join') && status && statusCode == '110') {\r\n            if (typeof this.stanzasCallbacks[id] === 'function') {\r\n              this.stanzasCallbacks[id](stanza);\r\n            }\r\n            return;\r\n          }\r\n        }\r\n\r\n        // Occupants JOIN/LEAVE events\r\n      } else {\r\n        if (userId != currentUserId) {\r\n          // Leave\r\n          if (type === 'unavailable') {\r\n            if (typeof this.onLeaveOccupant === 'function') {\r\n              Utils.safeCallbackCall(this.onLeaveOccupant, dialogId, parseInt(userId));\r\n            }\r\n            return;\r\n            // Join\r\n          } else {\r\n            if (typeof this.onJoinOccupant === 'function') {\r\n              Utils.safeCallbackCall(this.onJoinOccupant, dialogId, parseInt(userId));\r\n            }\r\n            return;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // ROSTER presences\r\n    const userId = this.helpers.getUserIdFromJID(from);\r\n    const contact = this.contactList.contacts[userId];\r\n\r\n    if (!type) {\r\n      if (typeof this.onContactListListener === 'function' && contact && contact.subscription !== 'none') {\r\n        Utils.safeCallbackCall(this.onContactListListener, userId);\r\n      }\r\n    } else {\r\n      switch (type) {\r\n        case 'subscribe':\r\n          if (contact && contact.subscription === 'to') {\r\n            contact ? (contact.ask = null) : (contact = { ask: null });\r\n            contact.subscription = 'both';\r\n\r\n            this.contactList._sendSubscriptionPresence({\r\n              jid: from,\r\n              type: 'subscribed'\r\n            });\r\n          } else {\r\n            if (typeof this.onSubscribeListener === 'function') {\r\n              Utils.safeCallbackCall(this.onSubscribeListener, userId);\r\n            }\r\n          }\r\n          break;\r\n        case 'subscribed':\r\n          if (contact && contact.subscription === 'from') {\r\n            contact ? (contact.ask = null) : (contact = { ask: null });\r\n            contact.subscription = 'both';\r\n          } else {\r\n            contact ? (contact.ask = null) : (contact = { ask: null });\r\n            contact.subscription = 'to';\r\n\r\n            if (typeof this.onConfirmSubscribeListener === 'function') {\r\n              Utils.safeCallbackCall(this.onConfirmSubscribeListener, userId);\r\n            }\r\n          }\r\n          break;\r\n        case 'unsubscribed':\r\n          contact ? (contact.ask = null) : (contact = { ask: null });\r\n          contact.subscription = 'none';\r\n\r\n          if (typeof this.onRejectSubscribeListener === 'function') {\r\n            Utils.safeCallbackCall(this.onRejectSubscribeListener, userId);\r\n          }\r\n\r\n          break;\r\n        case 'unsubscribe':\r\n          contact ? (contact.ask = null) : (contact = { ask: null });\r\n          contact.subscription = 'to';\r\n\r\n          break;\r\n        case 'unavailable':\r\n          if (\r\n            typeof this.onContactListListener === 'function' &&\r\n            contact &&\r\n            contact.subscription !== 'none'\r\n          ) {\r\n            Utils.safeCallbackCall(this.onContactListListener, userId, type);\r\n          }\r\n\r\n          // send initial presence if one of client (instance) goes offline\r\n          if (userId === currentUserId) {\r\n            this.xmppClient.send(ChatUtils.createPresenceStanza());\r\n          }\r\n\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  _onIQ(stanza) {\r\n    const stanzaId = ChatUtils.getAttr(stanza, 'id');\r\n\r\n    if (this.stanzasCallbacks[stanzaId]) {\r\n      Utils.safeCallbackCall(this.stanzasCallbacks[stanzaId], stanza);\r\n      delete this.stanzasCallbacks[stanzaId];\r\n    }\r\n  }\r\n\r\n  _onSystemMessageListener(rawStanza) {\r\n    const forwaredStanza = ChatUtils.getElementTreePath(rawStanza, ['sent', 'forwarded', 'message']),\r\n      stanza = forwaredStanza || rawStanza,\r\n      from = ChatUtils.getAttr(stanza, 'from'),\r\n      messageId = ChatUtils.getAttr(stanza, 'id'),\r\n      extraParams = ChatUtils.getElement(stanza, 'extraParams'),\r\n      userId = this.helpers.getUserIdFromJID(from),\r\n      delay = ChatUtils.getElement(stanza, 'delay'),\r\n      moduleIdentifier = ChatUtils.getElementText(extraParams, 'moduleIdentifier'),\r\n      bodyContent = ChatUtils.getElementText(stanza, 'body'),\r\n      extraParamsParsed = ChatUtils.parseExtraParams(extraParams);\r\n\r\n    if (moduleIdentifier === 'SystemNotifications' && typeof this.onSystemMessageListener === 'function') {\r\n      const message = {\r\n        id: messageId,\r\n        userId: userId,\r\n        body: bodyContent,\r\n        extension: extraParamsParsed.extension\r\n      };\r\n\r\n      Utils.safeCallbackCall(this.onSystemMessageListener, message);\r\n    } else if (this.webrtcSignalingProcessor && !delay && moduleIdentifier === 'WebRTCVideoChat') {\r\n      this.webrtcSignalingProcessor._onMessage(userId, extraParams);\r\n    }\r\n  }\r\n\r\n  _onMessageErrorListener(stanza) {\r\n    // <error code=\"503\" type=\"cancel\">\r\n    //   <service-unavailable xmlns=\"urn:ietf:params:xml:ns:xmpp-stanzas\"/>\r\n    //   <text xmlns=\"urn:ietf:params:xml:ns:xmpp-stanzas\" xml:lang=\"en\">Service not available.</text>\r\n    // </error>\r\n\r\n    const messageId = ChatUtils.getAttr(stanza, 'id');\r\n    //\r\n    const error = ChatUtils.buildErrorFromXMPPErrorStanza(stanza);\r\n\r\n    if (typeof this.onMessageErrorListener === 'function') {\r\n      Utils.safeCallbackCall(this.onMessageErrorListener, messageId, error);\r\n    }\r\n  }\r\n\r\n  _postConnectActions(isInitialConnect) {\r\n    Utils.DLog('[Chat]', 'CONNECTED');\r\n\r\n    const presence = ChatUtils.createPresenceStanza();\r\n\r\n    if (Config.chat.streamManagement.enable && Config.chatProtocol.active === 2) {\r\n      this.streamManagement.enable(this.xmppClient);\r\n      this.streamManagement.sentMessageCallback = this._sentMessageCallback;\r\n    }\r\n\r\n    this.helpers.setUserCurrentJid(this.helpers.userCurrentJid(this.xmppClient));\r\n\r\n    this.isConnected = true;\r\n    this._isConnecting = false;\r\n\r\n    this._enableCarbons();\r\n\r\n    this.xmppClient.send(presence); // initial presence\r\n\r\n    // reconnect\r\n    if (!isInitialConnect) {\r\n      if (typeof this.onReconnectListener === 'function') {\r\n        Utils.safeCallbackCall(this.onReconnectListener);\r\n      }\r\n    }\r\n  }\r\n\r\n  _establishConnection(params) {\r\n    if (this._isLogout || this._checkConnectionTimer) {\r\n      return;\r\n    }\r\n\r\n    const _connect = () => {\r\n      if (!this.isConnected && !this._isConnecting) {\r\n        this.connect(params);\r\n      } else {\r\n        clearInterval(this._checkConnectionTimer);\r\n        this._checkConnectionTimer = undefined;\r\n      }\r\n    };\r\n\r\n    _connect();\r\n\r\n    this._checkConnectionTimer = setInterval(() => {\r\n      _connect();\r\n    }, Config.chat.reconnectionTimeInterval * 1000);\r\n  }\r\n\r\n  _enableCarbons() {\r\n    const carbonParams = {\r\n      type: 'set',\r\n      from: this.helpers.getUserCurrentJid(),\r\n      id: ChatUtils.getUniqueId('enableCarbons')\r\n    };\r\n\r\n    const iqStanza = ChatUtils.createIqStanza(carbonParams);\r\n    iqStanza.c('enable', {\r\n      xmlns: 'urn:xmpp:carbons:2'\r\n    });\r\n\r\n    this.xmppClient.send(iqStanza);\r\n  }\r\n\r\n  _setSubscriptionToUserLastActivity(jidOrUserId, _isEnable) {\r\n    var iqParams = {\r\n      id: this.helpers.getUniqueId('statusStreaming'),\r\n      type: 'set'\r\n    };\r\n\r\n    var iqStanza = ChatUtils.createIqStanza(iqParams);\r\n\r\n    iqStanza.c('subscribe', {\r\n      xmlns: 'https://connectycube.com/protocol/status_streaming',\r\n      user_jid: this.helpers.jidOrUserId(jidOrUserId),\r\n      enable: _isEnable\r\n    });\r\n\r\n    this.xmppClient.send(iqStanza);\r\n  }\r\n\r\n  subscribeToUserLastActivityStatus(jidOrUserId) {\r\n    this._setSubscriptionToUserLastActivity(jidOrUserId, true)\r\n  }\r\n\r\n  unsubscribeFromUserLastActivityStatus(jidOrUserId) {\r\n    this._setSubscriptionToUserLastActivity(jidOrUserId, false)\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = ChatService;","function _readOnlyError(name) {\n  throw new Error(\"\\\"\" + name + \"\\\" is read-only\");\n}\n\nmodule.exports = _readOnlyError;","const Utils = require('../cubeInternalUtils'),\r\n\tConfig = require('../cubeConfig'),\r\n\tChatUtils = require('./cubeChatInternalUtils');\r\n\r\nclass ChatHelpers {\r\n\tconstructor() {\r\n\t\tthis._userCurrentJid = null;\r\n\t}\r\n\r\n\tgetUniqueId(suffix) {\r\n\t\treturn ChatUtils.getUniqueId(suffix);\r\n\t}\r\n\r\n\tjidOrUserId(jidOrUserId) {\r\n\t\tlet jid;\r\n\t\tif (typeof jidOrUserId === 'string' && jidOrUserId.includes('@')) { // jid\r\n\t\t\tjid = jidOrUserId;\r\n\t\t} else { // user id\r\n\t\t\tjid = jidOrUserId + '-' + Config.creds.appId + '@' + Config.endpoints.chat;\r\n\t\t}\r\n\t\treturn jid;\r\n\t}\r\n\r\n\ttypeChat(jidOrUserId) {\r\n\t\tlet chatType;\r\n\t\tif (typeof jidOrUserId === 'string') {\r\n\t\t\tchatType = jidOrUserId.indexOf('muc') > -1 ? 'groupchat' : 'chat';\r\n\t\t} else if (typeof jidOrUserId === 'number') {\r\n\t\t\tchatType = 'chat';\r\n\t\t} else {\r\n\t\t\tthrow new Error('Unsupported chat type');\r\n\t\t}\r\n\t\treturn chatType;\r\n\t}\r\n\r\n\tgetUserJid(userId, appId) {\r\n\t\tif (!appId) {\r\n\t\t\treturn userId + '-' + Config.creds.appId + '@' + Config.endpoints.chat;\r\n\t\t}\r\n\t\treturn userId + '-' + appId + '@' + Config.endpoints.chat;\r\n\t}\r\n\r\n\tgetUserNickWithMucDomain(userId) {\r\n\t\treturn Config.endpoints.muc + '/' + userId;\r\n\t}\r\n\r\n\tgetUserIdFromJID(jid) {\r\n\t\treturn jid.indexOf('@') < 0 ? null : parseInt(jid.split('@')[0].split('-')[0]);\r\n\t}\r\n\r\n\tgetDialogIdFromJID(jid) {\r\n\t\tif (jid.indexOf('@') < 0) return null;\r\n\t\treturn jid.split('@')[0].split('_')[1];\r\n\t}\r\n\r\n\tgetRoomJidFromDialogId(dialogId) {\r\n\t\treturn Config.creds.appId + '_' + dialogId + '@' + Config.endpoints.muc;\r\n\t}\r\n\r\n\tgetRoomJid(jid) {\r\n\t\treturn jid + '/' + this.getUserIdFromJID(this._userCurrentJid);\r\n\t}\r\n\r\n\tgetIdFromResource(jid) {\r\n\t\tlet s = jid.split('/');\r\n\t\tif (s.length < 2) return null;\r\n\t\ts.splice(0, 1);\r\n\t\treturn parseInt(s.join('/'));\r\n\t}\r\n\r\n\tgetRoomJidFromRoomFullJid(jid) {\r\n\t\tlet s = jid.split('/');\r\n\t\tif (s.length < 2) return null;\r\n\t\treturn s[0];\r\n\t}\r\n\r\n\tgetBsonObjectId() {\r\n\t\treturn Utils.getBsonObjectId();\r\n\t}\r\n\r\n\tgetUserIdFromRoomJid(jid) {\r\n\t\tlet arrayElements = jid.toString().split('/');\r\n\t\tif (arrayElements.length === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn arrayElements[arrayElements.length - 1];\r\n\t}\r\n\r\n\tuserCurrentJid(client) {\r\n\t\treturn client.jid._local + '@' + client.jid._domain + '/' + client.jid._resource;\r\n\t}\r\n\r\n\tgetUserCurrentJid() {\r\n\t\treturn this._userCurrentJid;\r\n\t}\r\n\r\n\tsetUserCurrentJid(jid) {\r\n\t\tthis._userCurrentJid = jid;\r\n\t}\r\n\r\n\tgetDialogJid(identifier) {\r\n\t\treturn identifier.indexOf('@') > 0 ? identifier : this.getRoomJidFromDialogId(identifier);\r\n\t}\r\n}\r\n\r\nmodule.exports = ChatHelpers;\r\n","const Utils = require('../cubeInternalUtils'),\r\n  ChatUtils = require('./cubeChatInternalUtils');\r\n\r\nclass StreamManagementService {\r\n  constructor() {\r\n    this._NS = 'urn:xmpp:sm:3';\r\n\r\n    this._isStreamManagementEnabled = false;\r\n\r\n    // Counter of the incoming stanzas\r\n    this._clientProcessedStanzasCounter = 0;\r\n    // The client send stanza counter.\r\n    this._clientSentStanzasCounter = 0;\r\n\r\n    this.sentMessageCallback = null;\r\n\r\n    this._lastAck = 0;\r\n\r\n    // connection\r\n    this._xmppClient = null;\r\n\r\n    // Original connection.send method\r\n    this._originalSend = null;\r\n\r\n    // In progress stanzas queue\r\n    this._unackedQueue = [];\r\n  }\r\n\r\n  enable(connection) {\r\n    let enableParams = {\r\n      xmlns: this._NS\r\n    };\r\n\r\n    if (!this._isStreamManagementEnabled) {\r\n      this._xmppClient = connection;\r\n      this._originalSend = this._xmppClient.send;\r\n      this._xmppClient.send = this.send.bind(this);\r\n    }\r\n\r\n    this._clientProcessedStanzasCounter = 0;\r\n    this._clientSentStanzasCounter = 0;\r\n    this._lastAck = 0;\r\n\r\n    this._addEnableHandlers();\r\n\r\n    const stanza = ChatUtils.createNonza('enable', enableParams);\r\n\r\n    this._xmppClient.send(stanza);\r\n  }\r\n\r\n  _addEnableHandlers() {\r\n    this._xmppClient.on('element', _incomingStanzaHandler.bind(this));\r\n\r\n    function _incomingStanzaHandler(stanza) {\r\n      let tagName = stanza.name || stanza.tagName || stanza.nodeTree.tagName;\r\n\r\n      if (tagName === 'enabled') {\r\n        this._isStreamManagementEnabled = true;\r\n        return;\r\n      }\r\n\r\n      if (ChatUtils.getAttr(stanza, 'xmlns') !== this._NS) {\r\n        this._increaseReceivedStanzasCounter();\r\n      }\r\n\r\n      if (tagName === 'r') {\r\n        let params = {\r\n          xmlns: this._NS,\r\n          h: this._clientProcessedStanzasCounter\r\n        },\r\n          answerStanza = ChatUtils.createNonza('a', params);\r\n\r\n        this._originalSend.call(this._xmppClient, answerStanza);\r\n        return;\r\n      }\r\n\r\n      if (tagName === 'a') {\r\n        const h = parseInt(ChatUtils.getAttr(stanza, 'h'));\r\n        this._checkCounterOnIncomeStanza(h);\r\n      }\r\n    }\r\n  }\r\n\r\n  send(stanza, message) {\r\n    let tagName = stanza.name || stanza.tagName || stanza.nodeTree.tagName,\r\n      type = ChatUtils.getAttr(stanza, 'type'),\r\n      bodyContent = ChatUtils.getElementText(stanza, 'body') || '',\r\n      attachments = ChatUtils.getAllElements(stanza, 'attachment') || '';\r\n\r\n    this._originalSend.call(this._xmppClient, stanza);\r\n\r\n    if (tagName === 'message' && (type === 'chat' || type === 'groupchat') && (bodyContent || attachments.length)) {\r\n      this._sendStanzasRequest({\r\n        message: message,\r\n        expect: this._clientSentStanzasCounter\r\n      });\r\n    }\r\n\r\n    ++this._clientSentStanzasCounter;\r\n  }\r\n\r\n  _sendStanzasRequest(data) {\r\n    if (this._isStreamManagementEnabled) {\r\n      this._unackedQueue.push(data);\r\n\r\n      const stanza = ChatUtils.createNonza('r', { xmlns: this._NS });\r\n\r\n      this._originalSend.call(this._xmppClient, stanza);\r\n    }\r\n  }\r\n\r\n  getClientSentStanzasCounter() {\r\n    return this._clientSentStanzasCounter;\r\n  }\r\n\r\n  _checkCounterOnIncomeStanza(h) {\r\n    const numAcked = h - this._lastAck;\r\n\r\n    Utils.DLog('[Chat][SM][_checkCounterOnIncomeStanza]', numAcked, h, this._lastAck);\r\n\r\n    for (let i = 0; i < numAcked && this._unackedQueue.length > 0; i++) {\r\n      this.sentMessageCallback(null, this._unackedQueue.shift().message);\r\n    }\r\n\r\n    this._lastAck = h;\r\n  }\r\n\r\n  _increaseReceivedStanzasCounter() {\r\n    ++this._clientProcessedStanzasCounter;\r\n  }\r\n}\r\n\r\nmodule.exports = StreamManagementService;\r\n","const ChatUtils = require('./cubeChatInternalUtils'),\r\n    Utils = require('../cubeInternalUtils'),\r\n    Config = require('../cubeConfig');\r\n\r\nclass ContactListService {\r\n  constructor (options) {\r\n    this.helpers = options.helpers;\r\n    this.xmppClient = options.xmppClient;\r\n    this.stanzasCallbacks = options.stanzasCallbacks;\r\n    //\r\n    this.contacts = {};\r\n\r\n    this.xmlns = \"jabber:iq:roster\"\r\n  }\r\n\r\n  get() {\r\n    return new Promise((resolve, reject) => {\r\n      const stanzaId = ChatUtils.getUniqueId('getRoster');\r\n\r\n      let contacts = {},\r\n        iqStanza = ChatUtils.createIqStanza({\r\n            type: 'get',\r\n            from: this.helpers.getUserCurrentJid(),\r\n            id: stanzaId\r\n        });\r\n\r\n      iqStanza.c('query', {\r\n        xmlns: this.xmlns\r\n      });\r\n\r\n      this.stanzasCallbacks[stanzaId] = stanza => {\r\n        const items = stanza.getChild('query').children;\r\n\r\n        for (let i = 0, len = items.length; i < len; i++) {\r\n          const userId = this.helpers.getUserIdFromJID(ChatUtils.getAttr(items[i], 'jid')),\r\n            ask = ChatUtils.getAttr(items[i], 'ask'),\r\n            subscription = ChatUtils.getAttr(items[i], 'subscription'),\r\n            name = ChatUtils.getAttr(items[i], 'name'),\r\n            isUniqName = userId + '-' + Config.creds.appId !== name;\r\n\r\n          contacts[userId] = {\r\n            subscription: subscription,\r\n            ask: ask || null,\r\n            name: isUniqName ? name : null\r\n          };\r\n        }\r\n\r\n        resolve(contacts);\r\n      };\r\n\r\n      this.xmppClient.send(iqStanza);\r\n    });\r\n  }\r\n\r\n  add(params) {\r\n    return new Promise((resolve, reject) => {\r\n      const userId = params.userId || params,\r\n        userJid = this.helpers.jidOrUserId(userId),\r\n        stanzaId = ChatUtils.getUniqueId('addContactInRoster');\r\n\r\n      let iqStanza = ChatUtils.createIqStanza({\r\n        type: 'set',\r\n        from: this.helpers.getUserCurrentJid(),\r\n        id: stanzaId\r\n      });\r\n\r\n      this.contacts[userId] = {\r\n        subscription: 'none',\r\n        ask: 'subscribe',\r\n        name: params.name || null\r\n      };\r\n\r\n      iqStanza\r\n        .c('query', {\r\n            xmlns: this.xmlns\r\n        })\r\n        .c('item', {\r\n            jid: userJid,\r\n            name: params.name || null\r\n        });\r\n\r\n\r\n      this.stanzasCallbacks[stanzaId] = () => {\r\n        this._sendSubscriptionPresence({\r\n          jid: userJid,\r\n          type: 'subscribe'\r\n        });\r\n\r\n        resolve();\r\n      };\r\n\r\n      this.xmppClient.send(iqStanza);\r\n    });\r\n  }\r\n\r\n  confirm(params) {\r\n    return new Promise((resolve, reject) => {\r\n      const userId = params.userId || params,\r\n          userJid = this.helpers.jidOrUserId(userId);\r\n\r\n      this._sendSubscriptionPresence({\r\n        jid: userJid,\r\n        type: 'subscribed'\r\n      });\r\n\r\n      if (Config.chat.contactList.subscriptionMode.mutual) {\r\n        this.add(params, function() {\r\n          resolve();\r\n        });\r\n      } else {\r\n        resolve();\r\n      }\r\n    });\r\n  }\r\n\r\n  reject(userId) {\r\n    return new Promise((resolve, reject) => {\r\n      const userJid = this.helpers.jidOrUserId(userId);\r\n\r\n      this.contacts[userId] = {\r\n        subscription: 'none',\r\n        ask: null\r\n      };\r\n\r\n      this._sendSubscriptionPresence({\r\n        jid: userJid,\r\n        type: 'unsubscribed'\r\n      });\r\n\r\n      resolve();\r\n    });\r\n  }\r\n\r\n  updateName(params) {\r\n    return new Promise((resolve, reject) => {\r\n      const userJid = this.helpers.jidOrUserId(params.userId),\r\n          stanzaId = ChatUtils.getUniqueId('updateContactInRoster');\r\n\r\n      let contact = this.contacts[params.userId];\r\n\r\n      if (Utils.isObject(contact)) {\r\n        contact.name = params.name || null;\r\n      } else {\r\n        reject('No contact exists with provided user id');\r\n        return;\r\n      }\r\n\r\n      let iqStanza = ChatUtils.createIqStanza({\r\n        type: 'set',\r\n        from: this.helpers.getUserCurrentJid(),\r\n        id: stanzaId\r\n      });\r\n\r\n      iqStanza\r\n        .c('query', {\r\n            xmlns: this.xmlns\r\n        })\r\n        .c('item', {\r\n            jid: userJid,\r\n            name: params.name || null\r\n        });\r\n\r\n      this.stanzasCallbacks[stanzaId] = res => {\r\n        res.attrs.type === \"result\" ? resolve() : reject(res)\r\n      };\r\n\r\n      this.xmppClient.send(iqStanza);\r\n    });\r\n  }\r\n\r\n  remove(userId) {\r\n    return new Promise((resolve, reject) => {\r\n      const userJid = this.helpers.jidOrUserId(userId),\r\n        stanzaId = ChatUtils.getUniqueId('removeConactInRoster');\r\n\r\n      let iqStanza = ChatUtils.createIqStanza({\r\n        type: 'set',\r\n        from: this.helpers.getUserCurrentJid(),\r\n        id: stanzaId\r\n      });\r\n\r\n      iqStanza\r\n        .c('query', {\r\n            xmlns: this.xmlns\r\n        })\r\n        .c('item', {\r\n            jid: userJid,\r\n            subscription: 'remove'\r\n        });\r\n\r\n\r\n      this.stanzasCallbacks[stanzaId] = () => {\r\n        delete this.contacts[userId];\r\n        resolve();\r\n      };\r\n\r\n      this.xmppClient.send(iqStanza);\r\n    });\r\n  }\r\n\r\n  _sendSubscriptionPresence(params) {\r\n    const presenceParams = {\r\n      to: params.jid,\r\n      type: params.type\r\n    };\r\n\r\n    const presenceStanza = ChatUtils.createPresenceStanza(presenceParams);\r\n\r\n    this.xmppClient.send(presenceStanza);\r\n  }\r\n}\r\n\r\nmodule.exports = ContactListService;\r\n","const ChatUtils = require('./cubeChatInternalUtils'),\r\n    Utils = require('../cubeInternalUtils');\r\n\r\nclass PrivacyListService {\r\n  constructor (options) {\r\n    this.helpers = options.helpers;\r\n    this.xmppClient = options.xmppClient;\r\n    this.stanzasCallbacks = options.stanzasCallbacks;\r\n\r\n    this.xmlns = \"jabber:iq:privacy\"\r\n  }\r\n\r\n  create(list) {\r\n    return new Promise((resolve, reject) => {\r\n      let userId,\r\n          userJid,\r\n          userMuc,\r\n          userAction,\r\n          mutualBlock,\r\n          listPrivacy = {},\r\n          listUserId = [];\r\n\r\n      for (let i = list.items.length - 1; i >= 0; i--) {\r\n        const user = list.items[i];\r\n\r\n        listPrivacy[user.user_id] = {\r\n          action: user.action,\r\n          mutualBlock: user.mutualBlock === true ? true : false\r\n        };\r\n      }\r\n\r\n      listUserId = Object.keys(listPrivacy);\r\n\r\n      const iqParams = {\r\n        type: 'set',\r\n        from: this.helpers.getUserCurrentJid(),\r\n        id: ChatUtils.getUniqueId('edit')\r\n      };\r\n\r\n      let iq = ChatUtils.createIqStanza(iqParams);\r\n\r\n      iq.c('query', {\r\n        xmlns: this.xmlns\r\n      }).c('list', {\r\n        name: list.name\r\n      });\r\n\r\n      function createPrivacyItem(iq, params) {\r\n        let list = iq.getChild('query').getChild('list');\r\n\r\n        list.c('item', {\r\n          type: 'jid',\r\n          value: params.jidOrMuc,\r\n          action: params.userAction,\r\n          order: params.order\r\n        }).c('message', {})\r\n          .up().c('presence-in', {})\r\n          .up().c('presence-out', {})\r\n          .up().c('iq', {})\r\n          .up().up();\r\n\r\n        return iq;\r\n      }\r\n\r\n      function createPrivacyItemMutal(iq, params) {\r\n        let list = iq.getChild('query').getChild('list');\r\n\r\n        list.c('item', {\r\n          type: 'jid',\r\n          value: params.jidOrMuc,\r\n          action: params.userAction,\r\n          order: params.order\r\n        }).up();\r\n\r\n        return iq;\r\n      }\r\n\r\n      for (let index = 0, j = 0, len = listUserId.length; index < len; index++ , j = j + 2) {\r\n        userId = listUserId[index];\r\n        mutualBlock = listPrivacy[userId].mutualBlock;\r\n\r\n        userAction = listPrivacy[userId].action;\r\n        userJid = this.helpers.jidOrUserId(parseInt(userId, 10));\r\n        userMuc = this.helpers.getUserNickWithMucDomain(userId);\r\n\r\n        if (mutualBlock && userAction === 'deny') {\r\n          iq = createPrivacyItemMutal(iq, {\r\n            order: j + 1,\r\n            jidOrMuc: userJid,\r\n            userAction: userAction\r\n          });\r\n          iq = createPrivacyItemMutal(iq, {\r\n            order: j + 2,\r\n            jidOrMuc: userMuc,\r\n            userAction: userAction\r\n          }).up().up();\r\n        } else {\r\n          iq = createPrivacyItem(iq, {\r\n            order: j + 1,\r\n            jidOrMuc: userJid,\r\n            userAction: userAction\r\n          });\r\n          iq = createPrivacyItem(iq, {\r\n            order: j + 2,\r\n            jidOrMuc: userMuc,\r\n            userAction: userAction\r\n          });\r\n        }\r\n      }\r\n\r\n      this.stanzasCallbacks[iqParams.id] = stanza => {\r\n        ChatUtils.isErrorStanza(stanza) ? reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza)) : resolve();\r\n      };\r\n\r\n      this.xmppClient.send(iq);\r\n    });\r\n  }\r\n\r\n  getList(name) {\r\n    return new Promise((resolve, reject) => {\r\n      let items,\r\n          userJid,\r\n          userId,\r\n          usersList = [],\r\n          list = {};\r\n\r\n      const iqParams = {\r\n        type: 'get',\r\n        from: this.helpers.getUserCurrentJid(),\r\n        id: ChatUtils.getUniqueId('getlist')\r\n      };\r\n\r\n      let iq = ChatUtils.createIqStanza(iqParams);\r\n\r\n      iq.c('query', {\r\n        xmlns: this.xmlns\r\n      }).c('list', {\r\n        name: name\r\n      });\r\n\r\n      this.stanzasCallbacks[iqParams.id] = stanza => {\r\n        const stanzaQuery = stanza.getChild('query');\r\n\r\n        list = stanzaQuery ? stanzaQuery.getChild('list') : null;\r\n        items = list ? list.getChildElements('item') : null;\r\n\r\n        for (let i = 0, len = items.length; i < len; i = i + 2) {\r\n          userJid = items[i].attrs.value;\r\n          userId = this.helpers.getUserIdFromJID(userJid);\r\n          usersList.push({\r\n            user_id: userId,\r\n            action: items[i].attrs.action\r\n          });\r\n        }\r\n\r\n        list = {\r\n          name: list.attrs.name,\r\n          items: usersList\r\n        };\r\n\r\n        resolve(list);\r\n\r\n        delete this.stanzasCallbacks[iqParams.id];\r\n      };\r\n\r\n      this.xmppClient.send(iq);\r\n    });\r\n  }\r\n\r\n  update(listWithUpdates) {\r\n    return new Promise((resolve, reject) => {\r\n      this.getList(listWithUpdates.name).then((existentList) => {\r\n        const updatedList = {\r\n          items: Utils.mergeArrays(existentList.items, listWithUpdates.items),\r\n          name: listWithUpdates.name\r\n        };\r\n        this.create(updatedList).then(() => {\r\n          resolve();\r\n        }).catch(error => {\r\n          reject(error);\r\n        });\r\n      }).catch(error => {\r\n        reject(error);\r\n      });\r\n    });\r\n  }\r\n\r\n  getNames() {\r\n    return new Promise((resolve, reject) => {\r\n      const iqParams = {\r\n        'type': 'get',\r\n        'from': this.helpers.getUserCurrentJid(),\r\n        'id': ChatUtils.getUniqueId('getNames')\r\n      };\r\n\r\n      let iq = ChatUtils.createIqStanza(iqParams);\r\n\r\n      iq.c('query', {\r\n        xmlns: this.xmlns\r\n      });\r\n\r\n      this.stanzasCallbacks[iq.attrs.id] = stanza => {\r\n        if (!ChatUtils.isErrorStanza(stanza)) {\r\n          const query = stanza.getChild('query'),\r\n            defaultList = query.getChild('default'),\r\n            activeList = query.getChild('active'),\r\n            allLists = query.getChildElements('list');\r\n\r\n          let defaultName = defaultList ? defaultList.attrs.name : null,\r\n            activeName = activeList ? activeList.attrs.name : null;\r\n\r\n          let allNames = [];\r\n\r\n          for (let i = 0, len = allLists.length; i < len; i++) {\r\n            allNames.push(allLists[i].attrs.name);\r\n          }\r\n\r\n          const namesList = {\r\n            default: defaultName,\r\n            active: activeName,\r\n            names: allNames\r\n          };\r\n\r\n          resolve(namesList);\r\n        } else {\r\n          reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza));\r\n        }\r\n      };\r\n\r\n      this.xmppClient.send(iq);\r\n    });\r\n  }\r\n\r\n  delete(name) {\r\n    return new Promise((resolve, reject) => {\r\n      const iqParams = {\r\n        from: this.xmppClient.jid || this.xmppClient.jid.user,\r\n        type: 'set',\r\n        id: ChatUtils.getUniqueId('remove')\r\n      };\r\n\r\n      let iq = ChatUtils.createIqStanza(iqParams);\r\n\r\n      iq.c('query', {\r\n        xmlns: this.xmlns\r\n      }).c('list', {\r\n        name: name ? name : ''\r\n      });\r\n\r\n      this.stanzasCallbacks[iq.attrs.id] = stanza => {\r\n        ChatUtils.isErrorStanza(stanza) ? reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza)) : resolve();\r\n      };\r\n\r\n      this.xmppClient.send(iq);\r\n    });\r\n  }\r\n\r\n  setAsDefault (name) {\r\n    return new Promise((resolve, reject) => {\r\n      const iqParams = {\r\n        from: this.xmppClient.jid || this.xmppClient.jid.user,\r\n        type: 'set',\r\n        id: ChatUtils.getUniqueId('default')\r\n      };\r\n\r\n      let iq = ChatUtils.createIqStanza(iqParams);\r\n\r\n      iq.c('query', {\r\n        xmlns: this.xmlns\r\n      }).c('default', name && name.length > 0 ? { name: name } : {});\r\n\r\n      this.stanzasCallbacks[iq.attrs.id] = stanza => {\r\n        ChatUtils.isErrorStanza(stanza) ? reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza)) : resolve();\r\n      };\r\n\r\n      this.xmppClient.send(iq);\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = PrivacyListService;\r\n","const ChatUtils = require('./cubeChatInternalUtils');\r\n\r\nclass GroupChatService {\r\n  constructor (options) {\r\n    this.helpers = options.helpers;\r\n    this.xmppClient = options.xmppClient;\r\n    this.stanzasCallbacks = options.stanzasCallbacks;\r\n    //\r\n    this.joinedRooms = {};\r\n\r\n    this.xmlns = \"http://jabber.org/protocol/muc\";\r\n  }\r\n\r\n  join (dialogIdOrJid) {\r\n    return new Promise((resolve, reject) => {\r\n      const id = ChatUtils.getUniqueId('join'),\r\n        dialogJid = this.helpers.getDialogJid(dialogIdOrJid),\r\n        presenceParams = {\r\n          id: id,\r\n          from: this.helpers.getUserCurrentJid(),\r\n          to: this.helpers.getRoomJid(dialogJid)\r\n        }\r\n\r\n      let presenceStanza = ChatUtils.createPresenceStanza(presenceParams);\r\n      presenceStanza.c('x', {\r\n        xmlns: this.xmlns\r\n      }).c('history', { maxstanzas: 0 });\r\n\r\n      this.stanzasCallbacks[id] = stanza => {\r\n        const from = ChatUtils.getAttr(stanza, 'from'),\r\n          dialogId = this.helpers.getDialogIdFromJID(from),\r\n          x = ChatUtils.getElement(stanza, 'x'),\r\n          xXMLNS = ChatUtils.getAttr(x, 'xmlns'),\r\n          status = ChatUtils.getElement(x, 'status'),\r\n          statusCode = ChatUtils.getAttr(status, 'code');\r\n\r\n        if (status && statusCode == '110') {\r\n          this.joinedRooms[dialogJid] = true;\r\n          resolve();\r\n        } else {\r\n          const type = ChatUtils.getAttr(stanza, 'type');\r\n\r\n          if (type && type === 'error' && xXMLNS === this.xmlns && id.endsWith(':join')) {\r\n            const errorEl = ChatUtils.getElement(stanza, 'error'),\r\n              code = ChatUtils.getAttr(errorEl, 'code'),\r\n              errorMessage = ChatUtils.getElementText(errorEl, 'text');\r\n\r\n            const errorResponse = {\r\n              code: code || 500,\r\n              message: errorMessage || 'Unknown issue'\r\n            }\r\n\r\n            reject(errorResponse);\r\n          }\r\n        }\r\n      };\r\n\r\n      this.xmppClient.send(presenceStanza);\r\n    });\r\n  }\r\n\r\n  leave (dialogIdOrJid) {\r\n    return new Promise((resolve, reject) => {\r\n      const dialogJid = this.helpers.getDialogJid(dialogIdOrJid);\r\n      const presenceParams = {\r\n        type: 'unavailable',\r\n        from: this.helpers.getUserCurrentJid(),\r\n        to: this.helpers.getRoomJid(dialogJid)\r\n      };\r\n\r\n      const presenceStanza = ChatUtils.createPresenceStanza(presenceParams);\r\n\r\n      delete this.joinedRooms[dialogJid];\r\n\r\n      this.stanzasCallbacks['muc:leave'] = (stanza) => {\r\n        resolve();\r\n      };\r\n\r\n      this.xmppClient.send(presenceStanza);\r\n    });\r\n  }\r\n\r\n  listOnlineUsers (dialogIdOrJid) {\r\n    return new Promise((resolve, reject) => {\r\n      const dialogJid = this.helpers.getDialogJid(dialogIdOrJid);\r\n      const iqParams = {\r\n        type: 'get',\r\n        to: dialogJid,\r\n        from: this.helpers.getUserCurrentJid(),\r\n        id: ChatUtils.getUniqueId('muc_disco_items'),\r\n      };\r\n\r\n      let iqStanza = ChatUtils.createIqStanza(iqParams);\r\n      iqStanza.c('query', {\r\n          xmlns: 'http://jabber.org/protocol/disco#items'\r\n      });\r\n\r\n      this.stanzasCallbacks[iqParams.id] = (stanza) => {\r\n        var stanzaId = stanza.attrs.id;\r\n\r\n        if (this.stanzasCallbacks[stanzaId]) {\r\n          const items = stanza.getChild('query').getChildElements('item');\r\n\r\n          let users = [];\r\n          for (var i = 0, len = items.length; i < len; i++) {\r\n            let userId = this.helpers.getUserIdFromRoomJid(items[i].attrs.jid);\r\n            users.push(parseInt(userId));\r\n          }\r\n\r\n          resolve(users);\r\n        }\r\n      };\r\n\r\n      this.xmppClient.send(iqStanza);\r\n\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = GroupChatService;\r\n","const Config = require('../cubeConfig')\r\nconst Utils = require('../cubeInternalUtils')\r\n\r\nconst DIALOGS_API_URL = Config.urls.chat + '/Dialog'\r\n\r\nclass ChatDialogsService {\r\n  constructor (proxy) {\r\n    this.proxy = proxy\r\n  }\r\n\r\n  list (params) {\r\n    const ajaxParams = {\r\n      type: 'GET',\r\n      url: Utils.getUrl(DIALOGS_API_URL),\r\n      data: params\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  create (params) {\r\n    if (params && params.occupants_ids && Utils.isArray(params.occupants_ids)) {\r\n      params.occupants_ids = params.occupants_ids.join(', ')\r\n    }\r\n\r\n    const ajaxParams = {\r\n      type: 'POST',\r\n      url: Utils.getUrl(DIALOGS_API_URL),\r\n      data: params\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  update (id, params) {\r\n    const ajaxParams = {\r\n      type: 'PUT',\r\n      url: Utils.getUrl(DIALOGS_API_URL, id),\r\n      data: params\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  delete (idOrIds, params) {\r\n    const ajaxParams = {\r\n      type: 'DELETE',\r\n      url: Utils.getUrl(DIALOGS_API_URL, idOrIds),\r\n    }\r\n\r\n    if (typeof idOrIds === 'string' || (Utils.isArray(idOrIds) && idOrIds.length === 1)) {\r\n      ajaxParams.dataType = 'text'\r\n    }\r\n\r\n    if (params) {\r\n      ajaxParams.data = params\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  addAdmins (id, admins_ids) {\r\n    const params = {\r\n      push_all: {\r\n        admins_ids: admins_ids\r\n      }\r\n    }\r\n\r\n    const ajaxParams = {\r\n      type: 'PUT',\r\n      url: Utils.getUrl(DIALOGS_API_URL, id, 'admins'),\r\n      data: params\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  removeAdmins (id, admins_ids) {\r\n    const params = {\r\n      pull_all: {\r\n        admins_ids: admins_ids\r\n      }\r\n    }\r\n\r\n    const ajaxParams = {\r\n      type: 'PUT',\r\n      url: Utils.getUrl(DIALOGS_API_URL, id, 'admins'),\r\n      data: params\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  subscribeToPublic (id) {\r\n    const ajaxParams = {\r\n      type: 'POST',\r\n      url: Utils.getUrl(DIALOGS_API_URL, id, 'subscribe')\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  unsubscribeFromPublic (id) {\r\n    const ajaxParams = {\r\n      type: 'DELETE',\r\n      url: Utils.getUrl(DIALOGS_API_URL, id, 'subscribe'),\r\n      dataType: 'text'\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  updateNotificationsSettings (id, enabled) {\r\n    const settings = {\r\n      enabled: enabled ? 1 : 0\r\n    }\r\n\r\n    const ajaxParams = {\r\n      type: 'PUT',\r\n      url: Utils.getUrl(DIALOGS_API_URL, id, 'notifications'),\r\n      data: settings\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  getNotificationsSettings (id) {\r\n    const ajaxParams = {\r\n      type: 'GET',\r\n      url: Utils.getUrl(DIALOGS_API_URL, id, 'notifications')\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  getPublicOccupants (id, params) {\r\n    const ajaxParams = {\r\n      type: 'GET',\r\n      url: Utils.getUrl(DIALOGS_API_URL, id, 'occupants'),\r\n      data: params\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n}\r\n\r\nmodule.exports = ChatDialogsService\r\n","const Config = require('../cubeConfig')\r\nconst Utils = require('../cubeInternalUtils')\r\n\r\nconst MESSAGES_API_URL = Config.urls.chat + '/Message'\r\n\r\nclass ChatMessagesService {\r\n  constructor (proxy) {\r\n    this.proxy = proxy\r\n  }\r\n\r\n  list (params) {\r\n    const ajaxParams = {\r\n      url: Utils.getUrl(MESSAGES_API_URL),\r\n      data: params\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  create (params) {\r\n    const ajaxParams = {\r\n      url: Utils.getUrl(MESSAGES_API_URL),\r\n      type: 'POST',\r\n      data: params\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  update (id, params) {\r\n    const ajaxParams = {\r\n      type: 'PUT',\r\n      dataType: 'text',\r\n      url: Utils.getUrl(MESSAGES_API_URL, id),\r\n      data: params\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  delete (id, params) {\r\n    const ajaxParams = {\r\n      url: Utils.getUrl(MESSAGES_API_URL, id),\r\n      type: 'DELETE',\r\n      dataType: 'text'\r\n    }\r\n\r\n    if (params) {\r\n      ajaxParams.data = params\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n\r\n  unreadCount (params) {\r\n    if (params && params.chat_dialog_ids && Utils.isArray(params.chat_dialog_ids)) {\r\n      params.chat_dialog_ids = params.chat_dialog_ids.join(', ')\r\n    }\r\n\r\n    const ajaxParams = {\r\n      url: Utils.getUrl(MESSAGES_API_URL + '/unread'),\r\n      data: params\r\n    }\r\n\r\n    return this.proxy.ajax(ajaxParams)\r\n  }\r\n}\r\n\r\nmodule.exports = ChatMessagesService\r\n","const WebRTCSession = require('./cubeWebRTCSession');\r\nconst WebRTCSignalingProcessor = require('./cubeWebRTCSignalingProcessor');\r\nconst WebRTCSignalingProvider = require('./cubeWebRTCSignalingProvider');\r\nconst Helpers = require('./cubeWebRTCHelpers');\r\nconst RTCPeerConnection = require('./cubeRTCPeerConnection');\r\nconst cubeWebRTCConstants = require('./cubeWebRTCConstants');\r\nconst SignalingConstants = cubeWebRTCConstants.SignalingConstants;\r\nconst SessionState = require('./cubeWebRTCConstants').SessionState;\r\nconst Utils = require('../cubeInternalUtils');\r\nconst mediaDevices = require('../cubeDependencies').mediaDevices;\r\n\r\nclass WebRTCClient {\r\n\r\n  constructor(connection) {\r\n    this.connection = connection;\r\n    this.signalingProcessor = new WebRTCSignalingProcessor(this);\r\n    this.signalingProvider = new WebRTCSignalingProvider(connection);\r\n\r\n    this.SessionConnectionState = cubeWebRTCConstants.SessionConnectionState;\r\n    this.PeerConnectionState = cubeWebRTCConstants.PeerConnectionState;\r\n    this.CallType = cubeWebRTCConstants.CallType;\r\n\r\n    this.sessions = {};\r\n\r\n    if (mediaDevices) {\r\n      mediaDevices.ondevicechange = this._onDevicesChangeListener.bind(this);\r\n    }\r\n  }\r\n\r\n  getMediaDevices(spec) {\r\n    const specDevices = []\r\n\r\n    return new Promise((resolve, reject) => {\r\n      if (!mediaDevices || !mediaDevices.enumerateDevices) {\r\n        reject(\"No 'enumerateDevices' API supported\");\r\n      } else {\r\n        mediaDevices.enumerateDevices().then(devices => {\r\n          if (spec) {\r\n            devices.forEach((device, i) => {\r\n              if (device.kind === spec) {\r\n                specDevices.push(device);\r\n              }\r\n            });\r\n            resolve(specDevices);\r\n          } else {\r\n            resolve(devices);\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  createNewSession(opponentsIDs, callType, opts) {\r\n    const callerID = Helpers.getUserIdFromJID(Helpers.userCurrentJid(this.connection));\r\n    const bandwidth = opts && opts.bandwidth && (!isNaN(opts.bandwidth)) ? +opts.bandwidth : 0;\r\n    if (!opponentsIDs) {\r\n      throw new Error('Can\\'t create a session without opponentsIDs.');\r\n    }\r\n\r\n    return this._createAndStoreSession(null, callerID, opponentsIDs, callType, bandwidth);\r\n  }\r\n\r\n  _createAndStoreSession(sessionID, initiatorID, opIDs, callType, bandwidth) {\r\n    const newSession = new WebRTCSession({\r\n      sessionID,\r\n      initiatorID,\r\n      opIDs,\r\n      callType,\r\n      signalingProvider: this.signalingProvider,\r\n      currentUserID: Helpers.getUserIdFromJID(Helpers.userCurrentJid(this.connection)),\r\n      bandwidth\r\n    });\r\n\r\n    newSession.onUserNotAnswerListener = this.onUserNotAnswerListener;\r\n    newSession.onRemoteStreamListener = this.onRemoteStreamListener;\r\n    newSession.onSessionConnectionStateChangedListener = this.onSessionConnectionStateChangedListener;\r\n    newSession.onSessionCloseListener = this.onSessionCloseListener;\r\n    newSession.onCallStatsReport = this.onCallStatsReport;\r\n\r\n    this.sessions[newSession.ID] = newSession;\r\n    return newSession;\r\n  }\r\n\r\n  clearSession(sessionId) {\r\n    delete this.sessions[sessionId];\r\n  }\r\n\r\n  /// DELEGATE (signaling)\r\n\r\n  _onCallListener(userID, sessionID, extension) {\r\n    const userInfo = extension.userInfo || {};\r\n\r\n    Helpers.trace(\"onCall. UserID:\" + userID + \". SessionID: \" + sessionID + \". extension: \", userInfo);\r\n\r\n    let session = this.sessions[sessionID];\r\n    const bandwidth = +userInfo.bandwidth || 0;\r\n\r\n    if (!session) {\r\n      session = this._createAndStoreSession(sessionID, extension.callerID, extension.opponentsIDs, extension.callType, bandwidth);\r\n      session._processOnCall(userID, extension);\r\n      Utils.safeCallbackCall(this.onCallListener, session, userInfo);\r\n    } else {\r\n      session._processOnCall(userID, extension);\r\n    }\r\n  }\r\n\r\n  _onAcceptListener(userID, sessionID, extension) {\r\n    const session = this.sessions[sessionID];\r\n    const userInfo = extension.userInfo || {};\r\n\r\n    Helpers.trace(\"onAccept. UserID:\" + userID + \". SessionID: \" + sessionID);\r\n\r\n    if (session && (session.state === SessionState.ACTIVE || session.state === SessionState.NEW)) {\r\n      Utils.safeCallbackCall(this.onAcceptCallListener, session, userID, userInfo);\r\n      session._processOnAccept(userID, extension);\r\n    } else {\r\n      Helpers.traceWarning(\"Ignore 'onAccept', there is no information about session \" + sessionID);\r\n    }\r\n  }\r\n\r\n  _onRejectListener(userID, sessionID, extension) {\r\n    const session = this.sessions[sessionID];\r\n\r\n    Helpers.trace(\"onReject. UserID:\" + userID + \". SessionID: \" + sessionID);\r\n\r\n    if (session) {\r\n      const userInfo = extension.userInfo || {};\r\n      Utils.safeCallbackCall(this.onRejectCallListener, session, userID, userInfo);\r\n      session._processOnReject(userID, extension);\r\n    } else {\r\n      Helpers.traceWarning(\"Ignore 'onReject', there is no information about session \" + sessionID);\r\n    }\r\n  }\r\n\r\n  _onStopListener(userID, sessionID, extension) {\r\n    Helpers.trace(\"onStop. UserID:\" + userID + \". SessionID: \" + sessionID);\r\n\r\n    const session = this.sessions[sessionID];\r\n    const userInfo = extension.userInfo || {};\r\n\r\n    if (session && (session.state === SessionState.ACTIVE || session.state === SessionState.NEW)) {\r\n      session._processOnStop(userID, extension);\r\n      Utils.safeCallbackCall(this.onStopCallListener, session, userID, userInfo);\r\n    } else {\r\n      Utils.safeCallbackCall(this.onInvalidEventsListener, 'onStop', session, userID, userInfo);\r\n      Helpers.traceWarning(\"Ignore 'onStop', there is no information about session \" + sessionID + \" by some reason.\");\r\n    }\r\n  }\r\n\r\n  _onIceCandidatesListener(userID, sessionID, extension) {\r\n    const session = this.sessions[sessionID];\r\n\r\n    Helpers.trace(\"onIceCandidates. UserID:\" + userID + \". SessionID: \" + sessionID + \". ICE candidates count: \" + extension.iceCandidates.length);\r\n\r\n    if (session) {\r\n      if (session.state === SessionState.ACTIVE) {\r\n        session._processOnIceCandidates(userID, extension);\r\n      } else {\r\n        Helpers.traceWarning('Ignore \\'OnIceCandidates\\', the session ( ' + sessionID + ' ) has invalid state.');\r\n      }\r\n    } else {\r\n      Helpers.traceWarning(\"Ignore 'OnIceCandidates', there is no information about session \" + sessionID);\r\n    }\r\n  }\r\n\r\n  _onDevicesChangeListener() {\r\n    Utils.safeCallbackCall(this.onDevicesChangeListener);\r\n  }\r\n}\r\n\r\nmodule.exports = WebRTCClient;\r\n","const config = require('../cubeConfig');\r\nconst RTCPeerConnection = require('./cubeRTCPeerConnection');\r\nconst Utils = require('../cubeInternalUtils');\r\nconst Helpers = require('./cubeWebRTCHelpers');\r\nconst SignalingConstants = require('./cubeWebRTCConstants').SignalingConstants;\r\nconst SessionState = require('./cubeWebRTCConstants').SessionState;\r\nconst PeerConnectionState = require('./cubeWebRTCConstants').PeerConnectionState;\r\nconst MediaDevicesImpl = require('../cubeDependencies').mediaDevices;\r\n\r\nclass WebRTCSession {\r\n    constructor(params) {\r\n        this.ID = params.sessionID ? params.sessionID : generateUUID();\r\n        this.state = SessionState.NEW;\r\n\r\n        this.initiatorID = parseInt(params.initiatorID);\r\n        this.opponentsIDs = params.opIDs;\r\n        this.callType = parseInt(params.callType);\r\n\r\n        this.peerConnections = {};\r\n\r\n        this.localStream = null;\r\n\r\n        this.mediaParams = null;\r\n\r\n        this.signalingProvider = params.signalingProvider;\r\n\r\n        this.currentUserID = params.currentUserID;\r\n\r\n        this.bandwidth = params.bandwidth;\r\n\r\n        this.answerTimer = null;\r\n\r\n        this.startCallTime = 0;\r\n        this.acceptCallTime = 0;\r\n    }\r\n\r\n    getUserMedia(params) {\r\n        return new Promise((resolve, reject) => {\r\n            MediaDevicesImpl.getUserMedia({\r\n                audio: params.audio || false,\r\n                video: params.video || false\r\n            }).then(stream => {\r\n                this.localStream = stream;\r\n                this.mediaParams = params;\r\n                if (params.elementId) {\r\n                    this.attachMediaStream(params.elementId, stream, params.options);\r\n                }\r\n                resolve(stream);\r\n            }).catch(reject);\r\n        });\r\n    }\r\n\r\n    connectionStateForUser(userID) {\r\n        const peerConnection = this.peerConnections[userID];\r\n        if (peerConnection) {\r\n            return peerConnection.state;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    attachMediaStream(id, stream, options) {\r\n        const elem = document.getElementById(id);\r\n\r\n        if (elem) {\r\n            if (typeof elem.srcObject === 'object') {\r\n                elem.srcObject = stream;\r\n            } else {\r\n                elem.src = window.URL.createObjectURL(stream);\r\n            }\r\n\r\n            if (options && options.muted) {\r\n                elem.muted = true;\r\n            }\r\n\r\n            if (options && options.mirror) {\r\n                elem.style.webkitTransform = 'scaleX(-1)';\r\n                elem.style.transform = 'scaleX(-1)';\r\n            }\r\n\r\n            elem.onloadedmetadata = function (e) {\r\n                elem.play();\r\n            };\r\n        } else {\r\n            throw new Error('Unable to attach media stream, element ' + id + ' is undefined');\r\n        }\r\n    }\r\n\r\n    detachMediaStream(id) {\r\n        const elem = document.getElementById(id);\r\n        if (elem) {\r\n            elem.pause();\r\n\r\n            if (typeof elem.srcObject === 'object') {\r\n                elem.srcObject = null;\r\n            } else {\r\n                elem.src = '';\r\n            }\r\n        }\r\n    }\r\n\r\n    switchMediaTracks(deviceIds) {\r\n        return new Promise((resolve, reject) => {\r\n            if (deviceIds && deviceIds.audio) {\r\n                if (typeof (this.mediaParams.audio) === \"boolean\") {\r\n                    this.mediaParams.audio = {};\r\n                }\r\n                this.mediaParams.audio.deviceId = deviceIds.audio;\r\n            }\r\n\r\n            if (deviceIds && deviceIds.video) {\r\n                if (typeof (this.mediaParams.video) === \"boolean\") {\r\n                    this.mediaParams.video = {};\r\n                }\r\n                this.mediaParams.video.deviceId = deviceIds.video;\r\n            }\r\n\r\n            this.localStream.getTracks().forEach(track => {\r\n                track.stop();\r\n            });\r\n\r\n            MediaDevicesImpl.getUserMedia({\r\n                audio: this.mediaParams.audio || false,\r\n                video: this.mediaParams.video || false\r\n            }).then(stream => {\r\n                this._replaceTracks(stream);\r\n                resolve(stream);\r\n            }).catch(error => {\r\n                reject(error);\r\n            });\r\n        });\r\n    }\r\n\r\n    _replaceTracks(stream) {\r\n        const peers = this.peerConnections;\r\n        const elementId = this.mediaParams.elementId;\r\n        const ops = this.mediaParams.options;\r\n        const newStreamTracks = stream.getTracks();\r\n\r\n        if (!Utils.getEnv().reactnative) {\r\n            this.detachMediaStream(elementId);\r\n        }\r\n\r\n        newStreamTracks.forEach(track => {\r\n            this.localStream.addTrack(track);\r\n        });\r\n\r\n        if (!Utils.getEnv().reactnative) {\r\n            this.attachMediaStream(elementId, stream, ops);\r\n        }\r\n\r\n        if (!Utils.getEnv().reactnative) {\r\n            for (let userId in peers) {\r\n                const peer = peers[userId];\r\n                peer.getSenders().map(sender => {\r\n                    sender.replaceTrack(newStreamTracks.find(track => {\r\n                        return track.kind === sender.track.kind;\r\n                    }));\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    call(extension) {\r\n        const ext = _prepareExtension(extension);\r\n\r\n        Helpers.trace('Call, extension: ' + JSON.stringify(ext.userInfo));\r\n\r\n        this.state = SessionState.ACTIVE;\r\n\r\n        this.opponentsIDs.forEach((userID, i, arr) => {\r\n            this._callInternal(userID, ext, true);\r\n        });\r\n    }\r\n\r\n    _callInternal(userID, extension, withOnNotAnswerCallback) {\r\n        const peer = this._createPeer(userID, 'offer');\r\n\r\n        // TODO: use 'addTrack' for all modern browsers\r\n        const safariVersion = Helpers.getVersionSafari();\r\n\r\n        if (safariVersion && safariVersion >= 11) {\r\n            this.localStream.getTracks().forEach(track => {\r\n                peer.addTrack(track, this.localStream);\r\n            });\r\n        } else {\r\n            peer.addLocalStream(this.localStream);\r\n        }\r\n\r\n        this.peerConnections[userID] = peer;\r\n\r\n        peer.getAndSetLocalSessionDescription(this.callType)\r\n            .then(() => {\r\n                Helpers.trace(\"getAndSessionDescription success\");\r\n                /** let's send call requests to user */\r\n                peer._startDialingTimer(extension, withOnNotAnswerCallback);\r\n            }).catch(err => {\r\n                Helpers.trace(\"getAndSessionDescription error: \" + err);\r\n            });\r\n    }\r\n\r\n    accept(extension) {\r\n        const ext = _prepareExtension(extension);\r\n\r\n        Helpers.trace('Accept, extension: ' + JSON.stringify(ext.userInfo));\r\n\r\n        if (this.state === SessionState.ACTIVE) {\r\n            Helpers.traceError(\"Can't accept, the session is already active, return.\");\r\n            return;\r\n        }\r\n\r\n        if (this.state === SessionState.CLOSED) {\r\n            Helpers.traceError(\"Can't accept, the session is already closed, return.\");\r\n            this.stop({});\r\n            return;\r\n        }\r\n\r\n        this.state = SessionState.ACTIVE;\r\n\r\n        this.acceptCallTime = new Date();\r\n\r\n        this._clearAnswerTimer();\r\n\r\n        this._acceptInternal(this.initiatorID, ext);\r\n\r\n        // group call\r\n        const oppIDs = this._uniqueOpponentsIDsWithoutInitiator();\r\n        if (oppIDs.length > 0) {\r\n            const offerTime = (this.acceptCallTime - this.startCallTime) / 1000;\r\n            this._startWaitingOfferOrAnswerTimer(offerTime);\r\n\r\n            oppIDs.forEach(opID => {\r\n                if (this.currentUserID > opID) {\r\n                    this._callInternal(opID, {}, true);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    _acceptInternal(userID, extension) {\r\n        const peerConnection = this.peerConnections[userID];\r\n\r\n        if (peerConnection) {\r\n\r\n            // TODO: use 'addTrack' for all modern browsers\r\n            const safariVersion = Helpers.getVersionSafari();\r\n            if (safariVersion && safariVersion >= 11) {\r\n                this.localStream.getTracks().forEach(track => {\r\n                    peerConnection.addTrack(track, this.localStream);\r\n                });\r\n            } else {\r\n                peerConnection.addLocalStream(this.localStream);\r\n            }\r\n\r\n            peerConnection\r\n                .setRemoteSessionDescription('offer', peerConnection.getRemoteSDP())\r\n                .then(() => {\r\n                    Helpers.trace(\"'setRemoteSessionDescription' success\");\r\n\r\n                    peerConnection\r\n                        .getAndSetLocalSessionDescription(this.callType)\r\n                        .then(() => {\r\n                            extension.sessionID = this.ID;\r\n                            extension.callType = this.callType;\r\n                            extension.callerID = this.initiatorID;\r\n                            extension.opponentsIDs = this.opponentsIDs;\r\n                            extension.sdp = peerConnection.localDescription.sdp;\r\n\r\n                            this.signalingProvider.sendMessage(userID, extension, SignalingConstants.SignalingType.ACCEPT);\r\n                        })\r\n                        .catch(err => {\r\n                            Helpers.trace(\"getAndSetLocalSessionDescription error: \" + err);\r\n                        });\r\n\r\n                })\r\n                .catch(error => {\r\n                    Helpers.traceError(\"'setRemoteSessionDescription' error: \" + error);\r\n                });\r\n        } else {\r\n            Helpers.traceError(\"Can't accept the call, there is no information about peer connection by some reason.\");\r\n        }\r\n    }\r\n\r\n    reject(extension) {\r\n        const ext = _prepareExtension(extension);\r\n\r\n        Helpers.trace('Reject, extension: ' + JSON.stringify(ext.userInfo));\r\n\r\n        this.state = SessionState.REJECTED;\r\n\r\n        this._clearAnswerTimer();\r\n\r\n        ext.sessionID = this.ID;\r\n        ext.callType = this.callType;\r\n        ext.callerID = this.initiatorID;\r\n        ext.opponentsIDs = this.opponentsIDs;\r\n\r\n        Object.keys(this.peerConnections).forEach(key => {\r\n            const peerConnection = this.peerConnections[key];\r\n            this.signalingProvider.sendMessage(peerConnection.userID, ext, SignalingConstants.SignalingType.REJECT);\r\n        });\r\n\r\n        this._close();\r\n    }\r\n\r\n    stop(extension) {\r\n        const ext = _prepareExtension(extension);\r\n\r\n        Helpers.trace('Stop, extension: ' + JSON.stringify(ext.userInfo));\r\n\r\n        this.state = SessionState.HUNGUP;\r\n\r\n        if (this.answerTimer) {\r\n            this._clearAnswerTimer();\r\n        }\r\n\r\n        ext.sessionID = this.ID;\r\n        ext.callType = this.callType;\r\n        ext.callerID = this.initiatorID;\r\n        ext.opponentsIDs = this.opponentsIDs;\r\n\r\n        Object.keys(this.peerConnections).forEach(key => {\r\n            const peerConnection = this.peerConnections[key];\r\n            this.signalingProvider.sendMessage(peerConnection.userID, ext, SignalingConstants.SignalingType.STOP);\r\n        });\r\n\r\n        this._close();\r\n    }\r\n\r\n    mute(type) {\r\n        this._muteStream(0, type);\r\n    }\r\n\r\n    unmute(type) {\r\n        this._muteStream(1, type);\r\n    }\r\n\r\n\r\n    _processOnCall(callerID, extension) {\r\n        const oppIDs = this._uniqueOpponentsIDs();\r\n\r\n        oppIDs.forEach(opID => {\r\n            const pConn = this.peerConnections[opID];\r\n\r\n            if (pConn) {\r\n                if (opID == callerID) {\r\n                    pConn.updateRemoteSDP(extension.sdp);\r\n\r\n                    /** The group call logic starts here */\r\n                    if (callerID != this.initiatorID && this.state === SessionState.ACTIVE) {\r\n                        this._acceptInternal(callerID, {});\r\n                    }\r\n                }\r\n            } else {\r\n                /** create peer connections for each opponent */\r\n                let peerConnection;\r\n                if (opID != callerID && this.currentUserID > opID) {\r\n                    peerConnection = this._createPeer(opID, 'offer');\r\n                } else {\r\n                    peerConnection = this._createPeer(opID, 'answer');\r\n                }\r\n\r\n                this.peerConnections[opID] = peerConnection;\r\n\r\n                if (opID == callerID) {\r\n                    peerConnection.updateRemoteSDP(extension.sdp);\r\n                    this._startAnswerTimer();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    _processOnAccept(userID, extension) {\r\n        const peerConnection = this.peerConnections[userID];\r\n\r\n        if (peerConnection) {\r\n            peerConnection._clearDialingTimer();\r\n\r\n            peerConnection\r\n                .setRemoteSessionDescription('answer', extension.sdp)\r\n                .then(() => {\r\n                    Helpers.trace(\"'setRemoteSessionDescription' success\");\r\n                })\r\n                .catch(error => {\r\n                    Helpers.traceError(\"'setRemoteSessionDescription' error: \" + error);\r\n                });\r\n        } else {\r\n            Helpers.traceWarning(\"Ignore 'OnAccept', there is no information about peer connection by some reason.\");\r\n        }\r\n    }\r\n\r\n    _processOnReject(userID, extension) {\r\n        const peerConnection = this.peerConnections[userID];\r\n\r\n        this._clearWaitingOfferOrAnswerTimer();\r\n\r\n        if (peerConnection) {\r\n            peerConnection.release();\r\n        } else {\r\n            Helpers.traceWarning(\"Ignore 'OnReject', there is no information about peer connection by some reason.\");\r\n        }\r\n\r\n        this._closeSessionIfAllConnectionsClosed();\r\n    }\r\n\r\n    _processOnStop(userID, extension) {\r\n        this._clearAnswerTimer();\r\n\r\n        /** drop the call if the initiator did it */\r\n        if (userID === this.initiatorID) {\r\n            const pcKeys = Object.keys(this.peerConnections);\r\n            if (pcKeys.length > 0) {\r\n                pcKeys.forEach(key => {\r\n                    this.peerConnections[key].release();\r\n                });\r\n            } else {\r\n                Helpers.traceWarning(\"Ignore 'OnStop', there is no information about peer connections by some reason.\");\r\n            }\r\n        } else {\r\n            const pc = this.peerConnections[userID];\r\n            if (pc) {\r\n                pc.release();\r\n            } else {\r\n                Helpers.traceWarning(\"Ignore 'OnStop', there is no information about peer connection by some reason.\");\r\n            }\r\n        }\r\n\r\n        this._closeSessionIfAllConnectionsClosed();\r\n    }\r\n\r\n    _processOnIceCandidates(userID, extension) {\r\n        const peerConnection = this.peerConnections[userID];\r\n        if (peerConnection) {\r\n            peerConnection.addCandidates(extension.iceCandidates);\r\n        } else {\r\n            Helpers.traceWarning(\"Ignore 'OnIceCandidates', there is no information about peer connection by some reason.\");\r\n        }\r\n    }\r\n\r\n    _processCall(peerConnection, ext) {\r\n        const extension = ext || {};\r\n\r\n        extension.sessionID = this.ID;\r\n        extension.callType = this.callType;\r\n        extension.callerID = this.initiatorID;\r\n        extension.opponentsIDs = this.opponentsIDs;\r\n        extension.sdp = peerConnection.localDescription.sdp;\r\n\r\n        //TODO: set bandwidth to the userInfo object\r\n        extension.userInfo = ext.userInfo || {};\r\n        extension.userInfo.bandwidth = this.bandwidth;\r\n\r\n        this.signalingProvider.sendMessage(peerConnection.userID, extension, SignalingConstants.SignalingType.CALL);\r\n    }\r\n\r\n    _processIceCandidates(peerConnection, iceCandidates) {\r\n        const extension = {};\r\n\r\n        extension.sessionID = this.ID;\r\n        extension.callType = this.callType;\r\n        extension.callerID = this.initiatorID;\r\n        extension.opponentsIDs = this.opponentsIDs;\r\n\r\n        this.signalingProvider.sendCandidate(peerConnection.userID, iceCandidates, extension);\r\n    }\r\n\r\n    _processOnNotAnswer(peerConnection) {\r\n        Helpers.trace(\"Answer timeout callback for session \" + this.ID + \" for user \" + peerConnection.userID);\r\n\r\n        this._clearWaitingOfferOrAnswerTimer();\r\n\r\n        peerConnection.release();\r\n\r\n        Utils.safeCallbackCall(this.onUserNotAnswerListener, this, peerConnection.userID);\r\n\r\n        this._closeSessionIfAllConnectionsClosed();\r\n    }\r\n\r\n    _onRemoteStreamListener(userID, stream) {\r\n        Utils.safeCallbackCall(this.onRemoteStreamListener, this, userID, stream);\r\n    }\r\n\r\n    _onCallStatsReport(userId, stats, error) {\r\n        Utils.safeCallbackCall(this.onCallStatsReport, this, userId, stats, error);\r\n    }\r\n\r\n    _onSessionConnectionStateChangedListener(userID, connectionState) {\r\n        Utils.safeCallbackCall(this.onSessionConnectionStateChangedListener, this, userID, connectionState);\r\n    }\r\n\r\n\r\n    _createPeer(userID, peerConnectionType) {\r\n        this.startCallTime = new Date();\r\n\r\n        const pcConfig = {\r\n            iceServers: _prepareIceServers(config.videochat.iceServers)\r\n        };\r\n\r\n        Helpers.trace(\"_createPeer, iceServers: \" + JSON.stringify(pcConfig));\r\n\r\n        const peer = new RTCPeerConnection(pcConfig);\r\n        peer._init(this, userID, this.ID, peerConnectionType);\r\n\r\n        return peer;\r\n    }\r\n\r\n    _close() {\r\n        Helpers.trace('_close');\r\n\r\n        Object.keys(this.peerConnections).forEach(key => {\r\n            const peer = this.peerConnections[key];\r\n            try {\r\n                peer.release();\r\n            } catch (e) {\r\n                console.warn('Peer close error:', e);\r\n            }\r\n        });\r\n\r\n        this._closeLocalMediaStream();\r\n\r\n        this.state = SessionState.CLOSED;\r\n\r\n        Utils.safeCallbackCall(this.onSessionCloseListener, this);\r\n    }\r\n\r\n    _closeSessionIfAllConnectionsClosed() {\r\n        let isAllConnectionsClosed = true;\r\n\r\n        Object.keys(this.peerConnections).forEach(key => {\r\n            const peerCon = this.peerConnections[key];\r\n            let peerState;\r\n\r\n            try {\r\n                /*\r\n                TODO:\r\n                Uses RTCPeerConnection.signalingState instead RTCPeerConnection.iceConnectionState,\r\n                because state 'closed' comes after few time from Safari, but signaling state comes instantly\r\n                */\r\n                peerState = peerCon.iceConnectionState === 'closed' ? 'closed' :\r\n                    peerCon.signalingState === 'closed' ? 'closed' :\r\n                        peerCon.released ? 'closed' : null;\r\n            } catch (err) {\r\n                Helpers.traceError(err);\r\n                // need to set peerState to 'closed' on error. FF will crashed without this part.\r\n                peerState = 'closed';\r\n            }\r\n\r\n            if (peerState !== 'closed') {\r\n                isAllConnectionsClosed = false;\r\n            }\r\n        });\r\n\r\n        Helpers.trace(\"All peer connections closed: \" + isAllConnectionsClosed);\r\n\r\n        if (isAllConnectionsClosed) {\r\n            this._closeLocalMediaStream();\r\n\r\n            Utils.safeCallbackCall(this.onSessionCloseListener, this);\r\n\r\n            this.state = SessionState.CLOSED;\r\n        }\r\n    }\r\n\r\n    _closeLocalMediaStream() {\r\n        if (this.localStream) {\r\n            this.localStream.getAudioTracks().forEach(audioTrack => {\r\n                audioTrack.stop();\r\n            });\r\n\r\n            this.localStream.getVideoTracks().forEach(videoTrack => {\r\n                videoTrack.stop();\r\n            });\r\n\r\n            this.localStream = null;\r\n        }\r\n    }\r\n\r\n    _muteStream(enabled, type) {\r\n        if (type === 'audio' && this.localStream.getAudioTracks().length > 0) {\r\n            this.localStream.getAudioTracks().forEach(track => {\r\n                track.enabled = !!enabled;\r\n            });\r\n            return;\r\n        }\r\n\r\n        if (type === 'video' && this.localStream.getVideoTracks().length > 0) {\r\n            this.localStream.getVideoTracks().forEach(track => {\r\n                track.enabled = !!enabled;\r\n            });\r\n            return;\r\n        }\r\n    }\r\n\r\n    _clearAnswerTimer() {\r\n        if (this.answerTimer) {\r\n            Helpers.trace(\"_clearAnswerTimer\");\r\n            clearTimeout(this.answerTimer);\r\n            this.answerTimer = null;\r\n        }\r\n    }\r\n\r\n    _startAnswerTimer() {\r\n        Helpers.trace(\"_startAnswerTimer\");\r\n\r\n        const answerTimeoutCallback = () => {\r\n            Helpers.trace(\"_answerTimeoutCallback\");\r\n\r\n            if (typeof this.onSessionCloseListener === 'function') {\r\n                this._close();\r\n            }\r\n\r\n            this.answerTimer = null;\r\n        };\r\n\r\n        const answerTimeInterval = config.videochat.answerTimeInterval * 1000;\r\n        this.answerTimer = setTimeout(answerTimeoutCallback, answerTimeInterval);\r\n    }\r\n\r\n    _clearWaitingOfferOrAnswerTimer() {\r\n        if (this.waitingOfferOrAnswerTimer) {\r\n            Helpers.trace(\"_clearWaitingOfferOrAnswerTimer\");\r\n            clearTimeout(this.waitingOfferOrAnswerTimer);\r\n            this.waitingOfferOrAnswerTimer = null;\r\n        }\r\n    }\r\n\r\n    _startWaitingOfferOrAnswerTimer(time) {\r\n        const timeout = (config.videochat.answerTimeInterval - time) < 0 ? 1 : config.videochat.answerTimeInterval - time;\r\n\r\n        const waitingOfferOrAnswerTimeoutCallback = () => {\r\n            Helpers.trace(\"waitingOfferOrAnswerTimeoutCallback\");\r\n\r\n            Object.keys(this.peerConnections).forEach(key => {\r\n                const peerConnection = this.peerConnections[key];\r\n                if (peerConnection.state === PeerConnectionState.CONNECTING || peerConnection.state === PeerConnectionState.NEW) {\r\n                    this._processOnNotAnswer(peerConnection);\r\n                }\r\n            });\r\n\r\n            this.waitingOfferOrAnswerTimer = null;\r\n        };\r\n\r\n        Helpers.trace(\"_startWaitingOfferOrAnswerTimer, timeout: \" + timeout);\r\n\r\n        this.waitingOfferOrAnswerTimer = setTimeout(waitingOfferOrAnswerTimeoutCallback, timeout * 1000);\r\n    }\r\n\r\n    _uniqueOpponentsIDs() {\r\n        const opponents = [];\r\n\r\n        if (this.initiatorID !== this.currentUserID) {\r\n            opponents.push(this.initiatorID);\r\n        }\r\n\r\n        this.opponentsIDs.forEach(userID => {\r\n            if (userID != this.currentUserID) {\r\n                opponents.push(parseInt(userID));\r\n            }\r\n        });\r\n\r\n        return opponents;\r\n    }\r\n\r\n    _uniqueOpponentsIDsWithoutInitiator() {\r\n        const opponents = [];\r\n\r\n        this.opponentsIDs.forEach(userID => {\r\n            if (userID != this.currentUserID) {\r\n                opponents.push(parseInt(userID));\r\n            }\r\n        });\r\n\r\n        return opponents;\r\n    }\r\n\r\n    toString() {\r\n        return 'ID: ' + this.ID + ', initiatorID:  ' + this.initiatorID + ', opponentsIDs: ' + this.opponentsIDs + ', state: ' + this.state + ', callType: ' + this.callType;\r\n    }\r\n}\r\n\r\nfunction generateUUID() {\r\n    let d = new Date().getTime();\r\n    const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\r\n        const r = (d + Math.random() * 16) % 16 | 0;\r\n        d = Math.floor(d / 16);\r\n        return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);\r\n    });\r\n    return uuid;\r\n}\r\n\r\nfunction _prepareExtension(extension) {\r\n    let ext = {};\r\n\r\n    try {\r\n        if (({}).toString.call(extension) === '[object Object]') {\r\n            ext.userInfo = extension;\r\n            ext = JSON.parse(JSON.stringify(ext).replace(/null/g, \"\\\"\\\"\"));\r\n        } else {\r\n            throw new Error('Invalid type of \"extension\" object.');\r\n        }\r\n    } catch (err) {\r\n        Helpers.traceWarning(err.message);\r\n    }\r\n\r\n    return ext;\r\n}\r\n\r\nfunction _prepareIceServers(iceServers) {\r\n    const iceServersCopy = JSON.parse(JSON.stringify(iceServers));\r\n\r\n    Object.keys(iceServersCopy).forEach((c, i, a) => {\r\n        if (iceServersCopy[i].hasOwnProperty('url')) {\r\n            iceServersCopy[i].urls = iceServersCopy[i].url;\r\n        } else {\r\n            iceServersCopy[i].url = iceServersCopy[i].urls;\r\n        }\r\n    });\r\n\r\n    return iceServersCopy;\r\n}\r\n\r\nmodule.exports = WebRTCSession;\r\n","const SignalingConstants = require('./cubeWebRTCConstants').SignalingConstants;\r\nconst ChatHelpers = require('../messaging/cubeChatInternalUtils');\r\n\r\nclass WebRTCSignalingProcessor {\r\n\r\n    constructor(delegate) {\r\n        this.delegate = delegate;\r\n    }\r\n\r\n    _onMessage(userId, extraParams) {\r\n        const extension = this._getExtension(extraParams);\r\n        const sessionId = extension.sessionID;\r\n        const signalType = extension.signalType;\r\n\r\n        /** cleanup */\r\n        delete extension.moduleIdentifier;\r\n        delete extension.sessionID;\r\n        delete extension.signalType;\r\n\r\n        switch (signalType) {\r\n            case SignalingConstants.SignalingType.CALL:\r\n                this.delegate._onCallListener(userId, sessionId, extension);\r\n                break;\r\n\r\n            case SignalingConstants.SignalingType.ACCEPT:\r\n                this.delegate._onAcceptListener(userId, sessionId, extension);\r\n                break;\r\n\r\n            case SignalingConstants.SignalingType.REJECT:\r\n                this.delegate._onRejectListener(userId, sessionId, extension);\r\n                break;\r\n\r\n            case SignalingConstants.SignalingType.STOP:\r\n                this.delegate._onStopListener(userId, sessionId, extension);\r\n                break;\r\n\r\n            case SignalingConstants.SignalingType.CANDIDATE:\r\n                this.delegate._onIceCandidatesListener(userId, sessionId, extension);\r\n                break;\r\n        }\r\n    }\r\n\r\n    // TODO: refactor it\r\n    _getExtension(extraParams) {\r\n        if (!extraParams) {\r\n            return null;\r\n        }\r\n\r\n        let extension = {}, iceCandidates = [], opponents = [],\r\n            candidate, opponent, childrenNodes;\r\n\r\n        let extraParamsChildNodes = extraParams.childNodes || extraParams.children;\r\n\r\n        for (let i = 0, len = extraParamsChildNodes.length; i < len; i++) {\r\n            const items = extraParamsChildNodes[i].childNodes || extraParamsChildNodes[i].children;\r\n            const itemTagName = extraParamsChildNodes[i].tagName || extraParamsChildNodes[i].name;\r\n\r\n            if (itemTagName === 'iceCandidates') {\r\n                for (let j = 0, len2 = items.length; j < len2; j++) {\r\n                    candidate = {};\r\n                    childrenNodes = items[j].childNodes || items[j].children;\r\n\r\n                    for (let k = 0, len3 = childrenNodes.length; k < len3; k++) {\r\n                        const childName = childrenNodes[k].tagName || childrenNodes[k].name;\r\n                        const childValue = childrenNodes[k].textContent || childrenNodes[k].children[0];\r\n                        candidate[childName] = childName === 'sdpMLineIndex' ? parseInt(childValue) : childValue;\r\n                    }\r\n\r\n                    iceCandidates.push(candidate);\r\n                }\r\n\r\n            } else if (itemTagName === 'opponentsIDs') {\r\n                for (let v = 0, len2v = items.length; v < len2v; v++) {\r\n                    opponent = items[v].textContent || items[v].children[0];\r\n                    opponents.push(parseInt(opponent));\r\n                }\r\n            } else {\r\n                if (items.length > 1) {\r\n                    let nodeTextContentSize = (extraParamsChildNodes[i].textContent || extraParamsChildNodes[i].children[0]).length;\r\n\r\n                    if (nodeTextContentSize > 4096) {\r\n                        let wholeNodeContent = \"\";\r\n\r\n                        for (let t = 0; t < items.length; ++t) {\r\n                            wholeNodeContent += (items.textContent || items.children[0]);\r\n                        }\r\n                        extension[itemTagName] = wholeNodeContent;\r\n                    } else {\r\n                        extension = ChatHelpers._XMLtoJS(extension, itemTagName, extraParamsChildNodes[i]);\r\n                    }\r\n                } else {\r\n                    if (itemTagName === 'userInfo') {\r\n                        extension = ChatHelpers._XMLtoJS(extension, itemTagName, extraParamsChildNodes[i]);\r\n                    } else {\r\n                        extension[itemTagName] = extraParamsChildNodes[i].textContent || extraParamsChildNodes[i].children[0];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (iceCandidates.length > 0) {\r\n            extension.iceCandidates = iceCandidates;\r\n        }\r\n        if (opponents.length > 0) {\r\n            extension.opponentsIDs = opponents;\r\n        }\r\n\r\n        return extension;\r\n    }\r\n}\r\n\r\nmodule.exports = WebRTCSignalingProcessor;\r\n","const Helpers = require('./cubeWebRTCHelpers');\r\nconst SignalingConstants = require('./cubeWebRTCConstants').SignalingConstants;\r\nconst Utils = require('../cubeInternalUtils');\r\nconst config = require('../cubeConfig');\r\nconst ChatHelpers = require('../messaging/cubeChatInternalUtils');\r\n\r\nclass WebRTCSignalingProvider {\r\n  constructor(signalingConnection) {\r\n    this.signalingConnection = signalingConnection;\r\n  }\r\n\r\n  sendCandidate(userId, iceCandidates, ext) {\r\n    const extension = ext || {};\r\n    extension.iceCandidates = iceCandidates;\r\n\r\n    this.sendMessage(userId, extension, SignalingConstants.SignalingType.CANDIDATE);\r\n  }\r\n\r\n  sendMessage(userId, ext, signalingType) {\r\n    const extension = ext || {};\r\n    /** basic parameters */\r\n    extension.moduleIdentifier = SignalingConstants.MODULE_ID;\r\n    extension.signalType = signalingType;\r\n    /** extension.sessionID */\r\n    /** extension.callType */\r\n    extension.platform = 'web';\r\n    /** extension.callerID */\r\n    /** extension.opponentsIDs */\r\n    /** extension.sdp */\r\n\r\n    if (extension.userInfo && !Object.keys(extension.userInfo).length) {\r\n      delete extension.userInfo;\r\n    }\r\n\r\n    const params = {\r\n      to: Helpers.getUserJid(userId, config.creds.appId),\r\n      type: 'headline',\r\n      id: Utils.getBsonObjectId()\r\n    };\r\n\r\n    let msg = ChatHelpers.createMessageStanza(params).c('extraParams', {\r\n      xmlns: 'jabber:client'\r\n    });\r\n\r\n    Object.keys(extension).forEach(field => {\r\n      if (field === 'iceCandidates') {\r\n        msg = msg.c('iceCandidates');\r\n        extension[field].forEach(candidate => {\r\n          msg = msg.c('iceCandidate');\r\n          Object.keys(candidate).forEach(key => {\r\n            msg = msg.c(key).t(candidate[key]).up();\r\n          });\r\n          msg = msg.up();\r\n        });\r\n        msg = msg.up();\r\n      } else if (field === 'opponentsIDs') {\r\n        msg = msg.c('opponentsIDs');\r\n        extension[field].forEach(opponentId => {\r\n          msg = msg.c('opponentID').t(opponentId).up();\r\n        });\r\n        msg = msg.up();\r\n      } else if (typeof extension[field] === 'object') {\r\n        ChatHelpers._JStoXML(field, extension[field], msg);\r\n      } else {\r\n        msg = msg.c(field).t(extension[field]).up();\r\n      }\r\n    });\r\n    msg = msg.up();\r\n\r\n    this.signalingConnection.send(msg);\r\n  }\r\n}\r\n\r\nmodule.exports = WebRTCSignalingProvider;\r\n","const ConferenceSession = require('./cubeConferenceSession')\r\nconst {DEVICE_INPUT_TYPES, CALL_TYPES} = require('./cubeConferenceConstansts') \r\nconst {mediaDevices} = require('../cubeDependencies')\r\n\r\nclass ConferenceClient {\r\n\r\n  DEVICE_INPUT_TYPES = DEVICE_INPUT_TYPES\r\n  CALL_TYPES = CALL_TYPES\r\n\r\n  sessionsStore = {}\r\n\r\n  onParticipantJoinedListener\r\n  onParticipantLeftListener\r\n\r\n  onSlowLinkListener\r\n  onRemoteStreamListener\r\n  onRemoteConnectionStateChangedListener\r\n  onSessionConnectionStateChangedListener\r\n\r\n  createNewSession(confConfig) {\r\n    const session = new ConferenceSession(confConfig)\r\n\r\n    session.onParticipantJoinedListener = this.onParticipantJoinedListener\r\n    session.onParticipantLeftListener = this.onParticipantLeftListener\r\n\r\n    session.onSlowLinkListener = this.onSlowLinkListener\r\n    session.onRemoteStreamListener = this.onRemoteStreamListener\r\n    session.onRemoteConnectionStateChangedListener = this.onRemoteConnectionStateChangedListener\r\n    session.onSessionConnectionStateChangedListener = this.onSessionConnectionStateChangedListener\r\n\r\n    this.sessionsStore[session.id] = session\r\n\r\n    return session\r\n  }\r\n\r\n  async getMediaDevices(deviceInputType) {\r\n    const mediaDevices = await this._listDevices()\r\n    if (deviceInputType === DEVICE_INPUT_TYPES.VIDEO) {\r\n      return mediaDevices.filter(({kind}) => kind === DEVICE_INPUT_TYPES.VIDEO)\r\n    } else if (deviceInputType === DEVICE_INPUT_TYPES.AUDIO) {\r\n      return mediaDevices.filter(({kind}) => kind === DEVICE_INPUT_TYPES.AUDIO)\r\n    }\r\n    return mediaDevices\r\n  }\r\n\r\n  _listDevices() {\r\n    return mediaDevices.enumerateDevices()\r\n  }\r\n\r\n  clearSession(session_id)  {\r\n    delete this.sessionsStore[session_id]\r\n  }\r\n}\r\n\r\nmodule.exports = ConferenceClient","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunctionPrototype[toStringTagSymbol] =\n    GeneratorFunction.displayName = \"GeneratorFunction\";\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      prototype[method] = function(arg) {\n        return this._invoke(method, arg);\n      };\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      if (!(toStringTagSymbol in genFun)) {\n        genFun[toStringTagSymbol] = \"GeneratorFunction\";\n      }\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList),\n      PromiseImpl\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  Gp[toStringTagSymbol] = \"Generator\";\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n}\n","const Utils = require('../cubeInternalUtils');\r\nconst {mediaDevices} = require('../cubeDependencies')\r\nconst {Client: ClientJanusConf} = require('./cubeVideoCallingConference')\r\nconst {CALL_TYPES} = require('./cubeConferenceConstansts') \r\n\r\nclass ConferenceSession {\r\n\r\n  id\r\n\r\n  constructor(janusConfig) {\r\n    this.id = `${Math.random()}`\r\n    this._clientConf = new ClientJanusConf(janusConfig)\r\n    this._setOnParticipantJoinListener()\r\n    this._setOnParticipantLeftListener()\r\n    this._setOnRemoveStreamListener()\r\n  }\r\n\r\n  localStream\r\n\r\n  get currentRoomId() {\r\n    return this._clientConf.currentDialogId\r\n  }\r\n\r\n  set currentRoomId(roomId) {\r\n    return this._clientConf.currentDialogId = roomId\r\n  }\r\n\r\n  get currentPublisherPC() {\r\n    return this._clientConf.videoRoomPlugin.webrtcStuff.pc\r\n  }\r\n\r\n  onParticipantJoinedListener\r\n  onParticipantLeftListener\r\n\r\n  onSlowLinkListener\r\n  onRemoteStreamListener\r\n  onRemoteConnectionStateChangedListener\r\n  onSessionConnectionStateChangedListener\r\n\r\n  activeVideoDeviceId\r\n  activeAudioDeviceId\r\n\r\n  _createSession() {\r\n    return new Promise((resolve, reject) => {\r\n      this._clientConf.createSession({\r\n        success: resolve,\r\n        error: reject\r\n      })\r\n    })\r\n  }\r\n\r\n  // async joinAsPublisher(roomId, user_id) {\r\n  //   await this._createSession()\r\n  //   this.currentRoomId = roomId\r\n  //   await this._createPublisher(user_id)\r\n  // }\r\n\r\n  // async joinAsListener(roomId, user_id) {\r\n  //   await this._createSession()\r\n  //   this.currentRoomId = roomId\r\n  //   await this._createListener(user_id)\r\n  // }\r\n\r\n  async join(roomId, user_id) {\r\n    await this._createSession()\r\n    this.currentRoomId = roomId\r\n    await this._createPublisher(user_id)\r\n  }\r\n\r\n  async _createPublisher(user_id) {\r\n    await this._createHandler(false, null)\r\n    await this._join(this.currentRoomId, user_id)\r\n  }\r\n\r\n  async _createListener(user_id) {\r\n    await this._createHandler(true, user_id)\r\n  }\r\n\r\n  _createHandler(isRemote, user_id) {\r\n    return new Promise((resolve, reject) => {\r\n      this._clientConf.attachVideoConferencingPlugin(isRemote, user_id, {\r\n        success: resolve,\r\n        error: reject,\r\n        iceState: isRemote ?  this._onRemoteIceStateChanged.bind(this, user_id) : this._onLocalIceStateChanged,\r\n        slowLink: isRemote ?  this._onSlowLink.bind(this, user_id) : this._onSlowLink.bind(this, void 0),\r\n      }, this.localStream)\r\n    })\r\n  }\r\n\r\n  _join(roomId, user_id) {\r\n    return new Promise((resolve, reject) => {\r\n      this._clientConf.join(roomId, user_id, false, {\r\n        success: resolve,\r\n        error: reject\r\n      })\r\n    })\r\n  }\r\n\r\n  _setOnParticipantJoinListener() {\r\n    this._clientConf.on('participantjoined', this._onParticipantJoined)\r\n  }\r\n\r\n  _setOnParticipantLeftListener() {\r\n    this._clientConf.on('participantleft', this._onParticipantLeft)\r\n  }\r\n\r\n  _setOnRemoveStreamListener() {\r\n    this._clientConf.on('remotestream', this._onRemoteStream)\r\n  }\r\n\r\n  _onParticipantJoined = (user_id, userDisplayName) => {\r\n    this._createListener(user_id)\r\n    Utils.safeCallbackCall(this.onParticipantJoinedListener, this, user_id, userDisplayName)\r\n  }\r\n\r\n  _onParticipantLeft = (user_id, userDisplayName) => {\r\n    Utils.safeCallbackCall(this.onParticipantLeftListener, this, user_id, userDisplayName)\r\n  }\r\n\r\n  _onLocalIceStateChanged = (iceState) => {\r\n    Utils.safeCallbackCall(this.onSessionConnectionStateChangedListener, this, iceState)\r\n  }\r\n\r\n  _onRemoteIceStateChanged = (user_id, iceState) => {\r\n    Utils.safeCallbackCall(this.onRemoteConnectionStateChangedListener, this, user_id, iceState)\r\n  }\r\n\r\n  _onRemoteStream = (stream, user_id) => {\r\n    Utils.safeCallbackCall(this.onRemoteStreamListener, this, user_id, stream)\r\n  }\r\n\r\n  _onSlowLink = (user_id, uplink, nacks) => {\r\n    Utils.safeCallbackCall(this.onSlowLinkListener, this, user_id, uplink, nacks)\r\n  }\r\n\r\n  listOfOnlineParticipants() {\r\n    return new Promise((resolve, reject) => {\r\n      this._clientConf.listOnlineParticipants(this.currentRoomId, {\r\n        success: resolve,\r\n        error: reject\r\n      })\r\n    }) \r\n  }\r\n\r\n  async leave() {\r\n    await this._leaveGroup()\r\n    this.currentRoomId = void 0\r\n    await this._destroy()\r\n    this.localStream = void 0\r\n  }\r\n\r\n  _leaveGroup() {\r\n    return new Promise((resolve, reject) => {\r\n      this._clientConf.leave({\r\n        success: resolve,\r\n        error: reject\r\n      })\r\n    })\r\n  }\r\n\r\n  _destroy() {\r\n    return new Promise((resolve, reject) => {\r\n      this._clientConf.destroySession({\r\n        success: resolve,\r\n        error: reject\r\n      })\r\n    })\r\n  }\r\n\r\n  getUserMedia(mediaParams, updateCurrentStream) {\r\n    const elementId = mediaParams.elementId\r\n    delete mediaParams.elementId\r\n    const attachStreamOptions = mediaParams.options\r\n    delete mediaParams.options\r\n\r\n    let prevAudioMuteState, prevVideoMuteState;\r\n\r\n    if (updateCurrentStream) {\r\n      prevAudioMuteState = this.isAudioMuted()\r\n      prevVideoMuteState = this.isVideoMuted()\r\n      this.localStream.getTracks().forEach(track => {\r\n        track.stop()\r\n        this.localStream.removeTrack(track)\r\n      })\r\n    }\r\n    return mediaDevices.getUserMedia(mediaParams).then(stream => {\r\n      const newStreamTracks = stream.getTracks()\r\n      if (!updateCurrentStream) {\r\n        this.localStream = stream\r\n      }\r\n      this.activeAudioDeviceId = this.activeVideoDeviceId = void 0\r\n      newStreamTracks.forEach(track => {\r\n        const trackSetting = track.getSettings()\r\n        if (track.kind === CALL_TYPES.AUDIO) {\r\n          this.activeAudioDeviceId = trackSetting.deviceId\r\n          if (updateCurrentStream) {\r\n            track.enabled = !prevAudioMuteState\r\n          }\r\n        } else {\r\n          this.activeVideoDeviceId = trackSetting.deviceId\r\n          if (updateCurrentStream) {\r\n            track.enabled = !prevVideoMuteState\r\n          }\r\n        }\r\n        if (updateCurrentStream) {\r\n          this.localStream.addTrack(track)\r\n        }\r\n      })\r\n      if (elementId) {\r\n        this.attachMediaStream(mediaParams.elementId, this.localStream, attachStreamOptions);\r\n      }\r\n      return this.localStream\r\n    })\r\n  }\r\n\r\n  switchMediaTracks(constraints, elementId) {\r\n    if (constraints[CALL_TYPES.VIDEO]) {\r\n      return this._switchVideo(constraints[CALL_TYPES.VIDEO], elementId)\r\n    } else if (constraints[CALL_TYPES.AUDIO]) {\r\n      return this._switchAudio(constraints[CALL_TYPES.AUDIO], elementId)\r\n    }\r\n    return Promise.reject()\r\n  }\r\n\r\n  _switchVideo(mediaDeviceId, elementId) {\r\n    return this.updateLocalStream({\r\n      audio: true,\r\n      video: { deviceId: mediaDeviceId }\r\n    }, elementId)\r\n  }\r\n\r\n  _switchAudio(mediaDeviceId, elementId) {\r\n    return this.updateLocalStream({\r\n      audio: { deviceId: mediaDeviceId },\r\n      video: true\r\n    }, elementId)\r\n  }\r\n\r\n  updateLocalStream(mediaParams, elementId) {\r\n    return this._switchMediaTracks(mediaParams)\r\n    .then(newLocalStream => this.attachMediaStream(elementId, newLocalStream, {muted: true, mirror: true}))\r\n  }\r\n\r\n  _switchMediaTracks(mediaParams) {\r\n    return this.getUserMedia(mediaParams, true).then(newLocalStream => {\r\n      const newStreamTracks = newLocalStream.getTracks()\r\n      const pcSenders = this.currentPublisherPC.getSenders()\r\n      newStreamTracks.forEach(track => {\r\n        const sender = pcSenders.find(sender => track.kind === sender.track.kind)\r\n        sender.replaceTrack(track)\r\n      })\r\n      return this.localStream\r\n    })\r\n  }\r\n\r\n  muteVideo() {\r\n    if (!this.isVideoMuted()) {\r\n      this._clientConf.toggleVideoMute()\r\n    }\r\n  }\r\n\r\n  unmuteVideo() {\r\n    if (this.isVideoMuted()) {\r\n      this._clientConf.toggleVideoMute()\r\n    }\r\n  }\r\n\r\n  muteAudio() {\r\n    if (!this.isAudioMuted()) {\r\n      this._clientConf.toggleAudioMute()\r\n    }\r\n  }\r\n\r\n  unmuteAudio() {\r\n    if (this.isAudioMuted()) {\r\n      this._clientConf.toggleAudioMute()\r\n    }\r\n  }\r\n\r\n  isVideoMuted() {\r\n    return this._clientConf.isVideoMuted()\r\n  }\r\n\r\n  isAudioMuted() {\r\n    return this._clientConf.isAudioMuted()\r\n  }\r\n\r\n  attachMediaStream(id, stream, options) {\r\n    const elem = document.getElementById(id);\r\n\r\n    if (elem) {\r\n        if (typeof elem.srcObject === 'object') {\r\n            elem.srcObject = stream;\r\n        } else {\r\n            elem.src = window.URL.createObjectURL(stream);\r\n        }\r\n\r\n        if (options && options.muted) {\r\n            elem.muted = true;\r\n        }\r\n\r\n        if (options && options.mirror) {\r\n            elem.style.webkitTransform = 'scaleX(-1)';\r\n            elem.style.transform = 'scaleX(-1)';\r\n        }\r\n\r\n        elem.onloadedmetadata = function (e) {\r\n            elem.play();\r\n        };\r\n    } else {\r\n        throw new Error('Unable to attach media stream, element ' + id + ' is undefined');\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = ConferenceSession\r\n","var Janus = require('./janus.umd');\r\nvar Utils = require('../cubeInternalUtils');\r\nvar coreConfig = require('../cubeConfig');\r\nvar EventEmitter = require('fbemitter').EventEmitter;\r\nvar mediaDevices = require('../cubeDependencies').mediaDevices;\r\n\r\nvar EVENT_PARTICIPANT_JOINED = \"participantjoined\";\r\nvar EVENT_PARTICIPANT_LEFT = \"participantleft\";\r\nvar EVENT_LOCAL_STREAM = \"localstream\";\r\nvar EVENT_REMOTE_STREAM = \"remotestream\";\r\n\r\n\r\n/**\r\n * @class\r\n * @param {Object} configParams - a set of configuration parameters. The\r\n *  following parameters are applied:<br>\r\n * @param {String} configParams.server - (<b>required</b>) the address of the\r\n *  gateway as a specific address (e.g., http://yourserver:8088 to use\r\n *  the plain HTTP API or ws://yourserver:8188 for WebSockets).\r\n * @param {Boolean} configParams.debug - (<i>optional</i>) whether debug should\r\n *  be enabled on the JavaScript console (true/false). Default is true.\r\n * @throws \"'server' parameter is mandatory\" error if 'server' parameter is null\r\n *  or undefined.\r\n * @throws \"missing adapter.js\" error if the 'adapter.js' is not connected.\r\n */\r\nfunction VideoConferencingClient(configParams) {\r\n  if (!Utils.getEnv().reactnative && !adapter) {\r\n    throw \"Error: in order to use this library please connect adapter.js. More info https://github.com/webrtc/adapter\";\r\n  }\r\n\r\n  this.configs = configParams;\r\n  if (!this.configs.server) {\r\n    throw \"'server' parameter is mandatory.\";\r\n  } else {\r\n    if (this.configs.server.includes(\"http\")) {\r\n      this.configs.server = this.configs.server + \"/janus\";\r\n    }\r\n  }\r\n  if (!this.configs.debug) {\r\n    this.configs.debug = \"all\";\r\n  }\r\n\r\n  this.engine = null;\r\n  this.videoRoomPlugin = null;\r\n  this.isOnlyAudio = false;\r\n  //\r\n  this.currentDialogId = null;\r\n  this.remoteFeeds = [];\r\n  this.remoteJseps = [];\r\n  this.remoteFeedsAttachingInProgress = [];\r\n  //\r\n  this.currentMidiaDeviceId = null;\r\n  //\r\n  this.bitrateTimers = [];\r\n  //\r\n  this.emitter = new EventEmitter();\r\n}\r\n\r\n/**\r\n * Attach media stream to HTML 'video' element\r\n *\r\n * @static\r\n * @param {Object} element - HTML 'video' element\r\n * @param {Object} stream - WebRTC media stream\r\n */\r\nVideoConferencingClient.attachMediaStream = function (element, stream) {\r\n  Janus.attachMediaStream(element, stream);\r\n};\r\n\r\n/**\r\n *  Get plugged devices\r\n *\r\n * @static\r\n * @param {function} callback - a callback to be notified about result\r\n *  (with single argument - array of all devices).\r\n */\r\nVideoConferencingClient.listDevices = function (callback) {\r\n  mediaDevices.enumerateDevices().then(function (devices) {\r\n    console.debug(devices);\r\n    callback(devices);\r\n  }).catch(function (err) {\r\n    console.log('[VideoConferencingClient.listDevices][error]', err);\r\n    callback([]);\r\n  });;\r\n};\r\n\r\n/**\r\n *  Get plugged video input devices only\r\n *\r\n * @static\r\n * @param {function} callback - a callback to be notified about result\r\n *  (with single argument - array of video input devices).\r\n */\r\nVideoConferencingClient.listVideoinputDevices = function (callback) {\r\n  VideoConferencingClient.listDevices(function (devices) {\r\n    var videoSelect = [];\r\n    // code sample\r\n    // https://github.com/webrtc/samples/blob/gh-pages/src/content/devices/input-output/js/main.js#L27\r\n    for (var i = 0; i !== devices.length; ++i) {\r\n      var deviceInfo = devices[i];\r\n      if (deviceInfo.kind === 'videoinput') {\r\n        var videoinputDescription = deviceInfo.label || 'camera ' + (videoSelect.length + 1);\r\n        var videoinputId = deviceInfo.deviceId;\r\n        videoSelect.push({ \"label\": videoinputDescription, \"deviceId\": videoinputId });\r\n      }\r\n    }\r\n    callback(videoSelect);\r\n  });\r\n};\r\n\r\nVideoConferencingClient.prototype = {\r\n\r\n  /**\r\n   * Create video session\r\n   *\r\n   * @param {Object} callbacks - a set of callbacks to be notified about result,\r\n   *  namely:<br>\r\n   * @param {function} callbacks.success - the session was successfully created\r\n   *  and is ready to be used.\r\n   * @param {function} callbacks.error - the session was NOT successfully\r\n   *  created. This callback passes single argument - text description of error.\r\n   * @param {function} callbacks.destroyed - the session was destroyed and\r\n   *  can't be used any more.\r\n   */\r\n  createSession: function (callbacks) {\r\n    var self = this;\r\n\r\n    Janus.init({\r\n      debug: this.configs.debug, callback: function () {\r\n\r\n        if (!Janus.isWebrtcSupported()) {\r\n          if (typeof callbacks.error === 'function') {\r\n            callbacks.error(\"Your browser does not support WebRTC, so you can't use this functionality.\");\r\n          }\r\n          return;\r\n        }\r\n\r\n        self.engine = new Janus({\r\n          server: self.configs.server,\r\n          iceServers: coreConfig.videochat.iceServers,\r\n\r\n          success: function () {\r\n            if (typeof callbacks.success === 'function') {\r\n              Utils.safeCallbackCall(callbacks.success);\r\n            }\r\n          },\r\n          error: function (error) {\r\n            if (typeof callbacks.error === 'function') {\r\n              Utils.safeCallbackCall(callbacks.error, error);\r\n            }\r\n          },\r\n          destroyed: function () {\r\n            if (typeof callbacks.destroyed === 'function') {\r\n              Utils.safeCallbackCall(callbacks.destroyed);\r\n            }\r\n          },\r\n          timeoutSessionCallback: function () {\r\n            if (typeof callbacks.timeoutSessionCallback === 'function') {\r\n              Utils.safeCallbackCall(callbacks.timeoutSessionCallback);\r\n            }\r\n          }\r\n        });\r\n\r\n      }\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Returns the unique session identifier\r\n   *\r\n   * @returns {String} unique session identifier or null.\r\n   */\r\n  getSessionId: function () {\r\n    if (this.engine) {\r\n      return this.engine.getSessionId();\r\n    }\r\n    return null;\r\n  },\r\n\r\n  /**\r\n   * Destroy video session\r\n   *\r\n   * @param {Object} callbacks - a set of callbacks to be notified about\r\n   *  result, namely:<br>\r\n   * @param {function} callbacks.success - the session was successfully\r\n   *  destroyed and no longer available.\r\n   * @param {function} callbacks.error - the session was NOT successfully\r\n   *  destroyed. This callback passes single argument - text description\r\n   *  of error.\r\n   */\r\n  destroySession: function (callbacks) {\r\n    var self = this;\r\n    this.engine.destroy({});\r\n\r\n    if (typeof callbacks.success === 'function') {\r\n      Utils.safeCallbackCall(callbacks.success);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Сreate a video conferencing plugin handle.\r\n   *\r\n   * @param  {Boolean} isRemote  To pass 'false' when you attach plugin to\r\n   *  current user and pass 'true' when attach to remote user.\r\n   * @param  {Number}  userId  To pass 'null' when you attach plugin to\r\n   *  current user and pass remote user id when attach to remote user.\r\n   * @param {Object} callbacks - a set of callbacks to be notified about\r\n   *  result, namely:<br>\r\n   * @param {function} callbacks.success - the handle was successfully\r\n   *  created and is ready to be used.\r\n   * @param {function} callbacks.error - the handle was NOT successfully\r\n   *  created or some error has occured. The format of error is the following:\r\n   *  {\"error_code\": \"some integer code\", \"error\": \"some text description\"}.\r\n   *  Possible values of 'error_code': <br>\r\n   * <ul>\r\n   * <li>428: No such feed - can happen when a user joins room and quickly\r\n   * leaves it so other user tries to subscribe to none existend feed.\r\n   * Usually, this error can be ignored.</li>\r\n   * <li>433: Unauthorized - do not have proper rights to join this room.</li>\r\n   * <li>436: User ID already exists in this room.</li>\r\n   * <li>400: Some not usual error occured, for example - no connection to\r\n   *  server. </li>\r\n   * </ul>\r\n   *\r\n   * @param {function} callbacks.consentDialog - this callback is triggered\r\n   *  just before <b>getUserMedia</b> is called (parameter=<b>true</b>) and\r\n   *  after it is completed (parameter=<b>false</b>); this means it can be\r\n   *  used to modify the UI accordingly, e.g., to prompt the user about the\r\n   *  need to accept the device access consent requests.\r\n   * @param {function} callbacks.mediaState - this callback is triggered\r\n   *  when server starts or stops receiving your media: for instance,\r\n   *  a <b>mediaState</b> with type=audio and on=true means server started\r\n   *  receiving your audio stream (or started getting them again after\r\n   *  a pause of more than a second); a mediaState with type=video\r\n   *  and on=false means server hasn't received any video from you in the\r\n   *  last second, after a start was detected before; useful to figure out\r\n   *  when server actually started handling your media, or to detect problems\r\n   *  on the media path (e.g., media never started, or stopped at some time).\r\n   * @param {function} callbacks.webrtcState - this callback is triggered\r\n   *  with a <b>true</b> value when the PeerConnection associated to a handle\r\n   *  becomes active (so ICE, DTLS and everything else succeeded) from\r\n   *  the library perspective, while <b>false</b> is triggered when\r\n   *  the PeerConnection goes down instead; useful to figure out when WebRTC\r\n   *  is actually up and running between you and server (e.g., to notify\r\n   *  a user they're actually now active in a conference).\r\n   * @param {function} callbacks.slowLink - this callback is triggered when\r\n   *  server reports trouble either sending or receiving media on the\r\n   *  specified PeerConnection, typically as a consequence of too many NACKs\r\n   *  received from/sent to the user in the last second: for instance,\r\n   *  a slowLink with uplink=true means you notified several missing packets\r\n   *  from server, while uplink=false means server is not receiving all your\r\n   *  packets; useful to figure out when there are problems on the media\r\n   *  path (e.g., excessive loss), in order to possibly react accordingly\r\n   *  (e.g., decrease the bitrate if most of our packets are getting lost).\r\n   * @param {function} callbacks.oncleanup - the WebRTC PeerConnection with\r\n   *  the plugin was closed.\r\n   */\r\n  attachVideoConferencingPlugin: function (isRemote, userId, callbacks, localStream) {\r\n    var self = this;\r\n    var remoteFeed = null;\r\n\r\n    this.engine.attach({\r\n      plugin: \"janus.plugin.videoroom\",\r\n      success: function (pluginHandle) {\r\n        if (isRemote) {\r\n          remoteFeed = pluginHandle;\r\n          remoteFeed.userId = userId;\r\n          self.remoteFeedsAttachingInProgress[userId] = remoteFeed;\r\n\r\n          // join remote's feed (listen)\r\n          var listen = {\r\n            \"request\": \"join\", \"room\": self.currentDialogId,\r\n            \"ptype\": \"listener\", \"feed\": userId\r\n          };\r\n\r\n          // If the publisher is VP8 and this is Safari, let's avoid video\r\n          // if (!Utils.getEnv().reactnative && adapter.browserDetails.browser === \"safari\") {\r\n          //   listen[\"offer_video\"] = true;\r\n          // }\r\n\r\n          remoteFeed.send({ \"message\": listen });\r\n        } else {\r\n          self.videoRoomPlugin = pluginHandle;\r\n        }\r\n\r\n        if (typeof callbacks.success === 'function') {\r\n          Utils.safeCallbackCall(callbacks.success);\r\n        }\r\n      },\r\n      error: function (error) {\r\n        if (typeof callbacks.error === 'function') {\r\n          Utils.safeCallbackCall(callbacks.error, error);\r\n        }\r\n      },\r\n      consentDialog: function (on) {\r\n        if (typeof callbacks.consentDialog === 'function') {\r\n          Utils.safeCallbackCall(callbacks.consentDialog, on);\r\n        }\r\n      },\r\n      mediaState: function (medium, on) {\r\n        if (typeof callbacks.mediaState === 'function') {\r\n          Utils.safeCallbackCall(callbacks.mediaState, medium, on);\r\n        }\r\n      },\r\n      webrtcState: function (on) {\r\n        if (typeof callbacks.webrtcState === 'function') {\r\n          Utils.safeCallbackCall(callbacks.webrtcState, on);\r\n        }\r\n      },\r\n      slowLink: function (uplink, nacks) {\r\n        if (typeof callbacks.slowLink === 'function') {\r\n          Utils.safeCallbackCall(callbacks.slowLink, uplink, nacks);\r\n        }\r\n      },\r\n      iceState: function (iceConnectionState) {\r\n        if (typeof callbacks.iceState === 'function') {\r\n          Utils.safeCallbackCall(callbacks.iceState, iceConnectionState);\r\n        }\r\n      },\r\n      onmessage: function (msg, jsep) {\r\n        var event = msg[\"videoroom\"];\r\n\r\n        // remote feed\r\n        if (isRemote) {\r\n          if (event) {\r\n            // Remote feed attached\r\n            if (event === \"attached\") {\r\n              var feedId = msg[\"id\"];\r\n              self.remoteFeeds[feedId] = self.remoteFeedsAttachingInProgress[feedId];\r\n              self.remoteFeedsAttachingInProgress[feedId] = null;\r\n            } else if (msg[\"error\"]) {\r\n              // #define VIDEOROOM_ERROR_NO_SUCH_FEED\t\t428\r\n              //\r\n              if (typeof callbacks.error === 'function') {\r\n                Utils.safeCallbackCall(callbacks.error, msg[\"error\"]);\r\n              }\r\n            }\r\n          }\r\n\r\n          if (jsep) {\r\n            var feedId = msg[\"id\"];\r\n\r\n            // ICE restart case\r\n            if (!feedId) {\r\n            }\r\n\r\n            self.remoteJseps[feedId] = jsep;\r\n\r\n            self.createAnswer({\r\n              remoteFeed: self.remoteFeeds[feedId], \r\n              jsep,\r\n              stream: localStream\r\n            }, {\r\n              success: function () {\r\n\r\n              },\r\n              error: function (error) {\r\n                if (typeof callbacks.error === 'function') {\r\n                  Utils.safeCallbackCall(callbacks.error, error);\r\n                }\r\n              }\r\n            });\r\n          }\r\n\r\n          // local feed\r\n        } else {\r\n          if (event) {\r\n            // We JOINED\r\n            if (event === \"joined\") {\r\n              self.createOffer({ useAudio: true, stream: localStream, useVideo: !self.isOnlyAudio }, {\r\n                success: function () {\r\n                  // Any new feed to attach to?\r\n                  if (msg[\"publishers\"]) {\r\n                    var publishers = msg[\"publishers\"];\r\n                    for (var f in publishers) {\r\n                      var userId = publishers[f][\"id\"];\r\n                      var userDisplayName = publishers[f][\"display\"];\r\n                      self.emitter.emit(EVENT_PARTICIPANT_JOINED, userId, userDisplayName);\r\n                    }\r\n                  }\r\n                },\r\n                error: function (error) {\r\n                  if (typeof callbacks.error === 'function') {\r\n                    Utils.safeCallbackCall(callbacks.error, error);\r\n                  }\r\n                }\r\n              });\r\n\r\n              // We JOINED and now receiving who is online\r\n            } else if (event === \"event\") {\r\n              // Any new feed to attach to?\r\n              if (msg[\"publishers\"]) {\r\n                var publishers = msg[\"publishers\"];\r\n\r\n                for (var f in publishers) {\r\n                  var userId = publishers[f][\"id\"];\r\n                  var userDisplayName = publishers[f][\"display\"];\r\n\r\n                  self.emitter.emit(EVENT_PARTICIPANT_JOINED, userId, userDisplayName);\r\n                }\r\n\r\n                // Someone is LEAVING\r\n              } else if (msg[\"leaving\"]) {\r\n                // One of the publishers has gone away?\r\n                var feedId = msg[\"leaving\"];\r\n                var success = self.detachRemoteFeed(feedId);\r\n                if (success) {\r\n                  self.emitter.emit(EVENT_PARTICIPANT_LEFT, feedId, null);\r\n                }\r\n\r\n              } else if (msg[\"unpublished\"]) {\r\n\r\n                // One of the publishers has gone away?\r\n                var feedId = msg[\"unpublished\"];\r\n                if (feedId != 'ok') {\r\n                  var success = self.detachRemoteFeed(feedId);\r\n                  if (success) {\r\n                    self.emitter.emit(EVENT_PARTICIPANT_LEFT, feedId, null);\r\n                  }\r\n                }\r\n\r\n              } else if (msg[\"error\"]) {\r\n                // #define VIDEOROOM_ERROR_ID_EXISTS\t\t\t436\r\n                // #define VIDEOROOM_ERROR_UNAUTHORIZED\t\t433\r\n                //\r\n                if (typeof callbacks.error === 'function') {\r\n                  Utils.safeCallbackCall(callbacks.error, msg[\"error\"]);\r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n          if (jsep) {\r\n            self.videoRoomPlugin.handleRemoteJsep({ jsep: jsep });\r\n\r\n            // TODO:\r\n            // handle wrong or unsupported codecs here...\r\n            // var video = msg[\"video_codec\"];\r\n            // if(mystream && mystream.getVideoTracks() && mystream.getVideoTracks().length > 0 && !video) {\r\n            // \t\t\"Our video stream has been rejected, viewers won't see us\";\r\n            // }\r\n\r\n          }\r\n\r\n        }\r\n      },\r\n      onlocalstream: function (stream) {\r\n        self.emitter.emit(EVENT_LOCAL_STREAM, stream);\r\n      },\r\n      onremotestream: function (stream) {\r\n        remoteFeed.stream = stream;\r\n\r\n        self.emitter.emit(EVENT_REMOTE_STREAM, stream, remoteFeed.userId);\r\n      },\r\n      oncleanup: function () {\r\n        console.info(\"ON CLEANUP\");\r\n        if (typeof callbacks.oncleanup === 'function') {\r\n          Utils.safeCallbackCall(callbacks.oncleanup);\r\n        }\r\n      },\r\n      detached: function () {\r\n\r\n      }\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Returns the unique plugin identifier\r\n   *\r\n   * @returns {String} unique plugin identifier or null.\r\n   */\r\n  getPluginId: function () {\r\n    if (this.videoRoomPlugin) {\r\n      return this.videoRoomPlugin.getId();\r\n    }\r\n    return null;\r\n  },\r\n\r\n  /**\r\n   * Detach a video conferencing plugin handle.\r\n   *\r\n   * @param {Object} callbacks - a set of callbacks to be notified about\r\n   *  result, namely:<br>\r\n   * @param {function} callbacks.success - the handle was successfully\r\n   *  destroyed.\r\n   * @param {function} callbacks.error - the handle was NOT successfully\r\n   *  destroyed. This callback passes single argument - text description\r\n   *  of error.\r\n   */\r\n  detachVideoConferencingPlugin: function (callbacks) {\r\n    var self = this;\r\n\r\n    var clean = function () {\r\n      self.videoRoomPlugin = null;\r\n\r\n      // detach all remote feeds\r\n      Object.keys(self.remoteFeeds).forEach(function (userId) {\r\n        self.detachRemoteFeed(userId);\r\n      });\r\n\r\n      self.remoteFeeds = [];\r\n      self.remoteJseps = [];\r\n\r\n      self.currentMidiaDeviceId = null;\r\n    };\r\n\r\n    this.videoRoomPlugin.detach({\r\n      success: function () {\r\n        clean();\r\n\r\n        if (typeof callbacks.success === 'function') {\r\n          Utils.safeCallbackCall(callbacks.success);\r\n        }\r\n      },\r\n      error: function (error) {\r\n        clean();\r\n\r\n        if (typeof callbacks.error === 'function') {\r\n          Utils.safeCallbackCall(callbacks.error, error);\r\n        }\r\n      },\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Join video conference room\r\n   *\r\n   * @param {String} chatDialogId - a chat dialog ID to join\r\n   * @param {Number} userId - an id of current user.\r\n   * @param {Boolean} isOnlyAudio - to join current room as audio-only.\r\n   * @param {Object} callbacks - a set of callbacks to be notified about\r\n   *  result, namely:<br>\r\n   * @param {function} callbacks.success - the chat dialog was successfully\r\n   *  joined.\r\n   * @param {function} callbacks.error - the chat dialog was NOT successfully\r\n   *  joined. This callback passes single argument - text description\r\n   *  of error.\r\n   */\r\n  join: function (chatDialogId, userId, isOnlyAudio, callbacks) {\r\n    var self = this;\r\n\r\n    if (typeof (isOnlyAudio) !== \"boolean\") {\r\n      throw \"'isOnlyAudio' parameter can be of type 'boolean' only.\";\r\n    }\r\n    self.isOnlyAudio = isOnlyAudio;\r\n    // if (!Utils.getEnv().reactnative && adapter.browserDetails.browser === \"safari\") {\r\n    //   self.isOnlyAudio = false;\r\n    // }\r\n\r\n    console.info(\"isOnlyAudio: \" + self.isOnlyAudio);\r\n\r\n    var joinEvent = {\r\n      \"request\": \"join\", \"room\": chatDialogId,\r\n      \"ptype\": \"publisher\", \"id\": userId\r\n    }; //\"display\": null\r\n    this.videoRoomPlugin.send({\r\n      \"message\": joinEvent,\r\n      success: function (resp) {\r\n        self.currentDialogId = chatDialogId;\r\n        self.currentUserId = userId;\r\n\r\n        if (typeof callbacks.success === 'function') {\r\n          Utils.safeCallbackCall(callbacks.success);\r\n        }\r\n      },\r\n      error: function (error) {\r\n        if (typeof callbacks.error === 'function') {\r\n          Utils.safeCallbackCall(callbacks.error, error);\r\n        }\r\n      }\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Leave video conference room\r\n   *\r\n   * @param {Object} callbacks - a set of callbacks to be notified about\r\n   *  result, namely:<br>\r\n   * @param {function} callbacks.success - the chat dialog was successfully\r\n   *  left.\r\n   * @param {function} callbacks.error - the chat dialog was NOT successfully\r\n   *  left. This callback passes single argument - text description of error.\r\n   */\r\n  leave: function (callbacks) {\r\n    var self = this;\r\n\r\n    console.warn(\"leave\");\r\n\r\n    if (!self.engine.isConnected()) {\r\n      if (typeof callbacks.success === 'function') {\r\n        Utils.safeCallbackCall(callbacks.success);\r\n      }\r\n      return;\r\n    }\r\n\r\n    var leaveEvent = { \"request\": \"leave\", \"room\": this.currentDialogId, \"id\": this.currentUserId };\r\n    if (this.videoRoomPlugin) {\r\n      this.videoRoomPlugin.send({ \"message\": leaveEvent });\r\n    }\r\n    this.currentDialogId = null;\r\n    this.currentUserId = null;\r\n\r\n    console.warn(\"resp\");\r\n    if (typeof callbacks.success === 'function') {\r\n      Utils.safeCallbackCall(callbacks.success);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * List online participants\r\n   *\r\n   * @param {String} chatDialogId - a chat dialog ID to list online\r\n   *  participants in.\r\n   * @param {Object} callbacks - a set of callbacks to be notified about\r\n   *  result, namely:<br>\r\n   * @param {function} callbacks.success - when everything is ok and you will\r\n   *  receive one argument - array of online participants.\r\n   * @param {function} callbacks.error - when an error occured. This callback\r\n   *  passes single argument - text description of error.\r\n   */\r\n  listOnlineParticipants: function (chatDialogId, callbacks) {\r\n    var listRequest = { \"request\": \"listparticipants\", \"room\": chatDialogId };\r\n    //\r\n    this.videoRoomPlugin.send({\r\n      \"message\": listRequest,\r\n      success: function (data) {\r\n        var participants = [];\r\n        if (data) {\r\n          participants = data.participants;\r\n        }\r\n        if (typeof callbacks.success === 'function') {\r\n          Utils.safeCallbackCall(callbacks.success, participants);\r\n        }\r\n      },\r\n      error: function (error) {\r\n        if (typeof callbacks.error === 'function') {\r\n          Utils.safeCallbackCall(callbacks.error, error);\r\n        }\r\n      }\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Toggle audio mute.\r\n   *\r\n   * @returns {Boolean} true if audio is muted, otherwise - false.\r\n   */\r\n  toggleAudioMute: function () {\r\n    var muted = this.videoRoomPlugin.isAudioMuted();\r\n    if (muted) {\r\n      this.videoRoomPlugin.unmuteAudio();\r\n    } else {\r\n      this.videoRoomPlugin.muteAudio();\r\n    }\r\n    return this.videoRoomPlugin.isAudioMuted();\r\n  },\r\n\r\n  /**\r\n   * Is audio muted.\r\n   *\r\n   * @returns {Boolean} true if audio is muted, otherwise - false.\r\n   */\r\n  isAudioMuted: function () {\r\n    return this.videoRoomPlugin.isAudioMuted();\r\n  },\r\n\r\n  /**\r\n   * Toggle remote user audio mute.\r\n   *\r\n   * @param {Number} userId - an id of user to mute audio.\r\n   *\r\n   * @returns {Boolean} true if audio is muted, otherwise - false.\r\n   */\r\n  toggleRemoteAudioMute: function (userId) {\r\n    var remoteFeed = this.remoteFeeds[userId];\r\n    if (!remoteFeed) {\r\n      return false;\r\n    }\r\n\r\n    var audioTracks = remoteFeed.stream.getAudioTracks();\r\n    if (audioTracks && audioTracks.length > 0) {\r\n      for (var i = 0; i < audioTracks.length; ++i) {\r\n        audioTracks[i].enabled = !audioTracks[i].enabled;\r\n      }\r\n      return !audioTracks[0].enabled;\r\n    }\r\n\r\n    return false;\r\n  },\r\n\r\n  /**\r\n   * Is remote audio muted.\r\n   *\r\n   * @param {Number} userId - an id of user to check audio mute\r\n   *  state.\r\n   *\r\n   * @returns {Boolean} true if audio is muted, otherwise - false.\r\n   */\r\n  isRemoteAudioMuted: function (userId) {\r\n    var remoteFeed = this.remoteFeeds[userId];\r\n    if (!remoteFeed) {\r\n      return false;\r\n    }\r\n\r\n    var audioTracks = remoteFeed.stream.getAudioTracks();\r\n    if (audioTracks && audioTracks.length > 0) {\r\n      return !audioTracks[0].enabled;\r\n    }\r\n\r\n    return false;\r\n  },\r\n\r\n  /**\r\n   * Toggle video mute.\r\n   *\r\n   * @returns {Boolean} true if video is muted, otherwise - false.\r\n   */\r\n  toggleVideoMute: function () {\r\n    var muted = this.videoRoomPlugin.isVideoMuted();\r\n    if (muted) {\r\n      this.videoRoomPlugin.unmuteVideo();\r\n    } else {\r\n      this.videoRoomPlugin.muteVideo();\r\n    }\r\n    return this.videoRoomPlugin.isVideoMuted();\r\n  },\r\n\r\n  /**\r\n   * Is video muted.\r\n   *\r\n   * @returns {Boolean} true if video is muted, otherwise - false.\r\n   */\r\n  isVideoMuted: function () {\r\n    return this.videoRoomPlugin.isVideoMuted();\r\n  },\r\n\r\n  /**\r\n   * Toggle remote user video mute.\r\n   *\r\n   * @param {Number} userId - an id of user to mute video.\r\n   *\r\n   * @returns {Boolean} true if video is muted, otherwise - false.\r\n   */\r\n  toggleRemoteVideoMute: function (userId) {\r\n    var remoteFeed = this.remoteFeeds[userId];\r\n    if (!remoteFeed) {\r\n      return false;\r\n    }\r\n\r\n    var videoTracks = remoteFeed.stream.getVideoTracks();\r\n    if (videoTracks && videoTracks.length > 0) {\r\n      for (var i = 0; i < videoTracks.length; ++i) {\r\n        videoTracks[i].enabled = !videoTracks[i].enabled;\r\n      }\r\n      return !videoTracks[0].enabled;\r\n    }\r\n\r\n    return false;\r\n  },\r\n\r\n  /**\r\n   * Is remote video muted.\r\n   *\r\n   * @param {Number} userId - an id of user to check video mute\r\n   *  state.\r\n   *\r\n   * @returns {Boolean} true if video is muted, otherwise - false.\r\n   */\r\n  isRemoteVideoMuted: function (userId) {\r\n    var remoteFeed = this.remoteFeeds[userId];\r\n    if (!remoteFeed) {\r\n      return false;\r\n    }\r\n\r\n    var videoTracks = remoteFeed.stream.getVideoTracks();\r\n    if (videoTracks && videoTracks.length > 0) {\r\n      return !videoTracks[0].enabled;\r\n    }\r\n\r\n    return false;\r\n  },\r\n\r\n  /**\r\n   * Switch video input source.\r\n   *\r\n   * @param {String} mediaDeviceId - an id of media device (camera) to switch to.\r\n   *  Can be obtained via 'VideoConferencingClient.listVideoinputDevices'.\r\n   * @param {Object} callbacks - a set of callbacks to be notified about\r\n   *  result, namely:<br>\r\n   * @param {function} callbacks.success - when everything is ok.\r\n   * @param {function} callbacks.error - when an error occured. This callback\r\n   *  passes single argument - text description of error.\r\n   */\r\n  switchVideoinput: function (mediaDeviceId, callbacks) {\r\n\r\n    if (!this.videoRoomPlugin) {\r\n      if (typeof callbacks.error === 'function') {\r\n        Utils.safeCallbackCall(callbacks.error, \"No active stream\");\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (this.isOnlyAudio) {\r\n      throw \"Can't switch video input in audio only call.\";\r\n    }\r\n\r\n    this.currentMidiaDeviceId = null;\r\n\r\n    var self = this;\r\n\r\n    this.createOffer({ video: { deviceId: mediaDeviceId }, replaceVideo: true }, {\r\n      success: function () {\r\n        console.info(\"switchVideoinput: success\");\r\n\r\n        self.currentMidiaDeviceId = mediaDeviceId;\r\n\r\n        if (typeof callbacks.success === 'function') {\r\n          Utils.safeCallbackCall(callbacks.success);\r\n        }\r\n      },\r\n      error: function (error) {\r\n        console.info(\"switchVideoinput: error\", error);\r\n\r\n        if (typeof callbacks.error === 'function') {\r\n          Utils.safeCallbackCall(callbacks.error, error);\r\n        }\r\n      }\r\n    });\r\n  },\r\n\r\n  switchAudioinput: function (mediaDeviceId, callbacks) {\r\n\r\n    if (!this.videoRoomPlugin) {\r\n      if (typeof callbacks.error === 'function') {\r\n        Utils.safeCallbackCall(callbacks.error, \"No active stream\");\r\n      }\r\n      return;\r\n    }\r\n\r\n    this.createOffer({ audio: { deviceId: mediaDeviceId }, replaceAudio: true }, {\r\n      success: function () {\r\n        console.info(\"switchVideoinput: success\");\r\n\r\n        if (typeof callbacks.success === 'function') {\r\n          Utils.safeCallbackCall(callbacks.success);\r\n        }\r\n      },\r\n      error: function (error) {\r\n        console.info(\"switchVideoinput: error\", error);\r\n\r\n        if (typeof callbacks.error === 'function') {\r\n          Utils.safeCallbackCall(callbacks.error, error);\r\n        }\r\n      }\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Initiate ICE restart for remote peer.\r\n   * These are typically needed whenever something in your network changes\r\n   * (e.g., you move from WiFi to mobile or a different WiFi) but want to\r\n   * keep the conversation going: in this case, an ICE restart needs to take\r\n   * place, as the peers need to exchange the new candidates they can be\r\n   * reached on.\r\n   *\r\n   * @param {Number} userIdOrCallbacks - an id of user to initiate ICE restart with or callbacks if it's a local peer.\r\n   * @param {function} callbacks.success - when everything is ok.\r\n   * @param {function} callbacks.error - when an error occured. This callback\r\n   *  passes single argument - text description of error.\r\n   */\r\n  iceRestart: function (userIdOrCallbacks, callbacks) {\r\n    // remote ICE restart\r\n    if (callbacks) {\r\n      console.info(\"Performing remote ICE restart for user: \", userIdOrCallbacks);\r\n\r\n      var remoteFeed = this.remoteFeeds[userIdOrCallbacks];\r\n\r\n      if (!remoteFeed) {\r\n        if (typeof callbacks.error === 'function') {\r\n          Utils.safeCallbackCall(callbacks.error, \"No such user feed\");\r\n        }\r\n        return;\r\n      }\r\n\r\n      var req = { \"request\": \"configure\", \"restart\": true };\r\n      remoteFeed.send({ \"message\": req });\r\n\r\n      if (typeof callbacks.success === 'function') {\r\n        Utils.safeCallbackCall(callbacks.success);\r\n      }\r\n\r\n      // local ICE restart\r\n    } else {\r\n      console.info(\"Performing local ICE restart\");\r\n\r\n      this.createOffer({ iceRestart: true }, {\r\n        success: function () {\r\n          if (typeof userIdOrCallbacks.success === 'function') {\r\n            Utils.safeCallbackCall(userIdOrCallbacks.success);\r\n          }\r\n        },\r\n        error: function (error) {\r\n          if (typeof userIdOrCallbacks.error === 'function') {\r\n            Utils.safeCallbackCall(userIdOrCallbacks.error, error);\r\n          }\r\n        }\r\n      });\r\n    }\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  createOffer: function (inputParams, callbacks) {\r\n    console.log(\"createOffer, inputParams: \", inputParams);\r\n    var self = this;\r\n\r\n    var useAudio = inputParams.useAudio;\r\n    var useVideo = inputParams.useVideo;\r\n\r\n    var stream = inputParams.stream;\r\n    delete inputParams.stream;\r\n\r\n    var replaceVideo = inputParams.replaceVideo;\r\n    var iceRestart = inputParams.iceRestart;\r\n\r\n    var videoQuality = self.configs.video ? self.configs.video.quality : null;\r\n    var videoFrameRate = self.configs.video ? self.configs.video.frameRate : null;\r\n\r\n    var params;\r\n    if (stream) {\r\n      params = { stream: stream };\r\n    } else if (replaceVideo) {\r\n      params = { media: inputParams };\r\n      if (videoQuality) {\r\n        params[\"media\"][\"video\"] = videoQuality;\r\n      }\r\n      if (videoFrameRate) {\r\n        params[\"media\"][\"videoFrameRate\"] = { min: videoFrameRate, max: videoFrameRate }\r\n      }\r\n    } else if (iceRestart) {\r\n      params = inputParams;\r\n    } else {\r\n      params = {\r\n        media: {\r\n          audioRecv: false,\r\n          videoRecv: false,\r\n          audioSend: useAudio,\r\n          videoSend: useVideo\r\n        }\r\n      }; // Publishers are sendonly\r\n      if (videoQuality) {\r\n        params[\"media\"][\"video\"] = videoQuality;\r\n      }\r\n      if (videoFrameRate) {\r\n        params[\"media\"][\"videoFrameRate\"] = { min: videoFrameRate, ideal: videoFrameRate }\r\n      }\r\n    }\r\n\r\n    console.info(\"createOffer params: \", params);\r\n\r\n    params.success = function (jsep) {\r\n      var publish = { \"request\": \"configure\" };\r\n      if (replaceVideo || iceRestart) {\r\n        // publish[\"update\"] = true;\r\n      } else {\r\n        publish[\"audio\"] = useAudio;\r\n        publish[\"video\"] = useVideo;\r\n      }\r\n      console.info(\"createOffer publish: \", publish);\r\n\r\n      self.videoRoomPlugin.send({ \"message\": publish, \"jsep\": jsep });\r\n\r\n      if (typeof callbacks.success === 'function') {\r\n        callbacks.success();\r\n      }\r\n    };\r\n\r\n    params.error = function (error) {\r\n      console.log(\"[createOffer] Error in createOffer: \", error);\r\n      if (useAudio) {\r\n        self.createOffer({ useAudio: false, useVideo: false }, callbacks);\r\n      } else {\r\n        if (typeof callbacks.error === 'function') {\r\n          callbacks.error(error);\r\n        }\r\n      }\r\n    };\r\n\r\n    this.videoRoomPlugin.createOffer(params);\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  createAnswer: function ({remoteFeed, jsep, stream}, callbacks) {\r\n    var self = this;\r\n\r\n    remoteFeed.createAnswer({\r\n      jsep: jsep,\r\n      stream,\r\n      media: { audioSend: false, videoSend: false },\t// We want recvonly audio/video\r\n      success: function (jsep) {\r\n        var body = { \"request\": \"start\", \"room\": self.currentDialogId };\r\n        remoteFeed.send({ \"message\": body, \"jsep\": jsep });\r\n\r\n        if (typeof callbacks.success === 'function') {\r\n          Utils.safeCallbackCall(callbacks.success);\r\n        }\r\n      },\r\n      error: function (error) {\r\n        console.log(\"[createAnswer] error: \", error);\r\n        if (typeof callbacks.error === 'function') {\r\n          Utils.safeCallbackCall(callbacks.error, error);\r\n        }\r\n      }\r\n    });\r\n  },\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  detachRemoteFeed: function (userId) {\r\n    var remoteFeed = this.remoteFeeds[userId];\r\n    if (remoteFeed) {\r\n      remoteFeed.detach();\r\n      this.remoteFeeds[userId] = null;\r\n      this.remoteJseps[userId] = null;\r\n      return true;\r\n    }\r\n    return false;\r\n  },\r\n\r\n  /**\r\n   * Start show a verbose description of the user's stream bitrate.\r\n   * Refresh it every 1 second.\r\n   *\r\n   * @param {Number} userId - an id of user to gets stream bitrate.\r\n   * @param {Object} element - DOM element to display bitrate on.\r\n   */\r\n  showBitrate: function (userId, element) {\r\n    var remoteFeed = this.remoteFeeds[userId];\r\n\r\n    if (!Utils.getEnv().reactnative && (adapter.browserDetails.browser === \"chrome\" || adapter.browserDetails.browser === \"firefox\")) {\r\n      this.bitrateTimers[userId] = setInterval(function () {\r\n        var bitrate = remoteFeed.getBitrate();\r\n        element.text(bitrate);\r\n      }, 1000);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Stop show a verbose description of the user's stream bitrate.\r\n   *\r\n   * @param {Number} userId - an id of user to stop show stream\r\n   * bitrate.\r\n   * @param {Object} element - DOM element to stop display bitrate on.\r\n   */\r\n  hideBitrate: function (userId, element) {\r\n    if (this.bitrateTimers[userId]) {\r\n      clearInterval(this.bitrateTimers[userId]);\r\n    }\r\n    this.bitrateTimers[userId] = null;\r\n    element.text = null;\r\n  },\r\n\r\n  /**\r\n   * Adds a listener to be invoked when events of the specified type are\r\n   * emitted. The data arguments emitted will be passed to the listener\r\n   * function. <br>\r\n   * Possible events:\r\n   * <ul>\r\n   * <li>'participantjoined': (userId, userDisplayName)</li>\r\n   * <li>'participantleft': (userId, userDisplayName)</li>\r\n   * <li>'localstream': (stream)</li>\r\n   * <li>'remotestream': (stream, userId)</li>\r\n   * </ul>\r\n   *\r\n   * @param {String} eventType - Name of the event to listen to\r\n   * @param {function} listener - Function to invoke when the specified\r\n   *  event is emitted\r\n   */\r\n  on: function (eventType, listener) {\r\n    var token = this.emitter.addListener(eventType, listener);\r\n  },\r\n\r\n  /**\r\n   * Removes all of the registered listeners.\r\n   *\r\n   * @param {?String} eventType - Optional name of the event whose registered\r\n   *   listeners to remove.\r\n   */\r\n  removeAllListeners: function (eventType) {\r\n    if (eventType) {\r\n      this.emitter.removeAllListeners(eventType);\r\n    } else {\r\n      this.emitter.removeAllListeners();\r\n    }\r\n  }\r\n};\r\n\r\nmodule.exports = { Client: VideoConferencingClient };\r\n","(function (global, factory) {\r\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\r\n\ttypeof define === 'function' && define.amd ? define(factory) :\r\n\t(global.Janus = factory());\r\n}(this, (function () {\r\n\r\n/* eslint-disable */\r\n/*\r\n * Module shim for rollup.js to work with.\r\n * Simply re-export Janus from janus.js, the real 'magic' is in the rollup config.\r\n *\r\n * Since this counts as 'autogenerated' code, ESLint is instructed to ignore the contents of this file when linting your project.\r\n */\r\n\r\n/*\r\n\tThe MIT License (MIT)\r\n\r\n\tCopyright (c) 2016 Meetecho\r\n\r\n\tPermission is hereby granted, free of charge, to any person obtaining\r\n\ta copy of this software and associated documentation files (the \"Software\"),\r\n\tto deal in the Software without restriction, including without limitation\r\n\tthe rights to use, copy, modify, merge, publish, distribute, sublicense,\r\n\tand/or sell copies of the Software, and to permit persons to whom the\r\n\tSoftware is furnished to do so, subject to the following conditions:\r\n\r\n\tThe above copyright notice and this permission notice shall be included\r\n\tin all copies or substantial portions of the Software.\r\n\r\n\tTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\r\n\tOR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n\tFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\r\n\tTHE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR\r\n\tOTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,\r\n\tARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\r\n\tOTHER DEALINGS IN THE SOFTWARE.\r\n */\r\n\r\n// List of sessions\r\nJanus.sessions = {};\r\n\r\n// Screensharing Chrome Extension ID\r\nJanus.extensionId = \"hapfgfdkleiggjjpfpenajgdnfckjpaj\";\r\nJanus.isExtensionEnabled = function() {\r\n\tif(window.navigator.userAgent.match('Chrome')) {\r\n\t\tvar chromever = parseInt(window.navigator.userAgent.match(/Chrome\\/(.*) /)[1], 10);\r\n\t\tvar maxver = 33;\r\n\t\tif(window.navigator.userAgent.match('Linux'))\r\n\t\t\tmaxver = 35;\t// \"known\" crash in chrome 34 and 35 on linux\r\n\t\tif(chromever >= 26 && chromever <= maxver) {\r\n\t\t\t// Older versions of Chrome don't support this extension-based approach, so lie\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn Janus.checkJanusExtension();\r\n\t} else {\r\n\t\t// Firefox of others, no need for the extension (but this doesn't mean it will work)\r\n\t\treturn true;\r\n\t}\r\n};\r\n\r\nJanus.useDefaultDependencies = function (deps) {\r\n\tvar f = (deps && deps.fetch) || fetch;\r\n\tvar p = (deps && deps.Promise) || Promise;\r\n\tvar socketCls = (deps && deps.WebSocket) || WebSocket;\r\n\treturn {\r\n\t\tnewWebSocket: function(server, proto) { return new socketCls(server, proto); },\r\n\t\tisArray: function(arr) { return Array.isArray(arr); },\r\n\t\tcheckJanusExtension: function() { return document.querySelector('#janus-extension-installed') !== null; },\r\n\t\twebRTCAdapter: (deps && deps.adapter) || adapter,\r\n\t\thttpAPICall: function(url, options) {\r\n\t\t\tvar fetchOptions = {method: options.verb, cache: 'no-cache'};\r\n\t\t\tif(options.withCredentials !== undefined) {\r\n\t\t\t\tfetchOptions.credentials = options.withCredentials === true ? 'include' : (options.withCredentials ? options.withCredentials : 'omit');\r\n\t\t\t}\r\n\t\t\tif(options.body !== undefined) {\r\n\t\t\t\tfetchOptions.body = JSON.stringify(options.body);\r\n\t\t\t}\r\n\r\n\t\t\tvar fetching = f(url, fetchOptions).catch(function(error) {\r\n\t\t\t\treturn p.reject({message: 'Probably a network error, is the gateway down?', error: error});\r\n\t\t\t});\r\n\r\n\t\t\t/*\r\n\t\t\t * fetch() does not natively support timeouts.\r\n\t\t\t * Work around this by starting a timeout manually, and racing it agains the fetch() to see which thing resolves first.\r\n\t\t\t */\r\n\r\n\t\t\tif(options.timeout !== undefined) {\r\n\t\t\t\tvar timeout = new p(function(resolve, reject) {\r\n\t\t\t\t\tvar timerId = setTimeout(function() {\r\n\t\t\t\t\t\tclearTimeout(timerId);\r\n\t\t\t\t\t\treturn reject({message: 'Request timed out', timeout: options.timeout});\r\n\t\t\t\t\t}, options.timeout);\r\n\t\t\t\t});\r\n\t\t\t\tfetching = p.race([fetching,timeout]);\r\n\t\t\t}\r\n\r\n\t\t\tfetching.then(function(response) {\r\n\t\t\t\tif(response.ok) {\r\n\t\t\t\t\tif(typeof(options.success) === typeof(Janus.noop)) {\r\n\t\t\t\t\t\treturn response.json().then(function(parsed) {\r\n\t\t\t\t\t\t\toptions.success(parsed);\r\n\t\t\t\t\t\t}).catch(function(error) {\r\n\t\t\t\t\t\t\treturn p.reject({message: 'Failed to parse response body', error: error, response: response});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn p.reject({message: 'API call failed', response: response});\r\n\t\t\t\t}\r\n\t\t\t}).catch(function(error) {\r\n\t\t\t\tif(typeof(options.error) === typeof(Janus.noop)) {\r\n\t\t\t\t\toptions.error(error.message || '<< internal error >>', error);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn fetching;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nJanus.useOldDependencies = function (deps) {\r\n\tvar jq = (deps && deps.jQuery) || jQuery;\r\n\tvar socketCls = (deps && deps.WebSocket) || WebSocket;\r\n\treturn {\r\n\t\tnewWebSocket: function(server, proto) { return new socketCls(server, proto); },\r\n\t\tisArray: function(arr) { return jq.isArray(arr); },\r\n\t\tcheckJanusExtension: function() { return jq('#janus-extension-installed').length > 0; },\r\n\t\twebRTCAdapter: (deps && deps.adapter) || adapter,\r\n\t\thttpAPICall: function(url, options) {\r\n\t\t\tvar payload = options.body !== undefined ? {\r\n\t\t\t\tcontentType: 'application/json',\r\n\t\t\t\tdata: JSON.stringify(options.body)\r\n\t\t\t} : {};\r\n\t\t\tvar credentials = options.withCredentials !== undefined ? {xhrFields: {withCredentials: options.withCredentials}} : {};\r\n\r\n\t\t\treturn jq.ajax(jq.extend(payload, credentials, {\r\n\t\t\t\turl: url,\r\n\t\t\t\ttype: options.verb,\r\n\t\t\t\tcache: false,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tasync: options.async,\r\n\t\t\t\ttimeout: options.timeout,\r\n\t\t\t\tsuccess: function(result) {\r\n\t\t\t\t\tif(typeof(options.success) === typeof(Janus.noop)) {\r\n\t\t\t\t\t\toptions.success(result);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function(xhr, status, err) {\r\n\t\t\t\t\tif(typeof(options.error) === typeof(Janus.noop)) {\r\n\t\t\t\t\t\toptions.error(status, err);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t},\r\n\t};\r\n};\r\n\r\nJanus.noop = function() {};\r\n\r\n// Initialization\r\nJanus.init = function(options) {\r\n\toptions = options || {};\r\n\toptions.callback = (typeof options.callback == \"function\") ? options.callback : Janus.noop;\r\n\tif(Janus.initDone === true) {\r\n\t\t// Already initialized\r\n\t\toptions.callback();\r\n\t} else {\r\n\t\tif(typeof console == \"undefined\" || typeof console.log == \"undefined\")\r\n\t\t\tconsole = { log: function() {} };\r\n\t\t// Console logging (all debugging disabled by default)\r\n\t\tJanus.trace = Janus.noop;\r\n\t\tJanus.debug = Janus.noop;\r\n\t\tJanus.vdebug = Janus.noop;\r\n\t\tJanus.log = Janus.noop;\r\n\t\tJanus.warn = Janus.noop;\r\n\t\tJanus.error = Janus.noop;\r\n\t\tif(options.debug === true || options.debug === \"all\") {\r\n\t\t\t// Enable all debugging levels\r\n\t\t\tJanus.trace = console.trace.bind(console);\r\n\t\t\tJanus.debug = console.debug.bind(console);\r\n\t\t\tJanus.vdebug = console.debug.bind(console);\r\n\t\t\tJanus.log = console.log.bind(console);\r\n\t\t\tJanus.warn = console.warn.bind(console);\r\n\t\t\tJanus.error = console.error.bind(console);\r\n\t\t} else if(Array.isArray(options.debug)) {\r\n\t\t\tfor(var i in options.debug) {\r\n\t\t\t\tvar d = options.debug[i];\r\n\t\t\t\tswitch(d) {\r\n\t\t\t\t\tcase \"trace\":\r\n\t\t\t\t\t\tJanus.trace = console.trace.bind(console);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"debug\":\r\n\t\t\t\t\t\tJanus.debug = console.debug.bind(console);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"vdebug\":\r\n\t\t\t\t\t\tJanus.vdebug = console.debug.bind(console);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"log\":\r\n\t\t\t\t\t\tJanus.log = console.log.bind(console);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"warn\":\r\n\t\t\t\t\t\tJanus.warn = console.warn.bind(console);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"error\":\r\n\t\t\t\t\t\tJanus.error = console.error.bind(console);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tconsole.error(\"Unknown debugging option '\" + d + \"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')\");\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tJanus.log(\"Initializing library\");\r\n\r\n\t\tvar usedDependencies = options.dependencies || Janus.useDefaultDependencies();\r\n\t\tJanus.isArray = usedDependencies.isArray;\r\n\t\tJanus.webRTCAdapter = usedDependencies.webRTCAdapter;\r\n\t\tJanus.httpAPICall = usedDependencies.httpAPICall;\r\n\t\tJanus.checkJanusExtension = usedDependencies.checkJanusExtension;\r\n\t\tJanus.newWebSocket = usedDependencies.newWebSocket;\r\n\r\n\t\t// Helper method to enumerate devices\r\n\t\tJanus.listDevices = function(callback, config) {\r\n\t\t\tcallback = (typeof callback == \"function\") ? callback : Janus.noop;\r\n\t\t\tif (config == null) config = { audio: true, video: true };\r\n\t\t\tif(navigator.mediaDevices) {\r\n\t\t\t\tnavigator.mediaDevices.getUserMedia(config)\r\n\t\t\t\t.then(function(stream) {\r\n\t\t\t\t\tnavigator.mediaDevices.enumerateDevices().then(function(devices) {\r\n\t\t\t\t\t\tJanus.debug(devices);\r\n\t\t\t\t\t\tcallback(devices);\r\n\t\t\t\t\t\t// Get rid of the now useless stream\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tvar tracks = stream.getTracks();\r\n\t\t\t\t\t\t\tfor(var i in tracks) {\r\n\t\t\t\t\t\t\t\tvar mst = tracks[i];\r\n\t\t\t\t\t\t\t\tif(mst !== null && mst !== undefined)\r\n\t\t\t\t\t\t\t\t\tmst.stop();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch(e) {}\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.catch(function(err) {\r\n\t\t\t\t\tJanus.error(err);\r\n\t\t\t\t\tcallback([]);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tJanus.warn(\"navigator.mediaDevices unavailable\");\r\n\t\t\t\tcallback([]);\r\n\t\t\t}\r\n\t\t};\r\n\t\t// Helper methods to attach/reattach a stream to a video element (previously part of adapter.js)\r\n\t\tJanus.attachMediaStream = function(element, stream) {\r\n\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === 'chrome') {\r\n\t\t\t\tvar chromever = Janus.webRTCAdapter.browserDetails.version;\r\n\t\t\t\tif(chromever >= 43) {\r\n\t\t\t\t\telement.srcObject = stream;\r\n\t\t\t\t} else if(typeof element.src !== 'undefined') {\r\n\t\t\t\t\telement.src = URL.createObjectURL(stream);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tJanus.error(\"Error attaching stream to element\");\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\telement.srcObject = stream;\r\n\t\t\t}\r\n\t\t};\r\n\t\tJanus.reattachMediaStream = function(to, from) {\r\n\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === 'chrome') {\r\n\t\t\t\tvar chromever = Janus.webRTCAdapter.browserDetails.version;\r\n\t\t\t\tif(chromever >= 43) {\r\n\t\t\t\t\tto.srcObject = from.srcObject;\r\n\t\t\t\t} else if(typeof to.src !== 'undefined') {\r\n\t\t\t\t\tto.src = from.src;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tJanus.error(\"Error reattaching stream to element\");\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tto.srcObject = from.srcObject;\r\n\t\t\t}\r\n\t\t};\r\n\t\t// Detect tab close: make sure we don't loose existing onbeforeunload handlers\r\n\t\tvar oldOBF = window.onbeforeunload;\r\n\t\twindow.onbeforeunload = function() {\r\n\t\t\tJanus.log(\"Closing window\");\r\n\t\t\tfor(var s in Janus.sessions) {\r\n\t\t\t\tif(Janus.sessions[s] !== null && Janus.sessions[s] !== undefined &&\r\n\t\t\t\t\t\tJanus.sessions[s].destroyOnUnload) {\r\n\t\t\t\t\tJanus.log(\"Destroying session \" + s);\r\n\t\t\t\t\tJanus.sessions[s].destroy({asyncRequest: false});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(oldOBF && typeof oldOBF == \"function\")\r\n\t\t\t\toldOBF();\r\n\t\t};\r\n\t\tJanus.initDone = true;\r\n\t\toptions.callback();\r\n\t}\r\n};\r\n\r\n// Helper method to check whether WebRTC is supported by this browser\r\nJanus.isWebrtcSupported = function() {\r\n\treturn window.RTCPeerConnection !== undefined && window.RTCPeerConnection !== null &&\r\n\t\tnavigator.getUserMedia !== undefined && navigator.getUserMedia !== null;\r\n};\r\n\r\n// Helper method to create random identifiers (e.g., transaction)\r\nJanus.randomString = function(len) {\r\n\tvar charSet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n\tvar randomString = '';\r\n\tfor (var i = 0; i < len; i++) {\r\n\t\tvar randomPoz = Math.floor(Math.random() * charSet.length);\r\n\t\trandomString += charSet.substring(randomPoz,randomPoz+1);\r\n\t}\r\n\treturn randomString;\r\n};\r\n\r\n\r\nfunction Janus(gatewayCallbacks) {\r\n\tif(Janus.initDone === undefined) {\r\n\t\tgatewayCallbacks.error(\"Library not initialized\");\r\n\t\treturn {};\r\n\t}\r\n\tif(!Janus.isWebrtcSupported()) {\r\n\t\tgatewayCallbacks.error(\"WebRTC not supported by this browser\");\r\n\t\treturn {};\r\n\t}\r\n\tJanus.log(\"Library initialized: \" + Janus.initDone);\r\n\tgatewayCallbacks = gatewayCallbacks || {};\r\n\tgatewayCallbacks.success = (typeof gatewayCallbacks.success == \"function\") ? gatewayCallbacks.success : Janus.noop;\r\n\tgatewayCallbacks.error = (typeof gatewayCallbacks.error == \"function\") ? gatewayCallbacks.error : Janus.noop;\r\n\tgatewayCallbacks.destroyed = (typeof gatewayCallbacks.destroyed == \"function\") ? gatewayCallbacks.destroyed : Janus.noop;\r\n\tif(gatewayCallbacks.server === null || gatewayCallbacks.server === undefined) {\r\n\t\tgatewayCallbacks.error(\"Invalid gateway url\");\r\n\t\treturn {};\r\n\t}\r\n\tvar websockets = false;\r\n\tvar ws = null;\r\n\tvar wsHandlers = {};\r\n\tvar wsKeepaliveTimeoutId = null;\r\n\r\n\tvar servers = null, serversIndex = 0;\r\n\tvar server = gatewayCallbacks.server;\r\n\tif(Janus.isArray(server)) {\r\n\t\tJanus.log(\"Multiple servers provided (\" + server.length + \"), will use the first that works\");\r\n\t\tserver = null;\r\n\t\tservers = gatewayCallbacks.server;\r\n\t\tJanus.debug(servers);\r\n\t} else {\r\n\t\tif(server.indexOf(\"ws\") === 0) {\r\n\t\t\twebsockets = true;\r\n\t\t\tJanus.log(\"Using WebSockets to contact Janus: \" + server);\r\n\t\t} else {\r\n\t\t\twebsockets = false;\r\n\t\t\tJanus.log(\"Using REST API to contact Janus: \" + server);\r\n\t\t}\r\n\t}\r\n\tvar iceServers = gatewayCallbacks.iceServers;\r\n\tif(iceServers === undefined || iceServers === null)\r\n\t\ticeServers = [{urls: \"stun:stun.l.google.com:19302\"}];\r\n\tvar iceTransportPolicy = gatewayCallbacks.iceTransportPolicy;\r\n\tvar bundlePolicy = gatewayCallbacks.bundlePolicy;\r\n\t// Whether IPv6 candidates should be gathered\r\n\tvar ipv6Support = gatewayCallbacks.ipv6;\r\n\tif(ipv6Support === undefined || ipv6Support === null)\r\n\t\tipv6Support = false;\r\n\t// Whether we should enable the withCredentials flag for XHR requests\r\n\tvar withCredentials = false;\r\n\tif(gatewayCallbacks.withCredentials !== undefined && gatewayCallbacks.withCredentials !== null)\r\n\t\twithCredentials = gatewayCallbacks.withCredentials === true;\r\n\t// Optional max events\r\n\tvar maxev = null;\r\n\tif(gatewayCallbacks.max_poll_events !== undefined && gatewayCallbacks.max_poll_events !== null)\r\n\t\tmaxev = gatewayCallbacks.max_poll_events;\r\n\tif(maxev < 1)\r\n\t\tmaxev = 1;\r\n\t// Token to use (only if the token based authentication mechanism is enabled)\r\n\tvar token = null;\r\n\tif(gatewayCallbacks.token !== undefined && gatewayCallbacks.token !== null)\r\n\t\ttoken = gatewayCallbacks.token;\r\n\t// API secret to use (only if the shared API secret is enabled)\r\n\tvar apisecret = null;\r\n\tif(gatewayCallbacks.apisecret !== undefined && gatewayCallbacks.apisecret !== null)\r\n\t\tapisecret = gatewayCallbacks.apisecret;\r\n\t// Whether we should destroy this session when onbeforeunload is called\r\n\tthis.destroyOnUnload = true;\r\n\tif(gatewayCallbacks.destroyOnUnload !== undefined && gatewayCallbacks.destroyOnUnload !== null)\r\n\t\tthis.destroyOnUnload = (gatewayCallbacks.destroyOnUnload === true);\r\n\r\n\tvar connected = false;\r\n\t// var reconnected = false;\r\n\t// var reconnecting = false;\r\n\tvar sessionId = null;\r\n\tvar pluginHandles = {};\r\n\tvar that = this;\r\n\tvar retries = 0;\r\n\tvar transactions = {};\r\n\tcreateSession(gatewayCallbacks);\r\n\r\n\t// Public methods\r\n\tthis.getServer = function() { return server; };\r\n\tthis.isConnected = function() { return connected; };\r\n\tthis.getSessionId = function() { return sessionId; };\r\n\tthis.destroy = function(callbacks) { destroySession(callbacks); };\r\n\tthis.attach = function(callbacks) { createHandle(callbacks); };\r\n\tthis.timeoutSessionCallback = (typeof gatewayCallbacks.timeoutSessionCallback == \"function\") ? gatewayCallbacks.timeoutSessionCallback : Janus.noop;\r\n\r\n\tfunction eventHandler() {\r\n\t\tif(sessionId == null)\r\n\t\t\treturn;\r\n\t\tJanus.debug('Long poll...');\r\n\t\tif(!connected) {\r\n\t\t\tJanus.warn(\"Is the gateway down? (connected=false)\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar longpoll = server + \"/\" + sessionId + \"?rid=\" + new Date().getTime();\r\n\t\tif(maxev !== undefined && maxev !== null)\r\n\t\t\tlongpoll = longpoll + \"&maxev=\" + maxev;\r\n\t\tif(token !== null && token !== undefined)\r\n\t\t\tlongpoll = longpoll + \"&token=\" + token;\r\n\t\tif(apisecret !== null && apisecret !== undefined)\r\n\t\t\tlongpoll = longpoll + \"&apisecret=\" + apisecret;\r\n\t\tJanus.httpAPICall(longpoll, {\r\n\t\t\tverb: 'GET',\r\n\t\t\twithCredentials: withCredentials,\r\n\t\t\tsuccess: handleEvent,\r\n\t\t\ttimeout: 60000,\t// FIXME\r\n\t\t\terror: function(textStatus, errorThrown) {\r\n\t\t\t\tJanus.error(textStatus + \": \" + errorThrown);\r\n\t\t\t\tretries++;\r\n\t\t\t\tif(retries > 3) {\r\n\t\t\t\t\t// Did we just lose the gateway? :-(\r\n\t\t\t\t\tconnected = false;\r\n\t\t\t\t\tgatewayCallbacks.error(\"Lost connection to the gateway (is it down?)\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\teventHandler();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// Private event handler: this will trigger plugin callbacks, if set\r\n\tfunction handleEvent(json, skipTimeout) {\r\n\t\tretries = 0;\r\n\t\tif(!websockets && sessionId !== undefined && sessionId !== null && skipTimeout !== true)\r\n\t\t\tsetTimeout(eventHandler, 200);\r\n\t\tif(!websockets && Janus.isArray(json)) {\r\n\t\t\t// We got an array: it means we passed a maxev > 1, iterate on all objects\r\n\t\t\tfor(var i=0; i<json.length; i++) {\r\n\t\t\t\thandleEvent(json[i], true);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(json[\"janus\"] === \"keepalive\") {\r\n\t\t\t// Nothing happened\r\n\t\t\tJanus.vdebug(\"Got a keepalive on session \" + sessionId);\r\n\t\t\treturn;\r\n\t\t} else if(json[\"janus\"] === \"ack\") {\r\n\t\t\t// Just an ack, we can probably ignore\r\n\t\t\tJanus.debug(\"Got an ack on session \" + sessionId);\r\n\t\t\tJanus.debug(json);\r\n\t\t\tvar transaction = json[\"transaction\"];\r\n\t\t\tif(transaction !== null && transaction !== undefined) {\r\n\t\t\t\tvar reportSuccess = transactions[transaction];\r\n\t\t\t\tif(reportSuccess !== null && reportSuccess !== undefined) {\r\n\t\t\t\t\treportSuccess(json);\r\n\t\t\t\t}\r\n\t\t\t\tdelete transactions[transaction];\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t} else if(json[\"janus\"] === \"success\") {\r\n\t\t\t// Success!\r\n\t\t\tJanus.debug(\"Got a success on session \" + sessionId);\r\n\t\t\tJanus.debug(json);\r\n\t\t\tvar transaction = json[\"transaction\"];\r\n\t\t\tif(transaction !== null && transaction !== undefined) {\r\n\t\t\t\tvar reportSuccess = transactions[transaction];\r\n\t\t\t\tif(reportSuccess !== null && reportSuccess !== undefined) {\r\n\t\t\t\t\treportSuccess(json);\r\n\t\t\t\t}\r\n\t\t\t\tdelete transactions[transaction];\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t} else if(json[\"janus\"] === \"webrtcup\") {\r\n\t\t\t// The PeerConnection with the gateway is up! Notify this\r\n\t\t\tJanus.debug(\"Got a webrtcup event on session \" + sessionId);\r\n\t\t\tJanus.debug(json);\r\n\t\t\tvar sender = json[\"sender\"];\r\n\t\t\tif(sender === undefined || sender === null) {\r\n\t\t\t\tJanus.warn(\"Missing sender...\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar pluginHandle = pluginHandles[sender];\r\n\t\t\tif(pluginHandle === undefined || pluginHandle === null) {\r\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tpluginHandle.webrtcState(true);\r\n\t\t\treturn;\r\n\t\t} else if(json[\"janus\"] === \"hangup\") {\r\n\t\t\t// A plugin asked the core to hangup a PeerConnection on one of our handles\r\n\t\t\tJanus.debug(\"Got a hangup event on session \" + sessionId);\r\n\t\t\tJanus.debug(json);\r\n\t\t\tvar sender = json[\"sender\"];\r\n\t\t\tif(sender === undefined || sender === null) {\r\n\t\t\t\tJanus.warn(\"Missing sender...\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar pluginHandle = pluginHandles[sender];\r\n\t\t\tif(pluginHandle === undefined || pluginHandle === null) {\r\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tpluginHandle.webrtcState(false, json[\"reason\"]);\r\n\t\t\tpluginHandle.hangup();\r\n\t\t} else if(json[\"janus\"] === \"detached\") {\r\n\t\t\t// A plugin asked the core to detach one of our handles\r\n\t\t\tJanus.debug(\"Got a detached event on session \" + sessionId);\r\n\t\t\tJanus.debug(json);\r\n\t\t\tvar sender = json[\"sender\"];\r\n\t\t\tif(sender === undefined || sender === null) {\r\n\t\t\t\tJanus.warn(\"Missing sender...\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar pluginHandle = pluginHandles[sender];\r\n\t\t\tif(pluginHandle === undefined || pluginHandle === null) {\r\n\t\t\t\t// Don't warn here because destroyHandle causes this situation.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tpluginHandle.detached = true;\r\n\t\t\tpluginHandle.ondetached();\r\n\t\t\tpluginHandle.detach();\r\n\t\t} else if(json[\"janus\"] === \"media\") {\r\n\t\t\t// Media started/stopped flowing\r\n\t\t\tJanus.debug(\"Got a media event on session \" + sessionId);\r\n\t\t\tJanus.debug(json);\r\n\t\t\tvar sender = json[\"sender\"];\r\n\t\t\tif(sender === undefined || sender === null) {\r\n\t\t\t\tJanus.warn(\"Missing sender...\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar pluginHandle = pluginHandles[sender];\r\n\t\t\tif(pluginHandle === undefined || pluginHandle === null) {\r\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tpluginHandle.mediaState(json[\"type\"], json[\"receiving\"]);\r\n\t\t} else if(json[\"janus\"] === \"slowlink\") {\r\n\t\t\tJanus.debug(\"Got a slowlink event on session \" + sessionId);\r\n\t\t\tJanus.debug(json);\r\n\t\t\t// Trouble uplink or downlink\r\n\t\t\tvar sender = json[\"sender\"];\r\n\t\t\tif(sender === undefined || sender === null) {\r\n\t\t\t\tJanus.warn(\"Missing sender...\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar pluginHandle = pluginHandles[sender];\r\n\t\t\tif(pluginHandle === undefined || pluginHandle === null) {\r\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tpluginHandle.slowLink(json[\"uplink\"], json[\"nacks\"]);\r\n\t\t} else if(json[\"janus\"] === \"error\") {\r\n\t\t\t// Oops, something wrong happened\r\n\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\r\n\t\t\tJanus.debug(json);\r\n\t\t\tvar transaction = json[\"transaction\"];\r\n\t\t\tif(transaction !== null && transaction !== undefined) {\r\n\t\t\t\tvar reportSuccess = transactions[transaction];\r\n\t\t\t\tif(reportSuccess !== null && reportSuccess !== undefined) {\r\n\t\t\t\t\treportSuccess(json);\r\n\t\t\t\t}\r\n\t\t\t\tdelete transactions[transaction];\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t} else if(json[\"janus\"] === \"event\") {\r\n\t\t\tJanus.debug(\"Got a plugin event on session \" + sessionId);\r\n\t\t\tJanus.debug(json);\r\n\t\t\tvar sender = json[\"sender\"];\r\n\t\t\tif(sender === undefined || sender === null) {\r\n\t\t\t\tJanus.warn(\"Missing sender...\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar plugindata = json[\"plugindata\"];\r\n\t\t\tif(plugindata === undefined || plugindata === null) {\r\n\t\t\t\tJanus.warn(\"Missing plugindata...\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tJanus.debug(\"  -- Event is coming from \" + sender + \" (\" + plugindata[\"plugin\"] + \")\");\r\n\t\t\tvar data = plugindata[\"data\"];\r\n\t\t\tJanus.debug(data);\r\n\t\t\tvar pluginHandle = pluginHandles[sender];\r\n\t\t\tif(pluginHandle === undefined || pluginHandle === null) {\r\n\t\t\t\tJanus.warn(\"This handle is not attached to this session\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar jsep = json[\"jsep\"];\r\n\t\t\tif(jsep !== undefined && jsep !== null) {\r\n\t\t\t\tJanus.debug(\"Handling SDP as well...\");\r\n\t\t\t\tJanus.debug(jsep);\r\n\t\t\t}\r\n\t\t\tvar callback = pluginHandle.onmessage;\r\n\t\t\tif(callback !== null && callback !== undefined) {\r\n\t\t\t\tJanus.debug(\"Notifying application...\");\r\n\t\t\t\t// Send to callback specified when attaching plugin handle\r\n\t\t\t\tcallback(data, jsep);\r\n\t\t\t} else {\r\n\t\t\t\t// Send to generic callback (?)\r\n\t\t\t\tJanus.debug(\"No provided notification callback\");\r\n\t\t\t}\r\n\t\t} else if(json[\"janus\"] === \"timeout\") {\r\n\t\t\tvar sessionId = json[\"session_id\"];\r\n\t\t\tvar session = Janus.sessions[sessionId];\r\n\t\t\tif(session){\r\n\t\t\t\tsession.timeoutSessionCallback();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tJanus.warn(\"Unkown message/event  '\" + json[\"janus\"] + \"' on session \" + sessionId);\r\n\t\t\tJanus.debug(json);\r\n\t\t}\r\n\t}\r\n\r\n\t// Private helper to send keep-alive messages on WebSockets\r\n\tfunction keepAlive() {\r\n\t\tif(server === null || !websockets || !connected)\r\n\t\t\treturn;\r\n\t\twsKeepaliveTimeoutId = setTimeout(keepAlive, 30000);\r\n\t\tvar request = { \"janus\": \"keepalive\", \"session_id\": sessionId, \"transaction\": Janus.randomString(12) };\r\n\t\tif(token !== null && token !== undefined)\r\n\t\t\trequest[\"token\"] = token;\r\n\t\tif(apisecret !== null && apisecret !== undefined)\r\n\t\t\trequest[\"apisecret\"] = apisecret;\r\n\t\tws.send(JSON.stringify(request));\r\n\t}\r\n\r\n\t// Private method to create a session\r\n\tfunction createSession(callbacks) {\r\n\t\tvar transaction = Janus.randomString(12);\r\n\t\tvar request = { \"janus\": \"create\", \"transaction\": transaction };\r\n\t\tif(token !== null && token !== undefined)\r\n\t\t\trequest[\"token\"] = token;\r\n\t\tif(apisecret !== null && apisecret !== undefined)\r\n\t\t\trequest[\"apisecret\"] = apisecret;\r\n\t\tif(server === null && Janus.isArray(servers)) {\r\n\t\t\t// We still need to find a working server from the list we were given\r\n\t\t\tserver = servers[serversIndex];\r\n\t\t\tif(server.indexOf(\"ws\") === 0) {\r\n\t\t\t\twebsockets = true;\r\n\t\t\t\tJanus.log(\"Server #\" + (serversIndex+1) + \": trying WebSockets to contact Janus (\" + server + \")\");\r\n\t\t\t} else {\r\n\t\t\t\twebsockets = false;\r\n\t\t\t\tJanus.log(\"Server #\" + (serversIndex+1) + \": trying REST API to contact Janus (\" + server + \")\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(websockets) {\r\n\t\t\tws = Janus.newWebSocket(server, 'janus-protocol');\r\n\t\t\twsHandlers = {\r\n\t\t\t\t'error': function() {\r\n\t\t\t\t\tconsole.warn(\"WS error\");\r\n\r\n\t\t\t\t\tJanus.error(\"Error connecting to the Janus WebSockets server... \" + server);\r\n\t\t\t\t\tif (Janus.isArray(servers)) {\r\n\t\t\t\t\t\tserversIndex++;\r\n\t\t\t\t\t\tif (serversIndex == servers.length) {\r\n\t\t\t\t\t\t\t// We tried all the servers the user gave us and they all failed\r\n\t\t\t\t\t\t\tcallbacks.error(\"Error connecting to any of the provided Janus servers: Is the gateway down?\");\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Let's try the next server\r\n\t\t\t\t\t\tserver = null;\r\n\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\tcreateSession(callbacks);\r\n\t\t\t\t\t\t}, 200);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcallbacks.error(\"Error connecting to the Janus WebSockets server: Is the gateway down?\");\r\n\t\t\t\t},\r\n\r\n\t\t\t\t'open': function() {\r\n\t\t\t\t\tconsole.warn(\"WS connected\");\r\n\r\n\t\t\t\t\t// if(reconnecting){\r\n\t\t\t\t\t// \treconnecting = false;\r\n\t\t\t\t\t// \treconnected = true;\r\n\t\t\t\t\t// \tconsole.warn(\"WS reconnected\");\r\n\t\t\t\t\t// }\r\n\r\n\t\t\t\t\t// if(!reconnected){\r\n\t\t\t\t\t\t// We need to be notified about the success\r\n\t\t\t\t\t\ttransactions[transaction] = function(json) {\r\n\t\t\t\t\t\t\tJanus.debug(json);\r\n\t\t\t\t\t\t\tif (json[\"janus\"] !== \"success\") {\r\n\t\t\t\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\r\n\t\t\t\t\t\t\t\tcallbacks.error(json[\"error\"].reason);\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\twsKeepaliveTimeoutId = setTimeout(keepAlive, 30000);\r\n\t\t\t\t\t\t\tconnected = true;\r\n\t\t\t\t\t\t\tsessionId = json.data[\"id\"];\r\n\t\t\t\t\t\t\tJanus.log(\"Created session: \" + sessionId);\r\n\t\t\t\t\t\t\tJanus.sessions[sessionId] = that;\r\n\t\t\t\t\t\t\tcallbacks.success();\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tws.send(JSON.stringify(request));\r\n\t\t\t\t\t// }else{\r\n\t\t\t\t\t// \tconnected = true;\r\n\t\t\t\t\t// }\r\n\t\t\t\t},\r\n\r\n\t\t\t\t'message': function(event) {\r\n\t\t\t\t\thandleEvent(JSON.parse(event.data));\r\n\t\t\t\t},\r\n\r\n\t\t\t\t'close': function() {\r\n\t\t\t\t\tif (server === null || !connected) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// if(connected){\r\n\t\t\t\t\t// \treconnecting = false;\r\n\t\t\t\t\t// }\r\n\t\t\t\t\tconnected = false;\r\n\t\t\t\t\t// reconnected = false;\r\n\r\n\t\t\t\t\tconsole.warn(\"WS close\");\r\n\t\t\t\t\t// // reconnection\r\n\t\t\t\t\t// //\r\n\t\t\t\t\t// // Try to reconnect in 5 seconds\r\n\t\t\t\t\t// setTimeout(function(){\r\n\t\t\t\t\t// \treconnecting = true;\r\n\t\t\t\t\t// \tconsole.warn(\"WS reconnection\");\r\n\t\t\t\t\t// \tcreateSession(callbacks);\r\n\t\t\t\t\t// }, 2000);\r\n\r\n\r\n\t\t\t\t\t// FIXME What if this is called when the page is closed?\r\n\t\t\t\t\tgatewayCallbacks.error(\"Lost connection to the gateway (is it down?)\");\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tfor(var eventName in wsHandlers) {\r\n\t\t\t\tws.addEventListener(eventName, wsHandlers[eventName]);\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tJanus.httpAPICall(server, {\r\n\t\t\tverb: 'POST',\r\n\t\t\twithCredentials: withCredentials,\r\n\t\t\tbody: request,\r\n\t\t\tsuccess: function(json) {\r\n\t\t\t\tJanus.debug(json);\r\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\r\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\r\n\t\t\t\t\tcallbacks.error(json[\"error\"].reason);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tconnected = true;\r\n\t\t\t\tsessionId = json.data[\"id\"];\r\n\t\t\t\tJanus.log(\"Created session: \" + sessionId);\r\n\t\t\t\tJanus.sessions[sessionId] = that;\r\n\t\t\t\teventHandler();\r\n\t\t\t\tcallbacks.success();\r\n\t\t\t},\r\n\t\t\terror: function(textStatus, errorThrown) {\r\n\t\t\t\tJanus.error(textStatus + \": \" + errorThrown);\t// FIXME\r\n\t\t\t\tif(Janus.isArray(servers)) {\r\n\t\t\t\t\tserversIndex++;\r\n\t\t\t\t\tif(serversIndex == servers.length) {\r\n\t\t\t\t\t\t// We tried all the servers the user gave us and they all failed\r\n\t\t\t\t\t\tcallbacks.error(\"Error connecting to any of the provided Janus servers: Is the gateway down?\");\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Let's try the next server\r\n\t\t\t\t\tserver = null;\r\n\t\t\t\t\tsetTimeout(function() { createSession(callbacks); }, 200);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif(errorThrown === \"\")\r\n\t\t\t\t\tcallbacks.error(textStatus + \": Is the gateway down?\");\r\n\t\t\t\telse\r\n\t\t\t\t\tcallbacks.error(textStatus + \": \" + errorThrown);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// Private method to destroy a session\r\n\tfunction destroySession(callbacks) {\r\n\t\tcallbacks = callbacks || {};\r\n\t\t// FIXME This method triggers a success even when we fail\r\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\r\n\t\tvar asyncRequest = true;\r\n\t\tif(callbacks.asyncRequest !== undefined && callbacks.asyncRequest !== null)\r\n\t\t\tasyncRequest = (callbacks.asyncRequest === true);\r\n\t\tJanus.log(\"Destroying session \" + sessionId + \" (async=\" + asyncRequest + \")\");\r\n\t\tif(!connected) {\r\n\t\t\tJanus.warn(\"Is the gateway down? (connected=false)\");\r\n\t\t\tcallbacks.success();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(sessionId === undefined || sessionId === null) {\r\n\t\t\tJanus.warn(\"No session to destroy\");\r\n\t\t\tcallbacks.success();\r\n\t\t\tgatewayCallbacks.destroyed();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdelete Janus.sessions[sessionId];\r\n\t\t// No need to destroy all handles first, Janus will do that itself\r\n\t\tvar request = { \"janus\": \"destroy\", \"transaction\": Janus.randomString(12) };\r\n\t\tif(token !== null && token !== undefined)\r\n\t\t\trequest[\"token\"] = token;\r\n\t\tif(apisecret !== null && apisecret !== undefined)\r\n\t\t\trequest[\"apisecret\"] = apisecret;\r\n\t\tif(websockets) {\r\n\t\t\trequest[\"session_id\"] = sessionId;\r\n\r\n\t\t\tvar unbindWebSocket = function() {\r\n\t\t\t\tfor(var eventName in wsHandlers) {\r\n\t\t\t\t\tws.removeEventListener(eventName, wsHandlers[eventName]);\r\n\t\t\t\t}\r\n\t\t\t\tws.removeEventListener('message', onUnbindMessage);\r\n\t\t\t\tws.removeEventListener('error', onUnbindError);\r\n\t\t\t\tif(wsKeepaliveTimeoutId) {\r\n\t\t\t\t\tclearTimeout(wsKeepaliveTimeoutId);\r\n\t\t\t\t}\r\n\t\t\t\tws.close();\r\n\t\t\t};\r\n\r\n\t\t\tvar onUnbindMessage = function(event){\r\n\t\t\t\tvar data = JSON.parse(event.data);\r\n\t\t\t\tif(data.session_id == request.session_id && data.transaction == request.transaction) {\r\n\t\t\t\t\tunbindWebSocket();\r\n\t\t\t\t\tcallbacks.success();\r\n\t\t\t\t\tgatewayCallbacks.destroyed();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tvar onUnbindError = function(event) {\r\n\t\t\t\tunbindWebSocket();\r\n\t\t\t\tcallbacks.error(\"Failed to destroy the gateway: Is the gateway down?\");\r\n\t\t\t\tgatewayCallbacks.destroyed();\r\n\t\t\t};\r\n\r\n\t\t\tws.addEventListener('message', onUnbindMessage);\r\n\t\t\tws.addEventListener('error', onUnbindError);\r\n\r\n\t\t\tws.send(JSON.stringify(request));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tJanus.httpAPICall(server + \"/\" + sessionId, {\r\n\t\t\tverb: 'POST',\r\n\t\t\tasync: asyncRequest,\t// Sometimes we need false here, or destroying in onbeforeunload won't work\r\n\t\t\twithCredentials: withCredentials,\r\n\t\t\tbody: request,\r\n\t\t\tsuccess: function(json) {\r\n\t\t\t\tJanus.log(\"Destroyed session:\");\r\n\t\t\t\tJanus.debug(json);\r\n\t\t\t\tsessionId = null;\r\n\t\t\t\tconnected = false;\r\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\r\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\r\n\t\t\t\t}\r\n\t\t\t\tcallbacks.success();\r\n\t\t\t\tgatewayCallbacks.destroyed();\r\n\t\t\t},\r\n\t\t\terror: function(textStatus, errorThrown) {\r\n\t\t\t\tJanus.error(textStatus + \": \" + errorThrown);\t// FIXME\r\n\t\t\t\t// Reset everything anyway\r\n\t\t\t\tsessionId = null;\r\n\t\t\t\tconnected = false;\r\n\t\t\t\tcallbacks.success();\r\n\t\t\t\tgatewayCallbacks.destroyed();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// Private method to create a plugin handle\r\n\tfunction createHandle(callbacks) {\r\n\t\tcallbacks = callbacks || {};\r\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\r\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\r\n\t\tcallbacks.consentDialog = (typeof callbacks.consentDialog == \"function\") ? callbacks.consentDialog : Janus.noop;\r\n\t\tcallbacks.iceState = (typeof callbacks.iceState == \"function\") ? callbacks.iceState : Janus.noop;\r\n\t\tcallbacks.mediaState = (typeof callbacks.mediaState == \"function\") ? callbacks.mediaState : Janus.noop;\r\n\t\tcallbacks.webrtcState = (typeof callbacks.webrtcState == \"function\") ? callbacks.webrtcState : Janus.noop;\r\n\t\tcallbacks.slowLink = (typeof callbacks.slowLink == \"function\") ? callbacks.slowLink : Janus.noop;\r\n\t\tcallbacks.onmessage = (typeof callbacks.onmessage == \"function\") ? callbacks.onmessage : Janus.noop;\r\n\t\tcallbacks.onlocalstream = (typeof callbacks.onlocalstream == \"function\") ? callbacks.onlocalstream : Janus.noop;\r\n\t\tcallbacks.onremotestream = (typeof callbacks.onremotestream == \"function\") ? callbacks.onremotestream : Janus.noop;\r\n\t\tcallbacks.ondata = (typeof callbacks.ondata == \"function\") ? callbacks.ondata : Janus.noop;\r\n\t\tcallbacks.ondataopen = (typeof callbacks.ondataopen == \"function\") ? callbacks.ondataopen : Janus.noop;\r\n\t\tcallbacks.oncleanup = (typeof callbacks.oncleanup == \"function\") ? callbacks.oncleanup : Janus.noop;\r\n\t\tcallbacks.ondetached = (typeof callbacks.ondetached == \"function\") ? callbacks.ondetached : Janus.noop;\r\n\t\tif(!connected) {\r\n\t\t\tJanus.warn(\"Is the gateway down? (connected=false)\");\r\n\t\t\tcallbacks.error(\"Is the gateway down? (connected=false)\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar plugin = callbacks.plugin;\r\n\t\tif(plugin === undefined || plugin === null) {\r\n\t\t\tJanus.error(\"Invalid plugin\");\r\n\t\t\tcallbacks.error(\"Invalid plugin\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar opaqueId = callbacks.opaqueId;\r\n\t\tvar transaction = Janus.randomString(12);\r\n\t\tvar request = { \"janus\": \"attach\", \"plugin\": plugin, \"opaque_id\": opaqueId, \"transaction\": transaction };\r\n\t\tif(token !== null && token !== undefined)\r\n\t\t\trequest[\"token\"] = token;\r\n\t\tif(apisecret !== null && apisecret !== undefined)\r\n\t\t\trequest[\"apisecret\"] = apisecret;\r\n\t\t// If we know the browser supports BUNDLE and/or rtcp-mux, let's advertise those right away\r\n\t\tif(Janus.webRTCAdapter.browserDetails.browser == \"chrome\" || Janus.webRTCAdapter.browserDetails.browser == \"firefox\" ||\r\n\t\t\t\tJanus.webRTCAdapter.browserDetails.browser == \"safari\") {\r\n\t\t\trequest[\"force-bundle\"] = true;\r\n\t\t\trequest[\"force-rtcp-mux\"] = true;\r\n\t\t}\r\n\t\tif(websockets) {\r\n\t\t\ttransactions[transaction] = function(json) {\r\n\t\t\t\tJanus.debug(json);\r\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\r\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\r\n\t\t\t\t\tcallbacks.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar handleId = json.data[\"id\"];\r\n\t\t\t\tJanus.log(\"Created handle: \" + handleId);\r\n\t\t\t\tvar pluginHandle =\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsession : that,\r\n\t\t\t\t\t\tplugin : plugin,\r\n\t\t\t\t\t\tid : handleId,\r\n\t\t\t\t\t\tdetached : false,\r\n\t\t\t\t\t\twebrtcStuff : {\r\n\t\t\t\t\t\t\tstarted : false,\r\n\t\t\t\t\t\t\tmyStream : null,\r\n\t\t\t\t\t\t\tstreamExternal : false,\r\n\t\t\t\t\t\t\tremoteStream : null,\r\n\t\t\t\t\t\t\tmySdp : null,\r\n\t\t\t\t\t\t\tmediaConstraints : null,\r\n\t\t\t\t\t\t\tpc : null,\r\n\t\t\t\t\t\t\tdataChannel : null,\r\n\t\t\t\t\t\t\tdtmfSender : null,\r\n\t\t\t\t\t\t\ttrickle : true,\r\n\t\t\t\t\t\t\ticeDone : false,\r\n\t\t\t\t\t\t\tvolume : {\r\n\t\t\t\t\t\t\t\tvalue : null,\r\n\t\t\t\t\t\t\t\ttimer : null\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tbitrate : {\r\n\t\t\t\t\t\t\t\tvalue : null,\r\n\t\t\t\t\t\t\t\tbsnow : null,\r\n\t\t\t\t\t\t\t\tbsbefore : null,\r\n\t\t\t\t\t\t\t\ttsnow : null,\r\n\t\t\t\t\t\t\t\ttsbefore : null,\r\n\t\t\t\t\t\t\t\ttimer : null\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgetId : function() { return handleId; },\r\n\t\t\t\t\t\tgetPlugin : function() { return plugin; },\r\n\t\t\t\t\t\tgetVolume : function() { return getVolume(handleId); },\r\n\t\t\t\t\t\tisAudioMuted : function() { return isMuted(handleId, false); },\r\n\t\t\t\t\t\tmuteAudio : function() { return mute(handleId, false, true); },\r\n\t\t\t\t\t\tunmuteAudio : function() { return mute(handleId, false, false); },\r\n\t\t\t\t\t\tisVideoMuted : function() { return isMuted(handleId, true); },\r\n\t\t\t\t\t\tmuteVideo : function() { return mute(handleId, true, true); },\r\n\t\t\t\t\t\tunmuteVideo : function() { return mute(handleId, true, false); },\r\n\t\t\t\t\t\tgetBitrate : function() { return getBitrate(handleId); },\r\n\t\t\t\t\t\tsend : function(callbacks) { sendMessage(handleId, callbacks); },\r\n\t\t\t\t\t\tdata : function(callbacks) { sendData(handleId, callbacks); },\r\n\t\t\t\t\t\tdtmf : function(callbacks) { sendDtmf(handleId, callbacks); },\r\n\t\t\t\t\t\tconsentDialog : callbacks.consentDialog,\r\n\t\t\t\t\t\ticeState : callbacks.iceState,\r\n\t\t\t\t\t\tmediaState : callbacks.mediaState,\r\n\t\t\t\t\t\twebrtcState : callbacks.webrtcState,\r\n\t\t\t\t\t\tslowLink : callbacks.slowLink,\r\n\t\t\t\t\t\tonmessage : callbacks.onmessage,\r\n\t\t\t\t\t\tcreateOffer : function(callbacks) { prepareWebrtc(handleId, callbacks); },\r\n\t\t\t\t\t\tcreateAnswer : function(callbacks) { prepareWebrtc(handleId, callbacks); },\r\n\t\t\t\t\t\thandleRemoteJsep : function(callbacks) { prepareWebrtcPeer(handleId, callbacks); },\r\n\t\t\t\t\t\tonlocalstream : callbacks.onlocalstream,\r\n\t\t\t\t\t\tonremotestream : callbacks.onremotestream,\r\n\t\t\t\t\t\tondata : callbacks.ondata,\r\n\t\t\t\t\t\tondataopen : callbacks.ondataopen,\r\n\t\t\t\t\t\toncleanup : callbacks.oncleanup,\r\n\t\t\t\t\t\tondetached : callbacks.ondetached,\r\n\t\t\t\t\t\thangup : function(sendRequest) { cleanupWebrtc(handleId, sendRequest === true); },\r\n\t\t\t\t\t\tdetach : function(callbacks) { destroyHandle(handleId, callbacks); }\r\n\t\t\t\t\t};\r\n\t\t\t\tpluginHandles[handleId] = pluginHandle;\r\n\t\t\t\tcallbacks.success(pluginHandle);\r\n\t\t\t};\r\n\t\t\trequest[\"session_id\"] = sessionId;\r\n\t\t\tws.send(JSON.stringify(request));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tJanus.httpAPICall(server + \"/\" + sessionId, {\r\n\t\t\tverb: 'POST',\r\n\t\t\twithCredentials: withCredentials,\r\n\t\t\tbody: request,\r\n\t\t\tsuccess: function(json) {\r\n\t\t\t\tJanus.debug(json);\r\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\r\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\r\n\t\t\t\t\tcallbacks.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar handleId = json.data[\"id\"];\r\n\t\t\t\tJanus.log(\"Created handle: \" + handleId);\r\n\t\t\t\tvar pluginHandle =\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsession : that,\r\n\t\t\t\t\t\tplugin : plugin,\r\n\t\t\t\t\t\tid : handleId,\r\n\t\t\t\t\t\tdetached : false,\r\n\t\t\t\t\t\twebrtcStuff : {\r\n\t\t\t\t\t\t\tstarted : false,\r\n\t\t\t\t\t\t\tmyStream : null,\r\n\t\t\t\t\t\t\tstreamExternal : false,\r\n\t\t\t\t\t\t\tremoteStream : null,\r\n\t\t\t\t\t\t\tmySdp : null,\r\n\t\t\t\t\t\t\tmediaConstraints : null,\r\n\t\t\t\t\t\t\tpc : null,\r\n\t\t\t\t\t\t\tdataChannel : null,\r\n\t\t\t\t\t\t\tdtmfSender : null,\r\n\t\t\t\t\t\t\ttrickle : true,\r\n\t\t\t\t\t\t\ticeDone : false,\r\n\t\t\t\t\t\t\tvolume : {\r\n\t\t\t\t\t\t\t\tvalue : null,\r\n\t\t\t\t\t\t\t\ttimer : null\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tbitrate : {\r\n\t\t\t\t\t\t\t\tvalue : null,\r\n\t\t\t\t\t\t\t\tbsnow : null,\r\n\t\t\t\t\t\t\t\tbsbefore : null,\r\n\t\t\t\t\t\t\t\ttsnow : null,\r\n\t\t\t\t\t\t\t\ttsbefore : null,\r\n\t\t\t\t\t\t\t\ttimer : null\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgetId : function() { return handleId; },\r\n\t\t\t\t\t\tgetPlugin : function() { return plugin; },\r\n\t\t\t\t\t\tgetVolume : function() { return getVolume(handleId); },\r\n\t\t\t\t\t\tisAudioMuted : function() { return isMuted(handleId, false); },\r\n\t\t\t\t\t\tmuteAudio : function() { return mute(handleId, false, true); },\r\n\t\t\t\t\t\tunmuteAudio : function() { return mute(handleId, false, false); },\r\n\t\t\t\t\t\tisVideoMuted : function() { return isMuted(handleId, true); },\r\n\t\t\t\t\t\tmuteVideo : function() { return mute(handleId, true, true); },\r\n\t\t\t\t\t\tunmuteVideo : function() { return mute(handleId, true, false); },\r\n\t\t\t\t\t\tgetBitrate : function() { return getBitrate(handleId); },\r\n\t\t\t\t\t\tsend : function(callbacks) { sendMessage(handleId, callbacks); },\r\n\t\t\t\t\t\tdata : function(callbacks) { sendData(handleId, callbacks); },\r\n\t\t\t\t\t\tdtmf : function(callbacks) { sendDtmf(handleId, callbacks); },\r\n\t\t\t\t\t\tconsentDialog : callbacks.consentDialog,\r\n\t\t\t\t\t\ticeState : callbacks.iceState,\r\n\t\t\t\t\t\tmediaState : callbacks.mediaState,\r\n\t\t\t\t\t\twebrtcState : callbacks.webrtcState,\r\n\t\t\t\t\t\tslowLink : callbacks.slowLink,\r\n\t\t\t\t\t\tonmessage : callbacks.onmessage,\r\n\t\t\t\t\t\tcreateOffer : function(callbacks) { prepareWebrtc(handleId, callbacks); },\r\n\t\t\t\t\t\tcreateAnswer : function(callbacks) { prepareWebrtc(handleId, callbacks); },\r\n\t\t\t\t\t\thandleRemoteJsep : function(callbacks) { prepareWebrtcPeer(handleId, callbacks); },\r\n\t\t\t\t\t\tonlocalstream : callbacks.onlocalstream,\r\n\t\t\t\t\t\tonremotestream : callbacks.onremotestream,\r\n\t\t\t\t\t\tondata : callbacks.ondata,\r\n\t\t\t\t\t\tondataopen : callbacks.ondataopen,\r\n\t\t\t\t\t\toncleanup : callbacks.oncleanup,\r\n\t\t\t\t\t\tondetached : callbacks.ondetached,\r\n\t\t\t\t\t\thangup : function(sendRequest) { cleanupWebrtc(handleId, sendRequest === true); },\r\n\t\t\t\t\t\tdetach : function(callbacks) { destroyHandle(handleId, callbacks); }\r\n\t\t\t\t\t};\r\n\t\t\t\tpluginHandles[handleId] = pluginHandle;\r\n\t\t\t\tcallbacks.success(pluginHandle);\r\n\t\t\t},\r\n\t\t\terror: function(textStatus, errorThrown) {\r\n\t\t\t\tJanus.error(textStatus + \": \" + errorThrown);\t// FIXME\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// Private method to send a message\r\n\tfunction sendMessage(handleId, callbacks) {\r\n\t\tcallbacks = callbacks || {};\r\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\r\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\r\n\t\tif(!connected) {\r\n\t\t\tJanus.warn(\"Is the gateway down? (connected=false)\");\r\n\t\t\tcallbacks.error(\"Is the gateway down? (connected=false)\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar message = callbacks.message;\r\n\t\tvar jsep = callbacks.jsep;\r\n\t\tvar transaction = Janus.randomString(12);\r\n\t\tvar request = { \"janus\": \"message\", \"body\": message, \"transaction\": transaction };\r\n\t\tif(token !== null && token !== undefined)\r\n\t\t\trequest[\"token\"] = token;\r\n\t\tif(apisecret !== null && apisecret !== undefined)\r\n\t\t\trequest[\"apisecret\"] = apisecret;\r\n\t\tif(jsep !== null && jsep !== undefined)\r\n\t\t\trequest.jsep = jsep;\r\n\t\tJanus.debug(\"Sending message to plugin (handle=\" + handleId + \"):\");\r\n\t\tJanus.debug(request);\r\n\t\tif(websockets) {\r\n\t\t\trequest[\"session_id\"] = sessionId;\r\n\t\t\trequest[\"handle_id\"] = handleId;\r\n\t\t\ttransactions[transaction] = function(json) {\r\n\t\t\t\tJanus.debug(\"Message sent!\");\r\n\t\t\t\tJanus.debug(json);\r\n\t\t\t\tif(json[\"janus\"] === \"success\") {\r\n\t\t\t\t\t// We got a success, must have been a synchronous transaction\r\n\t\t\t\t\tvar plugindata = json[\"plugindata\"];\r\n\t\t\t\t\tif(plugindata === undefined || plugindata === null) {\r\n\t\t\t\t\t\tJanus.warn(\"Request succeeded, but missing plugindata...\");\r\n\t\t\t\t\t\tcallbacks.success();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tJanus.log(\"Synchronous transaction successful (\" + plugindata[\"plugin\"] + \")\");\r\n\t\t\t\t\tvar data = plugindata[\"data\"];\r\n\t\t\t\t\tJanus.debug(data);\r\n\t\t\t\t\tcallbacks.success(data);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t} else if(json[\"janus\"] !== \"ack\") {\r\n\t\t\t\t\t// Not a success and not an ack, must be an error\r\n\t\t\t\t\tif(json[\"error\"] !== undefined && json[\"error\"] !== null) {\r\n\t\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\r\n\t\t\t\t\t\tcallbacks.error(json[\"error\"].code + \" \" + json[\"error\"].reason);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tJanus.error(\"Unknown error\");\t// FIXME\r\n\t\t\t\t\t\tcallbacks.error(\"Unknown error\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// If we got here, the plugin decided to handle the request asynchronously\r\n\t\t\t\tcallbacks.success();\r\n\t\t\t};\r\n\t\t\tws.send(JSON.stringify(request));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\r\n\t\t\tverb: 'POST',\r\n\t\t\twithCredentials: withCredentials,\r\n\t\t\tbody: request,\r\n\t\t\tsuccess: function(json) {\r\n\t\t\t\tJanus.debug(\"Message sent!\");\r\n\t\t\t\tJanus.debug(json);\r\n\t\t\t\tif(json[\"janus\"] === \"success\") {\r\n\t\t\t\t\t// We got a success, must have been a synchronous transaction\r\n\t\t\t\t\tvar plugindata = json[\"plugindata\"];\r\n\t\t\t\t\tif(plugindata === undefined || plugindata === null) {\r\n\t\t\t\t\t\tJanus.warn(\"Request succeeded, but missing plugindata...\");\r\n\t\t\t\t\t\tcallbacks.success();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tJanus.log(\"Synchronous transaction successful (\" + plugindata[\"plugin\"] + \")\");\r\n\t\t\t\t\tvar data = plugindata[\"data\"];\r\n\t\t\t\t\tJanus.debug(data);\r\n\t\t\t\t\tcallbacks.success(data);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t} else if(json[\"janus\"] !== \"ack\") {\r\n\t\t\t\t\t// Not a success and not an ack, must be an error\r\n\t\t\t\t\tif(json[\"error\"] !== undefined && json[\"error\"] !== null) {\r\n\t\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\r\n\t\t\t\t\t\tcallbacks.error(json[\"error\"].code + \" \" + json[\"error\"].reason);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tJanus.error(\"Unknown error\");\t// FIXME\r\n\t\t\t\t\t\tcallbacks.error(\"Unknown error\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// If we got here, the plugin decided to handle the request asynchronously\r\n\t\t\t\tcallbacks.success();\r\n\t\t\t},\r\n\t\t\terror: function(textStatus, errorThrown) {\r\n\t\t\t\tJanus.error(textStatus + \": \" + errorThrown);\t// FIXME\r\n\t\t\t\tcallbacks.error(textStatus + \": \" + errorThrown);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// Private method to send a trickle candidate\r\n\tfunction sendTrickleCandidate(handleId, candidate) {\r\n\t\tif(!connected) {\r\n\t\t\tJanus.warn(\"Is the gateway down? (connected=false)\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar request = { \"janus\": \"trickle\", \"candidate\": candidate, \"transaction\": Janus.randomString(12) };\r\n\t\tif(token !== null && token !== undefined)\r\n\t\t\trequest[\"token\"] = token;\r\n\t\tif(apisecret !== null && apisecret !== undefined)\r\n\t\t\trequest[\"apisecret\"] = apisecret;\r\n\t\tJanus.vdebug(\"Sending trickle candidate (handle=\" + handleId + \"):\");\r\n\t\tJanus.vdebug(request);\r\n\t\tif(websockets) {\r\n\t\t\trequest[\"session_id\"] = sessionId;\r\n\t\t\trequest[\"handle_id\"] = handleId;\r\n\t\t\tws.send(JSON.stringify(request));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\r\n\t\t\tverb: 'POST',\r\n\t\t\twithCredentials: withCredentials,\r\n\t\t\tbody: request,\r\n\t\t\tsuccess: function(json) {\r\n\t\t\t\tJanus.vdebug(\"Candidate sent!\");\r\n\t\t\t\tJanus.vdebug(json);\r\n\t\t\t\tif(json[\"janus\"] !== \"ack\") {\r\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function(textStatus, errorThrown) {\r\n\t\t\t\tJanus.error(textStatus + \": \" + errorThrown);\t// FIXME\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// Private method to send a data channel message\r\n\tfunction sendData(handleId, callbacks) {\r\n\t\tcallbacks = callbacks || {};\r\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\r\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\r\n\t\tvar pluginHandle = pluginHandles[handleId];\r\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\r\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\r\n\t\t\tJanus.warn(\"Invalid handle\");\r\n\t\t\tcallbacks.error(\"Invalid handle\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar config = pluginHandle.webrtcStuff;\r\n\t\tvar text = callbacks.text;\r\n\t\tif(text === null || text === undefined) {\r\n\t\t\tJanus.warn(\"Invalid text\");\r\n\t\t\tcallbacks.error(\"Invalid text\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tJanus.log(\"Sending string on data channel: \" + text);\r\n\t\tconfig.dataChannel.send(text);\r\n\t\tcallbacks.success();\r\n\t}\r\n\r\n\t// Private method to send a DTMF tone\r\n\tfunction sendDtmf(handleId, callbacks) {\r\n\t\tcallbacks = callbacks || {};\r\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\r\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\r\n\t\tvar pluginHandle = pluginHandles[handleId];\r\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\r\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\r\n\t\t\tJanus.warn(\"Invalid handle\");\r\n\t\t\tcallbacks.error(\"Invalid handle\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar config = pluginHandle.webrtcStuff;\r\n\t\tif(config.dtmfSender === null || config.dtmfSender === undefined) {\r\n\t\t\t// Create the DTMF sender, if possible\r\n\t\t\tif(config.myStream !== undefined && config.myStream !== null) {\r\n\t\t\t\tvar tracks = config.myStream.getAudioTracks();\r\n\t\t\t\tif(tracks !== null && tracks !== undefined && tracks.length > 0) {\r\n\t\t\t\t\tvar local_audio_track = tracks[0];\r\n\t\t\t\t\tconfig.dtmfSender = config.pc.createDTMFSender(local_audio_track);\r\n\t\t\t\t\tJanus.log(\"Created DTMF Sender\");\r\n\t\t\t\t\tconfig.dtmfSender.ontonechange = function(tone) { Janus.debug(\"Sent DTMF tone: \" + tone.tone); };\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(config.dtmfSender === null || config.dtmfSender === undefined) {\r\n\t\t\t\tJanus.warn(\"Invalid DTMF configuration\");\r\n\t\t\t\tcallbacks.error(\"Invalid DTMF configuration\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar dtmf = callbacks.dtmf;\r\n\t\tif(dtmf === null || dtmf === undefined) {\r\n\t\t\tJanus.warn(\"Invalid DTMF parameters\");\r\n\t\t\tcallbacks.error(\"Invalid DTMF parameters\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar tones = dtmf.tones;\r\n\t\tif(tones === null || tones === undefined) {\r\n\t\t\tJanus.warn(\"Invalid DTMF string\");\r\n\t\t\tcallbacks.error(\"Invalid DTMF string\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar duration = dtmf.duration;\r\n\t\tif(duration === null || duration === undefined)\r\n\t\t\tduration = 500;\t// We choose 500ms as the default duration for a tone\r\n\t\tvar gap = dtmf.gap;\r\n\t\tif(gap === null || gap === undefined)\r\n\t\t\tgap = 50;\t// We choose 50ms as the default gap between tones\r\n\t\tJanus.debug(\"Sending DTMF string \" + tones + \" (duration \" + duration + \"ms, gap \" + gap + \"ms)\");\r\n\t\tconfig.dtmfSender.insertDTMF(tones, duration, gap);\r\n\t}\r\n\r\n\t// Private method to destroy a plugin handle\r\n\tfunction destroyHandle(handleId, callbacks) {\r\n\t\tcallbacks = callbacks || {};\r\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\r\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\r\n\t\tvar asyncRequest = true;\r\n\t\tif(callbacks.asyncRequest !== undefined && callbacks.asyncRequest !== null)\r\n\t\t\tasyncRequest = (callbacks.asyncRequest === true);\r\n\t\tJanus.log(\"Destroying handle \" + handleId + \" (async=\" + asyncRequest + \")\");\r\n\t\tcleanupWebrtc(handleId);\r\n\t\tif (pluginHandles[handleId].detached) {\r\n\t\t\t// Plugin was already detached by Janus, calling detach again will return a handle not found error, so just exit here\r\n\t\t\tdelete pluginHandles[handleId];\r\n\t\t\tcallbacks.success();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!connected) {\r\n\t\t\tJanus.warn(\"Is the gateway down? (connected=false)\");\r\n\t\t\tcallbacks.error(\"Is the gateway down? (connected=false)\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar request = { \"janus\": \"detach\", \"transaction\": Janus.randomString(12) };\r\n\t\tif(token !== null && token !== undefined)\r\n\t\t\trequest[\"token\"] = token;\r\n\t\tif(apisecret !== null && apisecret !== undefined)\r\n\t\t\trequest[\"apisecret\"] = apisecret;\r\n\t\tif(websockets) {\r\n\t\t\trequest[\"session_id\"] = sessionId;\r\n\t\t\trequest[\"handle_id\"] = handleId;\r\n\t\t\tws.send(JSON.stringify(request));\r\n\t\t\tdelete pluginHandles[handleId];\r\n\t\t\tcallbacks.success();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\r\n\t\t\tverb: 'POST',\r\n\t\t\tasync: asyncRequest,\t// Sometimes we need false here, or destroying in onbeforeunload won't work\r\n\t\t\twithCredentials: withCredentials,\r\n\t\t\tbody: request,\r\n\t\t\tsuccess: function(json) {\r\n\t\t\t\tJanus.log(\"Destroyed handle:\");\r\n\t\t\t\tJanus.debug(json);\r\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\r\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\r\n\t\t\t\t}\r\n\t\t\t\tdelete pluginHandles[handleId];\r\n\t\t\t\tcallbacks.success();\r\n\t\t\t},\r\n\t\t\terror: function(textStatus, errorThrown) {\r\n\t\t\t\tJanus.error(textStatus + \": \" + errorThrown);\t// FIXME\r\n\t\t\t\t// We cleanup anyway\r\n\t\t\t\tdelete pluginHandles[handleId];\r\n\t\t\t\tcallbacks.success();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// WebRTC stuff\r\n\tfunction streamsDone(handleId, jsep, media, callbacks, stream) {\r\n\t\tconsole.warn(\"streamsDone\", media);\r\n\t\tvar pluginHandle = pluginHandles[handleId];\r\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\r\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\r\n\t\t\tJanus.warn(\"Invalid handle\");\r\n\t\t\tcallbacks.error(\"Invalid handle\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar config = pluginHandle.webrtcStuff;\r\n\t\tJanus.debug(\"streamsDone:\", stream);\r\n\t\tif(stream) {\r\n\t\t\tJanus.debug(\"  -- Audio tracks:\", stream.getAudioTracks());\r\n\t\t\tJanus.debug(\"  -- Video tracks:\", stream.getVideoTracks());\r\n\t\t}\r\n\t\t// If we're updating, check if we need to remove/replace one of the tracks\r\n\t\tif(media.update && !config.streamExternal) {\r\n\t\t\tif(media.removeAudio || media.replaceAudio) {\r\n\t\t\t\tif(config.myStream && config.myStream.getAudioTracks() && config.myStream.getAudioTracks().length) {\r\n\t\t\t\t\tJanus.log(\"Removing audio track:\", config.myStream.getAudioTracks()[0]);\r\n\t\t\t\t\tconfig.myStream.removeTrack(config.myStream.getAudioTracks()[0]);\r\n\t\t\t\t}\r\n\t\t\t\tif(config.pc.getSenders() && config.pc.getSenders().length) {\r\n\t\t\t\t\tfor(var index in config.pc.getSenders()) {\r\n\t\t\t\t\t\tvar s = config.pc.getSenders()[index];\r\n\t\t\t\t\t\tif(s && s.track && s.track.kind === \"audio\") {\r\n\t\t\t\t\t\t\tJanus.log(\"Removing audio sender:\", s);\r\n\t\t\t\t\t\t\tconfig.pc.removeTrack(s);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(media.removeVideo || media.replaceVideo) {\r\n\t\t\t\tif(config.myStream && config.myStream.getVideoTracks() && config.myStream.getVideoTracks().length) {\r\n\t\t\t\t\tJanus.log(\"Removing video track:\", config.myStream.getVideoTracks()[0]);\r\n\t\t\t\t\tconfig.myStream.removeTrack(config.myStream.getVideoTracks()[0]);\r\n\t\t\t\t}\r\n\t\t\t\tif(config.pc.getSenders() && config.pc.getSenders().length) {\r\n\t\t\t\t\tfor(var index in config.pc.getSenders()) {\r\n\t\t\t\t\t\tvar s = config.pc.getSenders()[index];\r\n\t\t\t\t\t\tif(s && s.track && s.track.kind === \"video\") {\r\n\t\t\t\t\t\t\tJanus.log(\"Removing video sender:\", s);\r\n\t\t\t\t\t\t\tconfig.pc.removeTrack(s);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// We're now capturing the new stream: check if we're updating or if it's a new thing\r\n\t\tvar addTracks = false;\r\n\t\tif(!config.myStream || !media.update || config.streamExternal) {\r\n\t\t\tconfig.myStream = stream;\r\n\t\t\taddTracks = true;\r\n\t\t} else {\r\n\t\t\t// We only need to update the existing stream\r\n\t\t\tif(((!media.update && isAudioSendEnabled(media)) || (media.update && (media.addAudio || media.replaceAudio))) &&\r\n\t\t\t\t\tstream.getAudioTracks() && stream.getAudioTracks().length) {\r\n\t\t\t\tJanus.log(\"Adding audio track:\", stream.getAudioTracks()[0]);\r\n\t\t\t\tconfig.myStream.addTrack(stream.getAudioTracks()[0]);\r\n\t\t\t\tconfig.pc.addTrack(stream.getAudioTracks()[0], stream);\r\n\t\t\t}\r\n\t\t\tif(((!media.update && isVideoSendEnabled(media)) || (media.update && (media.addVideo || media.replaceVideo))) &&\r\n\t\t\t\t\tstream.getVideoTracks() && stream.getVideoTracks().length) {\r\n\t\t\t\tJanus.log(\"Adding video track:\", stream.getVideoTracks()[0]);\r\n\t\t\t\tconfig.myStream.addTrack(stream.getVideoTracks()[0]);\r\n\t\t\t\tconfig.pc.addTrack(stream.getVideoTracks()[0], stream);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// If we still need to create a PeerConnection, let's do that\r\n\t\tif(!config.pc) {\r\n\t\t\tvar pc_config = {\"iceServers\": iceServers, \"iceTransportPolicy\": iceTransportPolicy, \"bundlePolicy\": bundlePolicy};\r\n\t\t\t//~ var pc_constraints = {'mandatory': {'MozDontOfferDataChannel':true}};\r\n\t\t\tvar pc_constraints = {\r\n\t\t\t\t\"optional\": [{\"DtlsSrtpKeyAgreement\": true}]\r\n\t\t\t};\r\n\t\t\tif(ipv6Support === true) {\r\n\t\t\t\t// FIXME This is only supported in Chrome right now\r\n\t\t\t\t// For support in Firefox track this: https://bugzilla.mozilla.org/show_bug.cgi?id=797262\r\n\t\t\t\tpc_constraints.optional.push({\"googIPv6\":true});\r\n\t\t\t}\r\n\t\t\t// Any custom constraint to add?\r\n\t\t\tif(callbacks.rtcConstraints && typeof callbacks.rtcConstraints === 'object') {\r\n\t\t\t\tJanus.debug(\"Adding custom PeerConnection constraints:\", callbacks.rtcConstraints);\r\n\t\t\t\tfor(var i in callbacks.rtcConstraints) {\r\n\t\t\t\t\tpc_constraints.optional.push(callbacks.rtcConstraints[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"edge\") {\r\n\t\t\t\t// This is Edge, enable BUNDLE explicitly\r\n\t\t\t\tpc_config.bundlePolicy = \"max-bundle\";\r\n\t\t\t}\r\n\t\t\tJanus.log(\"Creating PeerConnection\");\r\n\t\t\tJanus.debug(pc_constraints);\r\n\t\t\tconfig.pc = new RTCPeerConnection(pc_config, pc_constraints);\r\n\t\t\tJanus.debug(config.pc);\r\n\t\t\tif(config.pc.getStats) {\t// FIXME\r\n\t\t\t\tconfig.volume.value = 0;\r\n\t\t\t\tconfig.bitrate.value = \"0 kbits/sec\";\r\n\t\t\t}\r\n\t\t\tJanus.log(\"Preparing local SDP and gathering candidates (trickle=\" + config.trickle + \")\");\r\n\t\t\tconfig.pc.oniceconnectionstatechange = function(e) {\r\n\t\t\t\tif(config.pc)\r\n\t\t\t\t\tpluginHandle.iceState(config.pc.iceConnectionState);\r\n\t\t\t};\r\n\t\t\tconfig.pc.onicecandidate = function(event) {\r\n\t\t\t\tif (event.candidate == null ||\r\n\t\t\t\t\t\t(Janus.webRTCAdapter.browserDetails.browser === 'edge' && event.candidate.candidate.indexOf('endOfCandidates') > 0)) {\r\n\t\t\t\t\tJanus.log(\"End of candidates.\");\r\n\t\t\t\t\tconfig.iceDone = true;\r\n\t\t\t\t\tif(config.trickle === true) {\r\n\t\t\t\t\t\t// Notify end of candidates\r\n\t\t\t\t\t\tsendTrickleCandidate(handleId, {\"completed\": true});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// No trickle, time to send the complete SDP (including all candidates)\r\n\t\t\t\t\t\tsendSDP(handleId, callbacks);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// JSON.stringify doesn't work on some WebRTC objects anymore\r\n\t\t\t\t\t// See https://code.google.com/p/chromium/issues/detail?id=467366\r\n\t\t\t\t\tvar candidate = {\r\n\t\t\t\t\t\t\"candidate\": event.candidate.candidate,\r\n\t\t\t\t\t\t\"sdpMid\": event.candidate.sdpMid,\r\n\t\t\t\t\t\t\"sdpMLineIndex\": event.candidate.sdpMLineIndex\r\n\t\t\t\t\t};\r\n\t\t\t\t\tif(config.trickle === true) {\r\n\t\t\t\t\t\t// Send candidate\r\n\t\t\t\t\t\tsendTrickleCandidate(handleId, candidate);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tconfig.pc.ontrack = function(event) {\r\n\t\t\t\tJanus.log(\"Handling Remote Track\");\r\n\t\t\t\tJanus.debug(event);\r\n\t\t\t\tif(!event.streams)\r\n\t\t\t\t\treturn;\r\n\t\t\t\tconfig.remoteStream = event.streams[0];\r\n\t\t\t\tpluginHandle.onremotestream(config.remoteStream);\r\n\t\t\t\tif(event.track && !event.track.onended) {\r\n\t\t\t\t\tJanus.log(\"Adding onended callback to track:\", event.track);\r\n\t\t\t\t\tevent.track.onended = function(ev) {\r\n\t\t\t\t\t\tJanus.log(\"Remote track removed:\", ev);\r\n\t\t\t\t\t\tif(config.remoteStream) {\r\n\t\t\t\t\t\t\tconfig.remoteStream.removeTrack(ev.target);\r\n\t\t\t\t\t\t\tpluginHandle.onremotestream(config.remoteStream);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\tif(addTracks && stream !== null && stream !== undefined) {\r\n\t\t\tJanus.log('Adding local stream');\r\n\t\t\tstream.getTracks().forEach(function(track) { config.pc.addTrack(track, stream); });\r\n\t\t}\r\n\t\t// Any data channel to create?\r\n\t\tif(isDataEnabled(media) && !config.dataChannel) {\r\n\t\t\tJanus.log(\"Creating data channel\");\r\n\t\t\tvar onDataChannelMessage = function(event) {\r\n\t\t\t\tJanus.log('Received message on data channel: ' + event.data);\r\n\t\t\t\tpluginHandle.ondata(event.data);\t// FIXME\r\n\t\t\t};\r\n\t\t\tvar onDataChannelStateChange = function() {\r\n\t\t\t\tvar dcState = config.dataChannel !== null ? config.dataChannel.readyState : \"null\";\r\n\t\t\t\tJanus.log('State change on data channel: ' + dcState);\r\n\t\t\t\tif(dcState === 'open') {\r\n\t\t\t\t\tpluginHandle.ondataopen();\t// FIXME\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tvar onDataChannelError = function(error) {\r\n\t\t\t\tJanus.error('Got error on data channel:', error);\r\n\t\t\t\t// TODO\r\n\t\t\t};\r\n\t\t\t// Until we implement the proxying of open requests within the Janus core, we open a channel ourselves whatever the case\r\n\t\t\tconfig.dataChannel = config.pc.createDataChannel(\"JanusDataChannel\", {ordered:false});\t// FIXME Add options (ordered, maxRetransmits, etc.)\r\n\t\t\tconfig.dataChannel.onmessage = onDataChannelMessage;\r\n\t\t\tconfig.dataChannel.onopen = onDataChannelStateChange;\r\n\t\t\tconfig.dataChannel.onclose = onDataChannelStateChange;\r\n\t\t\tconfig.dataChannel.onerror = onDataChannelError;\r\n\t\t}\r\n\t\t// If there's a new local stream, let's notify the application\r\n\t\tif(config.myStream)\r\n\t\t\tpluginHandle.onlocalstream(config.myStream);\r\n\t\t// Create offer/answer now\r\n\t\tif(jsep === null || jsep === undefined) {\r\n\t\t\tcreateOffer(handleId, media, callbacks);\r\n\t\t} else {\r\n\t\t\tconfig.pc.setRemoteDescription(\r\n\t\t\t\t\tnew RTCSessionDescription(jsep),\r\n\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\tJanus.log(\"Remote description accepted!\");\r\n\t\t\t\t\t\tcreateAnswer(handleId, media, callbacks);\r\n\t\t\t\t\t}, callbacks.error);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction prepareWebrtc(handleId, callbacks) {\r\n\t\tcallbacks = callbacks || {};\r\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\r\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : webrtcError;\r\n\t\tvar jsep = callbacks.jsep;\r\n\t\tcallbacks.media = callbacks.media || { audio: true, video: true };\r\n\t\tvar media = callbacks.media;\r\n\t\tvar pluginHandle = pluginHandles[handleId];\r\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\r\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\r\n\t\t\tJanus.warn(\"Invalid handle\");\r\n\t\t\tcallbacks.error(\"Invalid handle\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar config = pluginHandle.webrtcStuff;\r\n\t\t// Are we updating a session?\r\n\t\tif(config.pc === undefined || config.pc === null) {\r\n\t\t\t// Nope, new PeerConnection\r\n\t\t\tmedia.update = false;\r\n\t\t} else if(config.pc !== undefined && config.pc !== null) {\r\n\t\t\tJanus.log(\"Updating existing media session\");\r\n\t\t\tmedia.update = true;\r\n\t\t\t// Check if there's anything do add/remove/replace, or if we\r\n\t\t\t// can go directly to preparing the new SDP offer or answer\r\n\t\t\tif(callbacks.stream !== null && callbacks.stream !== undefined) {\r\n\t\t\t\t// External stream: is this the same as the one we were using before?\r\n\t\t\t\tif(callbacks.stream !== config.myStream) {\r\n\t\t\t\t\tJanus.log(\"Renegotiation involves a new external stream\");\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Check if there are changes on audio\r\n\t\t\t\tif(media.addAudio) {\r\n\t\t\t\t\tmedia.replaceAudio = false;\r\n\t\t\t\t\tmedia.removeAudio = false;\r\n\t\t\t\t\tmedia.audioSend = true;\r\n\t\t\t\t\tif(config.myStream && config.myStream.getAudioTracks() && config.myStream.getAudioTracks().length) {\r\n\t\t\t\t\t\tJanus.error(\"Can't add audio stream, there already is one\");\r\n\t\t\t\t\t\tcallbacks.error(\"Can't add audio stream, there already is one\");\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if(media.removeAudio) {\r\n\t\t\t\t\tmedia.replaceAudio = false;\r\n\t\t\t\t\tmedia.addAudio = false;\r\n\t\t\t\t\tmedia.audioSend = false;\r\n\t\t\t\t} else if(media.replaceAudio) {\r\n\t\t\t\t\tmedia.addAudio = false;\r\n\t\t\t\t\tmedia.removeAudio = false;\r\n\t\t\t\t\tmedia.audioSend = true;\r\n\t\t\t\t}\r\n\t\t\t\tif(config.myStream === null || config.myStream === undefined) {\r\n\t\t\t\t\t// No media stream: if we were asked to replace, it's actually an \"add\"\r\n\t\t\t\t\tif(media.replaceAudio) {\r\n\t\t\t\t\t\tmedia.replaceAudio = false;\r\n\t\t\t\t\t\tmedia.addAudio = true;\r\n\t\t\t\t\t\tmedia.audioSend = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(isAudioSendEnabled(media))\r\n\t\t\t\t\t\tmedia.addAudio = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(config.myStream.getAudioTracks() === null\r\n\t\t\t\t\t\t\t|| config.myStream.getAudioTracks() === undefined\r\n\t\t\t\t\t\t\t|| config.myStream.getAudioTracks().length === 0) {\r\n\t\t\t\t\t\t// No audio track: if we were asked to replace, it's actually an \"add\"\r\n\t\t\t\t\t\tif(media.replaceAudio) {\r\n\t\t\t\t\t\t\tmedia.replaceAudio = false;\r\n\t\t\t\t\t\t\tmedia.addAudio = true;\r\n\t\t\t\t\t\t\tmedia.audioSend = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(isAudioSendEnabled(media))\r\n\t\t\t\t\t\t\tmedia.addAudio = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// Check if there are changes on video\r\n\t\t\t\tif(media.addVideo) {\r\n\t\t\t\t\tmedia.replaceVideo = false;\r\n\t\t\t\t\tmedia.removeVideo = false;\r\n\t\t\t\t\tmedia.videoSend = true;\r\n\t\t\t\t\tif(config.myStream && config.myStream.getVideoTracks() && config.myStream.getVideoTracks().length) {\r\n\t\t\t\t\t\tJanus.error(\"Can't add video stream, there already is one\");\r\n\t\t\t\t\t\tcallbacks.error(\"Can't add video stream, there already is one\");\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if(media.removeVideo) {\r\n\t\t\t\t\tmedia.replaceVideo = false;\r\n\t\t\t\t\tmedia.addVideo = false;\r\n\t\t\t\t\tmedia.videoSend = false;\r\n\t\t\t\t} else if(media.replaceVideo) {\r\n\t\t\t\t\tmedia.addVideo = false;\r\n\t\t\t\t\tmedia.removeVideo = false;\r\n\t\t\t\t\tmedia.videoSend = true;\r\n\t\t\t\t}\r\n\t\t\t\tif(config.myStream === null || config.myStream === undefined) {\r\n\t\t\t\t\t// No media stream: if we were asked to replace, it's actually an \"add\"\r\n\t\t\t\t\tif(media.replaceVideo) {\r\n\t\t\t\t\t\tmedia.replaceVideo = false;\r\n\t\t\t\t\t\tmedia.addVideo = true;\r\n\t\t\t\t\t\tmedia.videoSend = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(isVideoSendEnabled(media))\r\n\t\t\t\t\t\tmedia.addVideo = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(config.myStream.getVideoTracks() === null\r\n\t\t\t\t\t\t\t|| config.myStream.getVideoTracks() === undefined\r\n\t\t\t\t\t\t\t|| config.myStream.getVideoTracks().length === 0) {\r\n\t\t\t\t\t\t// No video track: if we were asked to replace, it's actually an \"add\"\r\n\t\t\t\t\t\tif(media.replaceVideo) {\r\n\t\t\t\t\t\t\tmedia.replaceVideo = false;\r\n\t\t\t\t\t\t\tmedia.addVideo = true;\r\n\t\t\t\t\t\t\tmedia.videoSend = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(isVideoSendEnabled(media))\r\n\t\t\t\t\t\t\tmedia.addVideo = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// Data channels can only be added\r\n\t\t\t\tif(media.addData)\r\n\t\t\t\t\tmedia.data = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tconfig.trickle = isTrickleEnabled(callbacks.trickle);\r\n\t\t// Was a MediaStream object passed, or do we need to take care of that?\r\n\t\tif(callbacks.stream !== null && callbacks.stream !== undefined) {\r\n\t\t\tvar stream = callbacks.stream;\r\n\t\t\tJanus.log(\"MediaStream provided by the application\");\r\n\t\t\tJanus.debug(stream);\r\n\t\t\t// If this is an update, let's check if we need to release the previous stream\r\n\t\t\tif(media.update) {\r\n\t\t\t\tif(config.myStream && config.myStream !== callbacks.stream && !config.streamExternal) {\r\n\t\t\t\t\t// We're replacing a stream we captured ourselves with an external one\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// Try a MediaStreamTrack.stop() for each track\r\n\t\t\t\t\t\tvar tracks = config.myStream.getTracks();\r\n\t\t\t\t\t\tfor(var i in tracks) {\r\n\t\t\t\t\t\t\tvar mst = tracks[i];\r\n\t\t\t\t\t\t\tJanus.log(mst);\r\n\t\t\t\t\t\t\tif(mst !== null && mst !== undefined)\r\n\t\t\t\t\t\t\t\tmst.stop();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\t// Do nothing if this fails\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconfig.myStream = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// Skip the getUserMedia part\r\n\t\t\tconfig.streamExternal = true;\r\n\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(isAudioSendEnabled(media) || isVideoSendEnabled(media)) {\r\n\t\t\tvar constraints = { mandatory: {}, optional: []};\r\n\t\t\tpluginHandle.consentDialog(true);\r\n\t\t\tvar audioSupport = isAudioSendEnabled(media);\r\n\t\t\tif(audioSupport === true && media != undefined && media != null) {\r\n\t\t\t\tif(typeof media.audio === 'object') {\r\n\t\t\t\t\taudioSupport = media.audio;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar videoSupport = isVideoSendEnabled(media);\r\n\t\t\tif(videoSupport === true && media != undefined && media != null) {\r\n\t\t\t\tvar simulcast = callbacks.simulcast === true ? true : false;\r\n\t\t\t\tif(simulcast && !jsep && (media.video === undefined || media.video === false))\r\n\t\t\t\t\tmedia.video = \"hires\";\r\n\t\t\t\tif(media.video && media.video != 'screen' && media.video != 'window') {\r\n\t\t\t\t\tif(typeof media.video === 'object') {\r\n\t\t\t\t\t\tvideoSupport = media.video;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar width = 0;\r\n\t\t\t\t\t\tvar height = 0, maxHeight = 0;\r\n\t\t\t\t\t\tif(media.video === 'lowres') {\r\n\t\t\t\t\t\t\t// Small resolution, 4:3\r\n\t\t\t\t\t\t\theight = 240;\r\n\t\t\t\t\t\t\tmaxHeight = 240;\r\n\t\t\t\t\t\t\twidth = 320;\r\n\t\t\t\t\t\t} else if(media.video === 'lowres-16:9') {\r\n\t\t\t\t\t\t\t// Small resolution, 16:9\r\n\t\t\t\t\t\t\theight = 180;\r\n\t\t\t\t\t\t\tmaxHeight = 180;\r\n\t\t\t\t\t\t\twidth = 320;\r\n\t\t\t\t\t\t} else if(media.video === 'hires' || media.video === 'hires-16:9' || media.video === 'hdres') {\r\n\t\t\t\t\t\t\t// High(HD) resolution is only 16:9\r\n\t\t\t\t\t\t\theight = 720;\r\n\t\t\t\t\t\t\tmaxHeight = 720;\r\n\t\t\t\t\t\t\twidth = 1280;\r\n\t\t\t\t\t\t} else if(media.video === 'fhdres') {\r\n\t\t\t\t\t\t\t// Full HD resolution is only 16:9\r\n\t\t\t\t\t\t\theight = 1080;\r\n\t\t\t\t\t\t\tmaxHeight = 1080;\r\n\t\t\t\t\t\t\twidth = 1920;\r\n\t\t\t\t\t\t} else if(media.video === '4kres') {\r\n\t\t\t\t\t\t\t// 4K resolution is only 16:9\r\n\t\t\t\t\t\t\theight = 2160;\r\n\t\t\t\t\t\t\tmaxHeight = 2160;\r\n\t\t\t\t\t\t\twidth = 3840;\r\n\t\t\t\t\t\t} else if(media.video === 'stdres') {\r\n\t\t\t\t\t\t\t// Normal resolution, 4:3\r\n\t\t\t\t\t\t\theight = 480;\r\n\t\t\t\t\t\t\tmaxHeight = 480;\r\n\t\t\t\t\t\t\twidth  = 640;\r\n\t\t\t\t\t\t} else if(media.video === 'stdres-16:9') {\r\n\t\t\t\t\t\t\t// Normal resolution, 16:9\r\n\t\t\t\t\t\t\theight = 360;\r\n\t\t\t\t\t\t\tmaxHeight = 360;\r\n\t\t\t\t\t\t\twidth = 640;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tJanus.log(\"Default video setting is stdres 4:3\");\r\n\t\t\t\t\t\t\theight = 480;\r\n\t\t\t\t\t\t\tmaxHeight = 480;\r\n\t\t\t\t\t\t\twidth = 640;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tJanus.log(\"Adding media constraint:\", media.video);\r\n\t\t\t\t\t\tvideoSupport = {\r\n\t\t\t\t\t\t\t'height': {'ideal': height},\r\n\t\t\t\t\t\t\t'width':  {'ideal': width}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tif(media.videoFrameRate){\r\n\t\t\t\t\t\t\tvideoSupport[\"frameRate\"] = media.videoFrameRate;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tJanus.debug(\"Adding video constraint:\", videoSupport);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if(media.video === 'screen' || media.video === 'window') {\r\n\t\t\t\t\tif(!media.screenshareFrameRate) {\r\n\t\t\t\t\t\tmedia.screenshareFrameRate = 3;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Not a webcam, but screen capture\r\n\t\t\t\t\tif(window.location.protocol !== 'https:') {\r\n\t\t\t\t\t\t// Screen sharing mandates HTTPS\r\n\t\t\t\t\t\tJanus.warn(\"Screen sharing only works on HTTPS, try the https:// version of this page\");\r\n\t\t\t\t\t\tpluginHandle.consentDialog(false);\r\n\t\t\t\t\t\tcallbacks.error(\"Screen sharing only works on HTTPS, try the https:// version of this page\");\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// We're going to try and use the extension for Chrome 34+, the old approach\r\n\t\t\t\t\t// for older versions of Chrome, or the experimental support in Firefox 33+\r\n\t\t\t\t\tvar cache = {};\r\n\t\t\t\t\tfunction callbackUserMedia (error, stream) {\r\n\t\t\t\t\t\tpluginHandle.consentDialog(false);\r\n\t\t\t\t\t\tif(error) {\r\n\t\t\t\t\t\t\tcallbacks.error({code: error.code, name: error.name, message: error.message});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfunction getScreenMedia(constraints, gsmCallback, useAudio) {\r\n\t\t\t\t\t\tJanus.log(\"Adding media constraint (screen capture)\");\r\n\t\t\t\t\t\tJanus.debug(constraints);\r\n\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia(constraints)\r\n\t\t\t\t\t\t\t.then(function(stream) {\r\n\t\t\t\t\t\t\t\tif(useAudio){\r\n\t\t\t\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia({ audio: true, video: false })\r\n\t\t\t\t\t\t\t\t\t.then(function (audioStream) {\r\n\t\t\t\t\t\t\t\t\t\tstream.addTrack(audioStream.getAudioTracks()[0]);\r\n\t\t\t\t\t\t\t\t\t\tgsmCallback(null, stream);\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tgsmCallback(null, stream);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.catch(function(error) { pluginHandle.consentDialog(false); gsmCallback(error); });\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === 'chrome') {\r\n\t\t\t\t\t\tvar chromever = Janus.webRTCAdapter.browserDetails.version;\r\n\t\t\t\t\t\tvar maxver = 33;\r\n\t\t\t\t\t\tif(window.navigator.userAgent.match('Linux'))\r\n\t\t\t\t\t\t\tmaxver = 35;\t// \"known\" crash in chrome 34 and 35 on linux\r\n\t\t\t\t\t\tif(chromever >= 26 && chromever <= maxver) {\r\n\t\t\t\t\t\t\t// Chrome 26->33 requires some awkward chrome://flags manipulation\r\n\t\t\t\t\t\t\tconstraints = {\r\n\t\t\t\t\t\t\t\tvideo: {\r\n\t\t\t\t\t\t\t\t\tmandatory: {\r\n\t\t\t\t\t\t\t\t\t\tgoogLeakyBucket: true,\r\n\t\t\t\t\t\t\t\t\t\tmaxWidth: window.screen.width,\r\n\t\t\t\t\t\t\t\t\t\tmaxHeight: window.screen.height,\r\n\t\t\t\t\t\t\t\t\t\tminFrameRate: media.screenshareFrameRate,\r\n\t\t\t\t\t\t\t\t\t\tmaxFrameRate: media.screenshareFrameRate,\r\n\t\t\t\t\t\t\t\t\t\tchromeMediaSource: 'screen'\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\taudio: isAudioSendEnabled(media)\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tgetScreenMedia(constraints, callbackUserMedia);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Chrome 34+ requires an extension\r\n\t\t\t\t\t\t\tvar pending = window.setTimeout(\r\n\t\t\t\t\t\t\t\tfunction () {\r\n\t\t\t\t\t\t\t\t\terror = new Error('NavigatorUserMediaError');\r\n\t\t\t\t\t\t\t\t\terror.name = 'The required Chrome extension is not installed: click <a href=\"#\">here</a> to install it. (NOTE: this will need you to refresh the page)';\r\n\t\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\r\n\t\t\t\t\t\t\t\t\treturn callbacks.error(error);\r\n\t\t\t\t\t\t\t\t}, 1000);\r\n\t\t\t\t\t\t\tcache[pending] = [callbackUserMedia, null];\r\n\t\t\t\t\t\t\twindow.postMessage({ type: 'janusGetScreen', id: pending }, '*');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (window.navigator.userAgent.match('Firefox')) {\r\n\t\t\t\t\t\tvar ffver = parseInt(window.navigator.userAgent.match(/Firefox\\/(.*)/)[1], 10);\r\n\t\t\t\t\t\tif(ffver >= 33) {\r\n\t\t\t\t\t\t\t// Firefox 33+ has experimental support for screen sharing\r\n\t\t\t\t\t\t\tconstraints = {\r\n\t\t\t\t\t\t\t\tvideo: {\r\n\t\t\t\t\t\t\t\t\tmozMediaSource: media.video,\r\n\t\t\t\t\t\t\t\t\tmediaSource: media.video\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\taudio: isAudioSendEnabled(media)\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tgetScreenMedia(constraints, function (err, stream) {\r\n\t\t\t\t\t\t\t\tcallbackUserMedia(err, stream);\r\n\t\t\t\t\t\t\t\t// Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=1045810\r\n\t\t\t\t\t\t\t\tif (!err) {\r\n\t\t\t\t\t\t\t\t\tvar lastTime = stream.currentTime;\r\n\t\t\t\t\t\t\t\t\tvar polly = window.setInterval(function () {\r\n\t\t\t\t\t\t\t\t\t\tif(!stream)\r\n\t\t\t\t\t\t\t\t\t\t\twindow.clearInterval(polly);\r\n\t\t\t\t\t\t\t\t\t\tif(stream.currentTime == lastTime) {\r\n\t\t\t\t\t\t\t\t\t\t\twindow.clearInterval(polly);\r\n\t\t\t\t\t\t\t\t\t\t\tif(stream.onended) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tstream.onended();\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tlastTime = stream.currentTime;\r\n\t\t\t\t\t\t\t\t\t}, 500);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar error = new Error('NavigatorUserMediaError');\r\n\t\t\t\t\t\t\terror.name = 'Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)';\r\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\r\n\t\t\t\t\t\t\tcallbacks.error(error);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Wait for events from the Chrome Extension\r\n\t\t\t\t\twindow.addEventListener('message', function (event) {\r\n\t\t\t\t\t\tif(event.origin != window.location.origin)\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\tif(event.data.type == 'janusGotScreen' && cache[event.data.id]) {\r\n\t\t\t\t\t\t\tvar data = cache[event.data.id];\r\n\t\t\t\t\t\t\tvar callback = data[0];\r\n\t\t\t\t\t\t\tdelete cache[event.data.id];\r\n\r\n\t\t\t\t\t\t\tif (event.data.sourceId === '') {\r\n\t\t\t\t\t\t\t\t// user canceled\r\n\t\t\t\t\t\t\t\tvar error = new Error('NavigatorUserMediaError');\r\n\t\t\t\t\t\t\t\terror.name = 'You cancelled the request for permission, giving up...';\r\n\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\r\n\t\t\t\t\t\t\t\tcallbacks.error(error);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tconstraints = {\r\n\t\t\t\t\t\t\t\t\taudio: false,\r\n\t\t\t\t\t\t\t\t\tvideo: {\r\n\t\t\t\t\t\t\t\t\t\tmandatory: {\r\n\t\t\t\t\t\t\t\t\t\t\tchromeMediaSource: 'desktop',\r\n\t\t\t\t\t\t\t\t\t\t\tmaxWidth: window.screen.width,\r\n\t\t\t\t\t\t\t\t\t\t\tmaxHeight: window.screen.height,\r\n\t\t\t\t\t\t\t\t\t\t\tminFrameRate: media.screenshareFrameRate,\r\n\t\t\t\t\t\t\t\t\t\t\tmaxFrameRate: media.screenshareFrameRate,\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\toptional: [\r\n\t\t\t\t\t\t\t\t\t\t\t{googLeakyBucket: true},\r\n\t\t\t\t\t\t\t\t\t\t\t{googTemporalLayeredScreencast: true}\r\n\t\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\tconstraints.video.mandatory.chromeMediaSourceId = event.data.sourceId;\r\n\t\t\t\t\t\t\t\tgetScreenMedia(constraints, callback, isAudioSendEnabled(media));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (event.data.type == 'janusGetScreenPending') {\r\n\t\t\t\t\t\t\twindow.clearTimeout(event.data.id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// If we got here, we're not screensharing\r\n\t\t\tif(media === null || media === undefined || media.video !== 'screen') {\r\n\t\t\t\t// Check whether all media sources are actually available or not\r\n\t\t\t\tnavigator.mediaDevices.enumerateDevices().then(function(devices) {\r\n\t\t\t\t\tvar audioExist = devices.some(function(device) {\r\n\t\t\t\t\t\treturn device.kind === 'audioinput';\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tvideoExist = devices.some(function(device) {\r\n\t\t\t\t\t\treturn device.kind === 'videoinput';\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Check whether a missing device is really a problem\r\n\t\t\t\t\tvar audioSend = isAudioSendEnabled(media);\r\n\t\t\t\t\tvar videoSend = isVideoSendEnabled(media);\r\n\t\t\t\t\tvar needAudioDevice = isAudioSendRequired(media);\r\n\t\t\t\t\tvar needVideoDevice = isVideoSendRequired(media);\r\n\t\t\t\t\tif(audioSend || videoSend || needAudioDevice || needVideoDevice) {\r\n\t\t\t\t\t\t// We need to send either audio or video\r\n\t\t\t\t\t\tvar haveAudioDevice = audioSend ? audioExist : false;\r\n\t\t\t\t\t\tvar haveVideoDevice = videoSend ? videoExist : false;\r\n\t\t\t\t\t\tif(!haveAudioDevice && !haveVideoDevice) {\r\n\t\t\t\t\t\t\t// FIXME Should we really give up, or just assume recvonly for both?\r\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\r\n\t\t\t\t\t\t\tcallbacks.error('No capture device found');\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t} else if(!haveAudioDevice && needAudioDevice) {\r\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\r\n\t\t\t\t\t\t\tcallbacks.error('Audio capture is required, but no capture device found');\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t} else if(!haveVideoDevice && needVideoDevice) {\r\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\r\n\t\t\t\t\t\t\tcallbacks.error('Video capture is required, but no capture device found');\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnavigator.mediaDevices.getUserMedia({\r\n\t\t\t\t\t\taudio: audioExist ? audioSupport : false,\r\n\t\t\t\t\t\tvideo: videoExist ? videoSupport : false\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then(function(stream) {\r\n\t\t\t\t\t\tvar videoTrack = stream.getVideoTracks()[0];\r\n\t\t\t\t\t\tif(videoTrack){\r\n\t\t\t\t\t\t\tJanus.debug(\"Video height: \" + videoTrack.getSettings().height);\r\n\t\t\t\t\t\t\tJanus.debug(\"Video width: \" + videoTrack.getSettings().width);\r\n\t\t\t\t\t\t\tJanus.debug(\"Video framerate: \" + videoTrack.getSettings().frameRate);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tpluginHandle.consentDialog(false); streamsDone(handleId, jsep, media, callbacks, stream); })\r\n\t\t\t\t\t.catch(function(error) { pluginHandle.consentDialog(false); callbacks.error({code: error.code, name: error.name, message: error.message}); });\r\n\t\t\t\t})\r\n\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\tpluginHandle.consentDialog(false);\r\n\t\t\t\t\tcallbacks.error('enumerateDevices error', error);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// No need to do a getUserMedia, create offer/answer right away\r\n\t\t\tstreamsDone(handleId, jsep, media, callbacks);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction prepareWebrtcPeer(handleId, callbacks) {\r\n\t\tcallbacks = callbacks || {};\r\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\r\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : webrtcError;\r\n\t\tvar jsep = callbacks.jsep;\r\n\t\tvar pluginHandle = pluginHandles[handleId];\r\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\r\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\r\n\t\t\tJanus.warn(\"Invalid handle\");\r\n\t\t\tcallbacks.error(\"Invalid handle\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar config = pluginHandle.webrtcStuff;\r\n\t\tif(jsep !== undefined && jsep !== null) {\r\n\t\t\tif(config.pc === null) {\r\n\t\t\t\tJanus.warn(\"Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep\");\r\n\t\t\t\tcallbacks.error(\"No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconfig.pc.setRemoteDescription(\r\n\t\t\t\t\tnew RTCSessionDescription(jsep),\r\n\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\tJanus.log(\"Remote description accepted!\");\r\n\t\t\t\t\t\tcallbacks.success();\r\n\t\t\t\t\t}, callbacks.error);\r\n\t\t} else {\r\n\t\t\tcallbacks.error(\"Invalid JSEP\");\r\n\t\t}\r\n\t}\r\n\r\n\tfunction createOffer(handleId, media, callbacks) {\r\n\t\tconsole.warn(\"createOffer:\", media);\r\n\r\n\t\tcallbacks = callbacks || {};\r\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\r\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\r\n\t\tvar pluginHandle = pluginHandles[handleId];\r\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\r\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\r\n\t\t\tJanus.warn(\"Invalid handle\");\r\n\t\t\tcallbacks.error(\"Invalid handle\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar config = pluginHandle.webrtcStuff;\r\n\t\tvar simulcast = callbacks.simulcast === true ? true : false;\r\n\t\tif(!simulcast) {\r\n\t\t\tJanus.log(\"Creating offer (iceDone=\" + config.iceDone + \")\");\r\n\t\t} else {\r\n\t\t\tJanus.log(\"Creating offer (iceDone=\" + config.iceDone + \", simulcast=\" + simulcast + \")\");\r\n\t\t}\r\n\t\t// https://code.google.com/p/webrtc/issues/detail?id=3508\r\n\t\tvar mediaConstraints = {\r\n\t\t\t'offerToReceiveAudio':isAudioRecvEnabled(media),\r\n\t\t\t'offerToReceiveVideo':isVideoRecvEnabled(media)\r\n\t\t};\r\n\t\tvar iceRestart = callbacks.iceRestart === true ? true : false;\r\n\t\tif(iceRestart) {\r\n\t\t\tmediaConstraints[\"iceRestart\"] = true;\r\n\t\t}\r\n\t\tJanus.debug(mediaConstraints);\r\n\t\t// Check if this is Firefox and we've been asked to do simulcasting\r\n\t\tvar sendVideo = isVideoSendEnabled(media);\r\n\t\tif(sendVideo && simulcast && Janus.webRTCAdapter.browserDetails.browser === \"firefox\") {\r\n\t\t\t// FIXME Based on https://gist.github.com/voluntas/088bc3cc62094730647b\r\n\t\t\tJanus.log(\"Enabling Simulcasting for Firefox (RID)\");\r\n\t\t\tvar sender = config.pc.getSenders()[1];\r\n\t\t\tJanus.log(sender);\r\n\t\t\tvar parameters = sender.getParameters();\r\n\t\t\tJanus.log(parameters);\r\n\t\t\tsender.setParameters({encodings: [\r\n\t\t\t\t{ rid: \"high\", active: true, priority: \"high\", maxBitrate: 1000000 },\r\n\t\t\t\t{ rid: \"medium\", active: true, priority: \"medium\", maxBitrate: 300000 },\r\n\t\t\t\t{ rid: \"low\", active: true, priority: \"low\", maxBitrate: 100000 }\r\n\t\t\t]});\r\n\t\t}\r\n\t\tconfig.pc.createOffer(\r\n\t\t\tfunction(offer) {\r\n\t\t\t\tJanus.debug(offer);\r\n\t\t\t\tJanus.log(\"Setting local description\");\r\n\t\t\t\tif(sendVideo && simulcast) {\r\n\t\t\t\t\t// This SDP munging only works with Chrome\r\n\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"chrome\") {\r\n\t\t\t\t\t\tJanus.log(\"Enabling Simulcasting for Chrome (SDP munging)\");\r\n\t\t\t\t\t\toffer.sdp = mungeSdpForSimulcasting(offer.sdp);\r\n\t\t\t\t\t} else if(Janus.webRTCAdapter.browserDetails.browser !== \"firefox\") {\r\n\t\t\t\t\t\tJanus.warn(\"simulcast=true, but this is not Chrome nor Firefox, ignoring\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconfig.mySdp = offer.sdp;\r\n\t\t\t\tconfig.pc.setLocalDescription(offer);\r\n\t\t\t\tconfig.mediaConstraints = mediaConstraints;\r\n\t\t\t\tif(!config.iceDone && !config.trickle) {\r\n\t\t\t\t\t// Don't do anything until we have all candidates\r\n\t\t\t\t\tJanus.log(\"Waiting for all candidates...\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tJanus.log(\"Offer ready\");\r\n\t\t\t\tJanus.debug(callbacks);\r\n\t\t\t\t// JSON.stringify doesn't work on some WebRTC objects anymore\r\n\t\t\t\t// See https://code.google.com/p/chromium/issues/detail?id=467366\r\n\t\t\t\tvar jsep = {\r\n\t\t\t\t\t\"type\": offer.type,\r\n\t\t\t\t\t\"sdp\": offer.sdp\r\n\t\t\t\t};\r\n\t\t\t\tcallbacks.success(jsep);\r\n\t\t\t}, callbacks.error, mediaConstraints);\r\n\t}\r\n\r\n\tfunction createAnswer(handleId, media, callbacks) {\r\n\t\tcallbacks = callbacks || {};\r\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\r\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\r\n\t\tvar pluginHandle = pluginHandles[handleId];\r\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\r\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\r\n\t\t\tJanus.warn(\"Invalid handle\");\r\n\t\t\tcallbacks.error(\"Invalid handle\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar config = pluginHandle.webrtcStuff;\r\n\t\tvar simulcast = callbacks.simulcast === true ? true : false;\r\n\t\tif(!simulcast) {\r\n\t\t\tJanus.log(\"Creating answer (iceDone=\" + config.iceDone + \")\");\r\n\t\t} else {\r\n\t\t\tJanus.log(\"Creating answer (iceDone=\" + config.iceDone + \", simulcast=\" + simulcast + \")\");\r\n\t\t}\r\n\t\tvar mediaConstraints = null;\r\n\t\tif(Janus.webRTCAdapter.browserDetails.browser == \"firefox\" || Janus.webRTCAdapter.browserDetails.browser == \"edge\") {\r\n\t\t\tmediaConstraints = {\r\n\t\t\t\t'offerToReceiveAudio':isAudioRecvEnabled(media),\r\n\t\t\t\t'offerToReceiveVideo':isVideoRecvEnabled(media)\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tmediaConstraints = {\r\n\t\t\t\t'mandatory': {\r\n\t\t\t\t\t'OfferToReceiveAudio':isAudioRecvEnabled(media),\r\n\t\t\t\t\t'OfferToReceiveVideo':isVideoRecvEnabled(media)\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\tJanus.debug(mediaConstraints);\r\n\t\t// Check if this is Firefox and we've been asked to do simulcasting\r\n\t\tvar sendVideo = isVideoSendEnabled(media);\r\n\t\tif(sendVideo && simulcast && Janus.webRTCAdapter.browserDetails.browser === \"firefox\") {\r\n\t\t\t// FIXME Based on https://gist.github.com/voluntas/088bc3cc62094730647b\r\n\t\t\tJanus.log(\"Enabling Simulcasting for Firefox (RID)\");\r\n\t\t\tvar sender = config.pc.getSenders()[1];\r\n\t\t\tJanus.log(sender);\r\n\t\t\tvar parameters = sender.getParameters();\r\n\t\t\tJanus.log(parameters);\r\n\t\t\tsender.setParameters({encodings: [\r\n\t\t\t\t{ rid: \"high\", active: true, priority: \"high\", maxBitrate: 1000000 },\r\n\t\t\t\t{ rid: \"medium\", active: true, priority: \"medium\", maxBitrate: 300000 },\r\n\t\t\t\t{ rid: \"low\", active: true, priority: \"low\", maxBitrate: 100000 }\r\n\t\t\t]});\r\n\t\t}\r\n\t\tconfig.pc.createAnswer(\r\n\t\t\tfunction(answer) {\r\n\t\t\t\tJanus.debug(answer);\r\n\t\t\t\tJanus.log(\"Setting local description\");\r\n\t\t\t\tif(sendVideo && simulcast) {\r\n\t\t\t\t\t// This SDP munging only works with Chrome\r\n\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"chrome\") {\r\n\t\t\t\t\t\t// FIXME Apparently trying to simulcast when answering breaks video in Chrome...\r\n\t\t\t\t\t\t//~ Janus.log(\"Enabling Simulcasting for Chrome (SDP munging)\");\r\n\t\t\t\t\t\t//~ answer.sdp = mungeSdpForSimulcasting(answer.sdp);\r\n\t\t\t\t\t\tJanus.warn(\"simulcast=true, but this is an answer, and video breaks in Chrome if we enable it\");\r\n\t\t\t\t\t} else if(Janus.webRTCAdapter.browserDetails.browser !== \"firefox\") {\r\n\t\t\t\t\t\tJanus.warn(\"simulcast=true, but this is not Chrome nor Firefox, ignoring\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconfig.mySdp = answer.sdp;\r\n\t\t\t\tconfig.pc.setLocalDescription(answer);\r\n\t\t\t\tconfig.mediaConstraints = mediaConstraints;\r\n\t\t\t\tif(!config.iceDone && !config.trickle) {\r\n\t\t\t\t\t// Don't do anything until we have all candidates\r\n\t\t\t\t\tJanus.log(\"Waiting for all candidates...\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// JSON.stringify doesn't work on some WebRTC objects anymore\r\n\t\t\t\t// See https://code.google.com/p/chromium/issues/detail?id=467366\r\n\t\t\t\tvar jsep = {\r\n\t\t\t\t\t\"type\": answer.type,\r\n\t\t\t\t\t\"sdp\": answer.sdp\r\n\t\t\t\t};\r\n\t\t\t\tcallbacks.success(jsep);\r\n\t\t\t}, callbacks.error, mediaConstraints);\r\n\t}\r\n\r\n\tfunction sendSDP(handleId, callbacks) {\r\n\t\tcallbacks = callbacks || {};\r\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\r\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\r\n\t\tvar pluginHandle = pluginHandles[handleId];\r\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\r\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\r\n\t\t\tJanus.warn(\"Invalid handle, not sending anything\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar config = pluginHandle.webrtcStuff;\r\n\t\tJanus.log(\"Sending offer/answer SDP...\");\r\n\t\tif(config.mySdp === null || config.mySdp === undefined) {\r\n\t\t\tJanus.warn(\"Local SDP instance is invalid, not sending anything...\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconfig.mySdp = {\r\n\t\t\t\"type\": config.pc.localDescription.type,\r\n\t\t\t\"sdp\": config.pc.localDescription.sdp\r\n\t\t};\r\n\t\tif(config.trickle === false)\r\n\t\t\tconfig.mySdp[\"trickle\"] = false;\r\n\t\tJanus.debug(callbacks);\r\n\t\tconfig.sdpSent = true;\r\n\t\tcallbacks.success(config.mySdp);\r\n\t}\r\n\r\n\tfunction getVolume(handleId) {\r\n\t\tvar pluginHandle = pluginHandles[handleId];\r\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\r\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\r\n\t\t\tJanus.warn(\"Invalid handle\");\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\tvar config = pluginHandle.webrtcStuff;\r\n\t\t// Start getting the volume, if getStats is supported\r\n\t\tif(config.pc.getStats && Janus.webRTCAdapter.browserDetails.browser == \"chrome\") {\t// FIXME\r\n\t\t\tif(config.remoteStream === null || config.remoteStream === undefined) {\r\n\t\t\t\tJanus.warn(\"Remote stream unavailable\");\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t\t// http://webrtc.googlecode.com/svn/trunk/samples/js/demos/html/constraints-and-stats.html\r\n\t\t\tif(config.volume.timer === null || config.volume.timer === undefined) {\r\n\t\t\t\tJanus.log(\"Starting volume monitor\");\r\n\t\t\t\tconfig.volume.timer = setInterval(function() {\r\n\t\t\t\t\tconfig.pc.getStats(function(stats) {\r\n\t\t\t\t\t\tvar results = stats.result();\r\n\t\t\t\t\t\tfor(var i=0; i<results.length; i++) {\r\n\t\t\t\t\t\t\tvar res = results[i];\r\n\t\t\t\t\t\t\tif(res.type == 'ssrc' && res.stat('audioOutputLevel')) {\r\n\t\t\t\t\t\t\t\tconfig.volume.value = res.stat('audioOutputLevel');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}, 200);\r\n\t\t\t\treturn 0;\t// We don't have a volume to return yet\r\n\t\t\t}\r\n\t\t\treturn config.volume.value;\r\n\t\t} else {\r\n\t\t\tJanus.log(\"Getting the remote volume unsupported by browser\");\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction isMuted(handleId, video) {\r\n\t\tvar pluginHandle = pluginHandles[handleId];\r\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\r\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\r\n\t\t\tJanus.warn(\"Invalid handle\");\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar config = pluginHandle.webrtcStuff;\r\n\t\tif(config.pc === null || config.pc === undefined) {\r\n\t\t\tJanus.warn(\"Invalid PeerConnection\");\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif(config.myStream === undefined || config.myStream === null) {\r\n\t\t\tJanus.warn(\"Invalid local MediaStream\");\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif(video) {\r\n\t\t\t// Check video track\r\n\t\t\tif(config.myStream.getVideoTracks() === null\r\n\t\t\t\t\t|| config.myStream.getVideoTracks() === undefined\r\n\t\t\t\t\t|| config.myStream.getVideoTracks().length === 0) {\r\n\t\t\t\tJanus.warn(\"No video track\");\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn !config.myStream.getVideoTracks()[0].enabled;\r\n\t\t} else {\r\n\t\t\t// Check audio track\r\n\t\t\tif(config.myStream.getAudioTracks() === null\r\n\t\t\t\t\t|| config.myStream.getAudioTracks() === undefined\r\n\t\t\t\t\t|| config.myStream.getAudioTracks().length === 0) {\r\n\t\t\t\tJanus.warn(\"No audio track\");\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn !config.myStream.getAudioTracks()[0].enabled;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction mute(handleId, video, mute) {\r\n\t\tvar pluginHandle = pluginHandles[handleId];\r\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\r\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\r\n\t\t\tJanus.warn(\"Invalid handle\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar config = pluginHandle.webrtcStuff;\r\n\t\tif(config.pc === null || config.pc === undefined) {\r\n\t\t\tJanus.warn(\"Invalid PeerConnection\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(config.myStream === undefined || config.myStream === null) {\r\n\t\t\tJanus.warn(\"Invalid local MediaStream\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(video) {\r\n\t\t\t// Mute/unmute video track\r\n\t\t\tif(config.myStream.getVideoTracks() === null\r\n\t\t\t\t\t|| config.myStream.getVideoTracks() === undefined\r\n\t\t\t\t\t|| config.myStream.getVideoTracks().length === 0) {\r\n\t\t\t\tJanus.warn(\"No video track\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tconfig.myStream.getVideoTracks()[0].enabled = mute ? false : true;\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\t// Mute/unmute audio track\r\n\t\t\tif(config.myStream.getAudioTracks() === null\r\n\t\t\t\t\t|| config.myStream.getAudioTracks() === undefined\r\n\t\t\t\t\t|| config.myStream.getAudioTracks().length === 0) {\r\n\t\t\t\tJanus.warn(\"No audio track\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tconfig.myStream.getAudioTracks()[0].enabled = mute ? false : true;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getBitrate(handleId) {\r\n\t\tvar pluginHandle = pluginHandles[handleId];\r\n\t\tif(pluginHandle === null || pluginHandle === undefined ||\r\n\t\t\t\tpluginHandle.webrtcStuff === null || pluginHandle.webrtcStuff === undefined) {\r\n\t\t\tJanus.warn(\"Invalid handle\");\r\n\t\t\treturn \"Invalid handle\";\r\n\t\t}\r\n\t\tvar config = pluginHandle.webrtcStuff;\r\n\t\tif(config.pc === null || config.pc === undefined)\r\n\t\t\treturn \"Invalid PeerConnection\";\r\n\t\t// Start getting the bitrate, if getStats is supported\r\n\t\tif(config.pc.getStats) {\r\n\t\t\tif(config.bitrate.timer === null || config.bitrate.timer === undefined) {\r\n\t\t\t\tJanus.log(\"Starting bitrate timer (via getStats)\");\r\n\t\t\t\tconfig.bitrate.timer = setInterval(function() {\r\n\t\t\t\t\tconfig.pc.getStats()\r\n\t\t\t\t\t\t.then(function(stats) {\r\n\t\t\t\t\t\t\tstats.forEach(function (res) {\r\n\t\t\t\t\t\t\t\tif(!res)\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\tvar inStats = false;\r\n\t\t\t\t\t\t\t\t// Check if these are statistics on incoming media\r\n\t\t\t\t\t\t\t\tif((res.mediaType === \"video\" || res.id.toLowerCase().indexOf(\"video\") > -1) &&\r\n\t\t\t\t\t\t\t\t\t\tres.type === \"inbound-rtp\" && res.id.indexOf(\"rtcp\") < 0) {\r\n\t\t\t\t\t\t\t\t\t// New stats\r\n\t\t\t\t\t\t\t\t\tinStats = true;\r\n\t\t\t\t\t\t\t\t} else if(res.type == 'ssrc' && res.bytesReceived &&\r\n\t\t\t\t\t\t\t\t\t\t(res.googCodecName === \"VP8\" || res.googCodecName === \"\")) {\r\n\t\t\t\t\t\t\t\t\t// Older Chromer versions\r\n\t\t\t\t\t\t\t\t\tinStats = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t// Parse stats now\r\n\t\t\t\t\t\t\t\tif(inStats) {\r\n\t\t\t\t\t\t\t\t\tconfig.bitrate.bsnow = res.bytesReceived;\r\n\t\t\t\t\t\t\t\t\tconfig.bitrate.tsnow = res.timestamp;\r\n\t\t\t\t\t\t\t\t\tif(config.bitrate.bsbefore === null || config.bitrate.tsbefore === null) {\r\n\t\t\t\t\t\t\t\t\t\t// Skip this round\r\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.bsbefore = config.bitrate.bsnow;\r\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.tsbefore = config.bitrate.tsnow;\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t// Calculate bitrate\r\n\t\t\t\t\t\t\t\t\t\tvar timePassed = config.bitrate.tsnow - config.bitrate.tsbefore;\r\n\t\t\t\t\t\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser == \"safari\")\r\n\t\t\t\t\t\t\t\t\t\t\ttimePassed = timePassed/1000;\t// Apparently the timestamp is in microseconds, in Safari\r\n\t\t\t\t\t\t\t\t\t\tvar bitRate = Math.round((config.bitrate.bsnow - config.bitrate.bsbefore) * 8 / timePassed);\r\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.value = bitRate + ' kbits/sec';\r\n\t\t\t\t\t\t\t\t\t\t//~ Janus.log(\"Estimated bitrate is \" + config.bitrate.value);\r\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.bsbefore = config.bitrate.bsnow;\r\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.tsbefore = config.bitrate.tsnow;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t}, 1000);\r\n\t\t\t\treturn \"0 kbits/sec\";\t// We don't have a bitrate value yet\r\n\t\t\t}\r\n\t\t\treturn config.bitrate.value;\r\n\t\t} else {\r\n\t\t\tJanus.warn(\"Getting the video bitrate unsupported by browser\");\r\n\t\t\treturn \"Feature unsupported by browser\";\r\n\t\t}\r\n\t}\r\n\r\n\tfunction webrtcError(error) {\r\n\t\tJanus.error(\"WebRTC error:\", error);\r\n\t}\r\n\r\n\tfunction cleanupWebrtc(handleId, hangupRequest) {\r\n\t\tJanus.log(\"Cleaning WebRTC stuff\");\r\n\t\tvar pluginHandle = pluginHandles[handleId];\r\n\t\tif(pluginHandle === null || pluginHandle === undefined) {\r\n\t\t\t// Nothing to clean\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar config = pluginHandle.webrtcStuff;\r\n\t\tif(config !== null && config !== undefined) {\r\n\t\t\tif(hangupRequest === true) {\r\n\t\t\t\t// Send a hangup request (we don't really care about the response)\r\n\t\t\t\tvar request = { \"janus\": \"hangup\", \"transaction\": Janus.randomString(12) };\r\n\t\t\t\tif(token !== null && token !== undefined)\r\n\t\t\t\t\trequest[\"token\"] = token;\r\n\t\t\t\tif(apisecret !== null && apisecret !== undefined)\r\n\t\t\t\t\trequest[\"apisecret\"] = apisecret;\r\n\t\t\t\tJanus.debug(\"Sending hangup request (handle=\" + handleId + \"):\");\r\n\t\t\t\tJanus.debug(request);\r\n\t\t\t\tif(websockets) {\r\n\t\t\t\t\trequest[\"session_id\"] = sessionId;\r\n\t\t\t\t\trequest[\"handle_id\"] = handleId;\r\n\t\t\t\t\tws.send(JSON.stringify(request));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\r\n\t\t\t\t\t\tverb: 'POST',\r\n\t\t\t\t\t\twithCredentials: withCredentials,\r\n\t\t\t\t\t\tdata: request\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// Cleanup stack\r\n\t\t\tconfig.remoteStream = null;\r\n\t\t\tif(config.volume.timer)\r\n\t\t\t\tclearInterval(config.volume.timer);\r\n\t\t\tconfig.volume.value = null;\r\n\t\t\tif(config.bitrate.timer)\r\n\t\t\t\tclearInterval(config.bitrate.timer);\r\n\t\t\tconfig.bitrate.timer = null;\r\n\t\t\tconfig.bitrate.bsnow = null;\r\n\t\t\tconfig.bitrate.bsbefore = null;\r\n\t\t\tconfig.bitrate.tsnow = null;\r\n\t\t\tconfig.bitrate.tsbefore = null;\r\n\t\t\tconfig.bitrate.value = null;\r\n\t\t\ttry {\r\n\t\t\t\t// Try a MediaStreamTrack.stop() for each track\r\n\t\t\t\tif(!config.streamExternal && config.myStream !== null && config.myStream !== undefined) {\r\n\t\t\t\t\tJanus.log(\"Stopping local stream tracks\");\r\n\t\t\t\t\tvar tracks = config.myStream.getTracks();\r\n\t\t\t\t\tfor(var i in tracks) {\r\n\t\t\t\t\t\tvar mst = tracks[i];\r\n\t\t\t\t\t\tJanus.log(mst);\r\n\t\t\t\t\t\tif(mst !== null && mst !== undefined)\r\n\t\t\t\t\t\t\tmst.stop();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} catch(e) {\r\n\t\t\t\t// Do nothing if this fails\r\n\t\t\t}\r\n\t\t\tconfig.streamExternal = false;\r\n\t\t\tconfig.myStream = null;\r\n\t\t\t// Close PeerConnection\r\n\t\t\ttry {\r\n\t\t\t\tconfig.pc.close();\r\n\t\t\t} catch(e) {\r\n\t\t\t\t// Do nothing\r\n\t\t\t}\r\n\t\t\tconfig.pc = null;\r\n\t\t\tconfig.mySdp = null;\r\n\t\t\tconfig.iceDone = false;\r\n\t\t\tconfig.dataChannel = null;\r\n\t\t\tconfig.dtmfSender = null;\r\n\t\t}\r\n\t\tpluginHandle.oncleanup();\r\n\t}\r\n\r\n\t// Helper method to munge an SDP to enable simulcasting (Chrome only)\r\n\tfunction mungeSdpForSimulcasting(sdp) {\r\n\t\t// Let's munge the SDP to add the attributes for enabling simulcasting\r\n\t\t// (based on https://gist.github.com/ggarber/a19b4c33510028b9c657)\r\n\t\tvar lines = sdp.split(\"\\r\\n\");\r\n\t\tvar video = false;\r\n\t\tvar ssrc = [ -1 ], ssrc_fid = -1;\r\n\t\tvar cname = null, msid = null, mslabel = null, label = null;\r\n\t\tvar insertAt = -1;\r\n\t\tfor(var i=0; i<lines.length; i++) {\r\n\t\t\tvar mline = lines[i].match(/m=(\\w+) */);\r\n\t\t\tif(mline) {\r\n\t\t\t\tvar medium = mline[1];\r\n\t\t\t\tif(medium === \"video\") {\r\n\t\t\t\t\t// New video m-line: make sure it's the first one\r\n\t\t\t\t\tif(ssrc[0] < 0) {\r\n\t\t\t\t\t\tvideo = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// We're done, let's add the new attributes here\r\n\t\t\t\t\t\tinsertAt = i;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// New non-video m-line: do we have what we were looking for?\r\n\t\t\t\t\tif(ssrc[0] > -1) {\r\n\t\t\t\t\t\t// We're done, let's add the new attributes here\r\n\t\t\t\t\t\tinsertAt = i;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(!video)\r\n\t\t\t\tcontinue;\r\n\t\t\tvar fid = lines[i].match(/a=ssrc-group:FID (\\d+) (\\d+)/);\r\n\t\t\tif(fid) {\r\n\t\t\t\tssrc[0] = fid[1];\r\n\t\t\t\tssrc_fid = fid[2];\r\n\t\t\t\tlines.splice(i, 1); i--;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(ssrc[0]) {\r\n\t\t\t\tvar match = lines[i].match('a=ssrc:' + ssrc[0] + ' cname:(.+)');\r\n\t\t\t\tif(match) {\r\n\t\t\t\t\tcname = match[1];\r\n\t\t\t\t}\r\n\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' msid:(.+)');\r\n\t\t\t\tif(match) {\r\n\t\t\t\t\tmsid = match[1];\r\n\t\t\t\t}\r\n\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' mslabel:(.+)');\r\n\t\t\t\tif(match) {\r\n\t\t\t\t\tmslabel = match[1];\r\n\t\t\t\t}\r\n\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc + ' label:(.+)');\r\n\t\t\t\tif(match) {\r\n\t\t\t\t\tlabel = match[1];\r\n\t\t\t\t}\r\n\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc_fid) === 0) {\r\n\t\t\t\t\tlines.splice(i, 1); i--;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc[0]) === 0) {\r\n\t\t\t\t\tlines.splice(i, 1); i--;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(lines[i].length == 0) {\r\n\t\t\t\tlines.splice(i, 1); i--;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(ssrc[0] < 0) {\r\n\t\t\t// Couldn't find a FID attribute, let's just take the first video SSRC we find\r\n\t\t\tinsertAt = -1;\r\n\t\t\tvideo = false;\r\n\t\t\tfor(var i=0; i<lines.length; i++) {\r\n\t\t\t\tvar mline = lines[i].match(/m=(\\w+) */);\r\n\t\t\t\tif(mline) {\r\n\t\t\t\t\tvar medium = mline[1];\r\n\t\t\t\t\tif(medium === \"video\") {\r\n\t\t\t\t\t\t// New video m-line: make sure it's the first one\r\n\t\t\t\t\t\tif(ssrc[0] < 0) {\r\n\t\t\t\t\t\t\tvideo = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// We're done, let's add the new attributes here\r\n\t\t\t\t\t\t\tinsertAt = i;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// New non-video m-line: do we have what we were looking for?\r\n\t\t\t\t\t\tif(ssrc[0] > -1) {\r\n\t\t\t\t\t\t\t// We're done, let's add the new attributes here\r\n\t\t\t\t\t\t\tinsertAt = i;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(!video)\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tif(ssrc[0] < 0) {\r\n\t\t\t\t\tvar value = lines[i].match(/a=ssrc:(\\d+)/);\r\n\t\t\t\t\tif(value) {\r\n\t\t\t\t\t\tssrc[0] = value[1];\r\n\t\t\t\t\t\tlines.splice(i, 1); i--;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar match = lines[i].match('a=ssrc:' + ssrc[0] + ' cname:(.+)');\r\n\t\t\t\t\tif(match) {\r\n\t\t\t\t\t\tcname = match[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' msid:(.+)');\r\n\t\t\t\t\tif(match) {\r\n\t\t\t\t\t\tmsid = match[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' mslabel:(.+)');\r\n\t\t\t\t\tif(match) {\r\n\t\t\t\t\t\tmslabel = match[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc + ' label:(.+)');\r\n\t\t\t\t\tif(match) {\r\n\t\t\t\t\t\tlabel = match[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc_fid) === 0) {\r\n\t\t\t\t\t\tlines.splice(i, 1); i--;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc[0]) === 0) {\r\n\t\t\t\t\t\tlines.splice(i, 1); i--;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(lines[i].length == 0) {\r\n\t\t\t\t\tlines.splice(i, 1); i--;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(ssrc[0] < 0) {\r\n\t\t\t// Still nothing, let's just return the SDP we were asked to munge\r\n\t\t\tJanus.warn(\"Couldn't find the video SSRC, simulcasting NOT enabled\");\r\n\t\t\treturn sdp;\r\n\t\t}\r\n\t\tif(insertAt < 0) {\r\n\t\t\t// Append at the end\r\n\t\t\tinsertAt = lines.length;\r\n\t\t}\r\n\t\t// Generate a couple of SSRCs\r\n\t\tssrc[1] = Math.floor(Math.random()*0xFFFFFFFF);\r\n\t\tssrc[2] = Math.floor(Math.random()*0xFFFFFFFF);\r\n\t\t// Add attributes to the SDP\r\n\t\tfor(var i=0; i<ssrc.length; i++) {\r\n\t\t\tif(cname) {\r\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' cname:' + cname);\r\n\t\t\t\tinsertAt++;\r\n\t\t\t}\r\n\t\t\tif(msid) {\r\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' msid:' + msid);\r\n\t\t\t\tinsertAt++;\r\n\t\t\t}\r\n\t\t\tif(mslabel) {\r\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' mslabel:' + msid);\r\n\t\t\t\tinsertAt++;\r\n\t\t\t}\r\n\t\t\tif(label) {\r\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' label:' + msid);\r\n\t\t\t\tinsertAt++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlines.splice(insertAt, 0, 'a=ssrc-group:SIM ' + ssrc[0] + ' ' + ssrc[1] + ' ' + ssrc[2]);\r\n\t\tsdp = lines.join(\"\\r\\n\");\r\n\t\tif(!sdp.endsWith(\"\\r\\n\"))\r\n\t\t\tsdp += \"\\r\\n\";\r\n\t\treturn sdp;\r\n\t}\r\n\r\n\t// Helper methods to parse a media object\r\n\tfunction isAudioSendEnabled(media) {\r\n\t\tJanus.debug(\"isAudioSendEnabled:\", media);\r\n\t\tif(media === undefined || media === null)\r\n\t\t\treturn true;\t// Default\r\n\t\tif(media.audio === false)\r\n\t\t\treturn false;\t// Generic audio has precedence\r\n\t\tif(media.audioSend === undefined || media.audioSend === null)\r\n\t\t\treturn true;\t// Default\r\n\t\treturn (media.audioSend === true);\r\n\t}\r\n\r\n\tfunction isAudioSendRequired(media) {\r\n\t\tJanus.debug(\"isAudioSendRequired:\", media);\r\n\t\tif(media === undefined || media === null)\r\n\t\t\treturn false;\t// Default\r\n\t\tif(media.audio === false || media.audioSend === false)\r\n\t\t\treturn false;\t// If we're not asking to capture audio, it's not required\r\n\t\tif(media.failIfNoAudio === undefined || media.failIfNoAudio === null)\r\n\t\t\treturn false;\t// Default\r\n\t\treturn (media.failIfNoAudio === true);\r\n\t}\r\n\r\n\tfunction isAudioRecvEnabled(media) {\r\n\t\tJanus.debug(\"isAudioRecvEnabled:\", media);\r\n\t\tif(media === undefined || media === null)\r\n\t\t\treturn true;\t// Default\r\n\t\tif(media.audio === false)\r\n\t\t\treturn false;\t// Generic audio has precedence\r\n\t\tif(media.audioRecv === undefined || media.audioRecv === null)\r\n\t\t\treturn true;\t// Default\r\n\t\treturn (media.audioRecv === true);\r\n\t}\r\n\r\n\tfunction isVideoSendEnabled(media) {\r\n\t\tJanus.debug(\"isVideoSendEnabled:\", media);\r\n\t\tif(media === undefined || media === null)\r\n\t\t\treturn true;\t// Default\r\n\t\tif(media.video === false)\r\n\t\t\treturn false;\t// Generic video has precedence\r\n\t\tif(media.videoSend === undefined || media.videoSend === null)\r\n\t\t\treturn true;\t// Default\r\n\t\treturn (media.videoSend === true);\r\n\t}\r\n\r\n\tfunction isVideoSendRequired(media) {\r\n\t\tJanus.debug(\"isVideoSendRequired:\", media);\r\n\t\tif(media === undefined || media === null)\r\n\t\t\treturn false;\t// Default\r\n\t\tif(media.video === false || media.videoSend === false)\r\n\t\t\treturn false;\t// If we're not asking to capture video, it's not required\r\n\t\tif(media.failIfNoVideo === undefined || media.failIfNoVideo === null)\r\n\t\t\treturn false;\t// Default\r\n\t\treturn (media.failIfNoVideo === true);\r\n\t}\r\n\r\n\tfunction isVideoRecvEnabled(media) {\r\n\t\tJanus.debug(\"isVideoRecvEnabled:\", media);\r\n\t\tif(media === undefined || media === null)\r\n\t\t\treturn true;\t// Default\r\n\t\tif(media.video === false)\r\n\t\t\treturn false;\t// Generic video has precedence\r\n\t\tif(media.videoRecv === undefined || media.videoRecv === null)\r\n\t\t\treturn true;\t// Default\r\n\t\treturn (media.videoRecv === true);\r\n\t}\r\n\r\n\tfunction isDataEnabled(media) {\r\n\t\tJanus.debug(\"isDataEnabled:\", media);\r\n\t\tif(Janus.webRTCAdapter.browserDetails.browser == \"edge\") {\r\n\t\t\tJanus.warn(\"Edge doesn't support data channels yet\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif(media === undefined || media === null)\r\n\t\t\treturn false;\t// Default\r\n\t\treturn (media.data === true);\r\n\t}\r\n\r\n\tfunction isTrickleEnabled(trickle) {\r\n\t\tJanus.debug(\"isTrickleEnabled:\", trickle);\r\n\t\tif(trickle === undefined || trickle === null)\r\n\t\t\treturn true;\t// Default is true\r\n\t\treturn (trickle === true);\r\n\t}\r\n}\r\n\r\nreturn Janus;\r\n\r\n})));\r\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\nvar fbemitter = {\n  EventEmitter: require('./lib/BaseEventEmitter'),\n  EmitterSubscription : require('./lib/EmitterSubscription')\n};\n\nmodule.exports = fbemitter;\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule BaseEventEmitter\n * @typechecks\n */\n\n'use strict';\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\nvar EmitterSubscription = require('./EmitterSubscription');\nvar EventSubscriptionVendor = require('./EventSubscriptionVendor');\n\nvar emptyFunction = require('fbjs/lib/emptyFunction');\nvar invariant = require('fbjs/lib/invariant');\n\n/**\n * @class BaseEventEmitter\n * @description\n * An EventEmitter is responsible for managing a set of listeners and publishing\n * events to them when it is told that such events happened. In addition to the\n * data for the given event it also sends a event control object which allows\n * the listeners/handlers to prevent the default behavior of the given event.\n *\n * The emitter is designed to be generic enough to support all the different\n * contexts in which one might want to emit events. It is a simple multicast\n * mechanism on top of which extra functionality can be composed. For example, a\n * more advanced emitter may use an EventHolder and EventFactory.\n */\n\nvar BaseEventEmitter = (function () {\n  /**\n   * @constructor\n   */\n\n  function BaseEventEmitter() {\n    _classCallCheck(this, BaseEventEmitter);\n\n    this._subscriber = new EventSubscriptionVendor();\n    this._currentSubscription = null;\n  }\n\n  /**\n   * Adds a listener to be invoked when events of the specified type are\n   * emitted. An optional calling context may be provided. The data arguments\n   * emitted will be passed to the listener function.\n   *\n   * TODO: Annotate the listener arg's type. This is tricky because listeners\n   *       can be invoked with varargs.\n   *\n   * @param {string} eventType - Name of the event to listen to\n   * @param {function} listener - Function to invoke when the specified event is\n   *   emitted\n   * @param {*} context - Optional context object to use when invoking the\n   *   listener\n   */\n\n  BaseEventEmitter.prototype.addListener = function addListener(eventType, listener, context) {\n    return this._subscriber.addSubscription(eventType, new EmitterSubscription(this._subscriber, listener, context));\n  };\n\n  /**\n   * Similar to addListener, except that the listener is removed after it is\n   * invoked once.\n   *\n   * @param {string} eventType - Name of the event to listen to\n   * @param {function} listener - Function to invoke only once when the\n   *   specified event is emitted\n   * @param {*} context - Optional context object to use when invoking the\n   *   listener\n   */\n\n  BaseEventEmitter.prototype.once = function once(eventType, listener, context) {\n    var emitter = this;\n    return this.addListener(eventType, function () {\n      emitter.removeCurrentListener();\n      listener.apply(context, arguments);\n    });\n  };\n\n  /**\n   * Removes all of the registered listeners, including those registered as\n   * listener maps.\n   *\n   * @param {?string} eventType - Optional name of the event whose registered\n   *   listeners to remove\n   */\n\n  BaseEventEmitter.prototype.removeAllListeners = function removeAllListeners(eventType) {\n    this._subscriber.removeAllSubscriptions(eventType);\n  };\n\n  /**\n   * Provides an API that can be called during an eventing cycle to remove the\n   * last listener that was invoked. This allows a developer to provide an event\n   * object that can remove the listener (or listener map) during the\n   * invocation.\n   *\n   * If it is called when not inside of an emitting cycle it will throw.\n   *\n   * @throws {Error} When called not during an eventing cycle\n   *\n   * @example\n   *   var subscription = emitter.addListenerMap({\n   *     someEvent: function(data, event) {\n   *       console.log(data);\n   *       emitter.removeCurrentListener();\n   *     }\n   *   });\n   *\n   *   emitter.emit('someEvent', 'abc'); // logs 'abc'\n   *   emitter.emit('someEvent', 'def'); // does not log anything\n   */\n\n  BaseEventEmitter.prototype.removeCurrentListener = function removeCurrentListener() {\n    !!!this._currentSubscription ? process.env.NODE_ENV !== 'production' ? invariant(false, 'Not in an emitting cycle; there is no current subscription') : invariant(false) : undefined;\n    this._subscriber.removeSubscription(this._currentSubscription);\n  };\n\n  /**\n   * Returns an array of listeners that are currently registered for the given\n   * event.\n   *\n   * @param {string} eventType - Name of the event to query\n   * @return {array}\n   */\n\n  BaseEventEmitter.prototype.listeners = function listeners(eventType) /* TODO: Array<EventSubscription> */{\n    var subscriptions = this._subscriber.getSubscriptionsForType(eventType);\n    return subscriptions ? subscriptions.filter(emptyFunction.thatReturnsTrue).map(function (subscription) {\n      return subscription.listener;\n    }) : [];\n  };\n\n  /**\n   * Emits an event of the given type with the given data. All handlers of that\n   * particular type will be notified.\n   *\n   * @param {string} eventType - Name of the event to emit\n   * @param {*} Arbitrary arguments to be passed to each registered listener\n   *\n   * @example\n   *   emitter.addListener('someEvent', function(message) {\n   *     console.log(message);\n   *   });\n   *\n   *   emitter.emit('someEvent', 'abc'); // logs 'abc'\n   */\n\n  BaseEventEmitter.prototype.emit = function emit(eventType) {\n    var subscriptions = this._subscriber.getSubscriptionsForType(eventType);\n    if (subscriptions) {\n      var keys = Object.keys(subscriptions);\n      for (var ii = 0; ii < keys.length; ii++) {\n        var key = keys[ii];\n        var subscription = subscriptions[key];\n        // The subscription may have been removed during this event loop.\n        if (subscription) {\n          this._currentSubscription = subscription;\n          this.__emitToSubscription.apply(this, [subscription].concat(Array.prototype.slice.call(arguments)));\n        }\n      }\n      this._currentSubscription = null;\n    }\n  };\n\n  /**\n   * Provides a hook to override how the emitter emits an event to a specific\n   * subscription. This allows you to set up logging and error boundaries\n   * specific to your environment.\n   *\n   * @param {EmitterSubscription} subscription\n   * @param {string} eventType\n   * @param {*} Arbitrary arguments to be passed to each registered listener\n   */\n\n  BaseEventEmitter.prototype.__emitToSubscription = function __emitToSubscription(subscription, eventType) {\n    var args = Array.prototype.slice.call(arguments, 2);\n    subscription.listener.apply(subscription.context, args);\n  };\n\n  return BaseEventEmitter;\n})();\n\nmodule.exports = BaseEventEmitter;","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule EventSubscription\n * @typechecks\n */\n\n'use strict';\n\n/**\n * EventSubscription represents a subscription to a particular event. It can\n * remove its own subscription.\n */\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\nvar EventSubscription = (function () {\n\n  /**\n   * @param {EventSubscriptionVendor} subscriber the subscriber that controls\n   *   this subscription.\n   */\n\n  function EventSubscription(subscriber) {\n    _classCallCheck(this, EventSubscription);\n\n    this.subscriber = subscriber;\n  }\n\n  /**\n   * Removes this subscription from the subscriber that controls it.\n   */\n\n  EventSubscription.prototype.remove = function remove() {\n    if (this.subscriber) {\n      this.subscriber.removeSubscription(this);\n      this.subscriber = null;\n    }\n  };\n\n  return EventSubscription;\n})();\n\nmodule.exports = EventSubscription;","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n * \n * @providesModule EventSubscriptionVendor\n * @typechecks\n */\n\n'use strict';\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\nvar invariant = require('fbjs/lib/invariant');\n\n/**\n * EventSubscriptionVendor stores a set of EventSubscriptions that are\n * subscribed to a particular event type.\n */\n\nvar EventSubscriptionVendor = (function () {\n  function EventSubscriptionVendor() {\n    _classCallCheck(this, EventSubscriptionVendor);\n\n    this._subscriptionsForType = {};\n    this._currentSubscription = null;\n  }\n\n  /**\n   * Adds a subscription keyed by an event type.\n   *\n   * @param {string} eventType\n   * @param {EventSubscription} subscription\n   */\n\n  EventSubscriptionVendor.prototype.addSubscription = function addSubscription(eventType, subscription) {\n    !(subscription.subscriber === this) ? process.env.NODE_ENV !== 'production' ? invariant(false, 'The subscriber of the subscription is incorrectly set.') : invariant(false) : undefined;\n    if (!this._subscriptionsForType[eventType]) {\n      this._subscriptionsForType[eventType] = [];\n    }\n    var key = this._subscriptionsForType[eventType].length;\n    this._subscriptionsForType[eventType].push(subscription);\n    subscription.eventType = eventType;\n    subscription.key = key;\n    return subscription;\n  };\n\n  /**\n   * Removes a bulk set of the subscriptions.\n   *\n   * @param {?string} eventType - Optional name of the event type whose\n   *   registered supscriptions to remove, if null remove all subscriptions.\n   */\n\n  EventSubscriptionVendor.prototype.removeAllSubscriptions = function removeAllSubscriptions(eventType) {\n    if (eventType === undefined) {\n      this._subscriptionsForType = {};\n    } else {\n      delete this._subscriptionsForType[eventType];\n    }\n  };\n\n  /**\n   * Removes a specific subscription. Instead of calling this function, call\n   * `subscription.remove()` directly.\n   *\n   * @param {object} subscription\n   */\n\n  EventSubscriptionVendor.prototype.removeSubscription = function removeSubscription(subscription) {\n    var eventType = subscription.eventType;\n    var key = subscription.key;\n\n    var subscriptionsForType = this._subscriptionsForType[eventType];\n    if (subscriptionsForType) {\n      delete subscriptionsForType[key];\n    }\n  };\n\n  /**\n   * Returns the array of subscriptions that are currently registered for the\n   * given event type.\n   *\n   * Note: This array can be potentially sparse as subscriptions are deleted\n   * from it when they are removed.\n   *\n   * TODO: This returns a nullable array. wat?\n   *\n   * @param {string} eventType\n   * @return {?array}\n   */\n\n  EventSubscriptionVendor.prototype.getSubscriptionsForType = function getSubscriptionsForType(eventType) {\n    return this._subscriptionsForType[eventType];\n  };\n\n  return EventSubscriptionVendor;\n})();\n\nmodule.exports = EventSubscriptionVendor;","\"use strict\";\n\n/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n */\n\nfunction makeEmptyFunction(arg) {\n  return function () {\n    return arg;\n  };\n}\n\n/**\n * This function accepts and discards inputs; it has no side effects. This is\n * primarily useful idiomatically for overridable function endpoints which\n * always need to be callable, since JS lacks a null-call idiom ala Cocoa.\n */\nvar emptyFunction = function emptyFunction() {};\n\nemptyFunction.thatReturns = makeEmptyFunction;\nemptyFunction.thatReturnsFalse = makeEmptyFunction(false);\nemptyFunction.thatReturnsTrue = makeEmptyFunction(true);\nemptyFunction.thatReturnsNull = makeEmptyFunction(null);\nemptyFunction.thatReturnsThis = function () {\n  return this;\n};\nemptyFunction.thatReturnsArgument = function (arg) {\n  return arg;\n};\n\nmodule.exports = emptyFunction;"],"sourceRoot":""}