<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ConnectyCube Video Chat VanillaJS code sample</title>

    <link rel="icon" type="image/png" sizes="32x32" href="https://connectycube.com/wp-content/themes/connectycube2019/favicon/favicon-32x32.png" />
    <link rel="icon"  type="image/png" sizes="16x16"  href="https://connectycube.com/wp-content/themes/connectycube2019/favicon/favicon-16x16.png" />

    <script type="module" src="/src/index.js"></script>
  </head>

  <body x-data="app">
    <!-- LOGIN SCREEN -->
    <section id="login" x-show="$store.ui.screen==='login'" class="mx-auto">
      <div class="flex flex-col items-center justify-center">
        <img src="/logo.png" alt="ConnectyCube Logo" class="h-60 w-auto" />
        <h1 class="font-bold font-mono text-2xl">Video Chat (VanillaJS)</h1>
        <div class="h-20 flex items-center">
          <div x-show="$store.ui.isLoggingIn" class="flex flex-row items-center gap-1 font-mono">
            <span>Connecting...</span>
            <img src="/spinner.svg" alt="Connecting..." class="size-5" />
          </div>
        </div>
      </div>

      <div class="flex flex-col gap-2 p-8">
        <template x-for="user in $store.users.users" :key="user.id">
          <button
            type="button"
            class="text-white font-medium rounded-full text-xl px-8 py-4 text-center me-2 cursor-pointer bg-gradient-to-r hover:bg-gradient-to-br focus:ring-4 focus:outline-none"
            :class="user.buttonStyle"
            @click="login(user)"
            x-text="`Login as ${user.name}`"
          ></button>
        </template>
      </div>
    </section>

    <!-- SELECT USERS SCREEN -->
    <section id="select" x-show="$store.ui.screen==='select'" class="mx-auto flex flex-col items-center justify-center gap-16">
      <h2 class="font-bold font-mono text-xl">Logged in as: <span x-text="$store.users.current.name" class="font-bold underline"></span></h2>
      <h2 class="font-bold font-mono text-xl">Select users to start a call:</h2>

      <div class="flex flex-col gap-2">
        <template x-for="userToSelect in $store.users.toSelect" :key="userToSelect.id">
          <label :for="`checkbox-${userToSelect.id}`" class="px-8 py-4 rounded-full cursor-pointer text-xl font-bold text-white bg-blue-800 hover:bg-blue-600 transform duration-300 flex flex-row items-center justify-around gap-10">
            <span x-text="userToSelect.name"></span>
            <input
              type="checkbox"
              class=""
              :id="`checkbox-${userToSelect.id}`"
              :value="userToSelect.id"
              x-model="$store.users.selected"
            />
          </label>
        </template>
      </div>

      <div class="flex flex-row items-center justify-center gap-12">
        <button type="button" class="p-2 rounded-full text-white bg-green-800 hover:bg-green-600 transform duration-300 cursor-pointer" @click="startAudioCall">
          <i data-lucide="phone" class="size-8 m-1"></i>
        </button>
        <button type="button" class="p-2 rounded-full text-white bg-green-800 hover:bg-green-600 transform duration-300 cursor-pointer" @click="startVideoCall">
          <i data-lucide="video" class="size-8 m-1"></i>
        </button>
        <button type="button" class="p-2 rounded-full text-white bg-red-800 hover:bg-red-600 transform duration-300 cursor-pointer" @click="logout">
          <i data-lucide="log-out" class="size-8 m-1"></i>
        </button>
      </div>

      <div class="fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center justify-center p-8 rounded-lg gap-8 bg-blue-950 border border-blue-800"
        x-show="$store.ui.isIncomingCall"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 scale-80"
        x-transition:enter-end="opacity-100 scale-100"
        x-transition:leave="transition ease-in duration-300"
        x-transition:leave-start="opacity-100 scale-100"
        x-transition:leave-end="opacity-0 scale-80">
        <span class="text-xl text-white font-mono">
          <span x-text="$store.ui.incomingCallText" class="font-medium"></span>
          <span x-text="$store.ui.incomingCallUserName" class="font-bold"></span>
        </span>
        <div class="flex flex-row items-center justify-center gap-8">
          <button type="button" @click="acceptCall" class="text-lg font-bold font-mono px-4 py-2 rounded-full text-white bg-green-600 hover:bg-green-500 transform duration-300 cursor-pointer border border-green-400">Accept</button>
          <button type="button" @click="rejectCall" class="text-lg font-bold font-mono px-4 py-2 rounded-full text-white bg-red-600 hover:bg-red-500 transform duration-300 cursor-pointer border border-red-400">Reject</button>
        </div>
      </div>
    </section>

      <!-- CALL SCREEN -->
      <section id="videochat" x-show="$store.ui.screen==='videochat'" class="size-full flex flex-col items-center bg-gray-950">
        <div class="h-[calc(100%-5rem)] w-auto max-w-[1440px] mx-auto grid gap-1" :class="$store.users.opponentsSize === 0 ? 'grid-cols-1 grid-rows-1' : $store.users.opponentsSize === 1 ? 'grid-cols-1 grid-rows-2' : 'grid-cols-2 grid-rows-2'">
          <template x-for="opponent in $store.users.opponentsArray" :key="opponent.id">
            <div class="size-full relative bg-gray-900">
              <video playsinline :id="`remoteStream-${opponent.id}`" class="size-full object-contain"></video>
              <div class="absolute top-0 left-0 px-2 py-0.5 w-full flex flex-row items-center justify-center gap-2 text-sm bg-gray-600/50">
                <span x-text="opponent.name" class="font-mono font-semibold text-white"></span>
                <img x-show="!opponent.stream" src="/spinner.svg" alt="Waiting..." class="size-4" />
              </div>
            </div>
          </template>

          <div class="size-full relative bg-gray-900" :class="$store.users.opponentsSize === 2 ? 'col-span-2' : ''">
            <video playsinline id="localStream" class="size-full object-contain"></video>
            <div class="absolute top-0 left-0 px-2 py-0.5 w-full flex flex-row items-center justify-center text-sm bg-gray-600/50">
              <span class="font-mono font-semibold text-md text-white">Me</span>
            </div>
          </div>
        </div>

        <div class="flex flex-row items-center justify-center gap-4 py-4 z-10">
          <button class="p-2 rounded-full text-white bg-yellow-600 hover:bg-yellow-500 transform duration-300 cursor-pointer" @click="toggleAudioMute">
            <i x-show="!$store.ui.isAudioMuted" data-lucide="mic" class="size-6 m-0.5"></i>
            <i x-show="$store.ui.isAudioMuted" data-lucide="mic-off" class="size-6 m-0.5"></i>
          </button>
          <button class="p-2 rounded-full text-white bg-blue-600 hover:bg-blue-500 transform duration-300 cursor-pointer" @click="toggleVideoMute">
            <i x-show="!$store.ui.isVideoMuted" data-lucide="video" class="size-6 m-0.5"></i>
            <i x-show="$store.ui.isVideoMuted" data-lucide="video-off" class="size-6 m-0.5"></i>
          </button>
          <button class="p-2 rounded-full text-white bg-red-600 hover:bg-red-500 transform duration-300 cursor-pointer" @click="stopCall">
            <i data-lucide="phone" class="size-6 m-0.5 rotate-135"></i>
          </button>
          <button class="p-2 rounded-full text-white bg-orange-600 hover:bg-orange-500 transform duration-300 cursor-pointer disabled:cursor-not-allowed" @click="switchCamera" :disabled="$store.ui.isSwitchCameraDisabled">
            <i data-lucide="switch-camera" class="size-6 m-0.5"></i>
          </button>
          <button class="p-2 rounded-full text-white bg-purple-600 hover:bg-purple-500 transform duration-300 cursor-pointer disabled:cursor-not-allowed" @click="screenShare" :disabled="$store.ui.isScreenShareDisabled">
            <i x-show="!$store.ui.isScreenShare"  data-lucide="screen-share" class="size-6 m-0.5"></i>
            <i x-show="$store.ui.isScreenShare"  data-lucide="screen-share-off" class="size-6 m-0.5"></i>
          </button>
        </div>
      </section>
      
      <!-- TOAST -->
      <div x-show="$store.toast.visible" x-text="$store.toast.message" class="fixed left-1/2 top-10 -translate-x-1/2 min-w-72 p-4 z-1 bg-gray-800 text-white text-center rounded-lg"></div>

      <!-- SOUNDS -->
      <audio x-ref="signalEnd" preload="auto"><source src="/audio/end_call.mp3" type="audio/mp3" /></audio>
      <audio x-ref="signalOut" loop preload="auto"><source src="/audio/dialing.mp3" type="audio/mp3" /></audio>
      <audio x-ref="signalIn" loop preload="auto"><source src="/audio/calling.mp3" type="audio/mp3" /></audio>
  </body>
</html>
